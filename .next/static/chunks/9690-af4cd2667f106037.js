"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9690],{69690:function(e,a,s){s.d(a,{Z:function(){return m}});var t=s(57437),r=s(2265),n=s(27648),i=s(99376),c=s(22252),l=s(91723),o=s(66901),d=s(94766),u=s(17985);function h(){let[e,a]=(0,r.useState)([]),[s,n]=(0,r.useState)(0),[i,h]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1);async function f(){try{x(!0);let e=await u.L.authenticatedFetch("/api/notifications"),s=await e.json();s.ok&&(a(s.notifications),n(s.unreadCount))}catch(e){console.error("Error loading notifications:",e)}finally{x(!1)}}async function g(e){try{await u.L.authenticatedFetch("/api/notifications/mark-read",{method:"POST",body:JSON.stringify({notificationIds:e})}),a(a=>a.map(a=>e.includes(a.id)?{...a,read:!0}:a)),n(a=>Math.max(0,a-e.length))}catch(e){console.error("Error marking notifications as read:",e)}}return(0,r.useEffect)(()=>{f();let e=setInterval(f,3e4);return()=>clearInterval(e)},[]),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>{h(!i),i||f()},className:"relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,t.jsx)(d.Z,{className:"w-5 h-5"}),s>0&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:s>99?"99+":s})]}),i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)}),(0,t.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-96 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 bg-gray-50",children:[(0,t.jsxs)("h3",{className:"font-medium text-gray-800 flex items-center gap-2",children:[(0,t.jsx)(d.Z,{className:"w-4 h-4"}),"Notificaciones",s>0&&(0,t.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:s})]}),s>0&&(0,t.jsx)("button",{onClick:()=>g(e.filter(e=>!e.read).map(e=>e.id)),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Marcar todas como le\xeddas"})]}),(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto",children:m?(0,t.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),"Cargando..."]}):0===e.length?(0,t.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,t.jsx)(d.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),(0,t.jsx)("p",{className:"text-sm",children:"No hay notificaciones"})]}):e.map(e=>(0,t.jsx)("div",{className:"p-3 border-l-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ".concat(function(e){switch(e){case"high":return"border-l-red-400 bg-red-50";case"medium":return"border-l-yellow-400 bg-yellow-50";case"low":return"border-l-gray-400 bg-gray-50";default:return"border-l-gray-300 bg-white"}}(e.priority)," ").concat(e.read?"":"bg-blue-50"),onClick:()=>{e.read||g([e.id])},children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-1",children:function(e,a){switch(e){case"apa_uploaded":return(0,t.jsx)(c.Z,{className:"w-4 h-4 ".concat("high"===a?"text-red-500":"text-blue-500")});case"apa_required":return(0,t.jsx)(l.Z,{className:"w-4 h-4 text-yellow-500"});case"apa_status_change":return(0,t.jsx)(o.Z,{className:"w-4 h-4 text-green-500"});default:return(0,t.jsx)(d.Z,{className:"w-4 h-4 text-gray-500"})}}(e.type,e.priority)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-800 leading-tight",children:e.title}),!e.read&&(0,t.jsx)("div",{className:"flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1 leading-relaxed",children:e.message}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:function(e){let a=new Date,s=new Date(e),t=a.getTime()-s.getTime(),r=Math.floor(t/6e4),n=Math.floor(t/36e5),i=Math.floor(t/864e5);return r<1?"Ahora mismo":r<60?"Hace ".concat(r," min"):n<24?"Hace ".concat(n," h"):i<7?"Hace ".concat(i," d\xeda").concat(i>1?"s":""):s.toLocaleDateString("es-ES")}(e.date)})]})]})},e.id))}),e.length>0&&(0,t.jsx)("div",{className:"p-2 border-t border-gray-200 bg-gray-50",children:(0,t.jsx)("button",{onClick:()=>{h(!1)},className:"w-full text-xs text-gray-600 hover:text-gray-800 py-2 text-center",children:"Ver todas las notificaciones"})})]})]})]})}var m=e=>{let{children:a}=e,[s,c]=(0,r.useState)(null),[l,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!0),m=(0,i.useRouter)(),x=(0,i.usePathname)();(0,r.useEffect)(()=>{!async function(){try{let e=await fetch("/api/auth/profile",{cache:"no-store"}),a=await e.json();if(a.ok)c(a.user),o(a.setup||!1);else{m.push("/login");return}}catch(e){console.error("Error loading profile:",e),m.push("/login");return}finally{u(!1)}}()},[m]);let f=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),m.push("/login")}catch(e){console.error("Logout error:",e),m.push("/login")}};return d?(0,t.jsx)("div",{className:"min-h-screen grid place-items-center",children:(0,t.jsx)("div",{className:"text-gray-700 text-sm",children:"Cargando..."})}):s?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,t.jsxs)("header",{className:"bg-white shadow-sm border-b",children:[(0,t.jsx)("div",{className:"px-6 py-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Garden Club Paraguayo"}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"|"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:s.nombre})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h,{}),(0,t.jsx)(n.default,{href:"/admin/configuracion-sistema",className:"flex items-center",children:(0,t.jsx)("span",{className:"material-icons text-gray-600 hover:text-blue-600 cursor-pointer text-2xl",style:{fontSize:24},title:"Configuraci\xf3n",children:"⚙"})}),(0,t.jsx)("button",{onClick:f,className:"text-sm text-gray-600 hover:text-gray-800 px-3 py-1 rounded hover:bg-gray-100",children:"Cerrar Sesi\xf3n"})]})]})}),(0,t.jsx)("nav",{className:"px-6 py-2 bg-gray-50 border-t",children:(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/dashboard",children:[(0,t.jsx)("span",{children:"\uD83D\uDCCA"}),"Dashboard"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/socios",children:[(0,t.jsx)("span",{children:"\uD83D\uDC65"}),"Socios"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/reservas",children:[(0,t.jsx)("span",{children:"\uD83D\uDDD3️"}),"Reservas"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/servicios",children:[(0,t.jsx)("span",{children:"\uD83D\uDECE️"}),"Servicios"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/cobradores",children:[(0,t.jsx)("span",{children:"\uD83D\uDC64"}),"Cobradores"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/cobranzas",children:[(0,t.jsx)("span",{children:"\uD83D\uDCB0"}),"Cobranzas"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/admin/usuarios",children:[(0,t.jsx)("span",{children:"\uD83D\uDD10"}),"Usuarios"]}),(0,t.jsxs)(n.default,{className:"menu-item",href:"/porteria",children:[(0,t.jsx)("span",{children:"\uD83D\uDEAA"}),"Porter\xeda"]})]})})]}),(0,t.jsx)("main",{className:"flex-1 min-h-screen",style:"/admin/dashboard"===x?{backgroundImage:"url(/fondoapp.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed"}:{backgroundColor:"#f9fafb"},children:(0,t.jsxs)("div",{className:"p-6",children:[l&&(0,t.jsxs)("div",{className:"mb-4 p-3 rounded bg-yellow-100 border border-yellow-300 text-sm",children:[(0,t.jsx)("b",{children:"Modo configuraci\xf3n:"})," No hay usuarios creados. Crea el primer usuario en"," ",(0,t.jsx)(n.default,{href:"/admin/usuarios",className:"underline",children:"Usuarios"})," para habilitar el login."]}),a]})})]}):(0,t.jsx)("div",{className:"min-h-screen grid place-items-center",children:(0,t.jsx)("div",{className:"text-red-600 text-sm",children:"No autenticado. Redirigiendo..."})})}},17985:function(e,a,s){s.d(a,{L:function(){return n}});var t=s(64131);let r="gcp_token";class n{static async authenticatedFetch(e){var a;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.Z.get(r),i=new Headers(s.headers||{}),c=s.body,l="undefined"!=typeof FormData&&c instanceof FormData,o="undefined"!=typeof URLSearchParams&&c instanceof URLSearchParams;return l||o?i.has("Content-Type")&&i.delete("Content-Type"):i.has("Content-Type")||i.set("Content-Type","application/json"),n&&i.set("Authorization","Bearer ".concat(n)),fetch(e,{...s,headers:i,credentials:null!==(a=s.credentials)&&void 0!==a?a:"include"})}static getToken(){return t.Z.get(r)}static removeToken(){t.Z.remove(r)}static isAuthenticated(){return!!this.getToken()}}}}]);