(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2443],{37419:function(e,r,a){Promise.resolve().then(a.bind(a,87711))},87711:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return d}});var o=a(57437),s=a(69690),t=a(17985),i=a(2265),l=a(99376),n=a(32660),c=a(27648);function d(){let e=(0,l.useParams)(),r=(0,l.useRouter)(),[a,d]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!0),[x,g]=(0,i.useState)(""),[p,f]=(0,i.useState)(null),[b,h]=(0,i.useState)([]),[y,j]=(0,i.useState)({nombres:"",apellidos:"",ci:"",telefono:"",celular:"",direccion:"",email:"",tipoCobrador:"EXTERNO",comisionPorDefecto:"12.5",formasPago:["efectivo"],cuentaBanco:"",activo:!0}),v=b.some(r=>"CLUB"===r.tipoCobrador&&r.id!==e.id),N=e=>{j(r=>{let a=r.formasPago;return a.includes(e)?{...r,formasPago:a.length>1?a.filter(r=>r!==e):a}:{...r,formasPago:[...a,e]}})};async function C(){try{let e=await t.L.authenticatedFetch("/api/collectors"),r=await e.json();h(Array.isArray(r)?r:[])}catch(e){console.error("Error loading collectors:",e),h([])}}async function P(){try{let a=await t.L.authenticatedFetch("/api/collectors/".concat(e.id)),o=await a.json();if(a.ok){var r;let e;f(o),e=Array.isArray(o.formaPago)?o.formaPago:o.formaPago?[o.formaPago]:["efectivo"],j({nombres:o.nombres,apellidos:o.apellidos,ci:o.ci,telefono:o.telefono||"",celular:o.celular||"",direccion:o.direccion||"",email:o.email||"",tipoCobrador:o.tipoCobrador||"EXTERNO",comisionPorDefecto:(null===(r=o.comisionPorDefecto)||void 0===r?void 0:r.toString())||"12.5",formasPago:e,cuentaBanco:o.cuentaBanco||"",activo:o.activo})}else g("Cobrador no encontrado")}catch(e){g("Error al cargar cobrador")}finally{u(!1)}}(0,i.useEffect)(()=>{e.id&&(P(),C())},[e.id]);let E=async a=>{a.preventDefault(),g(""),d(!0);try{let a={...y,comisionPorDefecto:"EXTERNO"===y.tipoCobrador||"PROFESOR"===y.tipoCobrador?parseFloat(y.comisionPorDefecto):void 0},o=await t.L.authenticatedFetch("/api/collectors/".concat(e.id),{method:"PATCH",body:JSON.stringify(a)}),s=await o.json();o.ok?r.push("/admin/cobradores/".concat(e.id)):g(s.msg||"Error al actualizar cobrador")}catch(e){g("Error de conexi\xf3n")}finally{d(!1)}};return m?(0,o.jsx)(s.Z,{children:(0,o.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})})}):p?(0,o.jsx)(s.Z,{children:(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[(0,o.jsx)(c.default,{href:"/admin/cobradores/".concat(e.id),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,o.jsx)(n.Z,{className:"w-5 h-5"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Editar Cobrador"}),(0,o.jsx)("p",{className:"text-gray-600",children:"Modifica la informaci\xf3n del cobrador"})]})]}),x&&(0,o.jsx)("div",{className:"p-4 rounded-lg ".concat(x.includes("Error")?"bg-red-50 text-red-800 border border-red-200":"bg-green-50 text-green-800 border border-green-200"),children:x}),(0,o.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,o.jsxs)("form",{onSubmit:E,className:"p-6 space-y-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n Personal"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombres *"}),(0,o.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.nombres,onChange:e=>j(r=>({...r,nombres:e.target.value})),disabled:"CLUB"===y.tipoCobrador}),"CLUB"===y.tipoCobrador&&(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\uD83D\uDCCC Nombre predeterminado para cobrador institucional"})]}),"CLUB"!==y.tipoCobrador&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos *"}),(0,o.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.apellidos,onChange:e=>j(r=>({...r,apellidos:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xe9dula de Identidad *"}),(0,o.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.ci,onChange:e=>j(r=>({...r,ci:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,o.jsx)("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.email,onChange:e=>j(r=>({...r,email:e.target.value}))})]})]})]})]}),"CLUB"!==y.tipoCobrador&&(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n de Contacto"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,o.jsx)("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.telefono,onChange:e=>j(r=>({...r,telefono:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Celular"}),(0,o.jsx)("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.celular,onChange:e=>j(r=>({...r,celular:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Direcci\xf3n"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.direccion,onChange:e=>j(r=>({...r,direccion:e.target.value}))})]})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Tipo de Cobrador y Comisiones"}),(0,o.jsx)("div",{className:"space-y-4",children:(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Cobrador *"}),(0,o.jsxs)("select",{required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.tipoCobrador,onChange:e=>j(r=>({...r,tipoCobrador:e.target.value})),children:[(0,o.jsx)("option",{value:"EXTERNO",children:"Externo"}),(0,o.jsx)("option",{value:"PROFESOR",children:"Profesor"}),(!v||"CLUB"===y.tipoCobrador)&&(0,o.jsx)("option",{value:"CLUB",children:"Garden Club"})]})]}),("EXTERNO"===y.tipoCobrador||"PROFESOR"===y.tipoCobrador)&&(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comisi\xf3n % *"}),(0,o.jsx)("input",{type:"number",required:"EXTERNO"===y.tipoCobrador||"PROFESOR"===y.tipoCobrador,min:"0",max:"100",step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.comisionPorDefecto,onChange:e=>j(r=>({...r,comisionPorDefecto:e.target.value})),placeholder:"12.5"})]})]})})]}),"CLUB"!==y.tipoCobrador&&(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n de Pago"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Formas de Pago Aceptadas * ",(0,o.jsx)("span",{className:"text-xs text-gray-500",children:"(Seleccione al menos una)"})]}),(0,o.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,o.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,o.jsx)("input",{type:"checkbox",checked:y.formasPago.includes("efectivo"),onChange:()=>N("efectivo"),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),(0,o.jsx)("span",{className:"text-sm text-gray-700",children:"Efectivo"})]}),(0,o.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,o.jsx)("input",{type:"checkbox",checked:y.formasPago.includes("transferencia"),onChange:()=>N("transferencia"),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),(0,o.jsx)("span",{className:"text-sm text-gray-700",children:"Transferencia"})]}),(0,o.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,o.jsx)("input",{type:"checkbox",checked:y.formasPago.includes("cheque"),onChange:()=>N("cheque"),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),(0,o.jsx)("span",{className:"text-sm text-gray-700",children:"Cheque"})]})]}),0===y.formasPago.length&&(0,o.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Debe seleccionar al menos una forma de pago"})]}),y.formasPago.includes("transferencia")&&(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cuenta Bancaria"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:y.cuentaBanco,onChange:e=>j(r=>({...r,cuentaBanco:e.target.value}))})]})]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado"}),(0,o.jsx)("div",{children:(0,o.jsxs)("label",{className:"flex items-center",children:[(0,o.jsx)("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:y.activo,onChange:e=>j(r=>({...r,activo:e.target.checked}))}),(0,o.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Cobrador Activo"})]})})]}),(0,o.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[(0,o.jsx)(c.default,{href:"/admin/cobradores/".concat(e.id),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",disabled:a,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 disabled:opacity-50",children:a?"Guardando...":"Guardar Cambios"})]})]})})]})}):(0,o.jsx)(s.Z,{children:(0,o.jsxs)("div",{className:"text-center py-12",children:[(0,o.jsx)("div",{className:"text-gray-500",children:"Cobrador no encontrado"}),(0,o.jsx)(c.default,{href:"/admin/cobradores",className:"text-primary-600 hover:text-primary-800 mt-4 inline-block",children:"← Volver a Cobradores"})]})})}},32660:function(e,r,a){"use strict";a.d(r,{Z:function(){return o}});let o=(0,a(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])}},function(e){e.O(0,[3643,9690,2971,2117,1744],function(){return e(e.s=37419)}),_N_E=e.O()}]);