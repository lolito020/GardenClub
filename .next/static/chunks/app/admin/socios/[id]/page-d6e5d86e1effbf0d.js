(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3137,8592],{55954:function(e,t,a){Promise.resolve().then(a.bind(a,93673))},93673:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var s=a(57437),r=a(69690),i=a(17985),n=a(2265),l=a(99376),o=a(94508),c=a(32660),d=a(94630),m=a(92369),x=a(88226),u=a(39763);let h=(0,u.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var p=a(95805),g=a(99397),b=a(48736),y=a(32489),j=a(27648),f=a(98592),v=a(22252),N=a(66901),w=a(31047);function C(e){let{open:t,onClose:a,memberId:r,memberName:l,memberCode:c,onSuccess:d}=e,m=new Date().getFullYear(),[x,u]=(0,n.useState)(m),[h,p]=(0,n.useState)(!1),[g,b]=(0,n.useState)(!1),[j,f]=(0,n.useState)(!1),[C,D]=(0,n.useState)(null),[E,S]=(0,n.useState)(""),[A,k]=(0,n.useState)("");async function T(){b(!0),S(""),k(""),D(null);try{let e=await i.L.authenticatedFetch("/api/members/".concat(r,"/generate-annual-quotas?year=").concat(x)),t=await e.json();e.ok?D(t.analysis):S(t.msg||"Error al analizar cuotas")}catch(e){S("Error de conexi\xf3n al analizar cuotas"),console.error(e)}finally{b(!1)}}async function I(){if(C&&C.canGenerate){f(!0),S(""),k("");try{let e=await i.L.authenticatedFetch("/api/members/".concat(r,"/generate-annual-quotas"),{method:"POST",body:JSON.stringify({year:x})}),t=await e.json();e.ok?(k(t.msg),setTimeout(()=>{d(),a()},1500)):S(t.msg||"Error al generar cuotas")}catch(e){S("Error de conexi\xf3n al generar cuotas"),console.error(e)}finally{f(!1)}}}function P(){j||(a(),S(""),k(""),D(null))}return((0,n.useEffect)(()=>{t&&r&&T()},[t,r,x]),t)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white z-10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Generar Cuotas Sociales Anuales"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[l," (",c,")"]})]}),(0,s.jsx)("button",{onClick:P,disabled:j,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,s.jsx)(y.Z,{className:"w-6 h-6"})})]}),(0,s.jsxs)("div",{className:"px-6 py-4 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"A\xf1o"}),(0,s.jsx)("input",{type:"number",value:x,onChange:e=>u(parseInt(e.target.value)||m),disabled:j,min:2e3,max:2099,step:1,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Ej: 2025"})]}),g&&(0,s.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),(0,s.jsx)("span",{className:"ml-3 text-gray-600",children:"Analizando..."})]}),E&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(v.Z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,s.jsx)("p",{className:"text-sm text-red-700 mt-1",children:E})]})]}),A&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(N.Z,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-green-800",children:"\xa1\xc9xito!"}),(0,s.jsx)("p",{className:"text-sm text-green-700 mt-1",children:A})]})]}),C&&!g&&(0,s.jsxs)(s.Fragment,{children:[C.warnings.length>0&&(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(v.Z,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-yellow-800",children:"Advertencias"}),(0,s.jsx)("ul",{className:"mt-2 space-y-1",children:C.warnings.map((e,t)=>(0,s.jsxs)("li",{className:"text-sm text-yellow-700",children:["• ",e]},t))})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:["Estado de meses - ",x]}),(0,s.jsx)("div",{className:"grid grid-cols-6 gap-2",children:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map((e,t)=>{let a=t+1,r=C.existingDebits.find(e=>e.month===a),i=C.missingMonths.includes(a),n="bg-gray-100 text-gray-400 border-gray-200",l=null,o="N/A";return r?"CANCELADO"===r.status?(n="bg-green-100 text-green-700 border-green-300",l=(0,s.jsx)(N.Z,{className:"w-3 h-3"}),o="Pagado"):"PARCIAL"===r.status?(n="bg-yellow-100 text-yellow-700 border-yellow-300",l=(0,s.jsx)(v.Z,{className:"w-3 h-3"}),o="Parcial"):(n="bg-orange-100 text-orange-700 border-orange-300",l=(0,s.jsx)(v.Z,{className:"w-3 h-3"}),o="Pendiente"):i&&(n="bg-blue-50 text-blue-700 border-blue-200",l=(0,s.jsx)(w.Z,{className:"w-3 h-3"}),o="A crear"),(0,s.jsxs)("div",{className:"border rounded-lg p-2 text-center ".concat(n),title:o,children:[(0,s.jsx)("div",{className:"text-xs font-medium",children:e}),l&&(0,s.jsx)("div",{className:"flex justify-center mt-1",children:l})]},t)})})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Resumen"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Meses con d\xe9bitos"}),(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:C.existingDebits.length})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Meses a generar"}),(0,s.jsx)("p",{className:"font-semibold text-blue-700",children:C.monthsToGenerate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Monto por mes"}),(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:(0,o.xG)(C.totalAmountToGenerate/Math.max(C.monthsToGenerate,1))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Total a generar"}),(0,s.jsx)("p",{className:"font-semibold text-blue-700",children:(0,o.xG)(C.totalAmountToGenerate)})]})]})]}),!C.canGenerate&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(v.Z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-blue-800",children:"Informaci\xf3n"}),(0,s.jsxs)("p",{className:"text-sm text-blue-700 mt-1",children:["Ya existen d\xe9bitos para todos los meses de ",x,". No hay nada que generar."]})]})]})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[(0,s.jsx)("button",{onClick:P,disabled:j,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:I,disabled:!C||!C.canGenerate||j||g,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Generando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.Z,{className:"w-4 h-4"}),"Generar ",(null==C?void 0:C.monthsToGenerate)||0," Cuotas"]})})]})]})}):null}let D=(0,u.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var E=a(18930);function S(e){let{open:t,onClose:a,memberId:r,memberName:l,memberCode:c,onSuccess:d}=e,m=new Date().getFullYear(),[x,u]=(0,n.useState)(m),[h,p]=(0,n.useState)(!1),[g,b]=(0,n.useState)(null),[j,f]=(0,n.useState)(""),[v,w]=(0,n.useState)("");async function C(){if(confirm("\xbfEst\xe1 seguro de revertir las cuotas generadas para ".concat(x,"?\n\nSolo se eliminar\xe1n d\xe9bitos PENDIENTES. Los d\xe9bitos con pagos o refinanciados no se eliminar\xe1n."))){p(!0),f(""),w(""),b(null);try{let e=await i.L.authenticatedFetch("/api/members/".concat(r,"/generate-annual-quotas?year=").concat(x),{method:"DELETE"}),t=await e.json();e.ok?(w(t.msg),b(t.result),setTimeout(()=>{d(),a()},2e3)):f(t.msg||"Error al revertir cuotas")}catch(e){f("Error de conexi\xf3n al revertir cuotas"),console.error(e)}finally{p(!1)}}}function S(){h||(a(),f(""),w(""),b(null))}return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white z-10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Revertir Cuotas Anuales"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[l," (",c,")"]})]}),(0,s.jsx)("button",{onClick:S,disabled:h,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,s.jsx)(y.Z,{className:"w-6 h-6"})})]}),(0,s.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[!g&&!v&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"A\xf1o a revertir"}),(0,s.jsx)("input",{type:"number",value:x,onChange:e=>u(parseInt(e.target.value)||m),disabled:h,min:2e3,max:2099,step:1,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"Ej: 2025"})]}),!g&&!v&&(0,s.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(D,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-yellow-800",children:"Advertencia"}),(0,s.jsxs)("p",{className:"text-sm text-yellow-700 mt-1",children:["Esta acci\xf3n eliminar\xe1 todos los d\xe9bitos de cuota social PENDIENTES generados para el a\xf1o ",x,"."]}),(0,s.jsxs)("ul",{className:"mt-2 text-sm text-yellow-700 space-y-1",children:[(0,s.jsx)("li",{children:"• Los d\xe9bitos con pagos (PARCIAL o CANCELADO) no se eliminar\xe1n"}),(0,s.jsx)("li",{children:"• Los d\xe9bitos refinanciados no se eliminar\xe1n"}),(0,s.jsx)("li",{children:"• Esta acci\xf3n no se puede deshacer"})]})]})]}),j&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(D,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,s.jsx)("p",{className:"text-sm text-red-700 mt-1",children:j})]})]}),v&&(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[(0,s.jsx)(N.Z,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-green-800",children:"\xa1\xc9xito!"}),(0,s.jsx)("p",{className:"text-sm text-green-700 mt-1",children:v})]})]}),g&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Resumen"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"D\xe9bitos eliminados"}),(0,s.jsx)("p",{className:"font-semibold text-green-700",children:g.deleted})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600",children:"D\xe9bitos omitidos"}),(0,s.jsx)("p",{className:"font-semibold text-yellow-700",children:g.skipped})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Total revertido"}),(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:(0,o.xG)(g.totalReverted)})]})]})]}),g.deletedDebits.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:["D\xe9bitos eliminados (",g.deleted,")"]}),(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:g.deletedDebits.map(e=>(0,s.jsxs)("li",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-700",children:e.monthText||"Mes ".concat(e.month||"?")}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:(0,o.xG)(e.amount)})]},e.id))})})]}),g.skippedDebits.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:["D\xe9bitos omitidos (",g.skipped,")"]}),(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:g.skippedDebits.map(e=>(0,s.jsxs)("li",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-700",children:e.monthText||"Mes ".concat(e.month||"?")}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:(0,o.xG)(e.amount)})]}),(0,s.jsx)("p",{className:"text-xs text-yellow-700",children:e.reason})]},e.id))})})]})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50",children:[(0,s.jsx)("button",{onClick:S,disabled:h,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:g?"Cerrar":"Cancelar"}),!g&&!v&&(0,s.jsx)("button",{onClick:C,disabled:h,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Revirtiendo..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.Z,{className:"w-4 h-4"}),"Revertir Cuotas"]})})]})]})}):null}function A(e){let t=String(e||"").toUpperCase();return"DEBIT"===t||"DEBE"===t?"DEBIT":"CREDIT"===t||"HABER"===t?"CREDIT":"DEBIT"}function k(){var e,t;let a=(0,l.useParams)(),[u,v]=(0,n.useState)(null),[N,w]=(0,n.useState)([]),[D,E]=(0,n.useState)([]),[k,M]=(0,n.useState)([]),[L,F]=(0,n.useState)([]),[R,G]=(0,n.useState)(!0),[O,Z]=(0,n.useState)(null),[B,H]=(0,n.useState)(!1),[z,Y]=(0,n.useState)(!1),[U,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{_(!1)},[null==u?void 0:u.foto]);let[J,V]=(0,n.useState)(1),[q,$]=(0,n.useState)(10),[Q,W]=(0,n.useState)([]),[K,X]=(0,n.useState)(!0),[ee,et]=(0,n.useState)([]),[ea,es]=(0,n.useState)(!0),[er,ei]=(0,n.useState)(!1),[en,el]=(0,n.useState)([]),[eo,ec]=(0,n.useState)(!1),[ed,em]=(0,n.useState)(""),[ex,eu]=(0,n.useState)(""),[eh,ep]=(0,n.useState)(1),[eg,eb]=(0,n.useState)(10),[ey,ej]=(0,n.useState)(!1),[ef,ev]=(0,n.useState)(!1),[eN,ew]=(0,n.useState)(!1),[eC,eD]=(0,n.useState)(""),[eE,eS]=(0,n.useState)({nombres:"",apellidos:"",ci:"",parentesco:"",nacimiento:"",email:"",telefono:""}),[eA,ek]=(0,n.useState)(!1),[eT,eI]=(0,n.useState)(null),[eP,eM]=(0,n.useState)({fecha:"",concepto:"",tipo:"DEBIT",monto:"",observaciones:"",vencimiento:""}),[eL,eF]=(0,n.useState)(!1),[eR,eG]=(0,n.useState)(!1),[eO,eZ]=(0,n.useState)(null),[eB,eH]=(0,n.useState)({fecha:"",concepto:"",formaPago:"",numeroRecibo:"",monto:"",cobradorId:"",observaciones:""}),[ez,eY]=(0,n.useState)(!1),[eU,e_]=(0,n.useState)([]),[eJ,eV]=(0,n.useState)(!0),[eq,e$]=(0,n.useState)(""),[eQ,eW]=(0,n.useState)(""),[eK,eX]=(0,n.useState)("ALL"),[e0,e2]=(0,n.useState)("ALL"),[e1,e5]=(0,n.useState)(""),[e3,e4]=(0,n.useState)(1),[e6,e7]=(0,n.useState)(50),[e9,e8]=(0,n.useState)(!1),[te,tt]=(0,n.useState)(!1),[ta,ts]=(0,n.useState)(!1),[tr,ti]=(0,n.useState)(null),[tn,tl]=(0,n.useState)([]),[to,tc]=(0,n.useState)(!1),[td,tm]=(0,n.useState)(!1),[tx,tu]=(0,n.useState)(null),[th,tp]=(0,n.useState)({serviceId:"",price:"",periodicity:"MONTHLY",nextChargeDate:"",notes:""}),[tg,tb]=(0,n.useState)(!1),[ty,tj]=(0,n.useState)("");async function tf(){try{let[e,t,s]=await Promise.all([i.L.authenticatedFetch("/api/members/".concat(a.id)),i.L.authenticatedFetch("/api/services"),i.L.authenticatedFetch("/api/payments?memberId=".concat(a.id))]),[r,n,l]=await Promise.all([e.json(),t.json(),s.json()]);v(r),w(Array.isArray(n)?n:[]),E(Array.isArray(l)?l:[]),V(1)}catch(e){console.error("Error loading member data:",e)}finally{G(!1)}}async function tv(){try{let e=await i.L.authenticatedFetch("/api/collectors"),t=await e.json(),a=Array.isArray(t)?t:[];M(a.filter(e=>!1!==e.activo))}catch(e){console.error("Error loading collectors:",e),M([])}}async function tN(e){try{let t=await i.L.authenticatedFetch("/api/members/".concat(encodeURIComponent(e),"/subscriptions"));if(!t.ok){if(404===t.status){F([]);return}throw Error(await t.text())}let a=await t.json();F(Array.isArray(a)?a:Array.isArray(null==a?void 0:a.items)?a.items:[])}catch(e){console.error("No se pudieron cargar suscripciones",e),F([])}}async function tw(e){try{let t=await i.L.authenticatedFetch("/api/members/".concat(e,"/familiares")),a=t.headers.get("content-type")||"";if(!t.ok){let e=await t.text();throw Error("HTTP ".concat(t.status," - ").concat(e.slice(0,200)))}if(!a.includes("application/json")){let e=await t.text();throw Error("Respuesta no JSON - ".concat(e.slice(0,200)))}let s=await t.json();W(Array.isArray(s)?s:[])}catch(e){console.error("Error loading family members:",e),W([])}finally{X(!1)}}async function tC(e){eV(!0);try{let s=await i.L.authenticatedFetch("/api/members/".concat(e,"/movements?pageSize=1000"));s.ok||(s=await i.L.authenticatedFetch("/api/movements?memberId=".concat(encodeURIComponent(e))));let r=s.headers.get("content-type")||"";if(!s.ok){let e=r.includes("application/json")?await s.json():await s.text();throw Error("string"==typeof e?e:(null==e?void 0:e.msg)||"HTTP ".concat(s.status))}if(!r.includes("application/json")){let e=await s.text();throw Error("Respuesta no JSON - ".concat(e.slice(0,200)))}let n=await s.json(),l=(Array.isArray(n)?n:Array.isArray(null==n?void 0:n.items)?n.items:[]).map((t,a)=>{var s,r,i,n,l,o,c,d,m,x,u,h,p,g,b,y,j,f,v,N,w,C,D;return{id:String(null!==(i=t.id)&&void 0!==i?i:"".concat(e,"-").concat(null!==(r=null!==(s=t.fecha)&&void 0!==s?s:t.date)&&void 0!==r?r:Date.now(),"-").concat(a)),memberId:String(null!==(n=t.memberId)&&void 0!==n?n:e),fecha:null!==(c=null!==(o=null!==(l=t.fecha)&&void 0!==l?l:t.date)&&void 0!==o?o:t.createdAt)&&void 0!==c?c:new Date().toISOString(),concepto:null!==(m=null!==(d=t.concepto)&&void 0!==d?d:t.description)&&void 0!==m?m:"",tipo:A(null!==(u=null!==(x=t.tipo)&&void 0!==x?x:t.type)&&void 0!==u?u:""),monto:Number(null!==(p=null!==(h=t.monto)&&void 0!==h?h:t.amount)&&void 0!==p?p:0),origen:null!==(b=null!==(g=t.origen)&&void 0!==g?g:t.source)&&void 0!==b?b:void 0,refId:null!==(j=null!==(y=t.refId)&&void 0!==y?y:t.referenceId)&&void 0!==j?j:void 0,observaciones:null!==(v=null!==(f=t.observaciones)&&void 0!==f?f:t.notes)&&void 0!==v?v:"",paidAmount:Number(null!==(N=t.paidAmount)&&void 0!==N?N:0),status:t.status,vencimiento:null!==(C=null!==(w=t.vencimiento)&&void 0!==w?w:t.dueDate)&&void 0!==C?C:void 0,allocations:null!==(D=t.allocations)&&void 0!==D?D:void 0}}).filter(e=>""!==e.concepto),o=await i.L.authenticatedFetch("/api/payments?memberId=".concat(encodeURIComponent(e))),c=o.headers.get("content-type")||"",d=[];if(o.ok&&c.includes("application/json")){let e=await o.json();d=Array.isArray(e)?e:[]}let m=d.map((t,a)=>{var s;return{id:"pay-".concat(null!==(s=t.id)&&void 0!==s?s:"".concat(e,"-").concat(t.fecha,"-").concat(a)),memberId:e,fecha:t.fecha?new Date(t.fecha).toISOString():new Date().toISOString(),concepto:t.concepto&&String(t.concepto).trim()||"Pago".concat(t.formaPago?" "+t.formaPago:"").concat(t.numeroRecibo?" • Recibo ".concat(t.numeroRecibo):""),tipo:"CREDIT",monto:Number(t.monto)||0,origen:"PAGO",refId:t.id,observaciones:t.observaciones||""}}),x=[...l,...m];function t(e){let t=new Date(e.fecha).toISOString().slice(0,10);return"PAGO"===e.origen&&e.refId?"PAGO:".concat(e.refId):"MOV:".concat(t,":").concat(Number(e.monto),":").concat(e.concepto,":").concat(e.tipo,":").concat(e.id)}function a(e){let t=0;return"PAGO"===e.origen&&(t+=2),e.observaciones&&e.observaciones.trim()&&(t+=1),t}let u=new Map;for(let e of x){let s=t(e),r=u.get(s);(!r||a(e)>a(r))&&u.set(s,e)}let h=Array.from(u.values());if("m1"===e){console.log("\n=== DEBUG DEDUPLICACI\xd3N ==="),console.log("Movimientos antes deduplicaci\xf3n: ".concat(x.length)),console.log("Movimientos despu\xe9s deduplicaci\xf3n: ".concat(h.length)),console.log("\nMovimientos eliminados por deduplicaci\xf3n:");let e=new Set(h.map(e=>e.id));x.filter(t=>!e.has(t.id)).forEach(e=>{console.log("- ".concat(e.fecha," | ").concat(e.tipo," | ").concat(e.monto," | ").concat(e.concepto," | key: ").concat(t(e)))})}h.sort((e,t)=>new Date(e.fecha).getTime()-new Date(t.fecha).getTime()),e_(h)}catch(e){console.error("No se pudo cargar movimientos",e),e_([])}finally{eV(!1)}}async function tD(e){tc(!0),ti(e),ts(!0),tl([]);try{let t=eU.filter(t=>"CREDIT"===t.tipo&&Array.isArray(t.allocations)&&t.allocations.some(t=>t.debitId===e.id)).map(t=>{var a;let s=null===(a=t.allocations)||void 0===a?void 0:a.find(t=>t.debitId===e.id);return{id:t.id,fecha:t.fecha,concepto:t.concepto,monto:t.monto,allocatedAmount:(null==s?void 0:s.amount)||0,tipo:"CREDIT"}}),a=[];for(let t of D){let s=await i.L.authenticatedFetch("/api/payments/".concat(t.id));if(s.ok){let t=await s.json();if(Array.isArray(t.allocations)){let s=t.allocations.find(t=>t.debitId===e.id);s&&a.push({id:t.id,fecha:t.fecha,concepto:t.concepto,monto:t.monto,allocatedAmount:s.amount||0,formaPago:t.formaPago,numeroRecibo:t.numeroRecibo,tipo:"PAYMENT"})}}}let s=[...t,...a].sort((e,t)=>new Date(e.fecha).getTime()-new Date(t.fecha).getTime()),r=[];for(let e of s){let t=r.find(t=>t.concepto===e.concepto&&t.fecha===e.fecha&&t.monto===e.monto&&t.allocatedAmount===e.allocatedAmount);if(t){if("PAYMENT"===e.tipo&&"PAYMENT"!==t.tipo){let a=r.indexOf(t);r[a]=e}}else r.push(e)}tl(r)}catch(e){console.error("Error al cargar cr\xe9ditos relacionados:",e),tl([])}finally{tc(!1)}}async function tE(e){es(!0);try{let t=await i.L.authenticatedFetch("/api/members/".concat(e,"/attachments"));if(!t.ok){let e=await t.text();throw Error("HTTP ".concat(t.status," - ").concat(e.slice(0,200)))}let a=await t.json(),s=(Array.isArray(a)?a:Array.isArray(null==a?void 0:a.items)?a.items:[]).map(e=>{var t,a,s,r,i,n,l,o,c;return{id:e.id,memberId:e.memberId,name:null!==(s=null!==(a=null!==(t=e.name)&&void 0!==t?t:e.nombre)&&void 0!==a?a:e.filename)&&void 0!==s?s:"archivo",type:null!==(n=null!==(i=null!==(r=e.type)&&void 0!==r?r:e.mime)&&void 0!==i?i:e.mimetype)&&void 0!==n?n:"",size:Number(e.size)||0,url:e.url,uploadedAt:null!==(c=null!==(o=null!==(l=e.uploadedAt)&&void 0!==l?l:e.fecha)&&void 0!==o?o:e.createdAt)&&void 0!==c?c:new Date().toISOString()}});et(s),ep(1)}catch(e){console.error("No se pudo cargar adjuntos",e),et([])}finally{es(!1)}}function tS(e){let t=[...e].sort((e,t)=>new Date(e.fecha).getTime()-new Date(t.fecha).getTime()),a=0,s=t.map(e=>("DEBIT"===e.tipo?a+=e.monto:a-=e.monto,{...e,saldo:a})),r=t.filter(e=>"DEBIT"===e.tipo).reduce((e,t)=>e+t.monto,0),i=t.filter(e=>"CREDIT"===e.tipo).reduce((e,t)=>e+t.monto,0);return{withRunning:s,totalDebe:r,totalHaber:i,saldo:r-i}}(0,n.useEffect)(()=>{a.id&&(tf(),tw(a.id),tC(a.id),tE(a.id),tv(),tN(a.id))},[a.id]),(0,n.useEffect)(()=>{eU.length>0&&function(){if(!eU||0===eU.length){Z(null);return}let e=eU.map(e=>({id:e.id,fecha:e.fecha,concepto:e.concepto,observaciones:e.observaciones||"",monto:e.monto,tipo:"CREDIT"===e.tipo?"credito":"debito",socio_id:e.memberId}));Z((0,f.analyzeSocialQuotaStatus)(e))}()},[eU]),(0,n.useEffect)(()=>{if(u&&!K&&null!==Q){let e=Q.length;if(0===e&&"Familiar"===u.categoria||e>0&&"Individual"===u.categoria){console.log("\uD83D\uDD0D Categor\xeda necesita actualizaci\xf3n autom\xe1tica");let e=setTimeout(()=>{t7(u.id)},300);return()=>clearTimeout(e)}}},[u,K,Q]),(0,n.useEffect)(()=>{(ef||ey)&&setTimeout(()=>{let e=document.querySelectorAll(".fixed.inset-0");console.log("\uD83D\uDD0D Detectados",e.length,"modales despu\xe9s de abrir"),e.length>1&&console.warn("⚠️ Se detectaron m\xfaltiples modales!",e)},100)},[ef,ey]);let{withRunning:tA,totalDebe:tk,totalHaber:tT,saldo:tI}=tS((0,n.useMemo)(()=>eU.filter(e=>{if("DEBIT"===e.tipo&&"REFINANCIADO"===e.status)return!1;let t="ALL"===eK||e.tipo===eK,a="ALL"===e0||e.status===e0,s=!e1||(e.concepto||"").toLowerCase().includes(e1.toLowerCase())||(e.observaciones||"").toLowerCase().includes(e1.toLowerCase()),r=!0,i=!0;return eq&&(r=new Date(e.fecha)>=new Date(eq)),eQ&&(i=new Date(e.fecha)<=new Date(eQ+"T23:59:59")),t&&a&&s&&r&&i}),[eU,eK,e0,e1,eq,eQ])),tP=Math.max(1,Math.ceil(tA.length/e6)),tM=Math.min(e3,tP),tL=(tM-1)*e6,tF=tL+e6,tR=tA.slice(tL,tF),{transporteDebe:tG,transporteHaber:tO,transporteSaldo:tZ,transporteAnterior:tB}=(0,n.useMemo)(()=>{let e=tA.slice(0,tL),t=e.reduce((e,t)=>e+("DEBIT"===t.tipo?t.monto:0),0),a=e.reduce((e,t)=>e+("CREDIT"===t.tipo?t.monto:0),0),s=tR.reduce((e,t)=>e+("DEBIT"===t.tipo?t.monto:0),0),r=tR.reduce((e,t)=>e+("CREDIT"===t.tipo?t.monto:0),0);return{transporteDebe:t+s,transporteHaber:a+r,transporteSaldo:t+s-a-r,transporteAnterior:{debe:t,haber:a,saldo:t-a}}},[tA,tL,tR]),{saldo:tH}=(0,n.useMemo)(()=>tS(eU),[eU]),tz=(0,n.useMemo)(()=>eU.filter(e=>"DEBIT"===A(e.tipo)&&("PENDIENTE"===e.status||"PARCIAL"===e.status)).reduce((e,t)=>e+Math.max(0,t.monto-(t.paidAmount||0)),0),[eU]),tY=(0,n.useMemo)(()=>u&&eU?"SUSPENDIDO"===u.estado?"SUSPENDIDO":function(e){let t=new Date;t.setHours(0,0,0,0);let a=e.filter(e=>"DEBIT"===A(e.tipo)&&Number(e.monto||0)-Number(e.paidAmount||0)>0);if(0===a.length)return"AL_DIA";for(let e of a)if(e.vencimiento){let a=new Date(e.vencimiento);if(a.setHours(0,0,0,0),a<t)return"ATRASADO"}return"AL_DIA"}(eU):(null==u?void 0:u.estado)||"AL_DIA",[eU,u]);function tU(e){eI(e),eM({fecha:e.fecha.slice(0,10),concepto:e.concepto,tipo:e.tipo,monto:(0,o.m9)(String(e.monto)),observaciones:e.observaciones||"",vencimiento:(e.vencimiento||"").slice(0,10)}),ek(!0)}function t_(){ek(!1),eI(null)}async function tJ(){if("DEBIT"===eP.tipo&&eP.vencimiento&&eP.fecha){let e=new Date(eP.fecha);if(new Date(eP.vencimiento)<e){alert("La fecha de vencimiento no puede ser menor a la fecha del movimiento."),eF(!1);return}}if(u&&eT){eF(!0);try{let e=eP.fecha;eT&&e===eT.fecha.slice(0,10)&&(e=eT.fecha.slice(0,10));let t={fecha:e,concepto:eP.concepto,tipo:eP.tipo,monto:(0,o.sU)(eP.monto||""),observaciones:eP.observaciones};if("DEBIT"===eP.tipo){let e=eP.vencimiento||null;if(e&&/^\d{2}\/\d{2}\/\d{4}$/.test(e)){let[t,a,s]=e.split("/");e="".concat(s,"-").concat(a,"-").concat(t)}t.vencimiento=e}console.log("PATCH vencimiento:",t.vencimiento),console.log("PATCH payload completo:",JSON.stringify(t,null,2)),console.log("editForm original:",JSON.stringify(eP,null,2));let a=await i.L.authenticatedFetch("/api/members/".concat(u.id,"/movements/").concat(eT.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(404===a.status&&(a=await i.L.authenticatedFetch("/api/movements/".concat(eT.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),!a.ok){let e="Error al guardar",t="";try{t=await a.text();let s=JSON.parse(t);s.msg&&(e=s.msg.includes("Movimiento no encontrado")?"El movimiento no existe o fue eliminado.":s.msg.includes("Tipo inv\xe1lido")?"El tipo de movimiento no es v\xe1lido.":s.msg.includes("Vencimiento inv\xe1lido")||s.msg.includes("Fecha inv\xe1lida")?"La fecha ingresada no es v\xe1lida. Usa formato DD/MM/YYYY o YYYY-MM-DD.":s.msg)}catch(a){e=t||e}alert(e),console.error("Guardar movimiento:",e);return}await tC(u.id),t_()}catch(e){alert("No se pudo guardar el movimiento"),console.error(e)}finally{eF(!1)}}}async function tV(e){if(u&&confirm("\xbfEliminar movimiento?"))try{let t=!1;for(;;){let a="/api/movements/".concat(encodeURIComponent(e))+(t?"?cascade=true":""),s=await i.L.authenticatedFetch(a,{method:"DELETE"});if(s.ok){await tC(u.id);return}if(409!==s.status||t){let e=await s.json().catch(()=>({}));throw Error(e.msg||"Error al eliminar")}{let e=(await s.json()).relatedCredits||[],a="Este d\xe9bito tiene pagos relacionados:\n";if(e.forEach((e,t)=>{a+="\n".concat(t+1,". ").concat(e.fecha?new Date(e.fecha).toLocaleDateString("es-PY"):""," - ").concat(e.concepto||""," - Gs.").concat((e.monto||0).toLocaleString("es-PY"))}),a+="\n\nSi contin\xfaas, se eliminar\xe1n tambi\xe9n estos pagos. \xbfDeseas continuar?",!window.confirm(a))return;t=!0}}}catch(e){alert("No se pudo eliminar el movimiento"),console.error(e)}}async function tq(e){try{var t;let a=await i.L.authenticatedFetch("/api/payments/".concat(e));if(!a.ok)throw Error(await a.text());t=await a.json(),eZ(t),eH({fecha:(t.fecha||"").slice(0,10),concepto:t.concepto||"",formaPago:t.formaPago||"",numeroRecibo:t.numeroRecibo||"",monto:(0,o.m9)(String(t.monto||"")),cobradorId:t.cobradorId||"",observaciones:t.observaciones||""}),eG(!0)}catch(e){alert("No se pudo cargar el pago"),console.error(e)}}function t$(){eG(!1),eZ(null)}async function tQ(){if(eO){eY(!0);try{let e=function(e){if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(/^\d{2}\/\d{2}\/\d{4}$/.test(e)){let[t,a,s]=e.split("/");return"".concat(s,"-").concat(a.padStart(2,"0"),"-").concat(t.padStart(2,"0"))}if(/^\d{2}-\d{2}-\d{4}$/.test(e)){let[t,a,s]=e.split("-");return"".concat(s,"-").concat(a.padStart(2,"0"),"-").concat(t.padStart(2,"0"))}return e}(eB.fecha);console.log("Fecha original:",eB.fecha),console.log("Fecha normalizada:",e),e=e.slice(0,10);let t={...eB,fecha:e,monto:(0,o.sU)(eB.monto||"")};console.log("Payload a enviar:",t);let s=await i.L.authenticatedFetch("/api/payments/".concat(eO.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error(await s.text());await tf();let r=(null==u?void 0:u.id)||a.id;await tC(r),t$()}catch(e){alert("No se pudo guardar el pago"),console.error(e)}finally{eY(!1)}}}async function tW(e){if(confirm("\xbfEliminar pago?"))try{let t=await i.L.authenticatedFetch("/api/payments/".concat(e),{method:"DELETE"});if(!t.ok)throw Error(await t.text());await tf();let s=(null==u?void 0:u.id)||a.id;await tC(s)}catch(e){alert("No se pudo eliminar el pago"),console.error(e)}}function tK(){tm(!1),tu(null),tj("")}async function tX(){if(!u||!tx)return;if(!th.serviceId){tj("Selecciona un servicio.");return}let e=parseFloat(th.price);if(isNaN(e)||e<=0){tj("El precio debe ser un n\xfamero mayor a cero.");return}if(!th.nextChargeDate){tj("La fecha de pr\xf3ximo cobro es requerida.");return}tb(!0),tj("");try{let t={serviceId:th.serviceId,price:e,periodicity:th.periodicity,nextChargeDate:th.nextChargeDate,notes:th.notes},a=await i.L.authenticatedFetch("/api/members/".concat(u.id,"/subscriptions/").concat(tx.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.text();throw Error(e||"Error al actualizar suscripci\xf3n")}await tN(u.id),tj("Suscripci\xf3n actualizada correctamente."),setTimeout(()=>{tb(!1),tK()},1e3)}catch(e){console.error("Error al editar suscripci\xf3n:",e),tj((null==e?void 0:e.message)||"No se pudo actualizar la suscripci\xf3n."),tb(!1)}}async function t0(e){var t;if(!u)return;let a=(null===(t=N.find(t=>t.id===e.serviceId))||void 0===t?void 0:t.nombre)||"Servicio desconocido";if(confirm('\xbfEst\xe1s seguro de que quieres cancelar la suscripci\xf3n a "'.concat(a,'"?\n\n')+"Esta acci\xf3n no se puede deshacer y la suscripci\xf3n se eliminar\xe1 completamente del listado."))try{let t=await i.L.authenticatedFetch("/api/members/".concat(u.id,"/subscriptions/").concat(e.id),{method:"DELETE"});if(!t.ok){let e=await t.text();throw Error(e||"Error al cancelar suscripci\xf3n")}await tN(u.id),alert("Suscripci\xf3n cancelada y eliminada correctamente.")}catch(e){console.error("Error al cancelar suscripci\xf3n:",e),alert("No se pudo cancelar la suscripci\xf3n: ".concat((null==e?void 0:e.message)||"Error desconocido"))}}function t2(){ei(!1)}async function t1(){if(u){if(!en.length){em("Seleccion\xe1 al menos un archivo.");return}ec(!0),em("");try{for(let e of en){let t=new FormData;t.append("file",e);let a=await i.L.authenticatedFetch("/api/members/".concat(u.id,"/attachments"),{method:"POST",body:t});if(!a.ok){let e=await a.text();throw Error(e)}}await tE(u.id),em("Adjunto(s) subido(s) correctamente."),setTimeout(()=>{ec(!1),t2()},600)}catch(e){console.error(e),em((null==e?void 0:e.message)||"No se pudo subir el/los adjunto(s)."),ec(!1)}}}async function t5(e){if(u&&confirm("\xbfEliminar adjunto?"))try{let t=await i.L.authenticatedFetch("/api/members/".concat(u.id,"/attachments?attachmentId=").concat(encodeURIComponent(e)),{method:"DELETE"}),a=t.headers.get("content-type")||"";if(!t.ok){let e=a.includes("application/json")?await t.json():await t.text();throw Error("string"==typeof e?e:(null==e?void 0:e.msg)||"HTTP ".concat(t.status))}await tE(u.id)}catch(e){console.error("No se pudo eliminar adjunto",e),alert("No se pudo eliminar adjunto")}}function t3(){ev(!1),eS({nombres:"",apellidos:"",ci:"",parentesco:"",nacimiento:"",email:"",telefono:""}),eD("")}async function t4(){if(u){ew(!0),eD("");try{if(!eE.nombres.trim()||!eE.apellidos.trim()||!eE.ci.trim()){eD("Nombres, apellidos y CI son obligatorios");return}let e=await i.L.authenticatedFetch("/api/members/".concat(u.id,"/familiares"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(eE)});if(!e.ok){let t=await e.text();throw Error(t)}await tw(u.id),await new Promise(e=>setTimeout(e,200)),await t7(u.id),eD("Familiar agregado correctamente"),setTimeout(()=>{t3()},1500)}catch(e){console.error("Error adding family member:",e),eD("Error: ".concat((null==e?void 0:e.message)||"No se pudo agregar el familiar"))}finally{ew(!1)}}}async function t6(e,t){if(u&&confirm("\xbfEliminar a ".concat(t," de la familia?")))try{let t=await i.L.authenticatedFetch("/api/families/".concat(e),{method:"DELETE"});if(!t.ok){let e=await t.text();throw Error(e)}await tw(u.id),await new Promise(e=>setTimeout(e,200)),await t7(u.id)}catch(e){console.error("Error deleting family member:",e),alert("Error: ".concat((null==e?void 0:e.message)||"No se pudo eliminar el familiar"))}}async function t7(e){if(u)try{let t=await i.L.authenticatedFetch("/api/members/".concat(e,"/familiares"));if(!t.ok){console.error("No se pudo obtener familiares para actualizar categor\xeda");return}let a=await t.json(),s=Array.isArray(a)?a.length:0;console.log("� Conteo de familiares: ".concat(s,", Categor\xeda actual: ").concat(u.categoria));let r=u.categoria;if(0===s&&"Familiar"===u.categoria?r="Individual":s>0&&"Individual"===u.categoria&&(r="Familiar"),r!==u.categoria){console.log("\uD83D\uDD04 Actualizando categor\xeda: ".concat(u.categoria," → ").concat(r));let t=await i.L.authenticatedFetch("/api/members/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoria:r})});if(!t.ok){let e=await t.text();throw console.error("❌ Error en API:",e),Error(e)}v(e=>e?{...e,categoria:r}:null),console.log("✅ Categor\xeda actualizada autom\xe1ticamente a: ".concat(r))}else console.log("No se requiere cambio de categor\xeda")}catch(e){console.error("Error updating member category:",e)}}(0,n.useEffect)(()=>{window.__mv_ctx={withRunning:tA,totalDebe:tk,totalHaber:tT,saldo:tI,member:u}},[tA,tk,tT,tI,u]);let t9=Math.max(1,Math.ceil(D.length/q)),t8=Math.min(J,t9),ae=D.slice((t8-1)*q,(t8-1)*q+q),at=(0,n.useMemo)(()=>{let e=ex.trim().toLowerCase();return e?ee.filter(t=>(t.name||"").toLowerCase().includes(e)):ee},[ee,ex]),aa=Math.max(1,Math.ceil(at.length/eg)),as=Math.min(eh,aa),ar=at.slice((as-1)*eg,(as-1)*eg+eg);if(R)return(0,s.jsx)(r.Z,{children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})})});if(!u)return(0,s.jsx)(r.Z,{children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-gray-500",children:"Socio no encontrado"}),(0,s.jsx)(j.default,{href:"/admin/socios",className:"text-primary-600 hover:text-primary-800 mt-4 inline-block",children:"← Volver a Socios"})]})});let ai=N.filter(e=>u.servicios.includes(e.id)),an=D[0];function al(e){let t=function(e){if("DEBIT"!==e.tipo)return"—";if("PENDIENTE"===e.status||"PARCIAL"===e.status||"CANCELADO"===e.status)return e.status;if("REFINANCIADO"===e.status)return"REFINANCIADO";let t=Number(e.paidAmount||0),a=Number(e.monto||0);return t<=0?"PENDIENTE":t>=a?"CANCELADO":"PARCIAL"}(e);return"—"===t?(0,s.jsx)("span",{className:"text-gray-400",children:"—"}):(0,s.jsx)("span",{className:"px-2 py-0.5 rounded-full border text-xs font-medium ".concat({PENDIENTE:"bg-yellow-100 text-yellow-800 border-yellow-200",PARCIAL:"bg-blue-100 text-blue-800 border-blue-200",CANCELADO:"bg-green-100 text-green-800 border-green-200",REFINANCIADO:"bg-gray-200 text-gray-600 border-gray-300"}[t]),children:t})}return(0,s.jsxs)(r.Z,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,s.jsxs)("div",{className:"px-6 py-4",children:[(0,s.jsxs)("nav",{className:"flex items-center text-sm text-gray-500 mb-3",children:[(0,s.jsx)(j.default,{href:"/admin",className:"hover:text-gray-700",children:"Panel"}),(0,s.jsx)("span",{className:"mx-2",children:"/"}),(0,s.jsx)(j.default,{href:"/admin/socios",className:"hover:text-gray-700",children:"Socios"}),(0,s.jsx)("span",{className:"mx-2",children:"/"}),(0,s.jsxs)("span",{className:"text-gray-900 font-medium",children:[u.nombres," ",u.apellidos]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(j.default,{href:"/admin/socios",className:"p-1.5 hover:bg-gray-100 rounded-md",children:(0,s.jsx)(c.Z,{className:"w-4 h-4"})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-xl font-semibold text-gray-900",children:[u.nombres," ",u.apellidos]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[u.codigo," • ",u.subcategoria]})]}),(0,s.jsx)("div",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat("AL_DIA"===tY?"bg-green-50 text-green-700 border-green-200":"ATRASADO"===tY?"bg-red-50 text-red-700 border-red-200":"bg-gray-50 text-gray-700 border-gray-200"),children:"AL_DIA"===tY?"Al D\xeda":"ATRASADO"===tY?"Atrasado":"Suspendido"})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(j.default,{href:"/admin/socios/".concat(u.id,"/editar"),className:"bg-blue-600 text-white px-3 py-1.5 rounded-md hover:bg-blue-700 flex items-center gap-1.5 text-sm",children:[(0,s.jsx)(d.Z,{className:"w-3.5 h-3.5"}),"Editar"]})})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-10 gap-4",children:[(0,s.jsxs)("div",{className:"xl:col-span-7 space-y-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),"Informaci\xf3n del Socio"]})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Datos Personales"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Nombres"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.nombres})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Apellidos"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.apellidos})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"C\xe9dula"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.ci})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"RUC"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.ruc||"-"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Informaci\xf3n Personal"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Nacimiento"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.nacimiento?(0,o.p6)(u.nacimiento):"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Nacionalidad"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.nacionalidad||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Fecha de Alta"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,o.p6)(u.alta)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Categor\xeda"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.categoria})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Contacto"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Tel\xe9fono"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.telefono||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Celular"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.celular||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Email"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.email||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Direcci\xf3n"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:u.direccion||"-"})]})]})]})]}),u.datosLaborales&&(0,s.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-100",children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Datos Laborales"}),(0,s.jsx)("div",{className:"text-sm font-medium mt-1",children:u.datosLaborales})]})]})]}),O&&(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),"Estado de Cuota Social"]})}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estado Actual"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Estado"}),(0,s.jsxs)("div",{className:"text-sm font-medium flex items-center gap-2 ".concat("up-to-date"===O.currentStatus?"text-green-700":"behind"===O.currentStatus?"text-red-700":"text-gray-700"),children:[(0,s.jsx)("span",{className:"inline-block w-2 h-2 rounded-full ".concat("up-to-date"===O.currentStatus?"bg-green-500":"behind"===O.currentStatus?"bg-red-500":"bg-gray-400")}),"up-to-date"===O.currentStatus?"Al d\xeda":"behind"===O.currentStatus?"Atrasado":"Desconocido"]})]}),O.monthsBehind>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Meses atrasados"}),(0,s.jsxs)("div",{className:"text-sm font-medium text-red-700",children:[O.monthsBehind," mes",1!==O.monthsBehind?"es":""]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"\xdaltimo Pago"}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Mes pagado"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:O.lastPaidMonthText||"Sin registros"})]})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Pr\xf3ximo Pago"}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Mes sugerido"}),(0,s.jsx)("div",{className:"text-sm font-medium text-blue-700",children:O.suggestedPaymentMonth})]})})]})]}),u&&("Socio"===u.subcategoria||"Socio Patrimonial"===u.subcategoria)&&(0,s.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Gesti\xf3n Anual"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Generar o revertir cuotas de todo el a\xf1o"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>H(!0),className:"px-3 py-1.5 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Generar Cuotas Anuales"}),(0,s.jsx)("button",{onClick:()=>Y(!0),className:"px-3 py-1.5 text-xs bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Revertir Cuotas"})]})]})})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(h,{className:"w-4 h-4 mr-2 text-gray-500"}),"Suscripciones Activas"]})}),(0,s.jsx)("div",{className:"p-4",children:0===L.length?(0,s.jsxs)("div",{className:"text-center py-6 text-gray-500",children:[(0,s.jsx)(h,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),(0,s.jsx)("p",{className:"text-sm",children:"No hay suscripciones activas"}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Las suscripciones se crean desde “A\xf1adir servicio”"})]}):(0,s.jsx)("div",{className:"space-y-2",children:L.map(e=>{let t=N.find(t=>t.id===e.serviceId),a=(null==t?void 0:t.nombre)||"Servicio desconocido",r="ACTIVE"===e.status?"bg-green-100 text-green-700":"PAUSED"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700",i="ACTIVE"===e.status?"Activa":"PAUSED"===e.status?"Pausada":"Desconocido";return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md border border-gray-100 hover:bg-gray-100 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,s.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-md flex items-center justify-center",children:(0,s.jsx)(h,{className:"w-3 h-3 text-blue-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:a}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat(r),children:i})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-0.5",children:[(0,s.jsxs)("span",{children:[(0,o.xG)(e.price||0)," • ","MONTHLY"===e.periodicity?"Mensual":"Anual"]}),(0,s.jsxs)("span",{children:["Vencimiento: ",e.nextChargeDate?(0,o.p6)(e.nextChargeDate):"-"]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{className:"px-2 py-1 text-xs border border-blue-200 text-blue-600 rounded hover:bg-blue-50 transition-colors",onClick:()=>{let t;return tu(e),t="",void(e.nextChargeDate&&(t=e.nextChargeDate.split("T")[0]),tp({serviceId:e.serviceId,price:(e.price||0).toString(),periodicity:e.periodicity||"MONTHLY",nextChargeDate:t,notes:e.notes||""}),tj(""),tm(!0))},title:"Editar suscripci\xf3n",children:"Editar"}),(0,s.jsx)("button",{className:"px-2 py-1 text-xs border border-red-200 text-red-600 rounded hover:bg-red-50 transition-colors",onClick:()=>t0(e),title:"Cancelar y eliminar suscripci\xf3n",children:"Cancelar"})]})]},e.id)})})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsx)("div",{className:"px-4 py-3 border-b border-gray-100",children:(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),"Historial de Pagos"]})}),(0,s.jsx)("div",{className:"p-4",children:D.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Fecha"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Concepto"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Forma Pago"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-xs font-medium text-gray-500",children:"Monto"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Recibo"})]})}),(0,s.jsx)("tbody",{children:ae.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,s.jsx)("td",{className:"py-2 px-2 text-sm",children:(0,o.p6)(e.fecha)}),(0,s.jsx)("td",{className:"py-2 px-2 text-sm",children:e.concepto}),(0,s.jsx)("td",{className:"py-2 px-2 text-sm capitalize",children:e.formaPago}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-medium text-sm",children:(0,o.xG)(e.monto)}),(0,s.jsx)("td",{className:"py-2 px-2 text-sm",children:e.numeroRecibo||"-"})]},e.id))})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["P\xe1gina ",t8," de ",t9," • ",D.length," pagos"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("select",{value:q,onChange:e=>{$(Number(e.target.value)),V(1)},className:"px-2 py-1 border rounded text-xs",children:[(0,s.jsx)("option",{value:5,children:"5"}),(0,s.jsx)("option",{value:10,children:"10"}),(0,s.jsx)("option",{value:20,children:"20"})]}),(0,s.jsx)("button",{onClick:()=>V(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",disabled:t8<=1,children:"‹"}),(0,s.jsx)("button",{onClick:()=>V(e=>Math.min(t9,e+1)),className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",disabled:t8>=t9,children:"›"})]})]})]}):(0,s.jsx)("div",{className:"text-gray-500 text-center py-6 text-sm",children:"No hay pagos registrados"})})]})]}),(0,s.jsxs)("div",{className:"xl:col-span-3 space-y-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsxs)("div",{className:"p-4 text-center",children:[(()=>{let e=function(e){if(!e)return"";let t=String(e);if(/^https?:\/\//i.test(t))return t;let a=t.startsWith("/")?t:"/".concat(t);return window.location?"".concat(window.location.origin).concat(a):a}(u.foto),t=e?"".concat(e).concat(e.includes("?")?"&":"?","v=1"):"";return t&&!U?(0,s.jsx)("img",{src:t,alt:"".concat(u.nombres," ").concat(u.apellidos),className:"w-20 h-20 rounded-full mx-auto object-cover mb-3 border-2 border-gray-200",referrerPolicy:"no-referrer",onError:()=>_(!0)}):(0,s.jsx)("div",{className:"w-20 h-20 rounded-full mx-auto bg-gray-100 border-2 border-gray-200 flex items-center justify-center mb-3",children:(0,s.jsx)(m.Z,{className:"w-10 h-10 text-gray-400"})})})(),(0,s.jsxs)("h4",{className:"font-medium text-sm text-gray-900",children:[u.nombres," ",u.apellidos]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:u.codigo})]}),(0,s.jsxs)("div",{className:"border-t border-gray-100 p-3 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"Deuda Total"}),(0,s.jsx)("span",{className:"text-sm font-medium ".concat(tz>0?"text-red-600":"text-green-600"),children:tz>0?(0,o.xG)(tz):(0,o.xG)(0)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"Servicios"}),(0,s.jsx)("span",{className:"text-sm font-medium text-blue-600",children:ai.length})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"\xdaltimo Pago"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:an?(0,o.p6)(an.fecha):"Sin pagos"})]}),tH<0&&(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"Saldo a favor"}),(0,s.jsx)("span",{className:"text-xs font-medium text-green-600",children:(0,o.xG)(Math.abs(tH))})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(p.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),"Familiares"]}),(0,s.jsx)("button",{type:"button",onClick:function(){console.log("\uD83D\uDD0D openFamilyModal llamado"),console.log("\uD83E\uDDF9 Modales existentes antes de abrir:",document.querySelectorAll(".fixed.inset-0").length),eS({nombres:"",apellidos:"",ci:"",parentesco:"",nacimiento:"",email:"",telefono:""}),eD(""),ev(!0),console.log("\uD83D\uDCC4 showAddFamilyModal establecido a true")},className:"p-1 hover:bg-gray-100 rounded",title:"Agregar Familiar",children:(0,s.jsx)(g.Z,{className:"w-3 h-3 text-gray-500"})})]}),(0,s.jsx)("div",{className:"p-3",children:K?(0,s.jsx)("div",{className:"text-gray-500 text-xs",children:"Cargando..."}):Q.length>0?(0,s.jsxs)("div",{className:"space-y-2",children:[Q.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"text-xs font-medium truncate",children:[e.nombres," ",e.apellidos]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["CI: ",e.ci]}),e.parentesco&&(0,s.jsx)("div",{className:"text-xs text-gray-400",children:e.parentesco})]}),(0,s.jsx)("button",{onClick:()=>t6(e.id,"".concat(e.nombres," ").concat(e.apellidos)),className:"px-1.5 py-0.5 text-xs border border-red-300 text-red-600 rounded hover:bg-red-50 flex-shrink-0",title:"Eliminar familiar",children:"\xd7"})]},e.id)),Q.length>3&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-100",children:["+",Q.length-3," m\xe1s"]}),(0,s.jsx)(j.default,{href:"/admin/familiares?socio=".concat(a.id),className:"block text-center text-xs text-blue-600 hover:text-blue-700 mt-2 pt-2 border-t border-gray-100",children:"Ver todos"})]}):(0,s.jsx)("div",{className:"text-gray-500 text-xs text-center py-2",children:"No hay familiares asociados"})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-800",children:"Adjuntos"}),(0,s.jsx)("button",{onClick:function(){ei(!0),el([]),em("")},className:"p-1 hover:bg-gray-100 rounded",title:"Subir adjuntos",children:(0,s.jsx)(g.Z,{className:"w-3 h-3 text-gray-500"})})]}),(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"space-y-2 mb-3",children:[(0,s.jsx)("input",{value:ex,onChange:e=>{eu(e.target.value),ep(1)},placeholder:"Buscar adjunto…",className:"px-2 py-1 border rounded w-full text-xs"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Filas:"}),(0,s.jsxs)("select",{value:eg,onChange:e=>{eb(Number(e.target.value)),ep(1)},className:"px-2 py-1 border rounded text-xs",children:[(0,s.jsx)("option",{value:5,children:"5"}),(0,s.jsx)("option",{value:50,children:"50"}),(0,s.jsx)("option",{value:100,children:"100"}),(0,s.jsx)("option",{value:200,children:"200"})]})]})]}),ea?(0,s.jsx)("div",{className:"text-gray-500 text-xs",children:"Cargando..."}):0===at.length?(0,s.jsx)("div",{className:"text-gray-500 text-xs text-center py-2",children:ex?"No se encontraron adjuntos":"Sin adjuntos"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"space-y-2",children:ar.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 p-2 bg-gray-50 rounded border border-gray-100",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-xs font-medium truncate",children:e.name}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[(e.size/1024).toFixed(1)," KB • ",new Date(e.uploadedAt).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"px-2 py-1 text-xs border rounded hover:bg-gray-50",children:"Ver"}),(0,s.jsx)("button",{onClick:()=>t5(e.id),className:"px-2 py-1 text-xs border border-red-300 text-red-600 rounded hover:bg-red-50",children:"\xd7"})]})]},e.id))}),aa>1&&(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["P\xe1gina ",as," de ",aa," • ",at.length," adjuntos"]}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("button",{onClick:()=>ep(e=>Math.max(1,e-1)),disabled:as<=1,className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs disabled:opacity-50",children:"‹"}),(0,s.jsx)("button",{onClick:()=>ep(e=>Math.min(aa,e+1)),disabled:as>=aa,className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs disabled:opacity-50",children:"›"})]})]})]})]})]})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-800",children:"Gesti\xf3n de movimientos"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Editar o eliminar d\xe9bitos y cr\xe9ditos"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>e8(!0),className:"px-2 py-1 text-xs rounded border hover:bg-gray-50",children:"Editar D\xe9bitos"}),(0,s.jsx)("button",{onClick:()=>tt(!0),className:"px-2 py-1 text-xs rounded border hover:bg-gray-50",children:"Editar Cr\xe9ditos"})]})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center",children:[(0,s.jsx)(b.Z,{className:"w-4 h-4 mr-2 text-gray-500"}),"Estado de cuenta (Movimientos)"]}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("button",{onClick:I,className:"px-2 py-1 text-xs border rounded hover:bg-gray-50",title:"Exportar Excel",children:"\uD83D\uDCCA Excel"}),(0,s.jsx)("button",{onClick:P,className:"px-2 py-1 text-xs border rounded hover:bg-gray-50",title:"Exportar PDF",children:"\uD83D\uDCC4 PDF"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-500 mb-1",children:"Desde"}),(0,s.jsx)("input",{type:"date",value:eq,onChange:e=>{e$(e.target.value),e4(1)},className:"px-2 py-1 border rounded text-xs"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-xs text-gray-500 mb-1",children:"Hasta"}),(0,s.jsx)("input",{type:"date",value:eQ,onChange:e=>{eW(e.target.value),e4(1)},className:"px-2 py-1 border rounded text-xs"})]}),(0,s.jsxs)("select",{value:eK,onChange:e=>{eX(e.target.value),e4(1)},className:"px-2 py-1 border rounded text-xs",children:[(0,s.jsx)("option",{value:"ALL",children:"Todos"}),(0,s.jsx)("option",{value:"DEBIT",children:"Debe"}),(0,s.jsx)("option",{value:"CREDIT",children:"Haber"})]}),(0,s.jsxs)("select",{value:e0,onChange:e=>{e2(e.target.value),e4(1)},className:"px-2 py-1 border rounded text-xs",children:[(0,s.jsx)("option",{value:"ALL",children:"Todos estados"}),(0,s.jsx)("option",{value:"PENDIENTE",children:"Pendiente"}),(0,s.jsx)("option",{value:"PARCIAL",children:"Parcial"}),(0,s.jsx)("option",{value:"CANCELADO",children:"Cancelado"})]}),(0,s.jsx)("input",{type:"text",value:e1,onChange:e=>{e5(e.target.value),e4(1)},placeholder:"Buscar...",className:"px-2 py-1 border rounded text-xs flex-1 min-w-0"}),(0,s.jsx)("button",{onClick:function(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0);e$(t.toISOString().slice(0,10)),eW(a.toISOString().slice(0,10)),e4(1)},className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",children:"Mes actual"}),(0,s.jsx)("button",{onClick:function(){let e=new Date,t=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear(),11,31);e$(t.toISOString().slice(0,10)),eW(a.toISOString().slice(0,10)),e4(1)},className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",children:"Este a\xf1o"}),(0,s.jsx)("button",{onClick:function(){e$(""),eW(""),eX("ALL"),e2("ALL"),e5(""),e4(1)},className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",children:"Limpiar"})]})]}),(0,s.jsx)("div",{className:"p-4",children:eJ?(0,s.jsx)("div",{className:"text-gray-500 py-6 text-center text-sm",children:"Cargando movimientos..."}):0===tA.length?(0,s.jsx)("div",{className:"text-gray-500 text-center py-6 text-sm",children:"Sin movimientos"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Fecha"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Concepto"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Observaciones"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Estado"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500",children:"Vence"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-xs font-medium text-gray-500",children:"Debe"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-xs font-medium text-gray-500",children:"Haber"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-xs font-medium text-gray-500",children:"Saldo"}),(0,s.jsx)("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500",children:"Acciones"})]})}),(0,s.jsxs)("tbody",{children:[tM>1&&tP>1&&(0,s.jsxs)("tr",{className:"bg-yellow-50 border-b border-yellow-200",children:[(0,s.jsx)("td",{className:"py-1.5 px-2 font-medium text-yellow-700 text-xs",children:"—"}),(0,s.jsx)("td",{className:"py-1.5 px-2 font-medium text-yellow-700 text-xs",children:"TRANSPORTE"}),(0,s.jsx)("td",{className:"py-1.5 px-2 font-medium text-yellow-700 text-xs",children:"—"}),(0,s.jsx)("td",{className:"py-1.5 px-2 font-medium text-yellow-700 text-xs",children:"—"}),(0,s.jsx)("td",{className:"py-1.5 px-2 font-medium text-yellow-700 text-xs",children:"—"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-right font-medium text-yellow-700 text-xs",children:tB.debe>0?(0,o.xG)(tB.debe):"-"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-right font-medium text-yellow-700 text-xs",children:tB.haber>0?(0,o.xG)(tB.haber):"-"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-right font-bold text-yellow-800 text-xs",children:(0,o.xG)(tB.saldo)}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-center font-medium text-yellow-700 text-xs",children:"—"})]}),tR.map(e=>{var t;let a="DEBIT"===e.tipo&&Number(e.paidAmount||0)>0;return(0,s.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"py-1.5 px-2 text-xs",children:(0,o.p6)(e.fecha)}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-xs",children:e.concepto}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-xs",children:e.observaciones||"—"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-xs",children:al(e)}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-xs",children:"DEBIT"===e.tipo&&e.vencimiento?(0,o.p6)(e.vencimiento):"—"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-right text-xs",children:"DEBIT"===e.tipo?(0,o.xG)(e.monto):"-"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-right text-xs",children:"CREDIT"===e.tipo?(0,o.xG)(e.monto):"-"}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-right font-medium text-xs",children:(0,o.xG)(null!==(t=e.saldo)&&void 0!==t?t:0)}),(0,s.jsx)("td",{className:"py-1.5 px-2 text-center text-xs",children:a?(0,s.jsxs)("button",{onClick:()=>tD(e),className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 border border-blue-200 rounded hover:bg-blue-100 transition-colors",title:"Ver pagos relacionados",children:[(0,s.jsx)(x.Z,{className:"w-3 h-3"}),(0,s.jsx)("span",{className:"text-xs",children:"Ver"})]}):"DEBIT"===e.tipo?(0,s.jsx)("span",{className:"text-gray-400 text-xs",children:"Sin pagos"}):(0,s.jsx)("span",{className:"text-gray-300",children:"—"})})]},e.id)})]}),(0,s.jsxs)("tfoot",{children:[tP>1&&(0,s.jsxs)("tr",{className:"bg-blue-50 border-t border-blue-200",children:[(0,s.jsx)("td",{colSpan:5,className:"py-2 px-2 text-right font-medium text-blue-700 text-xs",children:"Subtotal (Transporte)"}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-medium text-blue-700 text-xs",children:(0,o.xG)(tG)}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-medium text-blue-700 text-xs",children:(0,o.xG)(tO)}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-bold text-blue-800 text-xs",children:(0,o.xG)(tZ)}),(0,s.jsx)("td",{className:"py-2 px-2"})]}),(0,s.jsxs)("tr",{className:"bg-gray-50 border-t-2 border-gray-300",children:[(0,s.jsx)("td",{colSpan:5,className:"py-2 px-2 text-right font-semibold text-xs",children:"Totales"}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-semibold text-xs",children:(0,o.xG)(tG)}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-semibold text-xs",children:(0,o.xG)(tO)}),(0,s.jsx)("td",{className:"py-2 px-2 text-right font-bold text-xs",children:(0,o.xG)(tZ)}),(0,s.jsx)("td",{className:"py-2 px-2"})]})]})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["P\xe1gina ",tM," de ",tP," • ",tA.length," movimientos"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-xs",children:"Filas:"}),(0,s.jsxs)("select",{value:e6,onChange:e=>{e7(Number(e.target.value)),e4(1)},className:"px-2 py-1 border rounded text-xs",children:[(0,s.jsx)("option",{value:20,children:"20"}),(0,s.jsx)("option",{value:50,children:"50"}),(0,s.jsx)("option",{value:100,children:"100"}),(0,s.jsx)("option",{value:200,children:"200"})]}),(0,s.jsx)("button",{onClick:()=>e4(e=>Math.max(1,e-1)),className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",disabled:tM<=1,children:"‹"}),(0,s.jsx)("button",{onClick:()=>e4(e=>Math.min(tP,e+1)),className:"px-2 py-1 border rounded hover:bg-gray-50 text-xs",disabled:tM>=tP,children:"›"})]})]})]})})]}),u.observaciones&&(0,s.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Observaciones"}),(0,s.jsx)("p",{className:"text-gray-700",children:u.observaciones})]})})]}),ey&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Asociar Familiar"}),(0,s.jsx)("button",{onClick:()=>ej(!1),className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded text-sm",children:[(0,s.jsxs)("div",{className:"font-medium",children:["Socio titular: ",u.nombres," ",u.apellidos]}),(0,s.jsxs)("div",{className:"text-gray-600",children:["C\xf3digo: ",u.codigo]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombres *"}),(0,s.jsx)("input",{type:"text",value:eE.nombres,onChange:e=>eS(t=>({...t,nombres:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Ej. Ana Mar\xeda"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos *"}),(0,s.jsx)("input",{type:"text",value:eE.apellidos,onChange:e=>eS(t=>({...t,apellidos:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Ej. G\xf3mez Duarte"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CI *"}),(0,s.jsx)("input",{type:"text",value:eE.ci,onChange:e=>eS(t=>({...t,ci:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"1234567"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parentesco"}),(0,s.jsx)("input",{type:"text",value:eE.parentesco,onChange:e=>eS(t=>({...t,parentesco:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Hija, Esposo, etc."})]})]}),eC&&(0,s.jsx)("div",{className:"mt-3 text-sm",children:(0,s.jsx)("span",{className:eC.toLowerCase().includes("correct")?"text-green-600":"text-red-600",children:eC})}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>ej(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:t4,disabled:eN,className:"px-4 py-2 rounded-lg text-white ".concat(eN?"bg-primary-400":"bg-primary-500 hover:bg-primary-600"),children:eN?"Guardando…":"Guardar"})]})]})}),er&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Subir adjuntos"}),(0,s.jsx)("button",{onClick:t2,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("input",{type:"file",multiple:!0,onChange:e=>el(Array.from(e.target.files||[])),className:"block w-full text-sm text-gray-700"}),en.length>0&&(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:en.slice(0,9).map((e,t)=>{var a;let r=null===(a=e.type)||void 0===a?void 0:a.startsWith("image/");return(0,s.jsx)("div",{className:"border rounded p-1 h-20 flex items-center justify-center overflow-hidden",title:e.name,children:r?(0,s.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"object-cover w-full h-full"}):(0,s.jsx)("span",{className:"text-xs text-gray-600 text-center px-1",children:e.name})},t)})}),ed&&(0,s.jsx)("div",{className:"text-sm ".concat(ed.includes("correct")?"text-green-600":"text-red-600"),children:ed})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:t2,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:t1,disabled:eo,className:"px-4 py-2 rounded-lg text-white ".concat(eo?"bg-primary-400":"bg-primary-600 hover:bg-primary-700"),children:eo?"Subiendo…":"Guardar"})]})]})}),eA&&eT&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[70]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Editar movimiento"}),(0,s.jsx)("button",{onClick:t_,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Fecha"}),(0,s.jsx)("input",{type:"date",value:eP.fecha,onChange:e=>eM(t=>({...t,fecha:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Tipo"}),(0,s.jsxs)("select",{value:eP.tipo,onChange:e=>eM(t=>({...t,tipo:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[(0,s.jsx)("option",{value:"DEBIT",children:"Debe"}),(0,s.jsx)("option",{value:"CREDIT",children:"Haber"})]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Concepto"}),(0,s.jsx)("input",{type:"text",value:eP.concepto,onChange:e=>eM(t=>({...t,concepto:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),"DEBIT"===eP.tipo&&(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Fecha de vencimiento"}),(0,s.jsx)("input",{type:"date",value:eP.vencimiento,onChange:e=>eM(t=>({...t,vencimiento:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Monto"}),(0,s.jsx)("input",{type:"text",value:eP.monto,onChange:e=>eM(t=>({...t,monto:(0,o.m9)(e.target.value)})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Observaciones"}),(0,s.jsx)("input",{type:"text",value:eP.observaciones,onChange:e=>eM(t=>({...t,observaciones:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"Texto libre"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:t_,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:tJ,disabled:eL,className:"px-4 py-2 rounded-lg text-white ".concat(eL?"bg-primary-400":"bg-primary-600 hover:bg-primary-700"),children:eL?"Guardando…":"Guardar"})]})]})}),eR&&eO&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[70]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Editar pago"}),(0,s.jsx)("button",{onClick:t$,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Fecha"}),(0,s.jsx)("input",{type:"date",value:eB.fecha,onChange:e=>eH(t=>({...t,fecha:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Monto"}),(0,s.jsx)("input",{type:"text",inputMode:"numeric",value:(0,o.m9)((null===(e=eB.monto)||void 0===e?void 0:e.toString())||""),onChange:e=>{let t=(0,o.m9)(e.target.value);eH(e=>({...e,monto:(0,o.sU)(t).toString()}))},className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Concepto"}),(0,s.jsx)("input",{type:"text",value:eB.concepto,onChange:e=>eH(t=>({...t,concepto:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Forma de pago"}),(0,s.jsx)("input",{type:"text",value:eB.formaPago,onChange:e=>eH(t=>({...t,formaPago:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"N\xb0 Recibo"}),(0,s.jsx)("input",{type:"text",value:eB.numeroRecibo,onChange:e=>eH(t=>({...t,numeroRecibo:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Cobrador"}),(0,s.jsxs)("select",{value:eB.cobradorId,onChange:e=>eH(t=>({...t,cobradorId:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[(0,s.jsx)("option",{value:"",children:"Seleccionar"}),k.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.nombres," ",e.apellidos,e.codigo?" • ".concat(e.codigo):""]},e.id))]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Observaciones"}),(0,s.jsx)("input",{type:"text",value:eB.observaciones,onChange:e=>eH(t=>({...t,observaciones:e.target.value})),className:"w-full px-3 py-2 border rounded"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:t$,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,s.jsx)("button",{onClick:tQ,disabled:ez,className:"px-4 py-2 rounded-lg text-white ".concat(ez?"bg-primary-400":"bg-primary-600 hover:bg-primary-700"),children:ez?"Guardando…":"Guardar"})]})]})}),e9&&(0,s.jsx)(T,{open:e9,onClose:()=>e8(!1),type:"DEBIT",memberId:u.id,allMovements:eU,onChanged:async()=>{await tC(u.id)},onEditMovement:tU,onDeleteMovement:tV,onEditPaymentById:tq,onDeletePaymentById:tW}),te&&(0,s.jsx)(T,{open:te,onClose:()=>tt(!1),type:"CREDIT",memberId:u.id,allMovements:eU,onChanged:async()=>{await tC(u.id)},onEditMovement:tU,onDeleteMovement:tV,onEditPaymentById:tq,onDeletePaymentById:tW}),td&&tx&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[65]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Editar Suscripci\xf3n"}),(0,s.jsx)("button",{onClick:tK,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-3 bg-gray-50 rounded",children:[(0,s.jsx)("div",{className:"font-medium",children:(null===(t=N.find(e=>e.id===tx.serviceId))||void 0===t?void 0:t.nombre)||"Servicio desconocido"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Estado: ","ACTIVE"===tx.status?"Activa":"Pausada"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm mb-1 font-medium",children:["Servicio ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{value:th.serviceId,onChange:e=>tp(t=>({...t,serviceId:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[(0,s.jsx)("option",{value:"",children:"Seleccionar servicio"}),N.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.nombre," - ",(0,o.xG)(e.precio)]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm mb-1 font-medium",children:["Precio ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:th.price?(0,o.m9)(th.price):"",onChange:e=>{let t=(0,o.sU)(e.target.value);tp(e=>({...e,price:String(t)}))},placeholder:"0",className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1 font-medium",children:"Periodicidad"}),(0,s.jsxs)("select",{value:th.periodicity,onChange:e=>tp(t=>({...t,periodicity:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[(0,s.jsx)("option",{value:"MONTHLY",children:"Mensual"}),(0,s.jsx)("option",{value:"ANNUAL",children:"Anual"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm mb-1 font-medium",children:["Pr\xf3ximo cobro ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"date",value:th.nextChargeDate,onChange:e=>tp(t=>({...t,nextChargeDate:e.target.value})),className:"w-full px-3 py-2 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Notas"}),(0,s.jsx)("textarea",{value:th.notes,onChange:e=>tp(t=>({...t,notes:e.target.value})),placeholder:"Notas adicionales...",rows:3,className:"w-full px-3 py-2 border rounded"})]}),ty&&(0,s.jsx)("div",{className:"text-sm ".concat(ty.includes("correctamente")?"text-green-600":"text-red-600"),children:ty})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:tK,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",disabled:tg,children:"Cancelar"}),(0,s.jsx)("button",{onClick:tX,disabled:tg||!th.serviceId||!th.price||!th.nextChargeDate,className:"px-4 py-2 rounded-lg text-white ".concat(!tg&&th.serviceId&&th.price&&th.nextChargeDate?"bg-blue-600 hover:bg-blue-700":"bg-gray-400"),children:tg?"Guardando…":"Guardar cambios"})]})]})}),ef&&(0,s.jsx)("div",{id:"family-modal-overlay",className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[65]",children:(0,s.jsxs)("div",{id:"family-modal-content",className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Agregar Familiar"}),(0,s.jsx)("button",{onClick:t3,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm mb-1 font-medium",children:["Nombres ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:eE.nombres,onChange:e=>eS(t=>({...t,nombres:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"Nombres del familiar"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm mb-1 font-medium",children:["Apellidos ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:eE.apellidos,onChange:e=>eS(t=>({...t,apellidos:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"Apellidos del familiar"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm mb-1 font-medium",children:["CI ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:eE.ci,onChange:e=>eS(t=>({...t,ci:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"C\xe9dula de identidad"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1 font-medium",children:"Parentesco"}),(0,s.jsxs)("select",{value:eE.parentesco,onChange:e=>eS(t=>({...t,parentesco:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[(0,s.jsx)("option",{value:"",children:"Seleccionar parentesco"}),(0,s.jsx)("option",{value:"C\xf3nyuge",children:"C\xf3nyuge"}),(0,s.jsx)("option",{value:"Hijo/a",children:"Hijo/a"}),(0,s.jsx)("option",{value:"Padre",children:"Padre"}),(0,s.jsx)("option",{value:"Madre",children:"Madre"}),(0,s.jsx)("option",{value:"Hermano/a",children:"Hermano/a"}),(0,s.jsx)("option",{value:"Otro",children:"Otro"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1 font-medium",children:"Fecha de nacimiento"}),(0,s.jsx)("input",{type:"date",value:eE.nacimiento||"",onChange:e=>eS(t=>({...t,nacimiento:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"Fecha de nacimiento"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1 font-medium",children:"Email"}),(0,s.jsx)("input",{type:"email",value:eE.email||"",onChange:e=>eS(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"Email del familiar"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1 font-medium",children:"Tel\xe9fono"}),(0,s.jsx)("input",{type:"text",value:eE.telefono||"",onChange:e=>eS(t=>({...t,telefono:e.target.value})),className:"w-full px-3 py-2 border rounded",placeholder:"Tel\xe9fono del familiar"})]}),eC&&(0,s.jsx)("div",{className:"text-sm ".concat(eC.includes("correctamente")?"text-green-600":"text-red-600"),children:eC})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:t3,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",disabled:eN,children:"Cancelar"}),(0,s.jsx)("button",{onClick:t4,disabled:eN||!eE.nombres.trim()||!eE.apellidos.trim()||!eE.ci.trim(),className:"px-4 py-2 rounded-lg text-white ".concat(!eN&&eE.nombres.trim()&&eE.apellidos.trim()&&eE.ci.trim()?"bg-blue-600 hover:bg-blue-700":"bg-gray-400"),children:eN?"Guardando…":"Agregar Familiar"})]})]})}),ta&&tr&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[65]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Pagos Relacionados al D\xe9bito"}),(0,s.jsx)("button",{onClick:()=>ts(!1),className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:(0,s.jsx)(y.Z,{className:"w-5 h-5"})})]}),(0,s.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Fecha del D\xe9bito"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,o.p6)(tr.fecha)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Estado"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:al(tr)})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Concepto"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:tr.concepto})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Monto Total"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,o.xG)(tr.monto)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Monto Pagado"}),(0,s.jsx)("div",{className:"text-sm font-medium text-green-600",children:(0,o.xG)(tr.paidAmount||0)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Saldo Pendiente"}),(0,s.jsx)("div",{className:"text-sm font-medium text-red-600",children:(0,o.xG)(Math.max(0,tr.monto-(tr.paidAmount||0)))})]}),tr.vencimiento&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-gray-500",children:"Vencimiento"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,o.p6)(tr.vencimiento)})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Cr\xe9ditos y Pagos Asignados (",tn.length,")"]}),to?(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto mb-2"}),"Cargando pagos relacionados..."]}):0===tn.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No se encontraron pagos relacionados a este d\xe9bito."}):(0,s.jsx)("div",{className:"space-y-2",children:tn.map((e,t)=>(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)("span",{className:"text-xs font-medium text-gray-500",children:["#",t+1]}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat("PAYMENT"===e.tipo?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200"),children:"PAYMENT"===e.tipo?"Pago":"Cr\xe9dito"})]}),(0,s.jsx)("div",{className:"text-sm font-medium mb-1",children:e.concepto}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,s.jsxs)("div",{children:["Fecha: ",(0,o.p6)(e.fecha)]}),e.formaPago&&(0,s.jsxs)("div",{children:["Forma de pago: ",e.formaPago]}),e.numeroRecibo&&(0,s.jsxs)("div",{children:["Recibo: ",e.numeroRecibo]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Monto Total"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,o.xG)(e.monto)}),(0,s.jsxs)("div",{className:"text-xs text-green-600 font-medium mt-1",children:["Asignado: ",(0,o.xG)(e.allocatedAmount)]})]})]})},e.id))}),!to&&tn.length>0&&(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",children:"Total Asignado"}),(0,s.jsx)("span",{className:"text-lg font-bold text-green-600",children:(0,o.xG)(tn.reduce((e,t)=>e+t.allocatedAmount,0))})]})})]}),(0,s.jsx)("div",{className:"flex justify-end mt-6",children:(0,s.jsx)("button",{onClick:()=>ts(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Cerrar"})})]})}),u&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C,{open:B,onClose:()=>H(!1),memberId:u.id,memberName:"".concat(u.nombres," ").concat(u.apellidos),memberCode:u.codigo,onSuccess:()=>{tf(),tC(u.id)}}),(0,s.jsx)(S,{open:z,onClose:()=>Y(!1),memberId:u.id,memberName:"".concat(u.nombres," ").concat(u.apellidos),memberCode:u.codigo,onSuccess:()=>{tf(),tC(u.id)}})]})]})}function T(e){let{open:t,onClose:a,type:r,memberId:i,allMovements:l,onChanged:c,onEditMovement:d,onDeleteMovement:m,onEditPaymentById:x,onDeletePaymentById:u}=e,[h,p]=(0,n.useState)(""),[g,b]=(0,n.useState)(1),[y,j]=(0,n.useState)(10),f=(0,n.useMemo)(()=>l.filter(e=>e.tipo===r).filter(e=>!h||(e.concepto||"").toLowerCase().includes(h.toLowerCase())||(e.observaciones||"").toLowerCase().includes(h.toLowerCase())).sort((e,t)=>new Date(t.fecha).getTime()-new Date(e.fecha).getTime()),[l,r,h]),v=Math.max(1,Math.ceil(f.length/y)),N=Math.min(g,v),w=f.slice((N-1)*y,(N-1)*y+y);return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold",children:["Gestionar ","DEBIT"===r?"D\xe9bitos":"Cr\xe9ditos"]}),(0,s.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:"✕"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3 gap-2",children:[(0,s.jsx)("input",{value:h,onChange:e=>{p(e.target.value),b(1)},placeholder:"Buscar concepto u observaci\xf3n…",className:"px-3 py-2 border rounded w-full"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Filas:"}),(0,s.jsxs)("select",{value:y,onChange:e=>{j(Number(e.target.value)),b(1)},className:"px-2 py-1 border rounded",children:[(0,s.jsx)("option",{value:5,children:"5"}),(0,s.jsx)("option",{value:10,children:"10"}),(0,s.jsx)("option",{value:20,children:"20"})]})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full table-auto",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2",children:"Fecha"}),(0,s.jsx)("th",{className:"text-left py-2 px-2",children:"Concepto"}),(0,s.jsx)("th",{className:"text-right py-2 px-2",children:"Monto"}),(0,s.jsx)("th",{className:"text-left py-2 px-2",children:"Observaciones"}),(0,s.jsx)("th",{className:"text-right py-2 px-2",children:"Acciones"})]})}),(0,s.jsxs)("tbody",{children:[w.map(e=>(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"py-2 px-2",children:(0,o.p6)(e.fecha)}),(0,s.jsx)("td",{className:"py-2 px-2",children:e.concepto}),(0,s.jsx)("td",{className:"py-2 px-2 text-right",children:(0,o.xG)(e.monto)}),(0,s.jsx)("td",{className:"py-2 px-2",children:e.observaciones||"—"}),(0,s.jsx)("td",{className:"py-2 px-2",children:"PAGO"===e.origen&&e.refId?(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)("button",{onClick:()=>x(e.refId),className:"px-2 py-1 border rounded hover:bg-gray-50",title:"Editar",children:"Editar"}),(0,s.jsx)("button",{onClick:()=>u(e.refId),className:"px-2 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50",title:"Eliminar",children:"Eliminar"})]}):(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)("button",{onClick:()=>d(e),className:"px-2 py-1 border rounded hover:bg-gray-50",title:"Editar movimiento",children:"Editar"}),(0,s.jsx)("button",{onClick:()=>m(e.id),className:"px-2 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50",title:"Eliminar movimiento",children:"Eliminar"})]})})]},e.id)),0===w.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"py-6 text-center text-gray-500",children:"Sin movimientos"})})]})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["P\xe1gina ",N," de ",v," • ",f.length," movs"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>b(e=>Math.max(1,e-1)),disabled:N<=1,className:"px-2 py-1 border rounded hover:bg-gray-50",children:"Anterior"}),(0,s.jsx)("button",{onClick:()=>b(e=>Math.min(v,e+1)),disabled:N>=v,className:"px-2 py-1 border rounded hover:bg-gray-50",children:"Siguiente"})]})]})]})}):null}async function I(){var e,t,s,r,i,n,l,c,d,m;let x=window.__mv_ctx;if(!x||!x.withRunning){alert("No hay datos para exportar.");return}let{utils:u,writeFile:h}=await Promise.all([a.e(1425),a.e(6919)]).then(a.bind(a,2093)),p=[["ESTADO DE CUENTA"],[],["Nombre y Apellido:","".concat(null!==(n=null===(e=x.member)||void 0===e?void 0:e.nombres)&&void 0!==n?n:""," ").concat(null!==(l=null===(t=x.member)||void 0===t?void 0:t.apellidos)&&void 0!==l?l:"")],["Nro de Socio:",null!==(c=null===(s=x.member)||void 0===s?void 0:s.codigo)&&void 0!==c?c:""],["C\xe9dula:",null!==(d=null===(r=x.member)||void 0===r?void 0:r.ci)&&void 0!==d?d:""],[]],g=x.withRunning.map(e=>{var t;return{Fecha:(0,o.p6)(e.fecha),Concepto:e.concepto,Observaciones:e.observaciones||"",Estado:"DEBIT"===e.tipo?e.status||(0>=Number(e.paidAmount||0)?"PENDIENTE":Number(e.paidAmount||0)>=Number(e.monto||0)?"CANCELADO":"PARCIAL"):"—",Vence:"DEBIT"===e.tipo&&e.vencimiento?(0,o.p6)(e.vencimiento):"—",Debe:"DEBIT"===e.tipo?(e.monto||0).toLocaleString("es-PY",{minimumFractionDigits:0,maximumFractionDigits:0}):"",Haber:"CREDIT"===e.tipo?(e.monto||0).toLocaleString("es-PY",{minimumFractionDigits:0,maximumFractionDigits:0}):"",Saldo:(null!==(t=e.saldo)&&void 0!==t?t:0).toLocaleString("es-PY",{minimumFractionDigits:0,maximumFractionDigits:0})}});g.push({},{Concepto:"Totales",Debe:x.totalDebe.toLocaleString("es-PY",{minimumFractionDigits:0,maximumFractionDigits:0}),Haber:x.totalHaber.toLocaleString("es-PY",{minimumFractionDigits:0,maximumFractionDigits:0}),Saldo:x.saldo.toLocaleString("es-PY",{minimumFractionDigits:0,maximumFractionDigits:0})});let b=u.aoa_to_sheet(p);u.sheet_add_json(b,g,{origin:-1,skipHeader:!1});let y=u.book_new();u.book_append_sheet(y,b,"EstadoCuenta"),h(y,"estado-cuenta-".concat(null!==(m=null===(i=x.member)||void 0===i?void 0:i.codigo)&&void 0!==m?m:"","-").concat((0,o.Ji)(),".xlsx"))}async function P(){var e,t,s,r,i,n,l,c;let d=window.__mv_ctx;if(!d||!d.withRunning){alert("No hay datos para exportar.");return}let m=await a.e(4346).then(a.t.bind(a,62271,23)),x=await a.e(5950).then(a.t.bind(a,29,23)),u=m.default||m,h=x.default||x;u.vfs=h.vfs;let p=[[{text:"Fecha",bold:!0},{text:"Concepto",bold:!0},{text:"Observaciones",bold:!0},{text:"Estado",bold:!0},{text:"Vence",bold:!0},{text:"Debe",bold:!0,alignment:"right"},{text:"Haber",bold:!0,alignment:"right"},{text:"Saldo",bold:!0,alignment:"right"}]];d.withRunning.forEach(e=>{var t;let a="DEBIT"===e.tipo?e.status||(0>=Number(e.paidAmount||0)?"PENDIENTE":Number(e.paidAmount||0)>=Number(e.monto||0)?"CANCELADO":"PARCIAL"):"—";p.push([{text:(0,o.p6)(e.fecha)},{text:e.concepto},{text:e.observaciones||""},{text:a},{text:"DEBIT"===e.tipo&&e.vencimiento?(0,o.p6)(e.vencimiento):"—"},{text:"DEBIT"===e.tipo?(0,o.xG)(e.monto):"-",alignment:"right"},{text:"CREDIT"===e.tipo?(0,o.xG)(e.monto):"-",alignment:"right"},{text:(0,o.xG)(null!==(t=e.saldo)&&void 0!==t?t:0),alignment:"right"}])}),p.push([{text:"Totales",colSpan:5,alignment:"right",bold:!0},{},{},{},{},{text:(0,o.xG)(d.totalDebe),alignment:"right",bold:!0},{text:(0,o.xG)(d.totalHaber),alignment:"right",bold:!0},{text:(0,o.xG)(d.saldo),alignment:"right",bold:!0}]);let g={pageSize:"A4",pageOrientation:"landscape",pageMargins:[30,30,30,40],defaultStyle:{fontSize:8},content:[{text:"Estado de Cuenta",style:"header"},{text:"".concat(null!==(i=null===(e=d.member)||void 0===e?void 0:e.nombres)&&void 0!==i?i:""," ").concat(null!==(n=null===(t=d.member)||void 0===t?void 0:t.apellidos)&&void 0!==n?n:""," • ").concat(null!==(l=null===(s=d.member)||void 0===s?void 0:s.codigo)&&void 0!==l?l:""),margin:[0,0,0,10]},{table:{headerRows:1,widths:["auto","*","*","auto","auto","auto","auto","auto"],body:p},layout:"lightHorizontalLines"}],styles:{header:{fontSize:12,bold:!0,margin:[0,0,0,8]}}};u.createPdf(g).download("estado-cuenta-".concat(null!==(c=null===(r=d.member)||void 0===r?void 0:r.codigo)&&void 0!==c?c:"","-").concat(new Date().toISOString().slice(0,10),".pdf"))}},98592:function(e,t,a){"use strict";a.r(t),a.d(t,{analyzeSocialQuotaStatus:function(){return o},extractPaymentMonthFromObservation:function(){return l},generateSocialQuotaObservation:function(){return d},monthCodeToText:function(){return i},monthTextToCode:function(){return n}});var s=a(45365);let r=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];function i(e){let[t,a]=e.split("-"),s=parseInt(a,10)-1;return s<0||s>11?e:"".concat(r[s]," ").concat(t)}function n(e){let t=e.toLowerCase().match(/(\w+)\s+(\d{4})/);if(!t)return null;let[,a,s]=t,i=r.findIndex(e=>e===a);if(-1===i)return null;let n=(i+1).toString().padStart(2,"0");return"".concat(s,"-").concat(n)}function l(e){for(let t of[/mes de (\w+)\s+(\d{4})/i,/cuota social\s+(\w+)\s+(\d{4})/i,/cuota social\s*-\s*(\w+)\s+(\d{4})/i,/(\w+)\s+(\d{4})\s*-?\s*cuota/i]){let a=e.match(t);if(a){let e=a[1].toLowerCase(),t=a[2],s=r.findIndex(t=>t===e);if(-1!==s){let e=(s+1).toString().padStart(2,"0");return"".concat(t,"-").concat(e)}}}return null}function o(e){let t;let a=e.filter(e=>{if("credito"!==e.tipo)return!1;let t="".concat(e.concepto," ").concat(e.observaciones||"").toLowerCase();return t.includes("cuota social")||t.includes("cuota mensual")}),s=[];for(let e of a)if(e.observaciones){let t=l(e.observaciones);t&&s.push({monthCode:t,date:e.fecha})}if(s.sort((e,t)=>t.monthCode.localeCompare(e.monthCode)),0===s.length)return{lastPaidMonth:null,lastPaidMonthText:null,currentStatus:"unknown",monthsBehind:0,suggestedPaymentMonth:i(c()),suggestedPaymentMonthCode:c()};let r=s[0].monthCode,n=function(e,t){let[a,s]=e.split("-").map(Number),[r,i]=t.split("-").map(Number),n=new Date(a,s-1);return Math.round((new Date(r,i-1).getTime()-n.getTime())/2630016e3)}(r,c());t=n<=0?"up-to-date":"behind";let o=function(e){let[t,a]=e.split("-").map(Number),s=new Date(t,a-1);s.setMonth(s.getMonth()+1);let r=s.getFullYear(),i=(s.getMonth()+1).toString().padStart(2,"0");return"".concat(r,"-").concat(i)}(r);return{lastPaidMonth:r,lastPaidMonthText:i(r),currentStatus:t,monthsBehind:Math.max(0,n),suggestedPaymentMonth:i(o),suggestedPaymentMonthCode:o}}function c(){let e=(0,s.tF)(),t=e.getUTCFullYear(),a=(e.getUTCMonth()+1).toString().padStart(2,"0");return"".concat(t,"-").concat(a)}function d(e,t){let a=o(t);return"Pago de cuota social mes de ".concat(a.suggestedPaymentMonth)}},45365:function(e,t,a){"use strict";a.d(t,{D2:function(){return s},LJ:function(){return i},_4:function(){return n},tF:function(){return r}});let s={name:"America/Asuncion",offsetHours:-3,description:"Paraguay (UTC-3)"};function r(){let e=new Date,t=Object.fromEntries(new Intl.DateTimeFormat("en-CA",{timeZone:s.name,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).map(e=>[e.type,e.value]));return new Date(parseInt(t.year),parseInt(t.month)-1,parseInt(t.day),parseInt(t.hour),parseInt(t.minute),parseInt(t.second))}function i(e){if(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)}{let e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:s.name,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}function n(e){let t,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[a,s,r]=e.split("-").map(Number);t=new Date(a,s-1,r)}else t=new Date(e)}else t=e;if(a)return t.toLocaleString("es-PY",{timeZone:s.name,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});if(!("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)))return t.toLocaleDateString("es-PY",{timeZone:s.name,day:"2-digit",month:"2-digit",year:"numeric"});{let[t,a,s]=e.split("-");return"".concat(s.padStart(2,"0"),"/").concat(a.padStart(2,"0"),"/").concat(t)}}},94508:function(e,t,a){"use strict";a.d(t,{Fw:function(){return n},Ji:function(){return l},m9:function(){return o},p6:function(){return i},sQ:function(){return d},sU:function(){return c},xG:function(){return r}});var s=a(45365);function r(e){return new Intl.NumberFormat("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}).format(e)}function i(e){return(0,s._4)(e,!1)}function n(e){let t=(0,s.tF)(),a=new Date(new Date(e).getTime()+108e5),r=t.getUTCFullYear()-a.getUTCFullYear(),i=t.getUTCMonth()-a.getUTCMonth();return(i<0||0===i&&t.getUTCDate()<a.getUTCDate())&&r--,r}function l(){return(0,s.LJ)()}function o(e){let t=e.replace(/\D/g,"");return t?t.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function c(e){return parseInt(e.replace(/\./g,""))||0}function d(e){return Math.round(e)}},32660:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},31047:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},88226:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},48736:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},94630:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},99397:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},18930:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},92369:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},95805:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},32489:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[3643,9690,2971,2117,1744],function(){return e(e.s=55954)}),_N_E=e.O()}]);