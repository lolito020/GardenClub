(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6928],{50518:function(e,a,r){Promise.resolve().then(r.bind(r,36588))},36588:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return u}});var o=r(57437),s=r(69690),i=r(17985),t=r(2265),l=r(99376),n=r(32660),c=r(17689),d=r(27648);function u(){let e=(0,l.useParams)(),a=(0,l.useRouter)(),[r,u]=(0,t.useState)(!1),[m,g]=(0,t.useState)(!0),[x,p]=(0,t.useState)(""),[b,h]=(0,t.useState)(!1),[f,y]=(0,t.useState)(null),[v,j]=(0,t.useState)(""),[N,w]=(0,t.useState)({nombres:"",apellidos:"",ci:"",ruc:"",categoria:"Individual",subcategoria:"Socio",direccion:"",telefono:"",celular:"",email:"",nacimiento:"",nacionalidad:"Paraguaya",datosLaborales:"",alta:"",estado:"AL_DIA",foto:"",observaciones:"",aplicarCuotaIngreso:!1});async function C(){try{let a=await i.L.authenticatedFetch("/api/members/".concat(e.id)),r=await a.json();a.ok?(y(r),w({nombres:r.nombres,apellidos:r.apellidos,ci:r.ci,ruc:r.ruc||"",categoria:r.categoria,subcategoria:r.subcategoria,direccion:r.direccion||"",telefono:r.telefono||"",celular:r.celular||"",email:r.email||"",nacimiento:r.nacimiento||"",nacionalidad:r.nacionalidad||"Paraguaya",datosLaborales:r.datosLaborales||"",alta:r.alta,estado:r.estado,foto:r.foto||"",observaciones:r.observaciones||"",aplicarCuotaIngreso:r.aplicarCuotaIngreso||!1})):p("Socio no encontrado")}catch(e){p("Error al cargar socio")}finally{g(!1)}}(0,t.useEffect)(()=>{e.id&&C()},[e.id]);let k=async e=>{if(!e||0===e.trim().length||!f||e.trim()===f.ci){j("");return}try{let a=await i.L.authenticatedFetch("/api/members?ci=".concat(encodeURIComponent(e.trim()))),r=await a.json();if(a.ok&&Array.isArray(r)&&r.length>0){let a=r.filter(e=>e.id!==f.id);if(a.length>0){let r=a[0];j("Ya existe un ".concat("NO SOCIO"===r.subcategoria?"no-socio":"socio"," registrado con la CI ").concat(e,": ").concat(r.nombres," ").concat(r.apellidos," (").concat(r.codigo,")"))}else j("")}else j("")}catch(e){console.error("Error validating CI:",e),j("")}},S=async r=>{if(r.preventDefault(),p(""),v){p("Por favor, corrija los errores antes de continuar.");return}u(!0);try{let r=await i.L.authenticatedFetch("/api/members/".concat(e.id),{method:"PATCH",body:JSON.stringify(N)}),o=await r.json();r.ok?a.push("/admin/socios/".concat(e.id)):p(o.msg||"Error al actualizar socio")}catch(e){p("Error de conexi\xf3n")}finally{u(!1)}},I=async e=>{var a;let r=null===(a=e.target.files)||void 0===a?void 0:a[0];if(r){if(!["image/jpeg","image/png","image/webp","image/gif"].includes(r.type)){p("El archivo debe ser una imagen (jpg, png, webp, gif).");return}if(r.size>8388608){p("La imagen no puede superar ".concat(8,"MB."));return}h(!0),p("");try{let e=URL.createObjectURL(r);w(a=>({...a,foto:e}))}catch(e){}try{let e=new FormData;e.append("file",r);let a=new AbortController,o=setTimeout(()=>a.abort(),3e4),s=await i.L.authenticatedFetch("/api/uploads",{method:"POST",body:e,signal:a.signal});clearTimeout(o);let t={};try{t=await s.json()}catch(e){throw Error("Respuesta inv\xe1lida del servidor")}if(!s.ok||!(null==t?void 0:t.ok)||!(null==t?void 0:t.path))throw Error((null==t?void 0:t.msg)||"No se pudo subir la foto");w(e=>({...e,foto:t.path}))}catch(e){(null==e?void 0:e.name)==="AbortError"?p("La subida tard\xf3 demasiado. Intentalo de nuevo."):p((null==e?void 0:e.message)||"Error al subir la foto")}finally{h(!1)}}};return m?(0,o.jsx)(s.Z,{children:(0,o.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})})}):f?(0,o.jsx)(s.Z,{children:(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[(0,o.jsx)(d.default,{href:"/admin/socios/".concat(e.id),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,o.jsx)(n.Z,{className:"w-5 h-5"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Editar Socio"}),(0,o.jsx)("p",{className:"text-gray-600",children:"Modifica la informaci\xf3n del socio"})]})]}),x&&(0,o.jsx)("div",{className:"p-4 rounded-lg ".concat(x.includes("Error")?"bg-red-50 text-red-800 border border-red-200":"bg-green-50 text-green-800 border border-green-200"),children:x}),(0,o.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,o.jsxs)("form",{onSubmit:S,className:"p-6 space-y-8",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n Personal"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombres *"}),(0,o.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.nombres,onChange:e=>w(a=>({...a,nombres:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos *"}),(0,o.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.apellidos,onChange:e=>w(a=>({...a,apellidos:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"C\xe9dula de Identidad *"}),(0,o.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-1.5 border rounded-md focus:outline-none focus:ring-2 ".concat(v?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-primary-500"),value:N.ci,onChange:e=>{let a=e.target.value;w(e=>({...e,ci:a})),setTimeout(()=>k(a),500)},onBlur:e=>k(e.target.value)}),v&&(0,o.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RUC"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.ruc,onChange:e=>w(a=>({...a,ruc:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Nacimiento"}),(0,o.jsx)("input",{type:"date",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.nacimiento,onChange:e=>w(a=>({...a,nacimiento:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nacionalidad"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.nacionalidad,onChange:e=>w(a=>({...a,nacionalidad:e.target.value}))})]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Categorizaci\xf3n"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categor\xeda *"}),(0,o.jsxs)("select",{required:!0,className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.categoria,onChange:e=>w(a=>({...a,categoria:e.target.value})),children:[(0,o.jsx)("option",{value:"Individual",children:"Individual"}),(0,o.jsx)("option",{value:"Familiar",children:"Familiar"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subcategor\xeda *"}),(0,o.jsxs)("select",{required:!0,className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.subcategoria,onChange:e=>w(a=>({...a,subcategoria:e.target.value})),children:[(0,o.jsx)("option",{value:"Socio",children:"Socio"}),(0,o.jsx)("option",{value:"Socio Patrimonial",children:"Socio Patrimonial"}),(0,o.jsx)("option",{value:"Socio Vitalicio",children:"Socio Vitalicio"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado *"}),(0,o.jsxs)("select",{required:!0,className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.estado,onChange:e=>w(a=>({...a,estado:e.target.value})),children:[(0,o.jsx)("option",{value:"AL_DIA",children:"Al D\xeda"}),(0,o.jsx)("option",{value:"ATRASADO",children:"Atrasado"}),(0,o.jsx)("option",{value:"SUSPENDIDO",children:"Suspendido"})]})]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n de Contacto"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Direcci\xf3n"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.direccion,onChange:e=>w(a=>({...a,direccion:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,o.jsx)("input",{type:"tel",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.telefono,onChange:e=>w(a=>({...a,telefono:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Celular"}),(0,o.jsx)("input",{type:"tel",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.celular,onChange:e=>w(a=>({...a,celular:e.target.value}))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,o.jsx)("input",{type:"email",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.email,onChange:e=>w(a=>({...a,email:e.target.value}))})]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n Adicional"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 items-start",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Alta *"}),(0,o.jsx)("input",{type:"date",required:!0,className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.alta,onChange:e=>w(a=>({...a,alta:e.target.value}))})]}),(0,o.jsxs)("div",{className:"md:col-span-2",children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Datos Laborales"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.datosLaborales,onChange:e=>w(a=>({...a,datosLaborales:e.target.value}))})]}),(0,o.jsxs)("div",{className:"md:col-span-2",children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),(0,o.jsx)("input",{type:"text",className:"w-full px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.observaciones,onChange:e=>w(a=>({...a,observaciones:e.target.value}))})]}),(0,o.jsxs)("div",{className:"md:col-span-1",children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Foto"}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("input",{type:"file",accept:"image/*",onChange:I,className:"hidden",id:"photo-upload",disabled:b}),(0,o.jsxs)("label",{htmlFor:"photo-upload",className:"flex items-center gap-2 px-3 py-1.5 border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50 disabled:opacity-50 text-sm",children:[(0,o.jsx)(c.Z,{className:"w-4 h-4"}),b?"Subiendo...":"Cambiar Foto"]})]}),N.foto&&(0,o.jsx)("img",{src:N.foto,alt:"Preview",className:"w-10 h-10 rounded-full object-cover mt-2"})]}),(0,o.jsxs)("div",{className:"md:col-span-6",children:[(0,o.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer mt-2",children:[(0,o.jsx)("input",{type:"checkbox",checked:N.aplicarCuotaIngreso,onChange:e=>w(a=>({...a,aplicarCuotaIngreso:e.target.checked})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),(0,o.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Aplicar Cuota de Ingreso (Gs. 15.000.000)"})]}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Se crear\xe1 autom\xe1ticamente un d\xe9bito por la cuota de ingreso al guardar los cambios"})]})]})]}),(0,o.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[(0,o.jsx)(d.default,{href:"/admin/socios/".concat(e.id),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",disabled:r||!!v,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Guardando...":"Guardar Cambios"})]})]})})]})}):(0,o.jsx)(s.Z,{children:(0,o.jsxs)("div",{className:"text-center py-12",children:[(0,o.jsx)("div",{className:"text-gray-500",children:"Socio no encontrado"}),(0,o.jsx)(d.default,{href:"/admin/socios",className:"text-primary-600 hover:text-primary-800 mt-4 inline-block",children:"← Volver a Socios"})]})})}},32660:function(e,a,r){"use strict";r.d(a,{Z:function(){return o}});let o=(0,r(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},17689:function(e,a,r){"use strict";r.d(a,{Z:function(){return o}});let o=(0,r(39763).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},function(e){e.O(0,[3643,9690,2971,2117,1744],function(){return e(e.s=50518)}),_N_E=e.O()}]);