(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6740],{91616:function(e,r,o){Promise.resolve().then(o.bind(o,76715))},76715:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return F}});var t=o(57437),a=o(69690),n=o(2265),s=o(94508);function i(e){let{isOpen:r,onClose:a,memberId:i,member:c,debits:l,onSuccess:d}=e,[u,m]=(0,n.useState)(6),[x,p]=(0,n.useState)(10),[g,h]=(0,n.useState)(0),[b,v]=(0,n.useState)("0"),[f,y]=(0,n.useState)(()=>{let e=new Date;return e.setMonth(e.getMonth()+1),e.toISOString().split("T")[0]}),[N,j]=(0,n.useState)(""),[C,D]=(0,n.useState)(null),[w,E]=(0,n.useState)(null),[I,S]=(0,n.useState)(!1),A=l.reduce((e,r)=>e+(r.monto-(r.paidAmount||0)),0),T=e=>{let r=(0,s.m9)(e),o=(0,s.sU)(r);if(v(r),h(o),A>0){let e=Math.round(o/A*100);e<=80&&p(e)}},F=async()=>{if(!C||!(null==w?void 0:w.valid)){alert("No hay una proyecci\xf3n v\xe1lida para generar el PDF");return}try{S(!0);let{jsPDF:e}=await Promise.all([o.e(9213),o.e(2505),o.e(8758)]).then(o.bind(o,53375)),r=new e("portrait","mm","a4"),t=r.internal.pageSize.width,a=r.internal.pageSize.height,n=[41,128,185],i=[52,73,94],d=[245,246,250],m=[218,223,228],p=25,h=function(e,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r.setFontSize(a),r.setFont("helvetica",n?"bold":"normal");let s=r.getTextWidth(e);r.text(e,(t-s)/2,o)},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;return p+e>a-20&&(r.addPage(),p=25,!0)};r.setFillColor(...n),r.rect(0,0,t,15,"F"),r.setTextColor(255,255,255),r.setFontSize(14),r.setFont("helvetica","bold"),h("CLUB SOCIAL DEPORTIVO",10,14,!0),r.setDrawColor(...n),r.setLineWidth(.8),r.line(20,18,t-20,18),r.setTextColor(...i),h("SOLICITUD DE REFINANCIACI\xd3N",28,16,!0),p=38,r.setFontSize(9),r.setTextColor(...i);let v="".concat((null==c?void 0:c.nombres)||(null==c?void 0:c.nombre)||""," ").concat((null==c?void 0:c.apellidos)||(null==c?void 0:c.apellido)||"").trim(),y=(null==c?void 0:c.cedula)||(null==c?void 0:c.ci)||(null==c?void 0:c.numeroDocumento)||"",N=(null==c?void 0:c.codigo)||(null==c?void 0:c.nroSocio)||(null==c?void 0:c.id)||"";r.setFillColor(...d),r.rect(20,p-5,t-40,15,"F"),r.setDrawColor(...m),r.rect(20,p-5,t-40,15),r.setFont("helvetica","bold"),r.text("SOCIO:",25,p),r.setFont("helvetica","normal"),r.text(v||"Informaci\xf3n no disponible",45,p),r.setFont("helvetica","bold"),r.text("C.I.N\xb0:",25,p+5),r.setFont("helvetica","normal"),r.text(y||"No disponible",45,p+5),r.setFont("helvetica","bold"),r.text("C\xd3DIGO:",120,p),r.setFont("helvetica","normal"),r.text(N||"No disponible",145,p),r.setFont("helvetica","bold"),r.text("FECHA:",120,p+5),r.setFont("helvetica","normal"),r.text(new Date().toLocaleDateString("es-PY"),145,p+5),p+=15,b(40),p+=8,r.setFontSize(11),r.setTextColor(...n),r.setFont("helvetica","bold"),r.text("1. D\xc9BITOS A REFINANCIAR",20,p);let j=p+=6;r.setFillColor(...n),r.rect(20,j,t-40,6,"F"),r.setTextColor(255,255,255),r.setFontSize(9),r.text("CONCEPTO",22,j+4),r.text("MONTO",130,j+4),r.text("VENCIMIENTO",160,j+4),p=j+6,r.setTextColor(...i),r.setFont("helvetica","normal"),l.forEach((e,o)=>{o>0&&o%8==0&&(b(40),p+=10),o%2==0&&(r.setFillColor(...d),r.rect(20,p,t-40,6,"F")),r.setDrawColor(...m),r.rect(20,p,t-40,6);let a=e.concepto.length>45?e.concepto.substring(0,42)+"...":e.concepto;r.text(a,22,p+4),r.text((0,s.xG)(e.monto-(e.paidAmount||0)),130,p+4),r.text(e.vencimiento?(0,s.p6)(e.vencimiento):"N/A",160,p+4),p+=6}),r.setFillColor(...i),r.rect(20,p,t-40,6,"F"),r.setTextColor(255,255,255),r.setFont("helvetica","bold"),r.text("TOTAL A REFINANCIAR:",22,p+4),r.text((0,s.xG)(A),130,p+4),p+=14,b(30),r.setTextColor(...n),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("2. T\xc9RMINOS DE REFINANCIACI\xd3N",20,p),p+=6;let D=[["Cantidad de Cuotas:","".concat(u," cuotas")],["Porcentaje Inicial:","".concat(x,"%")],["Monto Cuota Inicial:",(0,s.xG)(g)],["Fecha Primera Cuota:",(0,s.p6)(f)],["Monto por Cuota:",(0,s.xG)((null==C?void 0:C.installmentAmount)||0)]];if(D.forEach((e,o)=>{let[a,n]=e,s=p+8*o;o%2==0&&(r.setFillColor(...d),r.rect(20,s,t-40,8,"F")),r.setDrawColor(...m),r.rect(20,s,t-40,8),r.setTextColor(...i),r.setFontSize(9),r.setFont("helvetica","bold"),r.text(a,25,s+5),r.setFont("helvetica","normal");let c=t-45-r.getTextWidth(n);r.text(n,c,s+5)}),p+=8*D.length+4,b(50),r.setTextColor(...n),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("3. CRONOGRAMA DE PAGOS",20,p),p+=6,null==C?void 0:C.schedule){let e=C.schedule;if(e.length>8){let o=Math.ceil(e.length/2),a=(t-50)/2;r.setFillColor(...n),r.rect(20,p,a,6,"F"),r.rect(20+a+10,p,a,6,"F"),r.setTextColor(255,255,255),r.setFontSize(8),r.text("CUOTA",25,p+4),r.text("MONTO",60,p+4),r.text("VENCIMIENTO",95,p+4),r.text("CUOTA",25+a+10,p+4),r.text("MONTO",60+a+10,p+4),r.text("VENCIMIENTO",95+a+10,p+4);let c=p+=6;e.forEach((e,t)=>{let n=c+4*Math.floor(t%o);if(t<o)t%2==0&&(r.setFillColor(...d),r.rect(20,n,a,4,"F")),r.setDrawColor(...m),r.rect(20,n,a,4),r.setTextColor(...i),r.text("".concat(e.number),25,n+2.5),r.text((0,s.xG)(e.amount),60,n+2.5),r.text((0,s.p6)(e.dueDate),95,n+2.5);else{let n=t-o,l=c+4*n;n%2==0&&(r.setFillColor(...d),r.rect(20+a+10,l,a,4,"F")),r.setDrawColor(...m),r.rect(20+a+10,l,a,4),r.setTextColor(...i),r.text("".concat(e.number),25+a+10,l+2.5),r.text((0,s.xG)(e.amount),60+a+10,l+2.5),r.text((0,s.p6)(e.dueDate),95+a+10,l+2.5)}}),p=c+4*o+8}else r.setFillColor(...n),r.rect(20,p,t-40,6,"F"),r.setTextColor(255,255,255),r.setFontSize(8),r.text("CUOTA",25,p+4),r.text("MONTO",70,p+4),r.text("VENCIMIENTO",120,p+4),p+=6,e.forEach((e,o)=>{o%2==0&&(r.setFillColor(...d),r.rect(20,p,t-40,5,"F")),r.setDrawColor(...m),r.rect(20,p,t-40,5),r.setTextColor(...i),r.setFontSize(8),r.text("".concat(e.number),25,p+3),r.text((0,s.xG)(e.amount),70,p+3),r.text((0,s.p6)(e.dueDate),120,p+3),p+=5}),p+=4}b(25),r.setTextColor(...n),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("4. RESUMEN FINANCIERO",20,p),p+=6,r.setFillColor(...d),r.rect(20,p,t-40,20,"F"),r.setDrawColor(...n),r.rect(20,p,t-40,20),[["Total Principal Refinanciado:",(0,s.xG)((null==C?void 0:C.principal)||0)],["Cuota Inicial:",(0,s.xG)((null==C?void 0:C.downPaymentAmount)||0)],["Total Financiado en Cuotas:",(0,s.xG)((null==C?void 0:C.totalInInstallments)||0)],["N\xfamero Total de Cuotas:","".concat(u," cuotas")],["Monto por Cuota:",(0,s.xG)((null==C?void 0:C.installmentAmount)||0)]].forEach((e,o)=>{let[a,n]=e,s=p+5+3.5*o;r.setFontSize(9),r.setFont("helvetica","bold"),r.setTextColor(...i),r.text(a,25,s),r.setFont("helvetica","normal"),r.setTextColor(...i);let c=t-45-r.getTextWidth(n);r.text(n,c,s)}),p+=25,b(35),r.setTextColor(...n),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("5. AUTORIZACIONES",20,p),p+=8;let w=(t-60)/2;r.setDrawColor(...m),r.rect(25,p,w,25),r.setFontSize(9),r.setTextColor(...i),r.setFont("helvetica","bold"),r.text("FIRMA DEL SOCIO",25+w/2-r.getTextWidth("FIRMA DEL SOCIO")/2,p+8),r.setFont("helvetica","normal"),r.setFontSize(8),r.text("Acepto los t\xe9rminos y condiciones de esta",30,p+15),r.text("refinanciaci\xf3n y me comprometo a su cumplimiento.",30,p+19),r.rect(35+w,p,w,25),r.setFont("helvetica","bold"),r.text("AUTORIZACI\xd3N DEL CLUB",35+w+w/2-r.getTextWidth("AUTORIZACI\xd3N DEL CLUB")/2,p+8),r.setFont("helvetica","normal"),r.setFontSize(8),r.text("Visto Bueno y Autorizaci\xf3n de la",35+w+5,p+15),r.text("Administraci\xf3n del Club",35+w+5,p+19),p+=32,r.setDrawColor(...m),r.line(20,p,t-20,p),p+=3,r.setFontSize(7),r.setTextColor(...i),h("Documento generado autom\xe1ticamente el ".concat(new Date().toLocaleString("es-PY")," - P\xe1gina 1 de 1"),p);let E=(c.full_name||c.name||"Sin_Nombre").replace(/[^a-zA-Z0-9áéíóúñÁÉÍÓÚÑ\s]/g,"").replace(/\s+/g,"_"),I=c.member_number||c.id,T=new Date().toLocaleDateString("es-PY",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),F="Refinanciacion_".concat(E,"_").concat(I,"_").concat(T,".pdf");r.save(F),alert("PDF generado exitosamente")}catch(e){console.error("Error generating PDF:",e),alert("Error al generar PDF: ".concat(e instanceof Error?e.message:"Error desconocido"))}finally{S(!1)}};return((0,n.useEffect)(()=>{let e=Math.round(x/100*A);h(e),v((0,s.m9)(e.toString()))},[A,x]),(0,n.useEffect)(()=>{r&&e();async function e(){S(!0);try{let[e,r]=await Promise.all([fetch("/api/refinancing/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({principal:A,downPaymentPercent:x,installments:u,startDueDate:f})}).then(e=>e.json()),fetch("/api/refinancing/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({principal:A,downPaymentPercent:x,installments:u,startDueDate:f})}).then(e=>e.json())]);e&&E(e),r&&r.schedule&&D(r)}catch(e){console.error("Error fetching refinancing data:",e),E({valid:!1,errors:["Error al cargar datos"],warnings:[]}),D(null)}finally{S(!1)}}},[A,x,u,f,r]),r)?l&&0!==l.length?(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-lg max-h-[90vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Refinanciaci\xf3n de Deuda"}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"D\xe9bitos seleccionados"}),(0,t.jsx)("ul",{className:"text-sm list-disc pl-5",children:l.map(e=>(0,t.jsxs)("li",{children:[e.concepto," — ",(0,s.xG)(e.monto-(e.paidAmount||0))," (Vence: ",e.vencimiento?(0,s.p6)(e.vencimiento):"-",")"]},e.id))})]}),I&&(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-center",children:[(0,t.jsx)("span",{className:"animate-spin text-blue-600",children:"⟳"})," Calculando proyecci\xf3n..."]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Cantidad de cuotas"}),(0,t.jsx)("input",{type:"number",min:1,max:12,value:u,onChange:e=>m(Number(e.target.value)),className:"w-full border rounded px-2 py-1"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Porcentaje de Cuota Inicial (%)"}),(0,t.jsx)("input",{type:"number",min:0,max:80,value:x,onChange:e=>p(Number(e.target.value)),className:"w-full border rounded px-2 py-1"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Cuota Inicial (monto)"}),(0,t.jsx)("input",{type:"text",inputMode:"numeric",value:b,onChange:e=>T(e.target.value),className:"w-full border rounded px-2 py-1 font-mono text-right",placeholder:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Fecha 1\xaa cuota"}),(0,t.jsx)("input",{type:"date",value:f,onChange:e=>y(e.target.value),className:"w-full border rounded px-2 py-1"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Observaciones"}),(0,t.jsx)("textarea",{value:N,onChange:e=>j(e.target.value),className:"w-full border rounded px-2 py-1"})]}),w&&!w.valid&&w.errors&&(0,t.jsx)("div",{className:"bg-red-100 text-red-700 p-2 rounded",children:w.errors.map(e=>(0,t.jsx)("div",{children:e},e))}),C&&C.schedule&&Array.isArray(C.schedule)&&(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,t.jsx)("div",{className:"font-semibold mb-3",children:"Proyecci\xf3n de cuotas"}),(0,t.jsx)("div",{className:"overflow-x-auto mb-4",children:(0,t.jsxs)("table",{className:"w-full text-sm border-collapse border border-gray-300",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-100",children:[(0,t.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Cuota Nro."}),(0,t.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-right",children:"Monto"}),(0,t.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"Fecha de Vencimiento"})]})}),(0,t.jsx)("tbody",{children:C.schedule.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"border border-gray-300 px-3 py-2 font-medium",children:e.number}),(0,t.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-right font-mono",children:(0,s.xG)(e.amount)}),(0,t.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-center",children:(0,s.p6)(e.dueDate)})]},e.number))})]})}),(0,t.jsxs)("div",{className:"border-t border-gray-300 pt-3 space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Total principal:"}),(0,t.jsx)("span",{className:"font-bold",children:(0,s.xG)(C.principal||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Cuota inicial:"}),(0,t.jsx)("span",{className:"font-bold text-blue-600",children:(0,s.xG)(C.downPaymentAmount||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Total en cuotas:"}),(0,t.jsx)("span",{className:"font-bold text-green-600",children:(0,s.xG)(C.totalInInstallments||0)})]})]})]})]}),(0,t.jsxs)("div",{className:"p-6 border-t flex justify-between items-center",children:[(0,t.jsx)("button",{onClick:()=>F(),disabled:!C||!(null==w?void 0:w.valid)||I,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:"\uD83D\uDCC4 Generar PDF"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,t.jsx)("button",{onClick:async()=>{if(!(null==w?void 0:w.valid)){alert("Por favor corrige los errores antes de continuar.");return}S(!0);try{let e={memberId:i,debitIds:l.map(e=>e.id),principal:A,installments:u,downPaymentPercent:x,downPaymentAmount:g,startDueDate:f,observations:N},r=await fetch("/api/refinancing/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok)await r.json(),alert("\xa1Refinanciaci\xf3n creada exitosamente!"),d();else{let e=await r.text();throw Error("Error ".concat(r.status,": ").concat(e))}}catch(e){console.error("Error processing refinancing:",e),alert("Error al procesar la refinanciaci\xf3n: ".concat(e instanceof Error?e.message:"Error desconocido"))}finally{S(!1)}},disabled:!(null==w?void 0:w.valid)||I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"animate-spin mr-1",children:"⟳"})," Procesando..."]}):"♻️ Refinanciar"})]})]})]})}):(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-lg shadow-lg p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Error"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"No se han seleccionado d\xe9bitos para refinanciar."}),(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cerrar"})]})}):null}var c=o(17985),l=o(45365),d=o(92735),u=o(88226),m=o(99397),x=o(73247),p=o(92369),g=o(17684);let h=(0,o(39763).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var b=o(32489),v=o(27648),f=o(18930);function y(e){let{conceptos:r,services:o,selectedMember:a,showFormValidation:n,vencimientoDefault:s,onAddConcepto:i,onUpdateConcepto:c,onRemoveConcepto:l,formatNumberWithSeparator:d,getNumericValueSafe:u,isServiceDuplicate:x,onServiceSelection:p,title:g="Conceptos",buttonColor:h="",onOpenReservaModal:b,modoReservaUnica:v=!1,onToggleModoReserva:y,canShowMultiReserva:N=!1,conceptosConReservaCount:j=0}=e;return(0,t.jsxs)("div",{className:"mb-4 bg-white p-3 rounded-lg border border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-gray-800",children:g}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[N&&y&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 rounded-md px-2 py-1 border border-gray-200",children:[(0,t.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"modo-reserva-".concat(g),checked:!v,onChange:()=>!v||y(),className:"w-3 h-3 text-gray-600 border-gray-300 focus:ring-gray-500"}),(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Reserva Individual"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"modo-reserva-".concat(g),checked:v,onChange:()=>v||y(),className:"w-3 h-3 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Reserva \xdanica"}),v&&j>0&&(0,t.jsxs)("span",{className:"text-xs text-blue-600 font-semibold",children:["(",j,")"]})]})]}),(0,t.jsxs)("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-3 py-1.5 ".concat(h," text-white rounded-md text-sm hover:opacity-90 transition-colors"),children:[(0,t.jsx)(m.Z,{size:14})," A\xf1adir concepto"]})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-[13px]",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,t.jsx)("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[180px]",children:"Servicio"}),(0,t.jsx)("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[80px]",children:"Tipo"}),(0,t.jsx)("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[100px]",children:"Monto"}),(0,t.jsx)("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[110px]",children:"Vencimiento"}),(0,t.jsx)("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[50px]",children:"D\xedas"}),(0,t.jsx)("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[80px]",children:"Suscripci\xf3n"}),(0,t.jsx)("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[120px]",children:"Espacios"}),(0,t.jsx)("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[80px]",children:"Reserva"}),(0,t.jsx)("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[50px]",children:"Acci\xf3n"})]})}),(0,t.jsx)("tbody",{children:r.map(e=>(0,t.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,t.jsxs)("td",{className:"p-1",children:[(0,t.jsxs)("select",{value:e.servicioId,onChange:async r=>{var t,n;let s=r.target.value;if(p){await p(e.id,s);return}let i=o.find(e=>e.id===s),l=i?String((null==a?void 0:a.subcategoria)==="NO SOCIO"?null!==(t=i.precioNoSocio)&&void 0!==t?t:i.precio:null!==(n=i.precioSocio)&&void 0!==n?n:i.precio):"";c(e.id,"servicioId",s),c(e.id,"concepto",(null==i?void 0:i.nombre)||""),c(e.id,"monto",l?d(l):""),(null==i?void 0:i.tipo)&&c(e.id,"tipoServicio",i.tipo)},className:"w-full px-1 py-1 text-[13px] border rounded focus:outline-none focus:ring-1 ".concat(n&&!e.servicioId?"border-red-300 focus:ring-red-500":n&&e.servicioId&&x(r,e.servicioId,o)?"border-amber-300 focus:ring-amber-500":"border-gray-300 focus:ring-blue-500"),children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar —"}),o.filter(o=>{let t=(null==a?void 0:a.subcategoria)==="NO SOCIO";return!!function(e,r){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!r&&!o)return!0;let t=!o&&(null==r?void 0:r.subcategoria)!=="NO SOCIO",a=o||(null==r?void 0:r.subcategoria)==="NO SOCIO";if(!0===e.agendamiento){if(t)return!0;if(a)return!0===e.noSocios}return t?!0===e.socios:!!a&&!0===e.noSocios}(o,a,t)&&(!!(o.nombre.toUpperCase().includes("HORA EXTRA")||o.nombre.toUpperCase().includes("HORAS EXTRA"))||!!e.requiereReserva||!r.some(r=>r.servicioId===o.id&&r.id!==e.id&&!r.requiereReserva))}).map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombre},e.id))]}),n&&!e.servicioId&&(0,t.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"Requerido"}),n&&e.servicioId&&!e.requiereReserva&&x(r,e.servicioId,o)&&(0,t.jsx)("div",{className:"text-xs text-amber-700 mt-1",children:"Servicio repetido"})]}),(0,t.jsx)("td",{className:"p-1",children:(0,t.jsxs)("select",{value:e.tipoServicio,onChange:r=>c(e.id,"tipoServicio",r.target.value),className:"w-full px-1 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"MENSUAL",children:"Mensual"}),(0,t.jsx)("option",{value:"ANUAL",children:"Anual"}),(0,t.jsx)("option",{value:"UNICO",children:"\xdanico"}),(0,t.jsx)("option",{value:"DIARIO",children:"Diario"})]})}),(0,t.jsxs)("td",{className:"p-1",children:[(0,t.jsx)("input",{type:"text",inputMode:"numeric",value:e.monto,onChange:r=>c(e.id,"monto",d(r.target.value)),className:"w-24 px-1 py-1 text-[13px] border rounded focus:outline-none focus:ring-1 ".concat(n&&(!e.monto||0>=parseFloat(u(e.monto)))?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"),placeholder:"50.000"}),n&&(!e.monto||0>=parseFloat(u(e.monto)))&&(0,t.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"Requerido"})]}),(0,t.jsx)("td",{className:"p-1",children:(0,t.jsx)("input",{type:"date",value:(()=>{if(e.requiereReserva&&e.reservaFecha)return e.reservaFecha.slice(0,10);if(e.relatedToReservaConceptId){let o=r.find(r=>r.id===e.relatedToReservaConceptId);if(null==o?void 0:o.reservaFecha)return o.reservaFecha.slice(0,10)}return e.vencimiento||s||""})(),onChange:r=>c(e.id,"vencimiento",r.target.value),className:"w-full px-1 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),(0,t.jsxs)("td",{className:"p-1 text-center",children:["DIARIO"===e.tipoServicio?(0,t.jsx)("input",{type:"number",min:1,value:e.dias||1,onChange:r=>c(e.id,"dias",Math.max(1,parseInt(r.target.value)||1)),className:"w-12 px-1 py-1 text-[13px] border rounded focus:outline-none focus:ring-1 text-center ".concat(n&&"DIARIO"===e.tipoServicio&&(!e.dias||e.dias<=0)?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500")}):(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"—"}),n&&"DIARIO"===e.tipoServicio&&(!e.dias||e.dias<=0)&&(0,t.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"Requerido"})]}),(0,t.jsx)("td",{className:"p-1 text-center",children:(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.crearSuscripcion||!1,onChange:r=>c(e.id,"crearSuscripcion",r.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsx)("span",{className:"sr-only",children:"Crear suscripci\xf3n"})]})}),(0,t.jsx)("td",{className:"p-1 text-center",children:(()=>{let r=o.find(r=>r.id===e.servicioId);if(!e.requiereReserva||!e.servicioId)return(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"—"});let a=[];return((null==r?void 0:r.espaciosDisponibles)&&r.espaciosDisponibles.length>0?a=r.espaciosDisponibles:(null==r?void 0:r.espacios)&&r.espacios.length>0&&(a=r.espacios.map((e,o)=>({id:"espacio-".concat(r.id,"-").concat(o),nombre:e,descripcion:"",activo:!0}))),0===a.length)?(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"—"}):(0,t.jsxs)("select",{value:(()=>{let r=e.reservaVenueId,t=o.find(r=>r.id===e.servicioId);if(r){if(!a.find(e=>e.id===r)){if(console.warn("⚠️ Concepto ".concat(e.concepto," (").concat(null==t?void 0:t.nombre,") tiene venueId ").concat(r," que no est\xe1 en espacios disponibles:"),a.map(e=>e.nombre)),a.length>0){let r=a[0].id;return setTimeout(()=>c(e.id,"reservaVenueId",r),0),r}return""}return r}if(a.length>0){let r=a[0].id;return console.log("✅ Auto-seleccionando primer espacio para ".concat(e.concepto," (").concat(null==t?void 0:t.nombre,"): ").concat(a[0].nombre)),setTimeout(()=>c(e.id,"reservaVenueId",r),0),r}return""})(),onChange:r=>c(e.id,"reservaVenueId",r.target.value),className:"w-full px-1 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[0===a.length&&(0,t.jsx)("option",{value:"",children:"Sin espacios disponibles"}),a.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombre},e.id))]})})()}),(0,t.jsx)("td",{className:"p-1 text-center",children:(()=>{let r=o.find(r=>r.id===e.servicioId);if(!(null==r?void 0:r.permiteAgendamiento))return(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"—"});let a=e.requiereReserva,n=a&&e.reservaFechaHora;return(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:a||!1,onChange:r=>c(e.id,"requiereReserva",r.target.checked),className:"w-3 h-3 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),(0,t.jsx)("span",{className:"sr-only",children:"Requiere reserva"})]}),a&&!v&&(0,t.jsx)("button",{type:"button",onClick:()=>null==b?void 0:b(e.id),className:"text-xs px-1 py-0.5 rounded transition-colors ".concat(n?"text-green-700":"text-purple-700"),title:n?"Editar reserva existente":"Configurar nueva reserva",children:n?"Editar":"Agendar"})]})})()}),(0,t.jsx)("td",{className:"p-1 text-center",children:(0,t.jsx)("button",{type:"button",onClick:()=>l(e.id),className:"inline-flex items-center justify-center w-6 h-6 text-red-600 hover:bg-red-50 rounded-md transition-colors",title:"Eliminar concepto",children:(0,t.jsx)(f.Z,{size:14})})})]},e.id))})]})})]})}function N(e){let{condicion:r,conceptos:o,pagoAplicado:a,permitirPagosParc:n,calculateTotal:s,getNumericValue:i,onProcessPayment:c,isFormValid:l,saving:d,onCancel:u}=e,m=s(o),x=a?parseInt(i(a)):0,p=m-x,g="CONTADO"===r?{texto:"PAGO COMPLETO",color:"text-green-700 bg-green-50 border-green-200"}:"CREDITO"===r?n&&x>0?x>=m?{texto:"PAGO COMPLETO",color:"text-green-700 bg-green-50 border-green-200"}:{texto:"PAGO PARCIAL",color:"text-blue-700 bg-blue-50 border-blue-200"}:{texto:"PENDIENTE",color:"text-orange-700 bg-orange-50 border-orange-200"}:{texto:"PENDIENTE",color:"text-gray-700 bg-gray-50 border-gray-200"};return(0,t.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Resumen de Pago"}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Total:"}),(0,t.jsxs)("span",{className:"font-semibold text-gray-900",children:["Gs. ",m>0?parseInt(String(m)).toLocaleString("es-PY"):"0"]})]}),(0,t.jsx)("div",{className:"px-3 py-2 rounded-lg border text-center ".concat(g.color),children:(0,t.jsx)("span",{className:"text-xs font-medium",children:g.texto})}),Array.isArray(o)&&o.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[(0,t.jsxs)("span",{children:["\uD83D\uDCCB ",o.length," concepto",1!==o.length?"s":""]}),"CONTADO"===r&&(0,t.jsx)("span",{children:"✅ Pago inmediato"}),"CREDITO"===r&&!n&&(0,t.jsx)("span",{children:"\uD83D\uDCDD A cr\xe9dito"}),"CREDITO"===r&&n&&(0,t.jsx)("span",{children:"\uD83D\uDCB0 Con pago parcial"})]}),"CREDITO"===r&&n&&x>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Pagado:"}),(0,t.jsxs)("span",{className:"font-semibold text-green-600",children:["Gs. ",x.toLocaleString("es-PY")]})]}),"CREDITO"===r&&n&&x>0&&p>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Saldo:"}),(0,t.jsxs)("span",{className:"font-semibold text-orange-600",children:["Gs. ",p.toLocaleString("es-PY")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:c,disabled:d||!l,className:"px-4 py-2 rounded-lg text-white font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat("CONTADO"===r?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"),children:d?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-2 border-white border-t-transparent"}),"Guardando..."]}):"CONTADO"===r?"Pagar":"Registrar"}),(0,t.jsx)("button",{onClick:u,disabled:d,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 text-sm transition-colors disabled:opacity-50",children:"Cancelar"})]})]})]})}function j(){try{return String(Math.random().toString(36).slice(2,9))}catch(e){return Date.now().toString(36)}}function C(e){return e?String(e).replace(/\./g,"").replace(/,/g,"."):"0"}function D(e){return e&&0!==e.length?e.reduce((e,r)=>e+(Number(C(r.monto))||0),0):0}function w(e,r,o){if(!e||!r||"HORAS_EXTRAS_TEMP"===r)return!1;if(o){let t=o.find(e=>e.id===r);if(t){let o=0;if(t.espaciosDisponibles&&Array.isArray(t.espaciosDisponibles)?o=t.espaciosDisponibles.length:t.espacios&&Array.isArray(t.espacios)&&(o=t.espacios.length),o>1)return e.reduce((e,o)=>e+(o.servicioId===r?1:0),0)>=o}}return e.reduce((e,o)=>e+(o.servicioId===r?1:0),0)>1}function E(e,r,o){if(!e)return(0,l.LJ)();let t=new Date(e);switch(r){case"MENSUAL":t.getDate(),t.setMonth(t.getMonth()+1);break;case"ANUAL":t.setFullYear(t.getFullYear()+1);break;case"DIARIO":t.setDate(t.getDate()+(o||1));break;case"UNICO":return e;default:t.setMonth(t.getMonth()+1)}return t.toISOString().slice(0,10)}function I(e,r,o){if(e.vencimientoManual){if(o&&o!==e.tipoServicio){let t=E(r,o,e.dias);return{...e,tipoServicio:o,vencimiento:t,vencimientoManual:!1}}return e}let t=E(r,o||e.tipoServicio,e.dias);return{...e,...o&&{tipoServicio:o},vencimiento:t}}function S(e){let r=String(e||"").toUpperCase();return"DEBIT"===r||"DEBE"===r?"DEBIT":"CREDIT"===r||"HABER"===r?"CREDIT":"DEBIT"}function A(e,r){if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return"";let[o,t,a]=e.split("-").map(Number),n=new Date(o,(null!=t?t:1)-1,null!=a?a:1);n.setDate(n.getDate()+r);let s=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0");return"".concat(s,"-").concat(i,"-").concat(c)}function T(e){let r="string"==typeof e?Number(e):null!=e?e:0;return Number.isFinite(r)?r:0}function F(){var e,r,f,F,O,P,k,H,R;let[L,M]=(0,n.useState)([]),[U,G]=(0,n.useState)([]),[q,z]=(0,n.useState)([]),[V,B]=(0,n.useState)([]),[Y,_]=(0,n.useState)(!0),[J,Z]=(0,n.useState)(""),[X,Q]=(0,n.useState)("nombre"),[W,$]=(0,n.useState)(""),[K,ee]=(0,n.useState)(""),[er,eo]=(0,n.useState)(""),[et,ea]=(0,n.useState)(!1),[en,es]=(0,n.useState)(!1),[ei,ec]=(0,n.useState)(null),[el,ed]=(0,n.useState)("unified"),[eu,em]=(0,n.useState)(!1),[ex,ep]=(0,n.useState)(""),[eg,eh]=(0,n.useState)([]),[eb,ev]=(0,n.useState)(!1),[ef,ey]=(0,n.useState)({venueId:"",fecha:(0,s.Ji)(),inicioHora:"19:00",finHora:"03:00",observaciones:"",cedula:"",telefono:"",ruc:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:"",acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:"",cantidadPersonas:"",observacionesGenerales:"",requiereApa:!0}),[eN,ej]=(0,n.useState)(!1),[eC,eD]=(0,n.useState)([]),[ew,eE]=(0,n.useState)({venueId:"",fecha:(0,s.Ji)(),inicioHora:"19:00",finHora:"03:00",observaciones:"",configuracionIndividual:!1,cedula:"",telefono:"",ruc:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:"",acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:"",cantidadPersonas:"",observacionesGenerales:"",requiereApa:!0,configuracionesIndividuales:{}}),[eI,eS]=(0,n.useState)({condicion:"CONTADO",fecha:(0,s.Ji)(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,s.Ji)(),30),observaciones:"",crearSuscripcion:!1,pagoAplicado:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",permitirPagosParc:!1,presupuestoDeudas:"",conceptos:[{id:j(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,s.Ji)(),30),observaciones:"",condicion:"CONTADO"}]});function eA(e,r){let o=function(e){(0,l.LJ)();let r=(0,l.tF)();return r.setUTCDate(r.getUTCDate()+30),{id:j(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:r.toISOString().slice(0,10),observaciones:"",crearSuscripcion:!1,vencimientoManual:!1,condicion:e||"CONTADO"}}(r||eI.condicion),t=E(e||eI.fecha||(0,s.Ji)(),"MENSUAL");return{...o,vencimiento:t,vencimientoManual:!1}}function eT(e,r,o,t){return eS(a=>({...a,conceptos:function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.map(a=>(a.concepto.toUpperCase().includes("HORA EXTRA")||"UNICO"===a.tipoServicio&&a.concepto.includes("h"))&&(t&&a.relatedToReservaConceptId===t||!t&&!a.relatedToReservaConceptId)?{...a,concepto:"HORA EXTRA (".concat(e,"h)"),monto:op(r.toString()),observaciones:o||"Hora extra - ".concat(e," hora(s)"),relatedToReservaConceptId:t}:a)}(a.conceptos)})),null}function eF(e,r,o,t){if(t&&function(e){let r=eI.conceptos;return r&&e&&r.find(r=>{let o=r.concepto.toUpperCase().includes("HORA EXTRA")||"UNICO"===r.tipoServicio&&r.concepto.includes("h"),t=r.relatedToReservaConceptId===e;return o&&t})||null}(t))return console.warn("Ya existe concepto de hora extra para esta reservaci\xf3n, actualizando existente"),eT(e,r,o,t);if(function(e,r,o){let t=eI.conceptos;return!!t&&t.some(t=>{let a=t.concepto.toUpperCase().includes("HORA EXTRA")||"UNICO"===t.tipoServicio&&t.concepto.includes("".concat(e,"h")),n=parseFloat(C(t.monto))===r,s=o&&t.observaciones&&t.observaciones.includes(o.substring(0,20));return a&&n&&s})}(e,r,o))return console.warn("Ya existe un concepto de hora extra similar, actualizando existente"),eT(e,r,o,t);let a=function(e,r,o,t){let a=q.find(e=>e.nombre.toUpperCase().includes("HORA EXTRA")||e.nombre.toUpperCase().includes("HORAS EXTRA")),n=(null==a?void 0:a.id)||"HORAS_EXTRAS_TEMP";return a||console.warn("⚠️ Servicio Horas Extras no encontrado, usando ID fallback:",n),{id:j(),servicioId:n,concepto:"HORA EXTRA (".concat(e,"h)"),tipoServicio:"UNICO",monto:op(r.toString()),dias:1,vencimiento:eI.fecha||(0,s.Ji)(),observaciones:o||"Hora extra - ".concat(e," hora(s)"),vencimientoManual:!1,relatedToReservaConceptId:t}}(e,r,o,t);return eS(e=>{let r=(e.conceptos||[]).concat(a);return{...e,conceptos:r}}),a}function eO(e){let r=eA(void 0,eI.condicion);eS(e=>{let o=(e.conceptos||[]).concat(r);return{...e,conceptos:o}})}function eP(e,r){eS(e=>{let o=(e.conceptos||[]).filter(e=>e.id!==r);return 0===o.length&&o.push(eA(void 0,e.condicion)),{...e,conceptos:o}})}function ek(e,r,o,t){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];eS(e=>({...e,conceptos:function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.map(n=>{if(n.id!==r)return n;let s={...n,[o]:t};return"vencimiento"!==o||a?"tipoServicio"===o&&e.fecha?s=I(s,e.fecha,t):"dias"===o&&"DIARIO"===s.tipoServicio&&e.fecha&&(s=I(s,e.fecha,s.tipoServicio)):s={...s,vencimiento:t,vencimientoManual:!0},s})}(e.conceptos)}))}function eH(){return eI.conceptos||[]}async function eR(e,r){var o,t;let a=q.find(e=>e.id===r);if(!a||!ei)return;let n="NO SOCIO"===ei.subcategoria?null!==(o=a.precioNoSocio)&&void 0!==o?o:a.precio:null!==(t=a.precioSocio)&&void 0!==t?t:a.precio,s=eI.condicion||"CONTADO";if(ek(s,e,"servicioId",r),ek(s,e,"concepto",a.nombre),ek(s,e,"monto",op(String(n))),ek(s,e,"tipoServicio",a.tipo),"UNICO"!==a.tipo){let o=await r_(ei.id,r);if(o){let r=(null==o?void 0:o.nextChargeDate)||(null==o?void 0:o.validUntil)||(null==o?void 0:o.nextDueDate)||(null==o?void 0:o.dueDate)||(null==o?void 0:o.vencimiento);r&&ek(s,e,"vencimiento",r,!0)}}}let[eL,eM]=(0,n.useState)([]),[eU,eG]=(0,n.useState)(!1),[eq,ez]=(0,n.useState)(!1),[eV,eB]=(0,n.useState)({nombres:"",apellidos:"",ci:"",telefono:"",email:""}),[eY,e_]=(0,n.useState)("");function eJ(){ez(!1),e_(""),eB({nombres:"",apellidos:"",ci:"",telefono:"",email:""})}let[eZ,eX]=(0,n.useState)({fecha:(0,s.Ji)(),servicioId:"",concepto:"",monto:"",tipoServicio:"MENSUAL",observaciones:"",vencimiento:A((0,s.Ji)(),30),makeSubscription:!1,autoDebit:!0}),[eQ,eW]=(0,n.useState)(!1),[e$,eK]=(0,n.useState)([{id:j(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",montoStr:"",vencimiento:new Date(Date.now()+2592e6).toISOString().slice(0,10)}]),[e0,e1]=(0,n.useState)({fecha:(0,s.Ji)(),metodoPago:"",cobradorId:"",numeroRecibo:"",observaciones:""}),[e2,e3]=(0,n.useState)(""),[e5,e4]=(0,n.useState)(!1),[e6,e7]=(0,n.useState)([]),[e8,e9]=(0,n.useState)({}),[re,rr]=(0,n.useState)([]),[ro,rt]=(0,n.useState)({}),[ra,rn]=(0,n.useState)(!1),[rs,ri]=(0,n.useState)([]),[rc,rl]=(0,n.useState)(!1),[rd,ru]=(0,n.useState)(null),[rm,rx]=(0,n.useState)(!1),[rp,rg]=(0,n.useState)(!1),[rh,rb]=(0,n.useState)([]),[rv,rf]=(0,n.useState)(!1),[ry,rN]=(0,n.useState)(""),[rj,rC]=(0,n.useState)({fecha:(0,s.Ji)(),montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""}),[rD,rw]=(0,n.useState)(!1),[rE,rI]=(0,n.useState)(""),[rS,rA]=(0,n.useState)(10),[rT,rF]=(0,n.useState)(1),[rO,rP]=(0,n.useState)(null),[rk,rH]=(0,n.useState)({x:0,y:0}),rR=(0,n.useRef)(null),[rL,rM]=(0,n.useState)({});async function rU(){_(!0);try{let e=await c.L.authenticatedFetch("/api/members"),r=await e.json(),o=Array.isArray(r)?r:[];M(o);let t=[];for(let e=0;e<o.length;e+=6)t.push(o.slice(e,e+6));let a=[];for(let e of t){let r=await Promise.all(e.map(async e=>{try{let r=await c.L.authenticatedFetch("/api/members/".concat(e.id,"/movements?pageSize=1000"));r.ok||(r=await c.L.authenticatedFetch("/api/movements?memberId=".concat(encodeURIComponent(e.id))));let o=r.headers.get("content-type")||"";if(!r.ok||!o.includes("application/json"))throw Error("fail");let t=await r.json(),a=(Array.isArray(t)?t:Array.isArray(null==t?void 0:t.items)?t.items:[]).map((r,o)=>{var t,a,n,s,i,c,l,d,u,m,x,p,g,h,b,v,f,y;return{id:String(null!==(t=r.id)&&void 0!==t?t:"".concat(e.id,"-").concat(o)),memberId:String(null!==(a=r.memberId)&&void 0!==a?a:e.id),fecha:null!==(s=null!==(n=r.fecha)&&void 0!==n?n:r.date)&&void 0!==s?s:new Date().toISOString(),concepto:String(null!==(c=null!==(i=r.concepto)&&void 0!==i?i:r.description)&&void 0!==c?c:""),tipo:S(null!==(d=null!==(l=r.tipo)&&void 0!==l?l:r.type)&&void 0!==d?d:""),monto:Number(null!==(m=null!==(u=r.monto)&&void 0!==u?u:r.amount)&&void 0!==m?m:0),origen:null!==(p=null!==(x=r.origen)&&void 0!==x?x:r.source)&&void 0!==p?p:void 0,refId:null!==(h=null!==(g=r.refId)&&void 0!==g?g:r.referenceId)&&void 0!==h?h:void 0,vencimiento:null!==(v=null!==(b=r.vencimiento)&&void 0!==b?b:r.dueDate)&&void 0!==v?v:void 0,paidAmount:Number(null!==(f=r.paidAmount)&&void 0!==f?f:0),status:null!==(y=r.status)&&void 0!==y?y:"PENDIENTE",allocations:r.allocations||[]}}),n=(e,r)=>{if(!e||"DEBIT"!==e.tipo)return 0;let o=0;for(let t of r)if(t.allocations&&Array.isArray(t.allocations))for(let r of t.allocations)r.debitId===e.id&&(o+=Number(r.amount||0));return o},i=a.filter(e=>"DEBIT"===S(e.tipo));a.filter(e=>"CREDIT"===S(e.tipo));let l=i.filter(e=>"REFINANCIADO"!==e.status&&"CANCELADO"!==e.status).reduce((e,r)=>{let o=n(r,a);return e+Math.max(0,(0,s.sQ)(r.monto)-(0,s.sQ)(o))},0),d="SUSPENDIDO"===e.estado?"SUSPENDIDO":function(e){let r=new Date;r.setHours(0,0,0,0);let o=e.filter(e=>"DEBIT"===S(e.tipo)&&Number(e.monto||0)-Number(e.paidAmount||0)>0);if(0===o.length)return"AL_DIA";for(let e of o)if(e.vencimiento){let o=new Date(e.vencimiento);if(o.setHours(0,0,0,0),o.getTime()<r.getTime())return"ATRASADO"}return"AL_DIA"}(a);return[e.id,{saldo:l,estadoCalc:d}]}catch(t){var r;let o="SUSPENDIDO"===e.estado?"SUSPENDIDO":"ATRASADO"===e.estado?"ATRASADO":"AL_DIA";return[e.id,{saldo:null!==(r=e.deudaTotal)&&void 0!==r?r:0,estadoCalc:o}]}}));a.push(...r)}let n={};a.forEach(e=>{let[r,o]=e;return n[r]=o}),rM(n)}catch(e){console.error("Error loading members/ledgers:",e),M([]),rM({})}finally{_(!1)}}async function rG(){try{let e=await c.L.authenticatedFetch("/api/collectors"),r=await e.json(),o=Array.isArray(r)?r:[];G(o.filter(e=>!1!==e.activo))}catch(e){console.error("Error loading collectors:",e),G([])}}(0,n.useEffect)(()=>{rU(),rG(),rz(),rV(),rY();let e=e=>{let r=e.target;rR.current&&rR.current.contains(r)||rP(null)},r=()=>{rP(null)};return document.addEventListener("click",e),window.addEventListener("scroll",r,!0),()=>{document.removeEventListener("click",e),window.removeEventListener("scroll",r,!0)}},[]),(0,n.useEffect)(()=>{if(eQ)return;let e=eZ.fecha;if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return;let r=eZ.tipoServicio,o="MENSUAL"===r?A(e,30):"ANUAL"===r?A(e,365):e;eX(e=>({...e,vencimiento:o||e.vencimiento}))},[eZ.fecha,eZ.tipoServicio,eQ]),(0,n.useEffect)(()=>{let e=(0,s.sU)(e2);e9(r=>(function(e,r,o){let t=r.map(e=>e.id),a=o,n={};for(let r of t){let o=T(e[r]||0);if(!o)continue;if(a<=0){n[r]="";continue}let t=Math.min(o,a);n[r]=t?String(t):"",a-=t}return n})(r,e6,e))},[e2,e6]),(0,n.useEffect)(()=>{if(ei&&0!==rs.length&&eH().some(e=>{let r=q.find(r=>r.id===e.servicioId);if(!r)return!1;let o=r.nombre.toLowerCase();return o.includes("cuota social")||o.includes("cuota mensual")||o.includes("mensualidad")})&&!eI.observaciones){let e=ei.codigo||"",r=rs.map(e=>({id:e.id,fecha:e.fecha,concepto:e.concepto,observaciones:e.observaciones||"",monto:e.monto,tipo:"CREDIT"===e.tipo?"credito":"debito",socio_id:e.memberId}));o.e(8592).then(o.bind(o,98592)).then(o=>{let{generateSocialQuotaObservation:t}=o,a=t(e,r);eS(e=>({...e,observaciones:a}))})}},[eI.conceptos,q,ei,rs,eI.observaciones]);let rq=()=>U.find(e=>"CLUB"===e.tipoCobrador);async function rz(){try{let e=await c.L.authenticatedFetch("/api/services"),r=await e.json(),o=(Array.isArray(r)?r:[]).filter(e=>!1!==e.activo);o.some(e=>e.nombre.toUpperCase().includes("HORA EXTRA")||e.nombre.toUpperCase().includes("HORAS EXTRA"))||(console.log('⚠️ Agregando servicio "Horas Extras" autom\xe1ticamente'),o.push({id:"HORAS_EXTRAS_TEMP",nombre:"Horas Extras",precio:0,tipo:"UNICO",activo:!0,descripcion:"Servicio para conceptos de hora extra",permiteAgendamiento:!1})),z(o)}catch(e){console.error("Error loading services:",e),z([{id:"HORAS_EXTRAS_TEMP",nombre:"Horas Extras",precio:0,tipo:"UNICO",activo:!0,descripcion:"Servicio para conceptos de hora extra",permiteAgendamiento:!1}])}}async function rV(){try{let e=await c.L.authenticatedFetch("/api/payment-methods"),r=await e.json(),o=(Array.isArray(r)?r:[]).filter(e=>!1!==e.activo);B(o.length?o:rB()),o.length||console.warn("payment-methods vac\xedo, usando fallback.")}catch(e){B(rB())}}function rB(){return[{id:"efectivo",nombre:"Efectivo"},{id:"transferencia",nombre:"Transferencia"},{id:"tarjeta",nombre:"Tarjeta"},{id:"cheque",nombre:"Cheque"}]}async function rY(){try{let e=await c.L.authenticatedFetch("/api/venues"),r=await e.json();eh(Array.isArray(r)?r.filter(e=>!1!==e.activo):[])}catch(e){console.error("Error loading venues:",e),eh([])}}async function r_(e,r){try{let o=await c.L.authenticatedFetch("/api/members/".concat(encodeURIComponent(e),"/subscriptions")),t=await o.json().catch(()=>({})),a=Array.isArray(t)?t:Array.isArray(null==t?void 0:t.items)?t.items:[];return(a=a.filter(e=>String(e.serviceId)===String(r)&&"ACTIVE"===e.status))[0]||null}catch(e){return null}}let rJ=async e=>{var r,o;ec(e),es(!0),ed("unified"),eG(!1),((e.deudaTotal||0)>0||((null===(r=rL[e.id])||void 0===r?void 0:r.saldo)||0)>0)&&rK(e.id),await r0(e.id);let t=rq(),a=(null==t?void 0:t.id)||"";eS({condicion:"CONTADO",fecha:(0,s.Ji)(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,s.Ji)(),30),observaciones:"",crearSuscripcion:!1,pagoAplicado:"",metodoPago:(null===(o=V[0])||void 0===o?void 0:o.id)||"efectivo",cobradorId:a,numeroRecibo:"",referencia:"",permitirPagosParc:!1,presupuestoDeudas:"",conceptos:[eA(void 0,"CONTADO")]}),e9({}),await rK(e.id)},rZ=()=>{es(!1),ec(null),ed("unified"),e7([]),e9({}),rr([]),rn(!1),eG(!1),rC({fecha:(0,s.Ji)(),montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""});let e=rq(),r=(null==e?void 0:e.id)||"";eS({condicion:"CONTADO",fecha:(0,s.Ji)(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,s.Ji)(),30),observaciones:"",crearSuscripcion:!1,pagoAplicado:"",metodoPago:"",cobradorId:r,numeroRecibo:"",referencia:"",permitirPagosParc:!1,presupuestoDeudas:"",conceptos:[eA(void 0,"CONTADO")]})},rX=e=>{ep(e);let r=eI.conceptos,o=null==r?void 0:r.find(r=>r.id===e),t=[];if(null==o?void 0:o.servicioId){let e=q.find(e=>e.id===o.servicioId);e&&(e.espaciosDisponibles&&e.espaciosDisponibles.length>0?(t=e.espaciosDisponibles.map(e=>({id:e.id,nombre:e.nombre,descripcion:e.descripcion,activo:!0,precioBaseHora:e.precioBaseHora,capacidad:e.capacidad})),console.log("\uD83D\uDCCD Espacios (nuevos) para ".concat(e.nombre,":"),t.map(e=>e.nombre))):e.espacios&&e.espacios.length>0?(t=e.espacios.map((r,o)=>({id:"".concat(e.id,"-espacio-").concat(o),nombre:r,descripcion:"Espacio para ".concat(e.nombre),activo:!0,precioBaseHora:e.precio||0,capacidad:4})),console.log("\uD83D\uDCCD Espacios (antiguos) para ".concat(e.nombre,":"),t.map(e=>e.nombre))):(t=[{id:"servicio-".concat(e.id),nombre:e.nombre,descripcion:"Espacio para ".concat(e.nombre),activo:!0,precioBaseHora:e.precio||0,capacidad:1}],console.log("\uD83D\uDCCD Espacio virtual para ".concat(e.nombre,":"),e.nombre)))}0===t.length&&(t=eg,console.log("\uD83D\uDCCD Usando venues globales como fallback")),o&&o.reservaVenueId?ey(e=>({...oa(),venueId:o.reservaVenueId||"",fecha:o.reservaFecha||(0,s.Ji)(),inicioHora:o.reservaHoraInicio||"19:00",finHora:o.reservaHoraFin||"23:00",observaciones:o.reservaObservaciones||"",cedula:o.reservaCedula||(null==ei?void 0:ei.ci)||"",telefono:o.reservaTelefono||(null==ei?void 0:ei.telefono)||"",ruc:o.reservaRuc||"",esParaTercero:o.reservaEsParaTercero||!1,terceroNombre:o.reservaTerceroNombre||"",terceroCedula:o.reservaTerceroCedula||"",terceroTelefono:o.reservaTerceroTelefono||"",terceroRuc:o.reservaTerceroRuc||"",horaExtra:o.reservaHoraExtra||!1,cantidadHorasExtra:o.reservaCantidadHorasExtra||"",montoHorasExtra:o.reservaMontoHorasExtra||"",acontecimiento:o.reservaAcontecimiento||"",quinceaneraFocusNombre:o.reservaQuinceaneraFocusNombre||"",noviosNombres:o.reservaNoviosNombres||"",cumpleaneroNombre:o.reservaCumpleaneroNombre||"",otrosDescripcion:o.reservaOtrosDescripcion||"",otrosNombrePersona:o.reservaOtrosNombrePersona||"",cantidadPersonas:o.reservaCantidadPersonas||"",observacionesGenerales:o.reservaObservacionesGenerales||""})):ey(e=>({...oa(),venueId:t.length>0?t[0].id:"",cedula:(null==ei?void 0:ei.ci)||"",telefono:(null==ei?void 0:ei.telefono)||""})),eh(t),console.log("\uD83C\uDFAF Modal abierto para servicio: ".concat(null==o?void 0:o.servicioId," con ").concat(t.length," espacio(s) disponible(s)")),em(!0)},rQ=()=>{em(!1),ep(""),ey(oa()),rY()},rW=async(e,r,o,t)=>{try{let a=new Date("".concat(r,"T").concat(o,":00")),n=new Date("".concat(r,"T").concat(t,":00"));n<=a&&n.setDate(n.getDate()+1),console.log("\uD83D\uDD0D Validando disponibilidad para: venueId=".concat(e,", fecha=").concat(r));let s="/api/reservas?resourceId=".concat(e,"&dateFrom=").concat("".concat(r,"T00:00:00.000Z"),"&dateTo=").concat("".concat(r,"T23:59:59.999Z"));console.log("\uD83D\uDCE1 URL de consulta: ".concat(s));let i=await c.L.authenticatedFetch(s);if(!i.ok)return console.warn("No se pudo validar disponibilidad, status:",i.status),{available:!0};let l=await i.json();console.log("\uD83D\uDCCB Reservas encontradas para ".concat(e,":"),l);let d=l.filter(e=>{if("CANCELADO"===e.status)return!1;let r=new Date(e.start),o=new Date(e.end);return a>=r&&a<o||n>r&&n<=o||a<=r&&n>=o});if(d.length>0){let e=d.map(e=>{let r=new Date(e.start).toLocaleTimeString("es-PY",{hour:"2-digit",minute:"2-digit"}),o=new Date(e.end).toLocaleTimeString("es-PY",{hour:"2-digit",minute:"2-digit"});return"".concat(r," - ").concat(o," (").concat(e.nombreContacto||"Sin contacto",")")}).join("\n");return{available:!1,conflicts:d,message:"El horario seleccionado tiene conflictos con reservas existentes:\n\n".concat(e,"\n\nPor favor seleccione otro horario.")}}return{available:!0}}catch(e){return console.error("Error validating availability:",e),{available:!0}}},r$=async()=>{let e=e=>{let[r,o]=e.split(":").map(Number);return 60*r+o},r=e(ef.finHora),o=e(ef.inicioHora);if(r>180&&r<480&&!(r<o)){alert("La hora de fin debe ser hasta las 03:00 am. Posterior a esa hora se cobra como hora extra.");return}if(!ex||!ef.venueId||!ef.fecha){alert("Por favor complete todos los campos requeridos (Espacio, Fecha)");return}if(ef.esParaTercero&&!ef.terceroNombre.trim()){alert("Por favor ingrese el nombre del tercero");return}if(!ef.acontecimiento){alert("Por favor seleccione un acontecimiento");return}if("15_anos"===ef.acontecimiento&&!ef.quinceaneraFocusNombre.trim()){alert("Por favor ingrese el nombre de la quincea\xf1era");return}if("boda"===ef.acontecimiento&&!ef.noviosNombres.trim()){alert("Por favor ingrese los nombres de los novios");return}if("cumpleanos"===ef.acontecimiento&&!ef.cumpleaneroNombre.trim()){alert("Por favor ingrese el nombre del cumplea\xf1er@");return}if("otros"===ef.acontecimiento&&!ef.otrosDescripcion.trim()){alert("Por favor ingrese la descripci\xf3n del acontecimiento");return}if(ef.horaExtra&&(!ef.cantidadHorasExtra||!ef.montoHorasExtra)){alert("Por favor complete cantidad y monto de las horas extra");return}let t=await rW(ef.venueId,ef.fecha,ef.inicioHora,ef.finHora);if(!t.available){alert("⚠️ Conflicto de horario\n\n".concat(t.message,"\n\nPor favor seleccione otro horario o espacio."));return}try{var a;let e=eI.condicion,r=eI.conceptos;if(r&&r.find(e=>e.id===ex)){ek(e,ex,"reservaVenueId",ef.venueId),ek(e,ex,"reservaFecha",ef.fecha),ek(e,ex,"reservaHoraInicio",ef.inicioHora),ek(e,ex,"reservaHoraFin",ef.finHora),ek(e,ex,"reservaObservaciones",ef.observaciones);let r=e=>{let[r,o]=e.split(":").map(Number);return 60*r+o},o=r(ef.finHora),t=r(ef.inicioHora);if(o<t){let r=new Date(ef.fecha),o=new Date(r);o.setDate(o.getDate()+1),ek(e,ex,"reservaFechaFin",o.toISOString().slice(0,10))}else ek(e,ex,"reservaFechaFin","");ek(e,ex,"reservaCedula",ef.cedula),ek(e,ex,"reservaTelefono",ef.telefono),ek(e,ex,"reservaRuc",ef.ruc),ek(e,ex,"reservaEsParaTercero",ef.esParaTercero),ek(e,ex,"reservaTerceroNombre",ef.terceroNombre),ek(e,ex,"reservaTerceroCedula",ef.terceroCedula),ek(e,ex,"reservaTerceroTelefono",ef.terceroTelefono),ek(e,ex,"reservaTerceroRuc",ef.terceroRuc),ek(e,ex,"reservaHoraExtra",ef.horaExtra),ek(e,ex,"reservaCantidadHorasExtra",ef.cantidadHorasExtra),ek(e,ex,"reservaMontoHorasExtra",ef.montoHorasExtra),ek(e,ex,"reservaAcontecimiento",ef.acontecimiento),ek(e,ex,"reservaQuinceaneraFocusNombre",ef.quinceaneraFocusNombre),ek(e,ex,"reservaNoviosNombres",ef.noviosNombres),ek(e,ex,"reservaCumpleaneroNombre",ef.cumpleaneroNombre),ek(e,ex,"reservaOtrosDescripcion",ef.otrosDescripcion),ek(e,ex,"reservaOtrosNombrePersona",ef.otrosNombrePersona),ek(e,ex,"reservaCantidadPersonas",ef.cantidadPersonas),ek(e,ex,"reservaObservacionesGenerales",ef.observacionesGenerales),ek(e,ex,"requiereApa",ef.requiereApa)}let o=(null===(a=eg.find(e=>e.id===ef.venueId))||void 0===a?void 0:a.nombre)||"Espacio seleccionado",t=(0,s.p6)(ef.fecha),n=!1;if(ef.horaExtra&&ef.cantidadHorasExtra&&ef.montoHorasExtra)try{let e=parseFloat(ef.cantidadHorasExtra),r=parseFloat(C(ef.montoHorasExtra));if(e>0&&r>0){let a="Hora extra para ".concat(o," - ").concat(t," (").concat(ef.inicioHora,"-").concat(ef.finHora,")"),s=eF(e,r,a,ex);(n=null!==s)&&(q.some(e=>e.nombre.toUpperCase().includes("HORA EXTRA")||e.nombre.toUpperCase().includes("HORAS EXTRA"))||z(e=>[...e,{id:"HORA_EXTRA_FALLBACK",nombre:"Horas Extras",precio:0,tipo:"UNICO",activo:!0,descripcion:"Servicio temporal para Horas Extras"}]),eS(e=>({...e})))}}catch(e){console.error("Error creating hora extra concepto:",e)}eS(e=>({...e})),rQ();let i=ef.acontecimiento?({"15_anos":"15 a\xf1os",boda:"Boda",cumpleanos:"Cumplea\xf1os",otros:"Otros"})[ef.acontecimiento]||"":"Sin especificar",c=n?"\n\n\uD83D\uDD50 \xa1Concepto de Hora Extra agregado autom\xe1ticamente!":"";alert("✅ Configuraci\xf3n de reserva guardada exitosamente!\n\n\uD83D\uDCCD ".concat(o,"\n\uD83D\uDCC5 ").concat(t,"\n\uD83D\uDD50 ").concat(ef.inicioHora," - ").concat(ef.finHora,"\n\uD83C\uDF89 ").concat(i).concat(c,"\n\nLa reserva se crear\xe1 autom\xe1ticamente al procesar el pago."))}catch(e){console.error("Error saving reserva data:",e),alert("Error al guardar los datos de reserva")}};async function rK(e){e4(!0);try{let r=await c.L.authenticatedFetch("/api/members/".concat(e,"/movements?type=DEBIT&pageSize=1000")),o=r.headers.get("content-type")||"",t=o.includes("application/json")?await r.json():{},a=Array.isArray(t)?t:Array.isArray(t.items)?t.items:[];if(!a.length)try{t=(o=(r=await c.L.authenticatedFetch("/api/movements?memberId=".concat(encodeURIComponent(e),"&type=DEBIT&pageSize=1000"))).headers.get("content-type")||"").includes("application/json")?await r.json():{},a=Array.isArray(t)?t:Array.isArray(t.items)?t.items:[]}catch(e){console.warn("Fallback fetch for pending debits failed",e)}let n=a.map(e=>({id:String(e.id),memberId:String(e.memberId),fecha:e.fecha,concepto:e.concepto,tipo:"DEBIT",monto:Number(e.monto||0),vencimiento:e.vencimiento,paidAmount:Number(e.paidAmount||0),observaciones:e.observaciones||"",status:e.status||"PENDIENTE",refinancingId:e.refinancingId})).filter(e=>{let r=e.status||"PENDIENTE",o=(e.paidAmount||0)<(e.monto||0);return"REFINANCIADO"!==r&&!!o});n.sort((e,r)=>{let o=e.vencimiento?new Date(e.vencimiento).getTime():1/0,t=r.vencimiento?new Date(r.vencimiento).getTime():1/0;if(o!==t)return o-t;let a=new Date(e.fecha).getTime(),n=new Date(r.fecha).getTime();return a-n}),e7(n)}catch(e){console.error("Error loading pending debits:",e),e7([])}finally{e4(!1)}}async function r0(e){try{let r=await c.L.authenticatedFetch("/api/members/".concat(e,"/movements?pageSize=1000"));r.ok||(r=await c.L.authenticatedFetch("/api/movements?memberId=".concat(encodeURIComponent(e),"&pageSize=1000")));let o=r.headers.get("content-type")||"";if(!r.ok||!o.includes("application/json"))throw Error("Error al cargar movimientos");let t=await r.json(),a=(Array.isArray(t)?t:Array.isArray(null==t?void 0:t.items)?t.items:[]).map(r=>{var o,t,a,n,s,i,c,l,d,u,m,x,p,g,h,b,v,f,y;return{id:String(null!==(o=r.id)&&void 0!==o?o:""),memberId:String(null!==(t=r.memberId)&&void 0!==t?t:e),fecha:null!==(n=null!==(a=r.fecha)&&void 0!==a?a:r.date)&&void 0!==n?n:new Date().toISOString(),concepto:String(null!==(i=null!==(s=r.concepto)&&void 0!==s?s:r.description)&&void 0!==i?i:""),tipo:S(null!==(l=null!==(c=r.tipo)&&void 0!==c?c:r.type)&&void 0!==l?l:""),monto:Number(null!==(u=null!==(d=r.monto)&&void 0!==d?d:r.amount)&&void 0!==u?u:0),origen:null!==(x=null!==(m=r.origen)&&void 0!==m?m:r.source)&&void 0!==x?x:void 0,refId:null!==(g=null!==(p=r.refId)&&void 0!==p?p:r.referenceId)&&void 0!==g?g:void 0,vencimiento:null!==(b=null!==(h=r.vencimiento)&&void 0!==h?h:r.dueDate)&&void 0!==b?b:void 0,paidAmount:Number(null!==(v=r.paidAmount)&&void 0!==v?v:0),observaciones:null!==(y=null!==(f=r.observaciones)&&void 0!==f?f:r.observations)&&void 0!==y?y:""}});ri(a)}catch(e){console.error("Error loading member movements for social quota analysis:",e),ri([])}}async function r1(e){rf(!0),rN("");try{let r=await c.L.authenticatedFetch("/api/refinancing/history?memberId=".concat(encodeURIComponent(e)));if(!r.ok)throw Error("Error ".concat(r.status,": ").concat(r.statusText));let o=await r.json();o.sort((e,r)=>{let o=new Date(e.createdAt||e.updatedAt).getTime();return new Date(r.createdAt||r.updatedAt).getTime()-o}),rb(o)}catch(e){console.error("Error loading refinancings history:",e),rN(e instanceof Error?e.message:"Error al cargar el historial"),rb([])}finally{rf(!1)}}let r2=(0,n.useMemo)(()=>e$.reduce((e,r)=>e+(0,s.sU)(r.montoStr),0),[e$]),r3=(0,n.useMemo)(()=>Object.values(e8).reduce((e,r)=>e+T(r),0),[e8]);async function r5(e){let r=L.find(r=>r.id===e);if(r&&window.confirm("\xbfEliminar al socio ".concat(r.nombres," ").concat(r.apellidos,"? Esta acci\xf3n eliminar\xe1 el socio y todos sus datos relacionados (movimientos, pagos, reservas, etc.). Esta acci\xf3n no se puede deshacer.")))try{let r=await c.L.authenticatedFetch("/api/members/".concat(e,"?force=true"),{method:"DELETE"}),o=await r.json();console.log("Delete response:",{status:r.status,data:o}),r.ok?(rI("Socio y todos sus datos eliminados correctamente"),await rU(),setTimeout(()=>rI(""),3e3)):(rI(o.msg||"Error al eliminar socio"),setTimeout(()=>rI(""),8e3))}catch(e){console.error("Delete exception:",e),rI("Error de conexi\xf3n al eliminar socio"),setTimeout(()=>rI(""),5e3)}}async function r4(){try{if(!eV.nombres.trim()||!eV.apellidos.trim()){alert("Nombres y apellidos son obligatorios");return}if(eV.ci.trim()){let e=L.find(e=>e.ci&&e.ci.trim().toLowerCase()===eV.ci.trim().toLowerCase());if(e){let r="NO SOCIO"===e.subcategoria?"no-socio":"socio";e_("Ya existe un ".concat(r," registrado con la CI ").concat(eV.ci,": ").concat(e.nombres," ").concat(e.apellidos," (C\xf3digo: ").concat(e.codigo,")"));return}}e_("");let e=Date.now(),r={codigo:"NS".concat(e.toString().slice(-6)),nombres:eV.nombres.trim(),apellidos:eV.apellidos.trim(),ci:eV.ci.trim()||"",telefono:eV.telefono.trim()||"",email:eV.email.trim()||"",categoria:"CLIENTE",subcategoria:"NO SOCIO",estado:"ACTIVO",alta:(0,s.Ji)(),ruc:""},o=await c.L.authenticatedFetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await o.json();if(o.ok){await rU();let e=t.member;eB({nombres:"",apellidos:"",ci:"",telefono:"",email:""}),e_(""),eJ(),ec(e),ed("unified"),es(!0)}else alert(t.msg||"Error al crear no-socio")}catch(e){console.error("Error creating no-socio:",e),alert("Error de conexi\xf3n al crear no-socio")}}async function r6(e){let r=L.find(r=>r.id===e);if(r&&window.confirm("\xbfConvertir a ".concat(r.nombres," ").concat(r.apellidos," de no-socio a socio? Se le asignar\xe1 un nuevo n\xfamero de socio.")))try{let r=await c.L.authenticatedFetch("/api/members/".concat(e,"/convert-to-socio"),{method:"POST"}),o=await r.json();r.ok?(alert("✅ ".concat(o.message)),await rU()):alert(o.error||"Error al convertir no-socio a socio")}catch(e){console.error("Error converting no-socio to socio:",e),alert("Error de conexi\xf3n al convertir no-socio a socio")}}(0,n.useMemo)(()=>(0,s.sU)(e2),[e2]),(0,n.useMemo)(()=>r2+r3,[r2,r3]);let r7=(0,n.useMemo)(()=>{let e=0,r=0;return L.forEach(o=>{var t,a;let n=null!==(a=null===(t=rL[o.id])||void 0===t?void 0:t.estadoCalc)&&void 0!==a?a:o.estado;"ATRASADO"===n?r++:"AL_DIA"===n&&e++}),{total:L.length,alDia:e,atrasados:r}},[L,rL]),r8=(0,n.useMemo)(()=>{let e=J.toLowerCase();return L.filter(r=>{var o,t;let a=!0;""!==J.trim()&&(a="codigo"===X?r.codigo.toLowerCase().includes(e):"ci"===X?!!(r.ci&&r.ci.toLowerCase().includes(e)):r.nombres.toLowerCase().includes(e)||r.apellidos.toLowerCase().includes(e));let n=null!==(t=null===(o=rL[r.id])||void 0===o?void 0:o.estadoCalc)&&void 0!==t?t:r.estado,s=!W||r.categoria===W,i=!K||n===K,c=!er||r.subcategoria===er;return a&&s&&i&&c})},[L,rL,J,X,W,K,er]),r9=Math.max(1,Math.ceil(r8.length/rS)),oe=Math.min(rT,r9),or=(oe-1)*rS,oo=e=>e.filter(e=>{let r=q.find(r=>r.id===e.servicioId);return(null==r?void 0:r.permiteAgendamiento)&&e.requiereReserva}),ot=e=>e.filter(e=>{let r=q.find(r=>r.id===e.servicioId),o=(null==r?void 0:r.permiteAgendamiento)&&e.requiereReserva,t=!!e.reservaVenueId;return o&&t}),oa=()=>({venueId:"",fecha:(0,s.Ji)(),inicioHora:"19:00",finHora:"03:00",observaciones:"",cedula:"",telefono:"",ruc:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:"",acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:"",cantidadPersonas:"",observacionesGenerales:"",requiereApa:!0}),on=e=>{console.log("\uD83D\uDE80 Abriendo modal de reserva m\xfaltiple para",e.length,"conceptos"),console.log("\uD83D\uDCCB Conceptos recibidos:",e.map(e=>({id:e.id,servicio:e.concepto,tieneReservaVenueId:!!e.reservaVenueId,reservaHoraInicio:e.reservaHoraInicio,reservaHoraFin:e.reservaHoraFin,reservaHoraExtra:e.reservaHoraExtra,reservaConfiguracionIndividual:e.reservaConfiguracionIndividual})));let r=oo(e);if(console.log("\uD83C\uDFAF Conceptos que requieren reserva:",r.map(e=>e.id)),r.length<2)return;eD(r.map(e=>e.id));let o=ot(r);console.log("\uD83D\uDD0D Conceptos: ".concat(r.length," requieren reserva, ").concat(o.length," ya tienen reserva guardada"));let t=o.length>0?o[0]:null;t?console.log("\uD83D\uDD04 Cargando reserva m\xfaltiple existente:",{venue:t.reservaVenueId,fecha:t.reservaFecha,horaExtra:t.reservaHoraExtra}):console.log("❌ No se encontr\xf3 concepto con reservaVenueId"),eE({venueId:t&&t.reservaVenueId||"",fecha:t&&t.reservaFecha||(0,s.Ji)(),inicioHora:t&&t.reservaHoraInicio||"19:00",finHora:t&&t.reservaHoraFin||"03:00",observaciones:t&&t.reservaObservaciones||"",configuracionIndividual:!!t&&(()=>{let r=t.reservaConfiguracionIndividual;if(void 0===r)for(let o of e){let e=o.reservaConfiguracionIndividual;if(void 0!==e){r=e,console.log("✅ Encontrada marca de configuracionIndividual en concepto",o.id,":",r);break}}if(void 0!==r)return console.log("✅ Usando marca guardada de configuracionIndividual:",r),r;if(0===o.length)return!1;if(1===o.length)return console.log("\uD83D\uDCDD Un solo concepto = configuraci\xf3n global"),!1;let a=o.map(e=>({horaExtra:e.reservaHoraExtra||!1,cantidadHoras:e.reservaCantidadHorasExtra||"",monto:e.reservaMontoHorasExtra||""})),n=a[0],s=a.some(e=>e.horaExtra!==n.horaExtra||e.cantidadHoras!==n.cantidadHoras||e.monto!==n.monto);return console.log("\uD83D\uDD0D Detectando por diferencias: ".concat(s?"Individual":"Global")),s})(),cedula:t?t.reservaCedula||(null==ei?void 0:ei.ci)||"":(null==ei?void 0:ei.ci)||"",telefono:t?t.reservaTelefono||(null==ei?void 0:ei.telefono)||"":(null==ei?void 0:ei.telefono)||"",ruc:t&&t.reservaRuc||"",esParaTercero:!!t&&(t.reservaEsParaTercero||!1),terceroNombre:t&&t.reservaTerceroNombre||"",terceroCedula:t&&t.reservaTerceroCedula||"",terceroTelefono:t&&t.reservaTerceroTelefono||"",terceroRuc:t&&t.reservaTerceroRuc||"",horaExtra:!!t&&(t.reservaHoraExtra||!1),cantidadHorasExtra:t&&t.reservaCantidadHorasExtra||"",montoHorasExtra:t&&t.reservaMontoHorasExtra||"",acontecimiento:t&&t.reservaAcontecimiento||"",quinceaneraFocusNombre:t&&t.reservaQuinceaneraFocusNombre||"",noviosNombres:t&&t.reservaNoviosNombres||"",cumpleaneroNombre:t&&t.reservaCumpleaneroNombre||"",otrosDescripcion:t&&t.reservaOtrosDescripcion||"",otrosNombrePersona:t&&t.reservaOtrosNombrePersona||"",cantidadPersonas:t&&t.reservaCantidadPersonas||"",observacionesGenerales:t&&t.reservaObservacionesGenerales||"",requiereApa:!t||void 0===t.requiereApa||t.requiereApa,configuracionesIndividuales:t?(()=>{let a={},n=t.reservaConfiguracionIndividual;if(void 0===n)for(let r of e){let e=r.reservaConfiguracionIndividual;if(void 0!==e){n=e,console.log("\uD83D\uDD0D Encontrada marca de configuracionIndividual en concepto",r.id,":",n);break}}let s=!1;if(console.log("\uD83D\uDD0D Cargando configuraciones individuales:",{marcaGuardada:n,conceptosConReserva:r.length,conceptosConReservaExistente:o.length,todosLosConceptos:e.map(e=>({id:e.id,tieneReservaVenueId:!!e.reservaVenueId,inicioHora:e.reservaHoraInicio,finHora:e.reservaHoraFin,horaExtra:e.reservaHoraExtra,cantidadHoras:e.reservaCantidadHorasExtra,monto:e.reservaMontoHorasExtra}))}),void 0!==n)s=n,console.log("✅ Usando marca guardada de configuracionIndividual:",n);else if(o.length>1){let e=o.map(e=>({horaExtra:e.reservaHoraExtra||!1,cantidadHoras:e.reservaCantidadHorasExtra||"",monto:e.reservaMontoHorasExtra||""})),r=e[0];console.log("\uD83D\uDD0D Detectando por diferencias:",{hayDiferencias:s=e.some(e=>e.horaExtra!==r.horaExtra||e.cantidadHoras!==r.cantidadHoras||e.monto!==r.monto),configuraciones:e})}return s?(r.forEach(r=>{let o=e.find(e=>e.id===r.id);o&&(o.reservaHoraInicio||o.reservaHoraFin||o.reservaHoraExtra||o.reservaCantidadHorasExtra||o.reservaMontoHorasExtra)?(a[r.id]={inicioHora:o.reservaHoraInicio||"19:00",finHora:o.reservaHoraFin||"03:00",horaExtra:o.reservaHoraExtra||!1,cantidadHorasExtra:o.reservaCantidadHorasExtra||"",montoHorasExtra:o.reservaMontoHorasExtra||""},console.log("✅ Cargando config guardada para concepto ".concat(r.id,":"),a[r.id])):(a[r.id]={inicioHora:"19:00",finHora:"03:00",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""},console.log("\uD83C\uDD95 Usando config por defecto para concepto ".concat(r.id)))}),console.log("\uD83D\uDCCB Configuraciones individuales cargadas para",Object.keys(a).length,"conceptos:",a)):console.log("\uD83C\uDF10 Usando configuraci\xf3n global"),a})():{}}),ej(!0)},os=()=>{let e=[];if(ew.fecha){let r=new Date(ew.fecha+"T00:00:00-03:00"),o=new Date,t=new Date(o.getFullYear(),o.getMonth(),o.getDate());new Date(r.getFullYear(),r.getMonth(),r.getDate())<t&&e.push("La fecha no puede ser anterior a hoy")}else e.push("Debe seleccionar una fecha");if(ew.inicioHora&&ew.finHora){let r=ew.inicioHora,o=ew.finHora,[t,a]=r.split(":").map(Number),[n,s]=o.split(":").map(Number),i=60*t+a,c=60*n+s;i===c&&e.push("La hora de inicio y fin no pueden ser iguales");let l=c-i;l<=0&&(l+=1440),l<60&&e.push("El evento debe tener una duraci\xf3n m\xednima de 1 hora")}else e.push("Debe especificar hora de inicio y fin");return ew.acontecimiento||e.push("Debe seleccionar un acontecimiento"),"15_anos"!==ew.acontecimiento||ew.quinceaneraFocusNombre.trim()||e.push("Debe ingresar el nombre de la quincea\xf1era"),"boda"!==ew.acontecimiento||ew.noviosNombres.trim()||e.push("Debe ingresar los nombres de los novios"),"cumpleanos"!==ew.acontecimiento||ew.cumpleaneroNombre.trim()||e.push("Debe ingresar el nombre del cumplea\xf1er@"),"otros"!==ew.acontecimiento||ew.otrosDescripcion.trim()||e.push("Debe ingresar la descripci\xf3n del acontecimiento"),e},oi=or+rS,oc=r8.slice(or,oi),ol=async()=>{try{let e=r8.map(e=>e.id).join(","),r=await c.L.authenticatedFetch("/api/members/export?format=excel&ids=".concat(encodeURIComponent(e))),o=await r.blob(),t=window.URL.createObjectURL(o),a=document.createElement("a");a.href=t,a.download="socios-".concat(new Date().toISOString().split("T")[0],".xlsx"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a)}catch(e){console.error("Error exporting to Excel:",e)}},od=e=>{let{estado:r}=e;return(0,t.jsx)("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium border ".concat((()=>{switch(r){case"AL_DIA":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"ATRASADO":return"bg-amber-50 text-amber-700 border-amber-200";case"SUSPENDIDO":return"bg-rose-50 text-rose-700 border-rose-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}})()),children:"AL_DIA"===r?"Al D\xeda":"ATRASADO"===r?"Atrasado":"SUSPENDIDO"===r?"Suspendido":r})};if(Y)return(0,t.jsx)(a.Z,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-400"})})});let ou=()=>{if(!eI.fecha)return!1;eI.condicion;let e=eI.conceptos||[];if(!e||0===e.length)return!1;if(e.length>0){for(let r of e){if(!r.servicioId)return!1;let e=parseFloat(C(r.monto));if(isNaN(e)||e<=0||"DIARIO"===r.tipoServicio&&(!r.dias||r.dias<=0))return!1}if(function(e){if(!e)return!1;let r=new Set;for(let o of e)if(o.servicioId&&!o.requiereReserva){if(r.has(o.servicioId))return!0;r.add(o.servicioId)}return!1}(e))return!1}if("CONTADO"===eI.condicion){if(!eI.metodoPago||!eI.cobradorId)return!1}else if("CREDITO"===eI.condicion&&eI.permitirPagosParc){if(!eI.pagoAplicado)return!1;let e=parseFloat(og(eI.pagoAplicado));if(isNaN(e)||e<=0||e>(D(eI.conceptos)||parseFloat(og(eI.monto||"0")))||!eI.metodoPago)return!1}return!0},om=async()=>{if(eG(!0),!ei||!ou())return;let e=eI.conceptos||[],r=[];for(let o of e)if(o.servicioId&&"UNICO"!==o.tipoServicio){let e=await r_(ei.id,o.servicioId);if(e){let t=q.find(e=>e.id===o.servicioId),a=(null==t?void 0:t.nombre)||"Servicio",n=e.nextChargeDate?(0,s.p6)(e.nextChargeDate):"N/A";r.push("ℹ️ ".concat(a,": Suscripci\xf3n activa (vence: ").concat(n,")"))}}if(r.length>0){let e="\uD83D\uDCCB Informaci\xf3n de Suscripciones:\n\n"+r.join("\n")+"\n\n✅ Este pago se registrar\xe1 normalmente y las fechas de vencimiento se actualizar\xe1n autom\xe1ticamente sumando el per\xedodo correspondiente.\n\n\xbfDeseas continuar?";if(!window.confirm(e)){rw(!1);return}}rw(!0);try{var o,t,a,n,i,l;let r=[];for(let o of e){let e=parseFloat(C(o.monto)),s=o.tipoServicio,i="ANUAL"===s?365:"MENSUAL"===s?30:o.dias||1;if((o.crearSuscripcion||eI.crearSuscripcion)&&"UNICO"!==s&&!await r_(ei.id,o.servicioId)){let r=await c.L.authenticatedFetch("/api/members/".concat(encodeURIComponent(ei.id),"/subscriptions"),{method:"POST",body:JSON.stringify({serviceId:o.servicioId,periodicity:s,price:e,autoDebit:!1,notes:"Creado desde formulario unificado el ".concat(eI.fecha),validUntil:o.vencimiento||A(eI.fecha,i)})}),t=await r.json().catch(()=>({}));if(!r.ok)throw Error((null==t?void 0:t.msg)||"No se pudo crear la suscripci\xf3n")}let l=await c.L.authenticatedFetch("/api/movements",{method:"POST",body:JSON.stringify({memberId:ei.id,fecha:eI.fecha,concepto:"".concat(o.concepto||"Servicio").concat("UNICO"!==s?" (".concat(s,")"):""),tipo:"DEBIT",monto:Number(e),origen:"SERVICIO",refId:o.servicioId,observaciones:o.observaciones||eI.observaciones||"Pago contado - ".concat(eI.metodoPago),vencimiento:"UNICO"===s?eI.fecha:o.vencimiento||A(eI.fecha,i)})}),d=await l.json().catch(()=>({}));if(!l.ok)throw Error((null==d?void 0:d.msg)||"No se pudo crear el d\xe9bito del servicio");let u=String(null!==(n=null!==(a=d.id)&&void 0!==a?a:null==d?void 0:null===(t=d.movement)||void 0===t?void 0:t.id)&&void 0!==n?n:"");r.push({id:u,amount:e,conceptoName:o.concepto||"Servicio",conceptoId:o.id,relatedToReservaConceptId:o.relatedToReservaConceptId||void 0})}let s=r.reduce((e,r)=>e+r.amount,0),d=r.map(e=>({debitId:e.id,amount:e.amount})),u=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:ei.id,fecha:eI.fecha,monto:s,concepto:"Pago contado: ".concat(r.map(e=>e.conceptoName).join(", ")),formaPago:eI.metodoPago,cobradorId:eI.cobradorId||void 0,numeroRecibo:eI.numeroRecibo||void 0,observaciones:eI.observaciones||"",allocations:d})}),m=await u.json().catch(()=>({}));if(!u.ok)throw Error((null==m?void 0:m.msg)||"No se pudo crear el pago");if(String(null!==(l=null!==(i=m.id)&&void 0!==i?i:null==m?void 0:null===(o=m.payment)||void 0===o?void 0:o.id)&&void 0!==l?l:""),eI.presupuestoDeudas&&parseFloat(og(eI.presupuestoDeudas))>0){let e=parseFloat(og(eI.presupuestoDeudas)),o=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:ei.id,fecha:eI.fecha,monto:e,concepto:"Pago de deudas pendientes - ".concat(r&&r.length?r.map(e=>e.conceptoName).join(", "):eI.concepto||""),formaPago:eI.metodoPago,cobradorId:eI.cobradorId||"",numeroRecibo:eI.numeroRecibo||"",observaciones:"Asignaci\xf3n autom\xe1tica a deudas pendientes. ".concat(eI.observaciones||"").trim()})}),t=await o.json().catch(()=>({}));o.ok||console.warn("No se pudo procesar el pago de deudas:",null==t?void 0:t.msg)}let x=[];for(let o of e)if(o.reservaVenueId&&o.reservaFecha)try{let e=new Date("".concat(o.reservaFecha,"T").concat(o.reservaHoraInicio||"19:00",":00")),t=o.reservaFechaFin||o.reservaFecha,a=new Date("".concat(t,"T").concat(o.reservaHoraFin||"23:00",":00"));a<=e&&!o.reservaFechaFin&&a.setDate(a.getDate()+1);let n={resourceId:o.reservaVenueId,memberId:ei.id,start:e.toISOString(),end:a.toISOString(),nombreContacto:"".concat(ei.nombres," ").concat(ei.apellidos),contacto:ei.celular||ei.telefono||"",medioContacto:ei.celular?"whatsapp":"telefono",invitados:0,adelanto:0,montoTotal:function(){let e=parseFloat(C(o.monto))||0,r=o.reservaMontoHorasExtra?Number(C(o.reservaMontoHorasExtra)):0;return e+r}(),status:"ACTIVO",notas:o.reservaObservaciones||o.observaciones||"",createdBy:"system",acontecimiento:o.reservaAcontecimiento||void 0,quinceaneraFocusNombre:o.reservaQuinceaneraFocusNombre||void 0,noviosNombres:o.reservaNoviosNombres||void 0,cumpleaneroNombre:o.reservaCumpleaneroNombre||void 0,otrosDescripcion:o.reservaOtrosDescripcion||void 0,otrosNombrePersona:o.reservaOtrosNombrePersona||void 0,esParaTercero:o.reservaEsParaTercero||void 0,terceroNombre:o.reservaTerceroNombre||void 0,terceroCedula:o.reservaTerceroCedula||void 0,terceroTelefono:o.reservaTerceroTelefono||void 0,terceroRuc:o.reservaTerceroRuc||void 0,cantidadPersonas:o.reservaCantidadPersonas?Number(o.reservaCantidadPersonas):void 0,observacionesGenerales:o.reservaObservacionesGenerales||void 0,horaExtra:o.reservaHoraExtra||void 0,cantidadHorasExtra:o.reservaCantidadHorasExtra?Number(o.reservaCantidadHorasExtra):void 0,montoHorasExtra:o.reservaMontoHorasExtra?Number(C(o.reservaMontoHorasExtra)):void 0,requiereApa:o.requiereApa||void 0,apaEstado:o.requiereApa?"PENDIENTE":void 0,debitMovementIds:function(){let e=r.filter(e=>e.conceptoId===o.id||e.relatedToReservaConceptId===o.id).map(e=>e.id);return e.length?e:void 0}(),debitMovementId:function(){var e;return(null===(e=r.find(e=>e.conceptoId===o.id||e.relatedToReservaConceptId===o.id))||void 0===e?void 0:e.id)||void 0}()},s=await c.L.authenticatedFetch("/api/reservas",{method:"POST",body:JSON.stringify(n)});if(s.ok)await s.json(),x.push("".concat(o.concepto||"Reserva"," (").concat(o.reservaFecha,")"));else{let e=await s.text(),r=e;try{r=JSON.parse(e).msg||e}catch(e){}console.error("❌ No se pudo crear la reserva para ".concat(o.concepto,":"),r),alert('⚠️ Error procesando reserva\n\nNo se pudo crear la reserva para "'.concat(o.concepto,'".\n\n').concat(r,"\n\nEl pago no se procesar\xe1. Por favor verifique la disponibilidad del horario."));return}}catch(e){console.error("Error creando reserva para ".concat(o.concepto,":"),e),alert('⚠️ Error inesperado\n\nError creando reserva para "'.concat(o.concepto,'": ').concat(e,"\n\nEl pago no se procesar\xe1."));return}let p=eI.presupuestoDeudas&&parseFloat(og(eI.presupuestoDeudas))>0?" y se asignaron Gs. ".concat(parseInt(og(eI.presupuestoDeudas)).toLocaleString("es-PY")," a deudas pendientes"):"",g=x.length>0?"\n\n\uD83C\uDFAF Reservas creadas:\n".concat(x.join("\n")):"";alert("✅ Pago al contado registrado exitosamente".concat(p).concat(g)),rZ(),await rU()}catch(e){console.error("Error al procesar pago contado:",e),alert("❌ Error: ".concat(e instanceof Error?e.message:"Error desconocido"))}finally{rw(!1)}},ox=async()=>{if(eG(!0),!ei||!ou())return;let e=eI.conceptos||[],r=[];for(let o of e)if(o.servicioId&&"UNICO"!==o.tipoServicio){let e=await r_(ei.id,o.servicioId);if(e){let t=q.find(e=>e.id===o.servicioId),a=(null==t?void 0:t.nombre)||"Servicio",n=e.nextChargeDate?(0,s.p6)(e.nextChargeDate):"N/A";r.push("ℹ️ ".concat(a,": Suscripci\xf3n activa (vence: ").concat(n,")"))}}if(r.length>0){let e="\uD83D\uDCCB Informaci\xf3n de Suscripciones:\n\n"+r.join("\n")+"\n\n✅ El d\xe9bito se registrar\xe1 normalmente. Cuando se pague, las fechas de vencimiento se actualizar\xe1n autom\xe1ticamente sumando el per\xedodo correspondiente.\n\n\xbfDeseas continuar?";if(!window.confirm(e)){rw(!1);return}}rw(!0);try{let r=[];for(let n of e){var o,t,a;let e=parseFloat(C(n.monto)),s=n.tipoServicio,i="ANUAL"===s?365:"MENSUAL"===s?30:n.dias||1;if((n.crearSuscripcion||eI.crearSuscripcion)&&"UNICO"!==s&&!await r_(ei.id,n.servicioId)){let r=await c.L.authenticatedFetch("/api/members/".concat(encodeURIComponent(ei.id),"/subscriptions"),{method:"POST",body:JSON.stringify({serviceId:n.servicioId,periodicity:s,price:e,autoDebit:!1,notes:"Creado desde formulario unificado el ".concat(eI.fecha),validUntil:n.vencimiento||A(eI.fecha,i)})}),o=await r.json().catch(()=>({}));if(!r.ok)throw Error((null==o?void 0:o.msg)||"No se pudo crear la suscripci\xf3n")}let l=await c.L.authenticatedFetch("/api/movements",{method:"POST",body:JSON.stringify({memberId:ei.id,fecha:eI.fecha,concepto:"".concat(n.concepto||"Servicio").concat("UNICO"!==s?" (".concat(s,")"):""),tipo:"DEBIT",monto:Number(e),origen:"SERVICIO",refId:n.servicioId,observaciones:n.observaciones||eI.observaciones||"Servicio a cr\xe9dito",vencimiento:"UNICO"===s?eI.fecha:n.vencimiento||A(eI.fecha,i)})}),d=await l.json().catch(()=>({}));if(!l.ok)throw Error((null==d?void 0:d.msg)||"No se pudo crear el d\xe9bito del servicio");let u=String(null!==(a=null!==(t=d.id)&&void 0!==t?t:null==d?void 0:null===(o=d.movement)||void 0===o?void 0:o.id)&&void 0!==a?a:"");r.push({id:u,amount:e,conceptoName:n.concepto||"Servicio",conceptoId:n.id,relatedToReservaConceptId:n.relatedToReservaConceptId||void 0})}if(eI.permitirPagosParc&&eI.pagoAplicado&&eI.metodoPago){let e=parseFloat(og(eI.pagoAplicado)),o=[];for(let t of r){if(e<=0)break;let r=Math.min(e,t.amount);o.push({debitId:t.id,amount:r}),e-=r}if(o.length>0){let e=o.reduce((e,r)=>e+r.amount,0),t=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:ei.id,fecha:eI.fecha,monto:e,concepto:"Pago parcial: ".concat(r.map(e=>e.conceptoName).join(", ")),formaPago:eI.metodoPago,cobradorId:eI.cobradorId||"",numeroRecibo:eI.referencia||"",observaciones:eI.observaciones||"",allocations:o})}),a=await t.json().catch(()=>({}));if(!t.ok)throw Error((null==a?void 0:a.msg)||"No se pudo crear el pago parcial")}}if(eI.presupuestoDeudas&&parseFloat(og(eI.presupuestoDeudas))>0){let e=parseFloat(og(eI.presupuestoDeudas)),o=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:ei.id,fecha:eI.fecha,monto:e,concepto:"Pago de deudas pendientes - ".concat(r&&r.length?r.map(e=>e.conceptoName).join(", "):eI.concepto||""),formaPago:eI.permitirPagosParc?eI.metodoPago:"EFECTIVO",cobradorId:"",numeroRecibo:"",observaciones:"Asignaci\xf3n autom\xe1tica a deudas pendientes. ".concat(eI.observaciones||"").trim()})}),t=await o.json().catch(()=>({}));o.ok||console.warn("No se pudo procesar el pago de deudas:",null==t?void 0:t.msg)}let n=[];for(let o of e)if(o.reservaVenueId&&o.reservaFecha)try{let e=new Date("".concat(o.reservaFecha,"T").concat(o.reservaHoraInicio||"19:00",":00")),t=o.reservaFechaFin||o.reservaFecha,a=new Date("".concat(t,"T").concat(o.reservaHoraFin||"23:00",":00"));a<=e&&!o.reservaFechaFin&&a.setDate(a.getDate()+1);let s={resourceId:o.reservaVenueId,memberId:ei.id,start:e.toISOString(),end:a.toISOString(),nombreContacto:"".concat(ei.nombres," ").concat(ei.apellidos),contacto:ei.celular||ei.telefono||"",medioContacto:ei.celular?"whatsapp":"telefono",invitados:0,adelanto:0,montoTotal:function(){let e=parseFloat(C(o.monto))||0,r=o.reservaMontoHorasExtra?Number(C(o.reservaMontoHorasExtra)):0;return e+r}(),status:"ACTIVO",notas:o.reservaObservaciones||o.observaciones||"",createdBy:"system",acontecimiento:o.reservaAcontecimiento||void 0,quinceaneraFocusNombre:o.reservaQuinceaneraFocusNombre||void 0,noviosNombres:o.reservaNoviosNombres||void 0,cumpleaneroNombre:o.reservaCumpleaneroNombre||void 0,otrosDescripcion:o.reservaOtrosDescripcion||void 0,otrosNombrePersona:o.reservaOtrosNombrePersona||void 0,esParaTercero:o.reservaEsParaTercero||void 0,terceroNombre:o.reservaTerceroNombre||void 0,terceroCedula:o.reservaTerceroCedula||void 0,terceroTelefono:o.reservaTerceroTelefono||void 0,terceroRuc:o.reservaTerceroRuc||void 0,cantidadPersonas:o.reservaCantidadPersonas?Number(o.reservaCantidadPersonas):void 0,observacionesGenerales:o.reservaObservacionesGenerales||void 0,horaExtra:o.reservaHoraExtra||void 0,cantidadHorasExtra:o.reservaCantidadHorasExtra?Number(o.reservaCantidadHorasExtra):void 0,montoHorasExtra:o.reservaMontoHorasExtra?Number(C(o.reservaMontoHorasExtra)):void 0,requiereApa:o.requiereApa||void 0,apaEstado:o.requiereApa?"PENDIENTE":void 0,debitMovementIds:function(){let e=r.filter(e=>e.conceptoId===o.id||e.relatedToReservaConceptId===o.id).map(e=>e.id);return e.length?e:void 0}(),debitMovementId:function(){var e;return(null===(e=r.find(e=>e.conceptoId===o.id||e.relatedToReservaConceptId===o.id))||void 0===e?void 0:e.id)||void 0}()},i=await c.L.authenticatedFetch("/api/reservas",{method:"POST",body:JSON.stringify(s)});if(i.ok)await i.json(),n.push("".concat(o.concepto||"Reserva"," (").concat(o.reservaFecha,")"));else{let e=await i.text(),r=e;try{r=JSON.parse(e).msg||e}catch(e){}console.error("❌ No se pudo crear la reserva para ".concat(o.concepto,":"),r),alert('⚠️ Error procesando reserva\n\nNo se pudo crear la reserva para "'.concat(o.concepto,'".\n\n').concat(r,"\n\nEl pago no se procesar\xe1. Por favor verifique la disponibilidad del horario."));return}}catch(e){console.error("Error creando reserva para ".concat(o.concepto,":"),e),alert('⚠️ Error inesperado\n\nError creando reserva para "'.concat(o.concepto,'": ').concat(e,"\n\nEl pago no se procesar\xe1."));return}let s=eI.permitirPagosParc&&eI.pagoAplicado?"✅ Servicio a cr\xe9dito con pago parcial registrado exitosamente":"✅ Servicio a cr\xe9dito registrado exitosamente",i=eI.presupuestoDeudas&&parseFloat(og(eI.presupuestoDeudas))>0?" y se asignaron Gs. ".concat(parseInt(og(eI.presupuestoDeudas)).toLocaleString("es-PY")," a deudas pendientes"):"",l=n.length>0?"\n\n\uD83C\uDFAF Reservas creadas:\n".concat(n.join("\n")):"";alert("".concat(s).concat(i).concat(l)),rZ(),await rU()}catch(e){console.error("Error al procesar servicio a cr\xe9dito:",e),alert("❌ Error: ".concat(e instanceof Error?e.message:"Error desconocido"))}finally{rw(!1)}},op=e=>{let r=e.replace(/[^\d]/g,"");return r?parseInt(r).toLocaleString("es-PY").replace(/,/g,"."):""},og=e=>e.replace(/\./g,""),oh=(e,r)=>{let o;let t={...ro};if(r){o=[...re,e];let r=ro[e];if(!(r&&parseInt(og(r))>0)){let r=e6.find(r=>r.id===e);if(r){let o=(r.monto||0)-(r.paidAmount||0);t[e]=op(o.toString())}}if(0===re.length&&!rj.fecha){let e=(0,s.Ji)();rC(r=>({...r,fecha:e}))}}else o=re.filter(r=>r!==e),delete t[e];rr(o),rt(t);let a=o.reduce((e,r)=>{let o=t[r];if(o){let r=parseInt(og(o));return e+(isNaN(r)?0:r)}return e},0),n=a>0?op(a.toString()):"";eS(e=>({...e,presupuestoDeudas:n})),rC(e=>({...e,montoAPagar:n}))},ob=(e,r)=>{let o=e6.find(r=>r.id===e);if(!o)return;let t=(o.monto||0)-(o.paidAmount||0),a=parseInt(og(r))||0;if(a>t){alert("El monto no puede ser mayor al saldo pendiente: Gs. ".concat(t.toLocaleString("es-PY")));return}let n={...ro,[e]:op(a.toString())};rt(n);let i=[...re];if(a>0&&!re.includes(e)){if(rr(i=[...re,e]),0===re.length&&!rj.fecha){let e=(0,s.Ji)();rC(r=>({...r,fecha:e}))}}else 0===a&&re.includes(e)&&rr(i=re.filter(r=>r!==e));let c=i.reduce((e,r)=>{let o=n[r];if(o){let r=parseInt(og(o));return e+(isNaN(r)?0:r)}return e},0),l=c>0?op(c.toString()):"";eS(e=>({...e,presupuestoDeudas:l})),rC(e=>({...e,montoAPagar:l}))},ov=()=>re.reduce((e,r)=>{let o=e6.find(e=>e.id===r);return o?e+((o.monto||0)-(o.paidAmount||0)):e},0);return(0,t.jsxs)(a.Z,{children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Gesti\xf3n de Socios"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Administra la informaci\xf3n de los socios del club"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-lg border border-gray-200 shadow-sm",children:[(0,t.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:r7.total}),(0,t.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"Total Socios"})]}),(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-lg border border-gray-200 shadow-sm",children:[(0,t.jsx)("span",{className:"text-lg font-semibold text-emerald-700",children:r7.alDia}),(0,t.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"Al D\xeda"})]}),(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-lg border border-gray-200 shadow-sm",children:[(0,t.jsx)("span",{className:"text-lg font-semibold text-amber-700",children:r7.atrasados}),(0,t.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"Atrasados"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:ol,className:"bg-white text-gray-700 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center gap-2 shadow-sm",children:[(0,t.jsx)(d.Z,{className:"w-4 h-4"}),"Exportar"]}),(0,t.jsxs)("button",{onClick:()=>ez(!0),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 flex items-center gap-2 shadow-sm",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4"}),"Cobrar (No socio)"]}),(0,t.jsxs)(v.default,{href:"/admin/socios/nuevo",className:"bg-custom-blue text-white px-4 py-2 rounded-lg hover:bg-custom-blue flex items-center gap-2 shadow-sm",children:[(0,t.jsx)(m.Z,{className:"w-4 h-4"}),"Nuevo Socio"]})]})]})]}),(0,t.jsx)("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end",children:[(0,t.jsxs)("div",{className:"md:col-span-5",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Buscar"}),(0,t.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,t.jsx)("div",{className:"relative w-2/5",children:(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:X,onChange:e=>{Q(e.target.value),rF(1)},children:[(0,t.jsx)("option",{value:"codigo",children:"Nro. de socio"}),(0,t.jsx)("option",{value:"ci",children:"C\xe9dula"}),(0,t.jsx)("option",{value:"nombre",children:"Nombre y Apellido"})]})}),(0,t.jsxs)("div",{className:"relative w-3/5",children:[(0,t.jsx)(x.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,t.jsx)("input",{type:"text",placeholder:"codigo"===X?"Ej: 1234":"ci"===X?"Ej: 1234567":"Nombre o Apellido...",className:"w-full h-[42px] pl-10 pr-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700",value:J,onChange:e=>{Z(e.target.value),rF(1)}})]})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Categor\xeda"}),(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:W,onChange:e=>{$(e.target.value),rF(1)},children:[(0,t.jsx)("option",{value:"",children:"Todas"}),(0,t.jsx)("option",{value:"Individual",children:"Individual"}),(0,t.jsx)("option",{value:"Familiar",children:"Familiar"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Subcategor\xeda"}),(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:er,onChange:e=>{eo(e.target.value),rF(1)},children:[(0,t.jsx)("option",{value:"",children:"Todas"}),(0,t.jsx)("option",{value:"SOCIO",children:"Socio"}),(0,t.jsx)("option",{value:"NO SOCIO",children:"No Socio"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estado"}),(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:K,onChange:e=>{ee(e.target.value),rF(1)},children:[(0,t.jsx)("option",{value:"",children:"Todos"}),(0,t.jsx)("option",{value:"AL_DIA",children:"Al D\xeda"}),(0,t.jsx)("option",{value:"ATRASADO",children:"Atrasado"}),(0,t.jsx)("option",{value:"SUSPENDIDO",children:"Suspendido"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-1",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"\xa0"}),(0,t.jsx)("button",{onClick:()=>{Z(""),Q("nombre"),$(""),ee(""),eo(""),rF(1)},className:"w-full h-[42px] px-1 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 text-xs",title:"Limpiar todos los filtros",children:"Limpiar"})]})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Socio"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Categor\xeda"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Estado"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Deuda"}),(0,t.jsx)("th",{className:"px-6 py-4 text-center text-[11px] font-semibold text-gray-500 uppercase tracking-wider"}),(0,t.jsx)("th",{className:"px-6 py-4 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:oc.map(e=>{var r,o,a,n,i;let c=null!==(n=null!==(a=null===(r=rL[e.id])||void 0===r?void 0:r.saldo)&&void 0!==a?a:e.deudaTotal)&&void 0!==n?n:0,l=null!==(i=null===(o=rL[e.id])||void 0===o?void 0:o.estadoCalc)&&void 0!==i?i:e.estado;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50/60",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:e.foto?(0,t.jsx)("img",{className:"h-10 w-10 rounded-full object-cover",src:e.foto,alt:"".concat(e.nombres," ").concat(e.apellidos),onError:e=>{e.currentTarget.src="/avatar-placeholder.png"}}):(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,t.jsx)(p.Z,{className:"w-5 h-5 text-gray-400"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.nombres," ",e.apellidos]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.codigo," • CI: ",op(String(e.ci||""))]})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("div",{className:"flex items-center text-sm text-gray-900",children:"NO SOCIO"===e.subcategoria?(0,t.jsx)("span",{children:"No Socio"}):(0,t.jsxs)(t.Fragment,{children:["Individual"===e.categoria?"\uD83D\uDC64":"Familiar"===e.categoria?"\uD83D\uDC65":"\uD83D\uDC64"," ",(0,t.jsx)("span",{className:"ml-1",children:e.subcategoria})]})})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)(od,{estado:l})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("div",{className:"text-sm font-medium ".concat(c>0?"text-amber-700":"text-gray-900"),children:(0,s.xG)(Math.max(0,c))})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:(0,t.jsx)("button",{onClick:()=>rJ(e),className:"bg-emerald-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-emerald-700 shadow-sm",children:"Cobrar"})}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,t.jsx)("button",{onClick:r=>(function(e,r){if(rO===e){rP(null);return}let o=r.currentTarget.getBoundingClientRect();rH({x:o.left-200,y:o.top}),rR.current=r.currentTarget,rP(e)})(e.id,r),className:"text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100",title:"M\xe1s acciones",children:(0,t.jsx)(g.Z,{className:"w-5 h-5"})}),rO===e.id&&(0,t.jsxs)("div",{className:"fixed z-50 w-48 bg-white rounded-md shadow-lg border border-gray-200 py-1",style:{left:"".concat(rk.x,"px"),top:"".concat(rk.y,"px")},children:[(0,t.jsxs)(v.default,{href:"/admin/socios/".concat(e.id),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>rP(null),children:[(0,t.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Ver Detalles"]}),"NO SOCIO"===e.subcategoria&&(0,t.jsxs)("button",{onClick:()=>{r6(e.id),rP(null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-emerald-700 hover:bg-emerald-50",children:[(0,t.jsx)(h,{className:"w-4 h-4 mr-2"}),"Convertir a Socio"]}),(0,t.jsxs)("button",{onClick:()=>{r5(e.id),rP(null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-rose-600 hover:bg-rose-50",children:[(0,t.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Eliminar"]})]})]})]},e.id)})})]})}),r8.length>0&&(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 p-6 border-t border-gray-200 bg-gray-50/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Filas por p\xe1gina:"}),(0,t.jsxs)("select",{value:rS,onChange:e=>{rA(Number(e.target.value)),rF(1)},className:"px-2 py-1.5 border border-gray-300 rounded text-sm",children:[(0,t.jsx)("option",{value:10,children:"10"}),(0,t.jsx)("option",{value:20,children:"20"}),(0,t.jsx)("option",{value:50,children:"50"}),(0,t.jsx)("option",{value:100,children:"100"})]})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Mostrando ",or+1,"–",Math.min(oi,r8.length)," de ",r8.length]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>rF(e=>Math.max(1,e-1)),className:"px-3 py-1.5 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",disabled:oe<=1,children:"Anterior"}),(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",oe," de ",r9]}),(0,t.jsx)("button",{onClick:()=>rF(e=>Math.min(r9,e+1)),className:"px-3 py-1.5 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",disabled:oe>=r9,children:"Siguiente"})]})]}),(0,t.jsx)("div",{style:{height:25},"aria-hidden":"true"})]})]}),eq&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true","aria-labelledby":"modal-no-socio-title",children:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-auto",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h2",{id:"modal-no-socio-title",className:"text-xl font-semibold text-gray-900",children:"Registro No-Socio"}),(0,t.jsx)("button",{onClick:eJ,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombres *"}),(0,t.jsx)("input",{type:"text",value:eV.nombres,onChange:e=>eB(r=>({...r,nombres:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ingrese nombres",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos *"}),(0,t.jsx)("input",{type:"text",value:eV.apellidos,onChange:e=>eB(r=>({...r,apellidos:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ingrese apellidos",required:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CI"}),(0,t.jsx)("input",{type:"text",value:eV.ci,onChange:e=>{let r=e.target.value;if(eB(e=>({...e,ci:r})),r.trim()){let e=L.find(e=>e.ci&&e.ci.trim().toLowerCase()===r.trim().toLowerCase());if(e){let r="NO SOCIO"===e.subcategoria?"no-socio":"socio";e_("Ya existe un ".concat(r," registrado con esta CI: ").concat(e.nombres," ").concat(e.apellidos," (").concat(e.codigo,")"))}else e_("")}else e_("")},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 ".concat(eY?"border-red-300 bg-red-50":"border-gray-300"),placeholder:"C\xe9dula de identidad"}),eY&&(0,t.jsxs)("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[(0,t.jsx)("svg",{className:"w-4 h-4 mr-1 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),eY]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,t.jsx)("input",{type:"tel",value:eV.telefono,onChange:e=>eB(r=>({...r,telefono:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"N\xfamero de tel\xe9fono"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,t.jsx)("input",{type:"email",value:eV.email,onChange:e=>eB(r=>({...r,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Correo electr\xf3nico"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,t.jsx)("button",{onClick:eJ,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,t.jsxs)("button",{onClick:r4,disabled:!eV.nombres.trim()||!eV.apellidos.trim()||!!eY,className:"flex-1 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4"}),"Crear y Cobrar"]})]})]})})}),en&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true","aria-labelledby":"modal-pago-unificado-title",children:(0,t.jsx)("div",{className:"w-full max-w-7xl max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{id:"modal-pago-unificado-title",className:"text-lg font-semibold text-gray-900",children:"Cobranza"}),ei&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[(0,t.jsxs)("span",{className:"font-medium",children:[ei.nombres," ",ei.apellidos]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:ei.codigo})]})]}),ei&&(0,t.jsx)("button",{onClick:()=>{ru(ei),rl(!0),rK(ei.id);let e=(0,s.Ji)(),r=rq(),o=(null==r?void 0:r.id)||"";rC(r=>({...r,fecha:e,cobradorId:o}))},className:"px-3 py-1.5 text-sm text-amber-700 hover:underline transition-colors border border-amber-200 rounded-md",children:"Deudas Pendientes"})]}),(0,t.jsx)("button",{onClick:rZ,className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:(0,t.jsx)("table",{className:"w-full",children:(0,t.jsx)("tbody",{children:(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"align-top pr-3",style:{width:"15%"},children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fecha de cobro o servicio*"}),(0,t.jsx)("input",{type:"date",value:eI.fecha,onChange:e=>{var r;let o;return o=r=e.target.value,void(r&&(o=r.split("T")[0]),eS(e=>({...e,fecha:o,conceptos:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>I(e,o,e.tipoServicio))}(e.conceptos)})))},className:"w-44 px-3 min-h-[42px] py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800"}),eU&&!eI.fecha&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Fecha requerida"})]}),(0,t.jsxs)("td",{className:"align-top pr-3",style:{width:"65%"},children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observaciones"}),(0,t.jsx)("textarea",{value:eI.observaciones,onChange:e=>eS(r=>({...r,observaciones:e.target.value})),className:"w-full px-3 h-[42px] border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800 resize-none",placeholder:"Observaciones adicionales..."})]}),(0,t.jsxs)("td",{className:"align-top",style:{width:"20%"},children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Condici\xf3n"}),(0,t.jsxs)("div",{className:"flex items-center gap-4 h-full",style:{minHeight:"42px",alignItems:"center"},children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"condicion",value:"CONTADO",checked:"CONTADO"===eI.condicion,onChange:()=>{eG(!1),eS(e=>({...e,condicion:"CONTADO",pagoAplicado:e.monto}))},className:"w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500"}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Al Contado"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"condicion",value:"CREDITO",checked:"CREDITO"===eI.condicion,onChange:()=>{eG(!1),eS(e=>({...e,condicion:"CREDITO",pagoAplicado:""}))},className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"A Cr\xe9dito"})]})]})]})]})})})}),"CONTADO"===eI.condicion&&(0,t.jsxs)("div",{className:"rounded-xl p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:"Pago Inmediato (Contado)"}),(0,t.jsx)(y,{conceptos:eH(),services:q,selectedMember:ei,showFormValidation:eU,vencimientoDefault:eI.vencimiento,onAddConcepto:()=>eO("CONTADO"),onUpdateConcepto:(e,r,o)=>ek("CONTADO",e,r,o),onRemoveConcepto:e=>eP("CONTADO",e),formatNumberWithSeparator:op,getNumericValueSafe:C,isServiceDuplicate:(e,r)=>w(e,r,q),onServiceSelection:eR,title:"Conceptos a pagar",buttonColor:"bg-green-600",onOpenReservaModal:rX,modoReservaUnica:eb,onToggleModoReserva:()=>ev(!eb),canShowMultiReserva:oo(eH()).length>=2,conceptosConReservaCount:oo(eH()).length}),oo(eH()).length>=2&&eb&&(0,t.jsx)("div",{className:"mb-4 flex justify-center",children:(0,t.jsxs)("button",{type:"button",onClick:()=>{eS(e=>(on(e.conceptos||[]),e))},className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm shadow-sm",children:[oo(eH()).some(e=>e.reservaFechaHora)?"Editar reservaci\xf3n":"Crear reserva",(0,t.jsx)("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:oo(eH()).length})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"M\xe9todo de Pago *"}),(0,t.jsxs)("select",{value:eI.metodoPago,onChange:e=>eS(r=>({...r,metodoPago:e.target.value})),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ".concat(eI.metodoPago?"border-gray-300 focus:ring-green-500 focus:border-green-500":"border-red-300 focus:ring-red-500 focus:border-red-500"),children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar m\xe9todo —"}),(0,t.jsx)("option",{value:"EFECTIVO",children:"Efectivo"}),(0,t.jsx)("option",{value:"TRANSFERENCIA",children:"Transferencia"}),(0,t.jsx)("option",{value:"TARJETA",children:"Tarjeta"}),(0,t.jsx)("option",{value:"CHEQUE",children:"Cheque"})]}),eU&&!eI.metodoPago&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"M\xe9todo de pago requerido"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cobrador *"}),(0,t.jsxs)("select",{value:eI.cobradorId,onChange:e=>eS(r=>({...r,cobradorId:e.target.value})),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ".concat(eU?eI.cobradorId?"border-gray-300 focus:ring-green-500 focus:border-green-500":"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-green-500 focus:border-green-500"),children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar cobrador —"}),U.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombres},e.id))]}),eU&&!eI.cobradorId&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Cobrador requerido"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"N\xba Recibo/Factura"}),(0,t.jsx)("input",{type:"text",value:eI.numeroRecibo,onChange:e=>eS(r=>({...r,numeroRecibo:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: 00001234"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Referencia/Comprobante"}),(0,t.jsx)("input",{type:"text",value:eI.referencia,onChange:e=>eS(r=>({...r,referencia:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"N\xba de transferencia, ticket, etc."})]})]})]}),"CREDITO"===eI.condicion&&(0,t.jsxs)("div",{className:"rounded-xl p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:"Configuraci\xf3n de Cr\xe9dito"}),(0,t.jsx)(y,{conceptos:eH(),services:q,selectedMember:ei,showFormValidation:eU,vencimientoDefault:eI.vencimiento,onAddConcepto:()=>eO("CREDITO"),onUpdateConcepto:(e,r,o)=>ek("CREDITO",e,r,o),onRemoveConcepto:e=>eP("CREDITO",e),formatNumberWithSeparator:op,getNumericValueSafe:C,isServiceDuplicate:(e,r)=>w(e,r,q),onServiceSelection:eR,title:"Conceptos (Cr\xe9dito)",buttonColor:"bg-blue-600",onOpenReservaModal:rX,modoReservaUnica:eb,onToggleModoReserva:()=>ev(!eb),canShowMultiReserva:oo(eH()).length>=2,conceptosConReservaCount:oo(eH()).length}),oo(eH()).length>=2&&eb&&(0,t.jsx)("div",{className:"mb-4 flex justify-center",children:(0,t.jsxs)("button",{type:"button",onClick:()=>{eS(e=>(on(e.conceptos||[]),e))},className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm shadow-sm",children:[oo(eH()).some(e=>e.reservaFechaHora)?"Editar reservaci\xf3n":"Crear reserva",(0,t.jsx)("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:oo(eH()).length})]})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"permitirPagosParc",checked:eI.permitirPagosParc,onChange:e=>{let r=e.target.checked,o=rq(),t=(null==o?void 0:o.id)||"";eS(e=>{var o;return{...e,permitirPagosParc:r,pagoAplicado:r?e.pagoAplicado:"",cobradorId:r&&!e.cobradorId?t:e.cobradorId,metodoPago:r&&!e.metodoPago?(null===(o=V[0])||void 0===o?void 0:o.id)||"efectivo":e.metodoPago}})},className:"w-4 h-4 text-blue-600"}),(0,t.jsx)("label",{htmlFor:"permitirPagosParc",className:"text-sm font-medium text-gray-700",children:"Aplicar pago parcial ahora"})]}),eI.permitirPagosParc&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-2 mt-3 p-3 bg-white rounded-lg border border-blue-200",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Monto Pago (Gs.) *"}),(0,t.jsx)("input",{type:"text",inputMode:"numeric",value:eI.pagoAplicado,onChange:e=>{let r=op(e.target.value);eS(e=>({...e,pagoAplicado:r}))},className:"w-full px-2 py-2 border rounded-md focus:outline-none focus:ring-2 text-xs ".concat(eU?eI.pagoAplicado&&parseFloat(og(eI.pagoAplicado))>0&&parseFloat(og(eI.pagoAplicado))<=D(eH())?"border-gray-300 focus:ring-blue-500 focus:border-blue-500":"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"),placeholder:"25.000"}),(()=>{let e=D(eH()),r=parseFloat(og(eI.pagoAplicado));return eI.pagoAplicado&&r>e})()&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"No puede superar el monto total"}),eU&&eI.pagoAplicado&&0>=parseFloat(og(eI.pagoAplicado))&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Monto debe ser mayor a 0"})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"M\xe9todo de Pago *"}),(0,t.jsxs)("select",{value:eI.metodoPago,onChange:e=>eS(r=>({...r,metodoPago:e.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-xs",children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar m\xe9todo —"}),(0,t.jsx)("option",{value:"EFECTIVO",children:"Efectivo"}),(0,t.jsx)("option",{value:"TRANSFERENCIA",children:"Transferencia"}),(0,t.jsx)("option",{value:"TARJETA",children:"Tarjeta"}),(0,t.jsx)("option",{value:"CHEQUE",children:"Cheque"})]})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cobrador *"}),(0,t.jsxs)("select",{value:eI.cobradorId,onChange:e=>eS(r=>({...r,cobradorId:e.target.value})),className:"w-full px-2 py-2 border rounded-md focus:outline-none focus:ring-2 text-xs ".concat(eU?eI.cobradorId?"border-gray-300 focus:ring-green-500 focus:border-green-500":"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-green-500 focus:border-green-500"),children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar cobrador —"}),U.map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombres},e.id))]})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Referencia"}),(0,t.jsx)("input",{type:"text",value:eI.referencia,onChange:e=>eS(r=>({...r,referencia:e.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-xs",placeholder:"N\xba comprobante"})]})]})]})]}),(0,t.jsx)(N,{condicion:eI.condicion,conceptos:eH(),pagoAplicado:eI.pagoAplicado,permitirPagosParc:eI.permitirPagosParc,calculateTotal:D,getNumericValue:og,onProcessPayment:()=>{"CONTADO"===eI.condicion?om():ox()},isFormValid:ou(),saving:rD,onCancel:rZ})]})]})})}),rc&&rd&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[90vh] flex flex-col overflow-hidden",children:[(0,t.jsx)("div",{className:"border-b border-gray-200 px-6 py-3 bg-white flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"border border-gray-300 p-1.5 rounded-lg",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-black",children:"Gesti\xf3n de Deudas Pendientes"}),(0,t.jsxs)("p",{className:"text-black text-sm",children:[rd.nombres," ",rd.apellidos,(0,t.jsxs)("span",{className:"ml-2 text-gray-600",children:["• C\xf3digo: ",rd.codigo]})]})]})]}),(0,t.jsx)("button",{onClick:()=>{rl(!1),ru(null),rr([]),rt({}),rC({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""})},className:"text-black hover:text-gray-600 transition-colors",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-black mb-3",children:"Datos del Pago"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-3 mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Fecha de Pago *"}),(0,t.jsx)("input",{type:"date",value:rj.fecha,onChange:e=>rC(r=>({...r,fecha:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"M\xe9todo de Pago *"}),(0,t.jsxs)("select",{value:rj.metodoPago,onChange:e=>rC(r=>({...r,metodoPago:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar m\xe9todo —"}),(0,t.jsx)("option",{value:"EFECTIVO",children:"Efectivo"}),(0,t.jsx)("option",{value:"TRANSFERENCIA",children:"Transferencia"}),(0,t.jsx)("option",{value:"TARJETA",children:"Tarjeta"}),(0,t.jsx)("option",{value:"CHEQUE",children:"Cheque"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Cobrador"}),(0,t.jsxs)("select",{value:rj.cobradorId,onChange:e=>rC(r=>({...r,cobradorId:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",children:[(0,t.jsx)("option",{value:"",children:"— Sin asignar —"}),U.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.nombres," ",e.apellidos]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Nro. de Recibo"}),(0,t.jsx)("input",{type:"text",value:rj.numeroRecibo,onChange:e=>rC(r=>({...r,numeroRecibo:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"001-001-0000123"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Referencia/Comprobante"}),(0,t.jsx)("input",{type:"text",value:rj.referencia,onChange:e=>rC(r=>({...r,referencia:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"N\xba transferencia, cheque, etc."})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Observaciones"}),(0,t.jsx)("textarea",{rows:2,value:rj.observaciones,onChange:e=>rC(r=>({...r,observaciones:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"Observaciones adicionales sobre el pago..."})]}),(0,t.jsx)("div",{})]})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg",children:[(0,t.jsx)("div",{className:"px-3 py-2 border-b border-gray-200 bg-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[(0,t.jsx)("span",{className:"font-medium text-black",children:"\uD83D\uDCCB Detalle de D\xe9bitos Pendientes"}),(0,t.jsx)("span",{className:"text-gray-400",children:"•"}),(0,t.jsxs)("span",{className:"text-black font-medium",children:["Deuda Total Gs.",((null===(e=rL[rd.id])||void 0===e?void 0:e.saldo)||rd.deudaTotal||0).toLocaleString("es-PY")]}),(0,t.jsx)("span",{className:"text-gray-400",children:"•"}),(0,t.jsxs)("span",{className:"text-black font-medium",children:["D\xe9bitos Pendientes ",e6.length]}),(0,t.jsx)("span",{className:"text-gray-400",children:"•"}),(0,t.jsxs)("span",{className:"text-black font-medium",children:["Seleccionados ",re.length>0?"Gs.".concat(ov().toLocaleString("es-PY")):"Gs.0"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>{e6.length>0&&rr(e6.map(e=>e.id))},title:"Seleccionar Todo",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs font-medium",children:"✓ Todo"}),(0,t.jsx)("button",{onClick:()=>rr([]),title:"Limpiar Selecci\xf3n",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs",children:"\uD83E\uDDF9"}),(0,t.jsx)("button",{onClick:()=>rK(rd.id),disabled:e5,title:"Actualizar Lista",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs disabled:opacity-50",children:e5?"⟳":"\uD83D\uDD04"}),(0,t.jsx)("button",{onClick:()=>{r1(rd.id),rg(!0)},title:"Ver Historial de Refinanciaciones",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs font-medium",children:"\uD83D\uDCCB Historial Refinanciaciones"})]})]})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:e5?(0,t.jsx)("div",{className:"p-6 text-center",children:(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"⟳ Cargando d\xe9bitos pendientes..."})}):e6.length>0?(0,t.jsxs)("table",{className:"w-full text-xs",children:[(0,t.jsx)("thead",{className:"bg-white border-b border-gray-200",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-2 py-3 text-left font-semibold text-black w-8",children:(0,t.jsx)("input",{type:"checkbox",checked:e6.length>0&&re.length===e6.length,onChange:e=>{e.target.checked?rr(e6.map(e=>e.id)):rr([])},className:"w-4 h-4 text-gray-600 bg-gray-100 border-gray-300 rounded focus:ring-gray-500 focus:ring-2"})}),(0,t.jsx)("th",{className:"px-3 py-3 text-left font-semibold text-black min-w-[150px]",children:"Descripci\xf3n"}),(0,t.jsx)("th",{className:"px-3 py-3 text-left font-semibold text-black w-20",children:"Fecha"}),(0,t.jsx)("th",{className:"px-3 py-3 text-left font-semibold text-black w-24",children:"Vencimiento"}),(0,t.jsx)("th",{className:"px-3 py-3 text-center font-semibold text-black w-20",children:"D\xedas Atraso"}),(0,t.jsx)("th",{className:"px-3 py-3 text-center font-semibold text-black w-16",children:"Estado"}),(0,t.jsx)("th",{className:"px-3 py-3 text-right font-semibold text-black w-28",children:"Saldo Pendiente"}),(0,t.jsx)("th",{className:"px-3 py-3 text-right font-semibold text-black w-24",children:"Pagado"}),(0,t.jsx)("th",{className:"px-3 py-3 text-center font-semibold text-black w-32",children:"Monto a Pagar"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:e6.map((e,r)=>{let o=(e.monto||0)-(e.paidAmount||0),a=e.vencimiento?new Date(e.vencimiento):null,n=new Date;n.setHours(0,0,0,0);let s=a?new Date(a):null;s&&s.setHours(0,0,0,0);let i=s&&s<n,c=re.includes(e.id),l=a?Math.floor((new Date().getTime()-a.getTime())/864e5):0;return(0,t.jsxs)("tr",{className:"transition-all hover:bg-gray-50 ".concat(c?"bg-gray-100 border-l-4 border-gray-400":""),children:[(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsx)("input",{type:"checkbox",id:"debt-".concat(e.id),checked:c,onChange:r=>oh(e.id,r.target.checked),className:"w-4 h-4 text-gray-600 bg-gray-100 border-gray-300 rounded focus:ring-gray-500 focus:ring-2"})}),(0,t.jsx)("td",{className:"px-3 py-3",children:(0,t.jsx)("label",{htmlFor:"debt-".concat(e.id),className:"font-medium text-black cursor-pointer block",children:e.concepto||"Sin concepto"})}),(0,t.jsx)("td",{className:"px-3 py-3 text-black",children:e.fecha?new Date(e.fecha).toLocaleDateString("es-PY"):"N/A"}),(0,t.jsx)("td",{className:"px-3 py-3 ".concat(i?"text-black font-medium":"text-black"),children:e.vencimiento?new Date(e.vencimiento).toLocaleDateString("es-PY"):"N/A"}),(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:i&&l>0?(0,t.jsx)("span",{className:"text-black font-medium",children:l}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:i?(0,t.jsx)("span",{className:"text-black text-xs font-medium",children:"VENCIDO"}):(0,t.jsx)("span",{className:"text-black text-xs font-medium",children:"AL D\xcdA"})}),(0,t.jsx)("td",{className:"px-3 py-3 text-right",children:(0,t.jsxs)("span",{className:"font-bold ".concat("text-black"),children:["Gs.",o.toLocaleString("es-PY")]})}),(0,t.jsx)("td",{className:"px-3 py-3 text-right text-black",children:(e.paidAmount||0)>0?"Gs.".concat((e.paidAmount||0).toLocaleString("es-PY")):"-"}),(0,t.jsx)("td",{className:"px-3 py-3",children:(0,t.jsx)("input",{type:"text",inputMode:"numeric",value:ro[e.id]||"",onChange:r=>ob(e.id,r.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"Ingrese monto"})})]},e.id)})})]}):(0,t.jsxs)("div",{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"text-gray-500 mb-2 text-sm",children:"No se encontraron d\xe9bitos pendientes"}),(0,t.jsx)("button",{onClick:()=>rK(rd.id),className:"text-amber-600 hover:text-amber-700 font-medium text-xs",children:"\uD83D\uDD04 Cargar d\xe9bitos"})]})})]}),(()=>{let e=Object.values(ro).reduce((e,r)=>{if(r){let o=parseInt(og(r));return e+(isNaN(o)?0:o)}return e},0),r=ov(),o=Math.max(0,r-e);return e>0&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 mx-4 shadow-sm bg-white",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h4",{className:"text-sm font-bold text-black flex items-center gap-2",children:"\uD83D\uDCCA Resumen del Pago"}),(0,t.jsxs)("span",{className:"text-xs border border-gray-300 text-black px-2 py-1 rounded-full font-medium",children:[re.length," d\xe9bito",1!==re.length?"s":""," seleccionado",1!==re.length?"s":""]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[(0,t.jsx)("div",{className:"text-xs text-black mb-1",children:"Total Adeudado"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-black",children:["Gs.",r.toLocaleString("es-PY")]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[(0,t.jsx)("div",{className:"text-xs text-black mb-1",children:"Total a Pagar"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-black",children:["Gs.",e.toLocaleString("es-PY")]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[(0,t.jsx)("div",{className:"text-xs text-black mb-1",children:"Saldo Restante"}),(0,t.jsxs)("div",{className:"text-lg font-bold ".concat("text-black"),children:["Gs.",o.toLocaleString("es-PY")]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[(0,t.jsx)("div",{className:"text-xs text-black mb-1",children:"M\xe9todo de Pago"}),(0,t.jsx)("div",{className:"text-sm font-medium text-black",children:rj.metodoPago||"No seleccionado"})]})]}),(0,t.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:o<=0?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-black border border-gray-300 px-3 py-2 rounded-lg text-sm",children:[(0,t.jsx)("span",{className:"text-lg",children:"✅"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:"Pago Completo"}),(0,t.jsx)("div",{className:"text-xs text-black",children:"Se saldar\xe1n todos los d\xe9bitos seleccionados"})]})]}):e>0?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-black border border-gray-300 px-3 py-2 rounded-lg text-sm",children:[(0,t.jsx)("span",{className:"text-lg",children:"\uD83D\uDCA1"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:"Pago Parcial"}),(0,t.jsxs)("div",{className:"text-xs text-black",children:["Quedar\xe1 un saldo pendiente de Gs.",o.toLocaleString("es-PY")]})]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-black border border-gray-300 px-3 py-2 rounded-lg text-sm",children:[(0,t.jsx)("span",{className:"text-lg",children:"ℹ️"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:"Sin Pagos Definidos"}),(0,t.jsx)("div",{className:"text-xs text-black",children:"Ingrese los montos a pagar para cada d\xe9bito"})]})]})})]})})()]}),(0,t.jsx)("div",{className:"bg-white border-t border-gray-200 px-4 py-3 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-3",children:(0,t.jsx)("div",{className:"text-xs text-black",children:re.length>0?"".concat(re.length," d\xe9bito").concat(re.length>1?"s":""," seleccionado").concat(re.length>1?"s":""):"Completa los datos de pago y selecciona los d\xe9bitos"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{rl(!1),ru(null),rr([]),rC({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""})},className:"px-3 py-1.5 text-sm border border-gray-300 rounded text-black hover:bg-gray-50 transition-colors",children:"Cerrar"}),re.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>rx(!0),className:"px-4 py-1.5 text-sm border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors font-medium",children:"♻️ Refinanciar deuda"}),(0,t.jsx)("button",{onClick:async()=>{if(!rd||!rj.fecha||!rj.metodoPago){alert("Por favor completa todos los campos requeridos.");return}let e=Object.values(ro).reduce((e,r)=>{if(r){let o=parseInt(og(r));return e+(isNaN(o)?0:o)}return e},0);if(e<=0){alert("Ingresa al menos un monto para procesar el pago.");return}rw(!0);try{let r=[];for(let e of Object.keys(ro)){let o=ro[e];if(o){let t=parseInt(og(o));t>0&&r.push({debitId:e,amount:t})}}if(0===r.length){alert("No hay montos v\xe1lidos para procesar.");return}let o={memberId:rd.id,fecha:rj.fecha,monto:e,concepto:"Pago de ".concat(r.length," d\xe9bito").concat(r.length>1?"s":""," pendiente").concat(r.length>1?"s":""),formaPago:rj.metodoPago.toLowerCase(),cobradorId:rj.cobradorId||"",numeroRecibo:rj.numeroRecibo||"",observaciones:rj.observaciones||(rj.referencia?"Referencia: ".concat(rj.referencia):""),allocations:r},t=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify(o)});if(t.ok)alert("\xa1Pago procesado exitosamente!\n\nTotal procesado: Gs. ".concat(e.toLocaleString("es-PY"),"\nD\xe9bitos pagados: ").concat(r.length)),rl(!1),ru(null),rr([]),rt({}),rC({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""}),await rU();else{let e=await t.text();throw Error("Error ".concat(t.status,": ").concat(e))}}catch(e){console.error("Error processing debt payments:",e),alert("Error al procesar el pago: ".concat(e instanceof Error?e.message:"Error desconocido"))}finally{rw(!1)}},disabled:(()=>{let e=Object.values(ro).reduce((e,r)=>{if(r){let o=parseInt(og(r));return e+(isNaN(o)?0:o)}return e},0);return!rj.fecha||!rj.metodoPago||e<=0||rD})(),className:"px-4 py-1.5 text-sm border border-gray-300 text-black rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-200 transition-colors font-medium",children:rD?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"animate-spin",children:"⟳"})," Procesando..."]}):(0,t.jsxs)(t.Fragment,{children:["\uD83D\uDCB3 Procesar Pago",(()=>{let e=Object.values(ro).reduce((e,r)=>{if(r){let o=parseInt(og(r));return e+(isNaN(o)?0:o)}return e},0);return e>0&&(0,t.jsxs)("span",{className:"ml-1 font-normal text-xs",children:["(Gs. ",e.toLocaleString("es-PY"),")"]})})()]})})]})]})]})})]})}),rm&&rd&&(0,t.jsx)(i,{isOpen:rm,onClose:()=>rx(!1),memberId:rd.id,member:rd,debits:e6.filter(e=>re.includes(e.id)),onSuccess:()=>{rx(!1),rl(!1),ru(null),rr([]),rt({}),rC({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""}),rU(),(null==rd?void 0:rd.id)&&rK(rd.id)}}),rp&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:e=>e.target===e.currentTarget&&rg(!1),children:(0,t.jsx)("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDCCB Historial de Refinanciaciones"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[null==rd?void 0:rd.nombres," ",null==rd?void 0:rd.apellidos]})]}),(0,t.jsx)("button",{onClick:()=>rg(!1),className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"max-h-[70vh] overflow-y-auto",children:rv?(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"⟳ Cargando historial..."})}):ry?(0,t.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg",children:[(0,t.jsxs)("div",{className:"text-red-800 text-sm",children:["❌ Error: ",ry]}),(0,t.jsx)("button",{onClick:()=>r1(rd.id),className:"mt-2 px-3 py-1 bg-red-100 text-red-800 rounded text-xs hover:bg-red-200",children:"\uD83D\uDD04 Reintentar"})]}):0===rh.length?(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"\uD83D\uDCC4 No hay refinanciaciones registradas para este socio."})}):(0,t.jsx)("div",{className:"space-y-4",children:rh.map(e=>{var r,a;return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["ID: ",e.id]}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full ".concat("ACTIVA"===e.status?"bg-green-100 text-green-800":"COMPLETADA"===e.status?"bg-blue-100 text-blue-800":"ANULADA"===e.status?"bg-red-100 text-red-800":"CANCELADA"===e.status?"bg-orange-100 text-orange-800":"APROBADA"===e.status?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:e.status})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Creado: ",new Date(e.createdAt).toLocaleDateString("es-PY"),e.executedAt&&(0,t.jsxs)(t.Fragment,{children:[" | Ejecutado: ",new Date(e.executedAt).toLocaleDateString("es-PY")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["ACTIVA"===e.status&&(0,t.jsx)("button",{onClick:async()=>{if(confirm("\xbfEst\xe1 seguro de cancelar esta refinanciaci\xf3n? Esta acci\xf3n revertir\xe1 todos los pagos y restaurar\xe1 las deudas originales."))try{let r=await c.L.authenticatedFetch("/api/refinancing/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refinancingId:e.id,cancelledBy:"admin"})});if(r.ok)alert("Refinanciaci\xf3n cancelada exitosamente"),r1(rd.id),rK(rd.id);else{let e=await r.json();alert("Error: ".concat(e.error||"No se pudo cancelar la refinanciaci\xf3n"))}}catch(e){console.error("Error cancelling refinancing:",e),alert("Error de conexi\xf3n al cancelar la refinanciaci\xf3n")}},className:"px-2 py-1 bg-red-100 text-red-800 rounded text-xs hover:bg-red-200 transition-colors",title:"Cancelar refinanciaci\xf3n",children:"\uD83D\uDDD1️ Cancelar"}),(0,t.jsx)("button",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs hover:bg-purple-200 transition-colors",title:"Generar PDF",onClick:async()=>{try{let r=(await Promise.all([o.e(9213),o.e(2505),o.e(8758)]).then(o.bind(o,53375))).default,t=e=>{var r,o;return null!==(o=null==e?void 0:null===(r=e.toLocaleString("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}))||void 0===r?void 0:r.replace("₲","Gs."))&&void 0!==o?o:"Gs.0"},a=e=>e?new Date(e).toLocaleDateString("es-PY"):"",n=e.originalDebitsSnapshot||[];e.principal,e.downPaymentAmount,e.totalInInstallments,e.installmentAmount,e.schedule;let s=new r("portrait","mm","a4"),i=s.internal.pageSize.width,c=s.internal.pageSize.height,l=[41,128,185],d=[52,73,94],u=[245,246,250],m=[218,223,228],x=25,p=function(e,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];s.setFontSize(o),s.setFont("helvetica",t?"bold":"normal");let a=s.getTextWidth(e);s.text(e,(i-a)/2,r)},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;return x+e>c-20&&(s.addPage(),x=25,!0)};s.setFillColor(...l),s.rect(0,0,i,15,"F"),s.setTextColor(255,255,255),s.setFontSize(14),s.setFont("helvetica","bold"),p("CLUB SOCIAL DEPORTIVO",10,14,!0),s.setDrawColor(...l),s.setLineWidth(.8),s.line(20,18,i-20,18),s.setTextColor(...d),p("SOLICITUD DE REFINANCIACI\xd3N",28,16,!0),x=38,s.setFontSize(9),s.setTextColor(...d);let h="".concat((null==rd?void 0:rd.nombres)||""," ").concat((null==rd?void 0:rd.apellidos)||"").trim(),b=(null==rd?void 0:rd.ci)||"",v=(null==rd?void 0:rd.codigo)||"";s.setFillColor(...u),s.rect(20,x-5,i-40,15,"F"),s.setDrawColor(...m),s.rect(20,x-5,i-40,15),s.setFont("helvetica","bold"),s.text("SOCIO:",25,x),s.setFont("helvetica","normal"),s.text(h||"Informaci\xf3n no disponible",45,x),s.setFont("helvetica","bold"),s.text("C.I.N\xb0:",25,x+5),s.setFont("helvetica","normal"),s.text(b||"No disponible",45,x+5),s.setFont("helvetica","bold"),s.text("C\xd3DIGO:",120,x),s.setFont("helvetica","normal"),s.text(v||"No disponible",145,x),s.setFont("helvetica","bold"),s.text("FECHA:",120,x+5),s.setFont("helvetica","normal"),s.text(new Date(e.createdAt).toLocaleDateString("es-PY"),145,x+5),x+=15,g(40),x+=8,s.setFontSize(11),s.setTextColor(...l),s.setFont("helvetica","bold"),s.text("1. D\xc9BITOS A REFINANCIAR",20,x);let f=x+=6;s.setFillColor(...l),s.rect(20,f,i-40,6,"F"),s.setTextColor(255,255,255),s.setFontSize(9),s.text("CONCEPTO",22,f+4),s.text("MONTO",130,f+4),s.text("VENCIMIENTO",160,f+4),x=f+6,s.setTextColor(...d),s.setFont("helvetica","normal"),n.forEach((e,r)=>{var o;r>0&&r%8==0&&(g(40),x+=10),r%2==0&&(s.setFillColor(...u),s.rect(20,x,i-40,6,"F")),s.setDrawColor(...m),s.rect(20,x,i-40,6);let n=((null===(o=e.concepto)||void 0===o?void 0:o.length)>45?e.concepto.substring(0,42)+"...":e.concepto)||"";s.text(n,22,x+4),s.text(t(e.monto-(e.paidAmount||0)),130,x+4),s.text(e.vencimiento?a(e.vencimiento):"N/A",160,x+4),x+=6}),s.setFillColor(...d),s.rect(20,x,i-40,6,"F"),s.setTextColor(255,255,255),s.setFont("helvetica","bold"),s.text("TOTAL A REFINANCIAR:",22,x+4),s.text(t(e.principal),130,x+4),x+=14,g(30),s.setTextColor(...l),s.setFontSize(11),s.setFont("helvetica","bold"),s.text("2. T\xc9RMINOS DE REFINANCIACI\xd3N",20,x),x+=6;let y=[["Cantidad de Cuotas:","".concat(e.installments," cuotas")],["Porcentaje Inicial:","".concat(e.downPaymentPercent,"%")],["Monto Cuota Inicial:",t(e.downPaymentAmount)],["Fecha Primera Cuota:",a(e.startDueDate)],["Monto por Cuota:",t(e.installmentAmount)]];if(y.forEach((e,r)=>{let[o,t]=e,a=x+8*r;r%2==0&&(s.setFillColor(...u),s.rect(20,a,i-40,8,"F")),s.setDrawColor(...m),s.rect(20,a,i-40,8),s.setTextColor(...d),s.setFontSize(9),s.setFont("helvetica","bold"),s.text(o,25,a+5),s.setFont("helvetica","normal");let n=i-45-s.getTextWidth(t);s.text(t,n,a+5)}),x+=8*y.length+4,g(50),s.setTextColor(...l),s.setFontSize(11),s.setFont("helvetica","bold"),s.text("3. CRONOGRAMA DE PAGOS",20,x),x+=6,e.schedule){let r=e.schedule;if(r.length>8){let e=Math.ceil(r.length/2),o=(i-50)/2;s.setFillColor(...l),s.rect(20,x,o,6,"F"),s.rect(20+o+10,x,o,6,"F"),s.setTextColor(255,255,255),s.setFontSize(8),s.text("CUOTA",25,x+4),s.text("MONTO",60,x+4),s.text("VENCIMIENTO",95,x+4),s.text("CUOTA",25+o+10,x+4),s.text("MONTO",60+o+10,x+4),s.text("VENCIMIENTO",95+o+10,x+4);let n=x+=6;r.forEach((r,i)=>{let c=n+4*Math.floor(i%e);if(i<e)i%2==0&&(s.setFillColor(...u),s.rect(20,c,o,4,"F")),s.setDrawColor(...m),s.rect(20,c,o,4),s.setTextColor(...d),s.text("".concat(r.number),25,c+2.5),s.text(t(r.amount),60,c+2.5),s.text(a(r.dueDate),95,c+2.5);else{let c=i-e,l=n+4*c;c%2==0&&(s.setFillColor(...u),s.rect(20+o+10,l,o,4,"F")),s.setDrawColor(...m),s.rect(20+o+10,l,o,4),s.setTextColor(...d),s.text("".concat(r.number),25+o+10,l+2.5),s.text(t(r.amount),60+o+10,l+2.5),s.text(a(r.dueDate),95+o+10,l+2.5)}}),x=n+4*e+8}else s.setFillColor(...l),s.rect(20,x,i-40,6,"F"),s.setTextColor(255,255,255),s.setFontSize(8),s.text("CUOTA",25,x+4),s.text("MONTO",70,x+4),s.text("VENCIMIENTO",120,x+4),x+=6,r.forEach((e,r)=>{r%2==0&&(s.setFillColor(...u),s.rect(20,x,i-40,5,"F")),s.setDrawColor(...m),s.rect(20,x,i-40,5),s.setTextColor(...d),s.setFontSize(8),s.text("".concat(e.number),25,x+3),s.text(t(e.amount),70,x+3),s.text(a(e.dueDate),120,x+3),x+=5}),x+=4}g(25),s.setTextColor(...l),s.setFontSize(11),s.setFont("helvetica","bold"),s.text("4. RESUMEN FINANCIERO",20,x),x+=6,s.setFillColor(...u),s.rect(20,x,i-40,20,"F"),s.setDrawColor(...l),s.rect(20,x,i-40,20);let N=0;N=e.schedule&&e.schedule.length>0?e.schedule.reduce((e,r)=>e+(r.amount||0),0):e.installmentAmount&&e.installments?e.installmentAmount*e.installments:(e.principal||0)-(e.downPaymentAmount||0),[["Total Principal Refinanciado:",t(e.principal)],["Cuota Inicial:",t(e.downPaymentAmount)],["Total Financiado en Cuotas:",t(N)],["N\xfamero Total de Cuotas:","".concat(e.installments," cuotas")],["Monto por Cuota:",t(e.installmentAmount)]].forEach((e,r)=>{let[o,t]=e,a=x+5+3.5*r;s.setFontSize(9),s.setFont("helvetica","bold"),s.setTextColor(...d),s.text(o,25,a),s.setFont("helvetica","normal"),s.setTextColor(...d);let n=i-45-s.getTextWidth(t);s.text(t,n,a)}),x+=25,g(35),s.setTextColor(...l),s.setFontSize(11),s.setFont("helvetica","bold"),s.text("5. AUTORIZACIONES",20,x),x+=8;let j=(i-60)/2;s.setDrawColor(...m),s.rect(25,x,j,25),s.setFontSize(9),s.setTextColor(...d),s.setFont("helvetica","bold"),s.text("FIRMA DEL SOCIO",25+j/2-s.getTextWidth("FIRMA DEL SOCIO")/2,x+8),s.setFont("helvetica","normal"),s.setFontSize(8),s.text("Acepto los t\xe9rminos y condiciones de esta",30,x+15),s.text("refinanciaci\xf3n y me comprometo a su cumplimiento.",30,x+19),s.rect(35+j,x,j,25),s.setFont("helvetica","bold"),s.text("AUTORIZACI\xd3N DEL CLUB",35+j+j/2-s.getTextWidth("AUTORIZACI\xd3N DEL CLUB")/2,x+8),s.setFont("helvetica","normal"),s.setFontSize(8),s.text("Visto Bueno y Autorizaci\xf3n de la",35+j+5,x+15),s.text("Administraci\xf3n del Club",35+j+5,x+19),x+=32,s.setDrawColor(...m),s.line(20,x,i-20,x),x+=3,s.setFontSize(7),s.setTextColor(...d),p("Documento generado autom\xe1ticamente el ".concat(new Date().toLocaleString("es-PY")," - P\xe1gina 1 de 1"),x);let C=(rd?"".concat(rd.nombres," ").concat(rd.apellidos).trim():"Sin_Nombre").replace(/[^a-zA-Z0-9áéíóúñÁÉÍÓÚÑ\s]/g,"").replace(/\s+/g,"_"),D=(null==rd?void 0:rd.codigo)||"Sin_Codigo",w=new Date(e.createdAt).toLocaleDateString("es-PY",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),E="Refinanciacion_".concat(C,"_").concat(D,"_").concat(w,".pdf");s.save(E)}catch(e){alert("Error al generar PDF: "+(e instanceof Error?e.message:e))}},children:"\uD83D\uDCC4 Generar PDF"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Principal:"}),(0,t.jsxs)("div",{className:"font-medium",children:["Gs.",(null===(r=e.principal)||void 0===r?void 0:r.toLocaleString("es-PY"))||0]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Anticipo:"}),(0,t.jsxs)("div",{className:"font-medium",children:["Gs.",(null===(a=e.downPaymentAmount)||void 0===a?void 0:a.toLocaleString("es-PY"))||0]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Cuotas:"}),(0,t.jsx)("div",{className:"font-medium",children:e.installments||0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Estado Cuotas:"}),(0,t.jsx)("div",{className:"font-medium",children:e.schedule?(0,t.jsxs)(t.Fragment,{children:[e.schedule.filter(e=>"PAGADA"===e.status).length," pagadas / ",e.schedule.length," total"]}):"N/A"})]})]}),e.observations&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Observaciones:"})," ",e.observations]}),e.schedule&&e.schedule.length>0&&(0,t.jsxs)("details",{className:"mt-3",children:[(0,t.jsx)("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Ver cronograma de cuotas"}),(0,t.jsx)("div",{className:"mt-2 overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"#"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Vencimiento"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Importe"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Pagado"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-center",children:"Estado"})]})}),(0,t.jsx)("tbody",{children:e.schedule.map(e=>{var r,o;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:e.number}),(0,t.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:new Date(e.dueDate).toLocaleDateString("es-PY")}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",(null===(r=e.amount)||void 0===r?void 0:r.toLocaleString("es-PY"))||0]}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",(null===(o=e.paidAmount)||void 0===o?void 0:o.toLocaleString("es-PY"))||0]}),(0,t.jsx)("td",{className:"border border-gray-300 px-2 py-1 text-center",children:(0,t.jsx)("span",{className:"px-1 py-0.5 text-xs rounded ".concat("PAGADA"===e.status?"bg-green-100 text-green-800":"PARCIAL"===e.status?"bg-yellow-100 text-yellow-800":"VENCIDA"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status})})]},e.number)})})]})})]}),e.originalDebitsSnapshot&&e.originalDebitsSnapshot.length>0&&(0,t.jsxs)("details",{className:"mt-3",children:[(0,t.jsx)("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Ver deudas refinanciadas"}),(0,t.jsx)("div",{className:"mt-2 overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"#"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Concepto"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Monto original"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Pagado antes"}),(0,t.jsx)("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Vencimiento"})]})}),(0,t.jsx)("tbody",{children:e.originalDebitsSnapshot.map((e,r)=>{var o,a;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:r+1}),(0,t.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:e.concepto}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",(null===(o=e.monto)||void 0===o?void 0:o.toLocaleString("es-PY"))||0]}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",(null===(a=e.paidAmount)||void 0===a?void 0:a.toLocaleString("es-PY"))||0]}),(0,t.jsx)("td",{className:"border border-gray-300 px-2 py-1",children:e.vencimiento?new Date(e.vencimiento).toLocaleDateString("es-PY"):"-"})]},e.id||r)})})]})})]})]},e.id)})})}),(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 flex justify-between items-center",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:rh.length>0&&"".concat(rh.length," refinanciaci\xf3n(es) encontrada(s)")}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>r1(rd.id),disabled:rv,className:"px-3 py-2 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 transition-colors text-sm disabled:opacity-50",children:[rv?"⟳":"\uD83D\uDD04"," Actualizar"]}),(0,t.jsx)("button",{onClick:()=>rg(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors text-sm",children:"Cerrar"})]})]})]})})}),eu&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:e=>e.target===e.currentTarget&&rQ(),children:(0,t.jsx)("div",{className:"w-full max-w-4xl max-h-[95vh] overflow-y-auto bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"\uD83D\uDCC5 Configurar Reserva"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Complete todos los detalles para la reserva del servicio"})]}),(0,t.jsx)("button",{onClick:rQ,className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDC64 Datos del Socio"}),(0,t.jsxs)("div",{className:"grid grid-cols-[3fr_1fr_1.5fr_2fr_2fr_1.2fr] gap-3 items-end",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre y Apellido"}),(0,t.jsx)("input",{type:"text",value:"".concat((null==ei?void 0:ei.nombres)||""," ").concat((null==ei?void 0:ei.apellidos)||""),disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"N\xb0 de Socio"}),(0,t.jsx)("input",{type:"text",value:(null==ei?void 0:ei.codigo)||"",disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600 text-center"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula"}),(0,t.jsx)("input",{type:"text",value:ef.cedula||(null==ei?void 0:ei.ci)||"",onChange:e=>ey(r=>({...r,cedula:e.target.value})),placeholder:"Ingrese c\xe9dula",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nro de Tel\xe9fono"}),(0,t.jsx)("input",{type:"text",value:ef.telefono||(null==ei?void 0:ei.telefono)||"",onChange:e=>ey(r=>({...r,telefono:e.target.value})),placeholder:"Ingrese tel\xe9fono",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ef.ruc,onChange:e=>ey(r=>({...r,ruc:e.target.value})),placeholder:"Ingrese RUC",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estado"}),(0,t.jsx)("div",{className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded text-center font-medium ".concat((null!==(P=null===(r=rL[(null==ei?void 0:ei.id)||""])||void 0===r?void 0:r.estadoCalc)&&void 0!==P?P:null==ei?void 0:ei.estado)==="AL_DIA"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"),children:(null!==(k=null===(f=rL[(null==ei?void 0:ei.id)||""])||void 0===f?void 0:f.estadoCalc)&&void 0!==k?k:null==ei?void 0:ei.estado)==="AL_DIA"?"Al d\xeda":"Atrasado"})]})]})]})}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"esParaTercero",checked:ef.esParaTercero,onChange:e=>ey(r=>({...r,esParaTercero:e.target.checked})),className:"w-4 h-4 text-amber-600 border-gray-300 rounded focus:ring-amber-500"}),(0,t.jsx)("label",{htmlFor:"esParaTercero",className:"text-xs font-medium text-gray-900",children:"\uD83C\uDFAD \xbfReserva a favor de un tercero?"})]}),ef.esParaTercero&&(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre y Apellido *"}),(0,t.jsx)("input",{type:"text",value:ef.terceroNombre,onChange:e=>ey(r=>({...r,terceroNombre:e.target.value})),placeholder:"Nombre completo del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ef.terceroCedula,onChange:e=>ey(r=>({...r,terceroCedula:e.target.value})),placeholder:"C\xe9dula del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tel\xe9fono (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ef.terceroTelefono,onChange:e=>ey(r=>({...r,terceroTelefono:e.target.value})),placeholder:"Tel\xe9fono del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ef.terceroRuc,onChange:e=>ey(r=>({...r,terceroRuc:e.target.value})),placeholder:"RUC del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83C\uDFE2 Servicios y Espacios"}),(()=>{let e=eH().find(e=>e.id===ex),r=q.find(r=>r.id===(null==e?void 0:e.servicioId));return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Servicio"}),(0,t.jsx)("input",{type:"text",value:(null==r?void 0:r.nombre)||"Servicio no encontrado",disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Espacio *"}),(0,t.jsx)("input",{type:"text",value:(()=>{let e=eg.find(e=>e.id===ef.venueId);if(e)return e.nombre;if((null==r?void 0:r.espacios)&&r.espacios.length>0){let e=r.espacios.findIndex((e,o)=>"espacio-".concat(r.id,"-").concat(o)===ef.venueId);if(e>=0)return r.espacios[e]}return"Espacio seleccionado previamente"})(),disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{className:"bg-purple-100 p-2 rounded text-xs",children:[(0,t.jsx)("strong",{children:"\uD83D\uDCB0 Pagos:"})," ",(()=>{let e=eH().find(e=>e.id===ex),r=q.find(r=>r.id===(null==e?void 0:e.servicioId)),o=(null==e?void 0:e.monto)?parseInt(e.monto.replace(/[^\d]/g,"")):0;return"".concat((null==r?void 0:r.nombre)||"N/A"," - Gs.").concat(o.toLocaleString("es-PY"))})()]})]})})()]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83C\uDF89 Datos del Evento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fecha del Evento *"}),(0,t.jsx)("input",{type:"date",value:ef.fecha,onChange:e=>ey(r=>({...r,fecha:e.target.value})),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hora de Inicio *"}),(0,t.jsx)("input",{type:"time",value:ef.inicioHora,onChange:e=>ey(r=>({...r,inicioHora:e.target.value})),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hora de Fin *"}),(0,t.jsx)("input",{type:"time",max:"03:00",value:ef.finHora,onChange:e=>ey(r=>({...r,finHora:e.target.value})),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"})]})]}),(0,t.jsx)("div",{className:"space-y-2",children:(()=>{let e=eH().find(e=>e.id===ex),r=q.find(r=>r.id===(null==e?void 0:e.servicioId)),o=null==r?void 0:r.permiteHorasExtras,a=null==r?void 0:r.precioHoraExtra;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"horaExtra",checked:ef.horaExtra,disabled:!o,onChange:e=>{if(e.target.checked&&o){let e=a?op(a.toString()):"";ey(r=>({...r,horaExtra:!0,cantidadHorasExtra:"1",montoHorasExtra:e}))}else ey(e=>({...e,horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""}))},className:"w-3 h-3 border-gray-300 rounded focus:ring-green-500 ".concat(o?"text-green-600":"text-gray-400")}),(0,t.jsx)("label",{htmlFor:"horaExtra",className:"text-xs ".concat(o?"text-gray-700":"text-gray-400"),children:"⏰ Hora extra"})]}),!o&&(0,t.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-2",children:(0,t.jsx)("p",{className:"text-xs text-amber-700",children:"⚠️ El servicio no permite horas extras"})}),ef.horaExtra&&o&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Horas"}),(0,t.jsx)("input",{type:"number",min:"1",step:"0.5",value:ef.cantidadHorasExtra,onChange:e=>{let r=(parseFloat(e.target.value)||0)*(a||0),o=r>0?op(r.toString()):"";ey(r=>({...r,cantidadHorasExtra:e.target.value,montoHorasExtra:o}))},placeholder:"Ej: 2",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Monto (Gs.)"}),(0,t.jsx)("input",{type:"text",value:ef.montoHorasExtra,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600",placeholder:"Calculado autom\xe1ticamente"})]})]})]})})()})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83C\uDF8A Acontecimiento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),(0,t.jsxs)("select",{value:ef.acontecimiento,onChange:e=>{ey(r=>({...r,acontecimiento:e.target.value,quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:""}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500",children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar tipo —"}),(0,t.jsx)("option",{value:"15_anos",children:"15 a\xf1os"}),(0,t.jsx)("option",{value:"boda",children:"Boda"}),(0,t.jsx)("option",{value:"cumpleanos",children:"Cumplea\xf1os"}),(0,t.jsx)("option",{value:"otros",children:"Otros"})]})]}),"15_anos"===ef.acontecimiento&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre de la Quincea\xf1era"}),(0,t.jsx)("input",{type:"text",value:ef.quinceaneraFocusNombre,onChange:e=>ey(r=>({...r,quinceaneraFocusNombre:e.target.value})),placeholder:"Nombre completo de la quincea\xf1era",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),"boda"===ef.acontecimiento&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombres de los Novios"}),(0,t.jsx)("input",{type:"text",value:ef.noviosNombres,onChange:e=>ey(r=>({...r,noviosNombres:e.target.value})),placeholder:"Ej: Juan P\xe9rez y Mar\xeda Gonz\xe1lez",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),"cumpleanos"===ef.acontecimiento&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre del/la Cumplea\xf1er@"}),(0,t.jsx)("input",{type:"text",value:ef.cumpleaneroNombre,onChange:e=>ey(r=>({...r,cumpleaneroNombre:e.target.value})),placeholder:"Nombre del/la cumplea\xf1er@",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),"otros"===ef.acontecimiento&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,t.jsx)("input",{type:"text",value:ef.otrosDescripcion,onChange:e=>ey(r=>({...r,otrosDescripcion:e.target.value})),placeholder:"Descripci\xf3n del evento",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre de la Persona (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ef.otrosNombrePersona,onChange:e=>ey(r=>({...r,otrosNombrePersona:e.target.value})),placeholder:"Nombre de la persona relacionada",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDCDD Informaci\xf3n Adicional"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad de Personas (Aproximada)"}),(0,t.jsx)("input",{type:"number",min:"1",value:ef.cantidadPersonas,onChange:e=>ey(r=>({...r,cantidadPersonas:e.target.value})),placeholder:"Ej: 50",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"requiereApa",checked:!1!==ef.requiereApa,onChange:e=>ey(r=>({...r,requiereApa:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsx)("label",{htmlFor:"requiereApa",className:"text-xs font-medium text-gray-700 select-none",children:"Requiere APA?"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observaciones Generales"}),(0,t.jsx)("textarea",{rows:1,value:ef.observacionesGenerales,onChange:e=>ey(r=>({...r,observacionesGenerales:e.target.value})),placeholder:"Detalles adicionales, requerimientos especiales, contactos importantes, etc.",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-4 pt-3 border-t border-gray-200",children:[(0,t.jsx)("button",{onClick:r$,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"\uD83D\uDCBE Guardar reserva"}),(0,t.jsx)("button",{onClick:rQ,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})})}),eN&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:e=>e.target===e.currentTarget&&ej(!1),children:(0,t.jsx)("div",{className:"w-full max-w-[52.8rem] max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDCC5 Reserva M\xfaltiple de Espacios"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Configure una reserva \xfanica para ",eC.length," espacios simult\xe1neamente"]})]}),(0,t.jsx)("button",{onClick:()=>ej(!1),className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDC64 Datos del Socio"}),(0,t.jsxs)("div",{className:"grid grid-cols-[3fr_1fr_1.5fr_2fr_2fr_1.2fr] gap-3 items-end",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre y Apellido"}),(0,t.jsx)("input",{type:"text",value:ei?"".concat(ei.nombres," ").concat(ei.apellidos):"",disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"N\xb0 de Socio"}),(0,t.jsx)("input",{type:"text",value:(null==ei?void 0:ei.codigo)||"",disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600 text-center"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula"}),(0,t.jsx)("input",{type:"text",value:ew.cedula||(null==ei?void 0:ei.ci)||"",onChange:e=>eE(r=>({...r,cedula:e.target.value})),placeholder:"Ingrese c\xe9dula",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nro de Tel\xe9fono"}),(0,t.jsx)("input",{type:"text",value:ew.telefono||(null==ei?void 0:ei.telefono)||"",onChange:e=>eE(r=>({...r,telefono:e.target.value})),placeholder:"Ingrese tel\xe9fono",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ew.ruc,onChange:e=>eE(r=>({...r,ruc:e.target.value})),placeholder:"Ingrese RUC",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estado"}),(0,t.jsx)("div",{className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded text-center font-medium ".concat((null!==(H=null===(F=rL[(null==ei?void 0:ei.id)||""])||void 0===F?void 0:F.estadoCalc)&&void 0!==H?H:null==ei?void 0:ei.estado)==="AL_DIA"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"),children:(null!==(R=null===(O=rL[(null==ei?void 0:ei.id)||""])||void 0===O?void 0:O.estadoCalc)&&void 0!==R?R:null==ei?void 0:ei.estado)==="AL_DIA"?"Al d\xeda":"Atrasado"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"esParaTerceroMulti",checked:ew.esParaTercero,onChange:e=>eE(r=>({...r,esParaTercero:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsx)("label",{htmlFor:"esParaTerceroMulti",className:"text-xs font-medium text-gray-700 select-none",children:"\uD83E\uDD1D Reserva a favor de un tercero"})]}),ew.esParaTercero&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre Completo *"}),(0,t.jsx)("input",{type:"text",value:ew.terceroNombre,onChange:e=>eE(r=>({...r,terceroNombre:e.target.value})),placeholder:"Nombre completo del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula"}),(0,t.jsx)("input",{type:"text",value:ew.terceroCedula,onChange:e=>eE(r=>({...r,terceroCedula:e.target.value})),placeholder:"C\xe9dula del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),(0,t.jsx)("input",{type:"text",value:ew.terceroTelefono,onChange:e=>eE(r=>({...r,terceroTelefono:e.target.value})),placeholder:"Tel\xe9fono del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),(0,t.jsx)("input",{type:"text",value:ew.terceroRuc,onChange:e=>eE(r=>({...r,terceroRuc:e.target.value})),placeholder:"RUC del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83C\uDFE2 Servicios y Espacios"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-xs text-gray-600 mb-2",children:[eC.length," concepto(s) seleccionado(s) para reserva:"]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded overflow-hidden",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 bg-gray-100 border-b border-gray-200",children:[(0,t.jsx)("div",{className:"px-2 py-1 text-xs font-semibold text-gray-700 border-r border-gray-200",children:"Servicio"}),(0,t.jsx)("div",{className:"px-2 py-1 text-xs font-semibold text-gray-700",children:"Espacio"})]}),(0,t.jsx)("div",{className:"max-h-16 overflow-y-auto",children:eC.map(e=>{let r=eH().find(r=>r.id===e),o=q.find(e=>e.id===(null==r?void 0:r.servicioId)),a=null;return(null==r?void 0:r.reservaVenueId)&&!(a=eg.find(e=>e.id===r.reservaVenueId))&&o&&(o.espaciosDisponibles&&o.espaciosDisponibles.length>0?a=o.espaciosDisponibles.find(e=>e.id===r.reservaVenueId):o.espacios&&o.espacios.length>0&&(a=o.espacios.map((e,r)=>({id:"espacio-".concat(o.id,"-").concat(r),nombre:e,descripcion:"",activo:!0})).find(e=>e.id===r.reservaVenueId))),(0,t.jsxs)("div",{className:"grid grid-cols-2 border-b border-gray-100 last:border-b-0 hover:bg-blue-25",children:[(0,t.jsxs)("div",{className:"px-2 py-1 text-xs text-gray-700 border-r border-gray-100 flex items-center",children:[(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full flex-shrink-0 mr-1"}),(0,t.jsx)("span",{className:"font-medium truncate",children:(null==o?void 0:o.nombre)||"Servicio no encontrado"})]}),(0,t.jsx)("div",{className:"px-2 py-1 text-xs text-gray-700 flex items-center",children:a?(0,t.jsxs)("span",{className:"truncate font-medium",children:[a.nombre,a.capacidad?" (".concat(a.capacidad," pers.)"):""]}):(null==r?void 0:r.reservaVenueId)?(0,t.jsx)("span",{className:"truncate",children:(null==o?void 0:o.nombre)||"Servicio no encontrado"}):(0,t.jsx)("span",{className:"truncate",children:(null==o?void 0:o.nombre)||"Sin espacio asignado"})})]},e)})})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[(0,t.jsx)("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDCDD Informaci\xf3n Adicional"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad de Personas"}),(0,t.jsx)("input",{type:"number",min:"1",value:ew.cantidadPersonas,onChange:e=>eE(r=>({...r,cantidadPersonas:e.target.value})),placeholder:"Ej: 50",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-gray-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Requiere APA"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)("input",{type:"checkbox",id:"requiereApaMulti",checked:!1!==ew.requiereApa,onChange:e=>eE(r=>({...r,requiereApa:e.target.checked})),className:"w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsx)("label",{htmlFor:"requiereApaMulti",className:"text-xs font-medium text-gray-700 select-none",children:"S\xed"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observaciones"}),(0,t.jsx)("textarea",{rows:2,value:ew.observacionesGenerales,onChange:e=>eE(r=>({...r,observacionesGenerales:e.target.value})),placeholder:"Detalles adicionales...",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-gray-500 resize-none"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1 mb-3",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"⚙️ Configuraci\xf3n Avanzada"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("input",{type:"checkbox",id:"configuracionIndividualCheck",checked:ew.configuracionIndividual,onChange:e=>{let r=e.target.checked;if(!r&&ew.horaExtra){let e=0,o=0;if(eC.forEach(r=>{let t=eH().find(e=>e.id===r),a=q.find(e=>e.id===(null==t?void 0:t.servicioId));(null==a?void 0:a.permiteHorasExtras)&&(null==a?void 0:a.precioHoraExtra)&&(e+=a.precioHoraExtra,o++)}),o>0){let t=parseFloat(ew.cantidadHorasExtra)||1,a=t*e,n=op(a.toString());console.log("\uD83D\uDCB0 Auto-calculando monto global:",{horas:t,servicios:o,montoPorHora:e,montoTotal:a,montoFormateado:n}),eE(e=>({...e,configuracionIndividual:r,cantidadHorasExtra:t.toString(),montoHorasExtra:n}));return}}eE(e=>({...e,configuracionIndividual:r}))},className:"w-3 h-3 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),(0,t.jsx)("label",{htmlFor:"configuracionIndividualCheck",className:"text-xs font-medium text-gray-700 select-none",children:"Configuraci\xf3n individual por servicio"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"Permite configurar horarios y horas extra espec\xedficos para cada servicio seleccionado."})]})]}),ew.configuracionIndividual&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83D\uDD27 Configuraci\xf3n Individual por Servicio"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"Configure horarios y horas extra espec\xedficos para cada servicio:"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[(0,t.jsx)("th",{className:"border border-gray-200 px-3 py-2 text-left font-medium text-gray-700",children:"Servicio"}),(0,t.jsx)("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Inicio"}),(0,t.jsx)("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Fin"}),(0,t.jsx)("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Extra"}),(0,t.jsx)("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Cantidad"}),(0,t.jsx)("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Monto (Gs.)"})]})}),(0,t.jsx)("tbody",{children:eC.map(e=>{let r=eH().find(r=>r.id===e),o=q.find(e=>e.id===(null==r?void 0:r.servicioId)),a=ew.configuracionesIndividuales[e]||{inicioHora:ew.inicioHora||"19:00",finHora:ew.finHora||"03:00",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""};return(0,t.jsxs)("tr",{className:"hover:bg-gray-25",children:[(0,t.jsx)("td",{className:"border border-gray-200 px-3 py-2 font-medium text-gray-800",children:null==o?void 0:o.nombre}),(0,t.jsx)("td",{className:"border border-gray-200 px-3 py-2 text-center",children:(0,t.jsx)("input",{type:"time",value:a.inicioHora,onChange:r=>{eE(o=>({...o,configuracionesIndividuales:{...o.configuracionesIndividuales,[e]:{...a,inicioHora:r.target.value}}}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded text-center"})}),(0,t.jsx)("td",{className:"border border-gray-200 px-3 py-2 text-center",children:(0,t.jsx)("input",{type:"time",value:a.finHora,onChange:r=>{eE(o=>({...o,configuracionesIndividuales:{...o.configuracionesIndividuales,[e]:{...a,finHora:r.target.value}}}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded text-center"})}),(0,t.jsx)("td",{className:"border border-gray-200 px-3 py-2 text-center",children:(null==o?void 0:o.permiteHorasExtras)&&(null==o?void 0:o.precioHoraExtra)?(0,t.jsx)("input",{type:"checkbox",checked:a.horaExtra,onChange:r=>{eE(t=>({...t,configuracionesIndividuales:{...t.configuracionesIndividuales,[e]:{...a,horaExtra:r.target.checked,cantidadHorasExtra:r.target.checked?"1":"",montoHorasExtra:r.target.checked?op(((null==o?void 0:o.precioHoraExtra)||0).toString()):""}}}))},className:"w-4 h-4 border-gray-300 rounded focus:ring-orange-500 text-orange-600"}):(0,t.jsx)("div",{className:"flex items-center justify-center cursor-help",title:"".concat((null==o?void 0:o.nombre)||"Servicio"," no permite hora extra o no tiene precio configurado"),children:(0,t.jsx)("span",{className:"text-red-500 text-xs",children:"❌"})})}),(0,t.jsx)("td",{className:"border border-gray-200 px-3 py-2 text-center",children:a.horaExtra&&(null==o?void 0:o.permiteHorasExtras)&&(null==o?void 0:o.precioHoraExtra)?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,t.jsx)("input",{type:"number",min:"1",step:"0.5",value:a.cantidadHorasExtra,onChange:r=>{let t=(parseFloat(r.target.value)||0)*((null==o?void 0:o.precioHoraExtra)||5e4),n=t>0?op(t.toString()):"";eE(o=>({...o,configuracionesIndividuales:{...o.configuracionesIndividuales,[e]:{...a,cantidadHorasExtra:r.target.value,montoHorasExtra:n}}}))},placeholder:"1",className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded text-center"}),(0,t.jsx)("span",{className:"text-gray-500 text-xs",children:"hrs"})]}):(0,t.jsx)("span",{className:"text-gray-400",children:"—"})}),(0,t.jsx)("td",{className:"border border-gray-200 px-3 py-2 text-center",children:a.horaExtra&&(null==o?void 0:o.permiteHorasExtras)&&(null==o?void 0:o.precioHoraExtra)?(0,t.jsx)("input",{type:"text",value:a.montoHorasExtra,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600 text-center",placeholder:"Auto"}):(null==o?void 0:o.permiteHorasExtras)&&(null==o?void 0:o.precioHoraExtra)?(0,t.jsx)("span",{className:"text-gray-400",children:"—"}):(0,t.jsx)("span",{className:"text-red-400 text-xs",children:"Sin config."})})]},e)})})]})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[!ew.configuracionIndividual&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"⏰ Horas Extra"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"horaExtraMulti",checked:ew.horaExtra,onChange:e=>{if(e.target.checked){let e=0,r=0;if(eC.forEach(o=>{let t=eH().find(e=>e.id===o),a=q.find(e=>e.id===(null==t?void 0:t.servicioId));(null==a?void 0:a.permiteHorasExtras)&&(null==a?void 0:a.precioHoraExtra)&&(e+=a.precioHoraExtra,r++)}),0===r){alert("❌ Ninguno de los servicios seleccionados permite horas extra o no tienen precio configurado.\n\nDebe configurar los precios de hora extra en la p\xe1gina de Editar Servicios primero.");return}let o=op(e.toString());eE(e=>({...e,horaExtra:!0,cantidadHorasExtra:"1",montoHorasExtra:o}))}else eE(e=>({...e,horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""}))},className:"w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500"}),(0,t.jsx)("label",{htmlFor:"horaExtraMulti",className:"text-xs font-medium text-gray-700",children:"\xbfHora extra? (despu\xe9s de las 03:00)"})]}),(0,t.jsx)("div",{className:"text-xs text-gray-600 pl-6",children:(()=>{let e=[],r=[];return eC.forEach(o=>{let t=eH().find(e=>e.id===o),a=q.find(e=>e.id===(null==t?void 0:t.servicioId));(null==a?void 0:a.permiteHorasExtras)&&(null==a?void 0:a.precioHoraExtra)?e.push("".concat(a.nombre," (").concat(op(a.precioHoraExtra.toString())," Gs/h)")):r.push((null==a?void 0:a.nombre)||"Desconocido")}),(0,t.jsxs)("div",{className:"space-y-1",children:[e.length>0&&(0,t.jsxs)("div",{children:["✅ ",(0,t.jsx)("strong",{children:"Con hora extra:"})," ",e.join(", ")]}),r.length>0&&(0,t.jsxs)("div",{className:"text-red-600",children:["❌ ",(0,t.jsx)("strong",{children:"Sin configurar:"})," ",r.join(", ")]})]})})()}),(0,t.jsx)("div",{className:"flex items-center gap-2"}),ew.horaExtra&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 pl-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad (horas)"}),(0,t.jsx)("input",{type:"number",min:"1",step:"0.5",value:ew.cantidadHorasExtra,onChange:e=>{let r=parseFloat(e.target.value)||0,o=0;eC.forEach(e=>{let r=eH().find(r=>r.id===e),t=q.find(e=>e.id===(null==r?void 0:r.servicioId));(null==t?void 0:t.permiteHorasExtras)&&(null==t?void 0:t.precioHoraExtra)&&(o+=t.precioHoraExtra)});let t=r*o,a=t>0?op(t.toString()):"";eE(r=>({...r,cantidadHorasExtra:e.target.value,montoHorasExtra:a}))},placeholder:"Ej: 2",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-yellow-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Monto (Gs.)"}),(0,t.jsx)("input",{type:"text",value:ew.montoHorasExtra,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600",placeholder:"Calculado autom\xe1ticamente"})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83C\uDF89 Datos del Evento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fecha"}),(0,t.jsx)("input",{type:"date",value:ew.fecha,onChange:e=>eE(r=>({...r,fecha:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]}),!ew.configuracionIndividual&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Inicio"}),(0,t.jsx)("input",{type:"time",value:ew.inicioHora,onChange:e=>eE(r=>({...r,inicioHora:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fin"}),(0,t.jsx)("input",{type:"time",value:ew.finHora,onChange:e=>eE(r=>({...r,finHora:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83C\uDF8A Acontecimiento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),(0,t.jsxs)("select",{value:ew.acontecimiento,onChange:e=>eE(r=>({...r,acontecimiento:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500",children:[(0,t.jsx)("option",{value:"",children:"— Seleccionar —"}),(0,t.jsx)("option",{value:"15_anos",children:"\uD83C\uDF82 15 a\xf1os"}),(0,t.jsx)("option",{value:"boda",children:"\uD83D\uDC92 Boda"}),(0,t.jsx)("option",{value:"cumpleanos",children:"\uD83C\uDF89 Cumple"}),(0,t.jsx)("option",{value:"otros",children:"\uD83C\uDFAA Otros"})]})]}),"15_anos"===ew.acontecimiento&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quincea\xf1era"}),(0,t.jsx)("input",{type:"text",value:ew.quinceaneraFocusNombre,onChange:e=>eE(r=>({...r,quinceaneraFocusNombre:e.target.value})),placeholder:"Nombre completo",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),"boda"===ew.acontecimiento&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Novios"}),(0,t.jsx)("input",{type:"text",value:ew.noviosNombres,onChange:e=>eE(r=>({...r,noviosNombres:e.target.value})),placeholder:"Juan y Mar\xeda",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),"cumpleanos"===ew.acontecimiento&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cumplea\xf1er@"}),(0,t.jsx)("input",{type:"text",value:ew.cumpleaneroNombre,onChange:e=>eE(r=>({...r,cumpleaneroNombre:e.target.value})),placeholder:"Nombre",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),"otros"===ew.acontecimiento&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),(0,t.jsx)("input",{type:"text",value:ew.otrosDescripcion,onChange:e=>eE(r=>({...r,otrosDescripcion:e.target.value})),placeholder:"Tipo de evento",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Persona"}),(0,t.jsx)("input",{type:"text",value:ew.otrosNombrePersona,onChange:e=>eE(r=>({...r,otrosNombrePersona:e.target.value})),placeholder:"Nombre (opcional)",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]})]})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-6 pt-4 border-t border-gray-200",children:[(0,t.jsx)("button",{onClick:()=>{let e=os();if(e.length>0){alert("❌ Errores de validaci\xf3n:\n\n"+e.join("\n"));return}let r=eg.find(e=>e.id===ew.venueId),o=(null==r?void 0:r.nombre)||"Espacio no encontrado",t=0,a=0;eS(e=>{let r={...e};return eC.forEach(o=>{var t,a;let n=null===(t=e.conceptos)||void 0===t?void 0:t.find(e=>e.id===o),{fechaInicio:s,fechaFin:i}=(()=>{let e=ew.fecha,r=ew.inicioHora,o=ew.finHora,[t,a]=r.split(":").map(Number),[n,s]=o.split(":").map(Number),i=e;if(60*n+s<60*t+a){let r=new Date(e+"T00:00:00");r.setDate(r.getDate()+1),i=r.toISOString().split("T")[0]}return{fechaInicio:e,fechaFin:i}})(),c=ew.venueId;if(n){let e=q.find(e=>e.id===n.servicioId);e&&((e.espaciosDisponibles&&e.espaciosDisponibles.length>0?e.espaciosDisponibles.some(e=>e.id===ew.venueId):e.espacios&&e.espacios.length>0?e.espacios.some((r,o)=>"".concat(e.id,"-espacio-").concat(o)===ew.venueId):eg.some(e=>e.id===ew.venueId))||(console.warn("⚠️ Servicio ".concat(e.nombre," no tiene disponible el venue ").concat(ew.venueId)),c=""))}let l={reservaVenueId:c,reservaFecha:s,reservaHoraInicio:ew.inicioHora,reservaHoraFin:ew.finHora,reservaFechaInicio:s,reservaFechaFin:i,reservaObservaciones:ew.observaciones,requiereApa:ew.requiereApa,reservaCedula:ew.cedula,reservaTelefono:ew.telefono,reservaRuc:ew.ruc,reservaEsParaTercero:ew.esParaTercero,reservaTerceroNombre:ew.terceroNombre,reservaTerceroCedula:ew.terceroCedula,reservaTerceroTelefono:ew.terceroTelefono,reservaTerceroRuc:ew.terceroRuc,reservaAcontecimiento:ew.acontecimiento,reservaQuinceaneraFocusNombre:ew.quinceaneraFocusNombre,reservaNoviosNombres:ew.noviosNombres,reservaCumpleaneroNombre:ew.cumpleaneroNombre,reservaOtrosDescripcion:ew.otrosDescripcion,reservaOtrosNombrePersona:ew.otrosNombrePersona,reservaCantidadPersonas:ew.cantidadPersonas,reservaObservacionesGenerales:ew.observacionesGenerales,reservaHoraExtra:ew.horaExtra,reservaCantidadHorasExtra:ew.cantidadHorasExtra,reservaMontoHorasExtra:ew.montoHorasExtra,reservaConfiguracionIndividual:ew.configuracionIndividual},d=ew.configuracionesIndividuales[o];if(d){if(d.inicioHora&&(l.reservaHoraInicio=d.inicioHora),d.finHora){l.reservaHoraFin=d.finHora;let e=d.inicioHora||ew.inicioHora,r=d.finHora,[o,t]=e.split(":").map(Number),[a,n]=r.split(":").map(Number);if(60*a+n<60*o+t){let e=new Date(s+"T00:00:00");e.setDate(e.getDate()+1);let r=e.toISOString().split("T")[0];l.reservaFechaFin=r}else l.reservaFechaFin=i}l.reservaHoraExtra=d.horaExtra||l.reservaHoraExtra,l.reservaCantidadHorasExtra=d.cantidadHorasExtra||l.reservaCantidadHorasExtra,l.reservaMontoHorasExtra=d.montoHorasExtra||l.reservaMontoHorasExtra}n&&(console.log("\uD83D\uDCBE Guardando reserva m\xfaltiple para concepto ".concat(n.condicion," ").concat(o,":"),l),r.conceptos=null===(a=r.conceptos)||void 0===a?void 0:a.map(e=>e.id===o?{...e,...l}:e))}),r}),ot(eH().filter(e=>eC.includes(e.id)));let n=ew.configuracionIndividual,s=eH().filter(e=>e.concepto.toLowerCase().includes("hora extra")),i=!1;if(s.length>0&&(i=s.filter(e=>e.relatedConceptoId&&eC.includes(e.relatedConceptoId)).length>0),console.log("⚡ Analizando transici\xf3n de horas extra:",{configPreviaIndividual:i,configActualIndividual:n,conceptosHoraExtraExistentes:s.length,cambioDeConfiguracion:i!==n}),(i!==n&&s.length>0||s.length>0&&(n||!n&&ew.horaExtra))&&(console.log("\uD83D\uDD04 Limpiando TODOS los conceptos de horas extra anteriores..."),eS(e=>{let r=e.conceptos.length,o=e.conceptos.filter(e=>{let r=e.concepto.toLowerCase().includes("hora extra");return r&&console.log("\uD83D\uDDD1️ Eliminando hora extra ".concat(e.condicion,": ").concat(e.concepto)),!r});return console.log("\uD83D\uDCCA Conceptos: ".concat(r," → ").concat(o.length)),{...e,conceptos:o}})),console.log("\uD83D\uDD50 Creando conceptos de hora extra:",{configuracionIndividual:ew.configuracionIndividual,horaExtraGlobal:ew.horaExtra,selectedConceptsCount:eC.length}),ew.configuracionIndividual)console.log("\uD83D\uDC65 MODO INDIVIDUAL: Creando conceptos individuales por servicio"),eC.forEach(e=>{let r=ew.configuracionesIndividuales[e];if(r&&r.horaExtra&&r.cantidadHorasExtra&&r.montoHorasExtra)try{let n=parseFloat(r.cantidadHorasExtra),s=parseFloat(C(r.montoHorasExtra));if(n>0&&s>0){let r=eH().find(r=>r.id===e),i=q.find(e=>e.id===(null==r?void 0:r.servicioId)),c=new Date(ew.fecha+"T12:00:00").toLocaleDateString("es-PY"),l="Hora extra para ".concat((null==i?void 0:i.nombre)||"Servicio"," - ").concat(o," - ").concat(c);console.log("➕ Creando concepto INDIVIDUAL para ".concat(null==i?void 0:i.nombre,": ").concat(n,"h x ").concat(s));let d=eF(n,s,l,e);null!==d&&(t++,a+=s,console.log("✅ Concepto INDIVIDUAL creado: ID ".concat(d)))}}catch(r){console.error("Error creating hora extra concepto for",e,r)}});else if(ew.horaExtra&&ew.cantidadHorasExtra&&ew.montoHorasExtra){console.log("\uD83C\uDF0D MODO GLOBAL: Creando UN concepto global para todas las reservas");try{let e=parseFloat(ew.cantidadHorasExtra),r=parseFloat(C(ew.montoHorasExtra));if(e>0&&r>0){let n=new Date(ew.fecha+"T12:00:00").toLocaleDateString("es-PY"),s="Hora extra global - ".concat(o," - ").concat(n);console.log("➕ Creando concepto GLOBAL: ".concat(e,"h x ").concat(r));let i=eF(e,r,s);null!==i&&(t++,console.log("✅ Concepto GLOBAL creado: ID ".concat(i)),a+=r)}}catch(e){console.error("Error creating global hora extra concepto:",e)}}ej(!1);let c="";eC.forEach(e=>{var r;let o=eH().find(r=>r.id===e),t=q.find(e=>e.id===(null==o?void 0:o.servicioId)),a=null;(null==o?void 0:o.reservaVenueId)&&((null==t?void 0:t.espaciosDisponibles)&&(a=t.espaciosDisponibles.find(e=>e.id===o.reservaVenueId)),a||(a=eg.find(e=>e.id===o.reservaVenueId))),!a&&(null==t?void 0:null===(r=t.espaciosDisponibles)||void 0===r?void 0:r.length)>0&&(a=t.espaciosDisponibles[0]);let n=(null==a?void 0:a.nombre)||"Espacio por asignar";c+="\uD83D\uDCCD ".concat((null==t?void 0:t.nombre)||"Servicio",": ").concat(n,"\n")});let l=new Date(ew.fecha+"T12:00:00").toLocaleDateString("es-PY"),d="✅ Reserva m\xfaltiple configurada exitosamente!\n\n".concat(c,"\uD83D\uDCC5 ").concat(l,"\n\uD83D\uDD50 ").concat(ew.inicioHora," - ").concat(ew.finHora,"\n\uD83C\uDFAF ").concat(eC.length," espacios configurados");t>0&&(d+="\n\n\uD83D\uDD50 \xa1".concat(t," concepto(s) de Hora Extra agregados autom\xe1ticamente!\n\uD83D\uDCB0 Monto total horas extra: ").concat(op(a.toString())," Gs.")),alert(d)},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"\uD83D\uDCBE Guardar reserva"}),(0,t.jsx)("button",{onClick:()=>ej(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})})})]})}},45365:function(e,r,o){"use strict";o.d(r,{D2:function(){return t},LJ:function(){return n},_4:function(){return s},tF:function(){return a}});let t={name:"America/Asuncion",offsetHours:-3,description:"Paraguay (UTC-3)"};function a(){let e=new Date,r=Object.fromEntries(new Intl.DateTimeFormat("en-CA",{timeZone:t.name,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).map(e=>[e.type,e.value]));return new Date(parseInt(r.year),parseInt(r.month)-1,parseInt(r.day),parseInt(r.hour),parseInt(r.minute),parseInt(r.second))}function n(e){if(e){let r=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return"".concat(r,"-").concat(o,"-").concat(t)}{let e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:t.name,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}function s(e){let r,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[o,t,a]=e.split("-").map(Number);r=new Date(o,t-1,a)}else r=new Date(e)}else r=e;if(o)return r.toLocaleString("es-PY",{timeZone:t.name,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});if(!("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)))return r.toLocaleDateString("es-PY",{timeZone:t.name,day:"2-digit",month:"2-digit",year:"numeric"});{let[r,o,t]=e.split("-");return"".concat(t.padStart(2,"0"),"/").concat(o.padStart(2,"0"),"/").concat(r)}}},94508:function(e,r,o){"use strict";o.d(r,{Fw:function(){return s},Ji:function(){return i},m9:function(){return c},p6:function(){return n},sQ:function(){return d},sU:function(){return l},xG:function(){return a}});var t=o(45365);function a(e){return new Intl.NumberFormat("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}).format(e)}function n(e){return(0,t._4)(e,!1)}function s(e){let r=(0,t.tF)(),o=new Date(new Date(e).getTime()+108e5),a=r.getUTCFullYear()-o.getUTCFullYear(),n=r.getUTCMonth()-o.getUTCMonth();return(n<0||0===n&&r.getUTCDate()<o.getUTCDate())&&a--,a}function i(){return(0,t.LJ)()}function c(e){let r=e.replace(/\D/g,"");return r?r.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function l(e){return parseInt(e.replace(/\./g,""))||0}function d(e){return Math.round(e)}},88226:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},92735:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},17684:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},99397:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},73247:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},18930:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},92369:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},32489:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});let t=(0,o(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[3643,9690,2971,2117,1744],function(){return e(e.s=91616)}),_N_E=e.O()}]);