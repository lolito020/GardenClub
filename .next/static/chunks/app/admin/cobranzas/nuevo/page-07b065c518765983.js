(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1756],{78156:function(e,t,r){Promise.resolve().then(r.bind(r,77790))},77790:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var a=r(57437),n=r(69690),s=r(17985),o=r(2265),i=r(99376),l=r(32660),c=r(73247),d=r(27648),u=r(94508),m=r(45365);function p(){let e=(0,i.useRouter)(),[t,r]=(0,o.useState)(!1),[p,g]=(0,o.useState)(""),[x,h]=(0,o.useState)([]),[b,f]=(0,o.useState)([]),[y,j]=(0,o.useState)([]),[v,N]=(0,o.useState)(""),[w,C]=(0,o.useState)(null),[I,S]=(0,o.useState)(!1),[k,D]=(0,o.useState)([]),[A,F]=(0,o.useState)([]),[P,T]=(0,o.useState)({memberId:"",fecha:(0,m.LJ)(),monto:"",concepto:"",formaPago:"efectivo",cobradorId:"",observaciones:"",numeroRecibo:""});async function L(){try{let[e,t,r]=await Promise.all([s.L.authenticatedFetch("/api/members"),s.L.authenticatedFetch("/api/services"),s.L.authenticatedFetch("/api/collectors")]),[a,n,o]=await Promise.all([e.json(),t.json(),r.json()]);h(Array.isArray(a)?a:[]),f(Array.isArray(n)?n.filter(e=>!1!==e.activo):[]),j(Array.isArray(o)?o.filter(e=>!1!==e.activo):[])}catch(e){console.error("Error loading data:",e)}}async function E(e){try{let t=await s.L.authenticatedFetch("/api/members/".concat(e,"/movements?type=DEBIT")),r=(t.headers.get("content-type")||"").includes("application/json")?await t.json():[],a=(Array.isArray(r)?r:Array.isArray(null==r?void 0:r.items)?r.items:[]).map(e=>({id:e.id,memberId:e.memberId,fecha:e.fecha,concepto:e.concepto,tipo:e.tipo||"DEBIT",monto:Number(e.monto||0),paidAmount:Number(e.paidAmount||0),status:e.status||void 0})).filter(e=>"DEBIT"===e.tipo&&Number(e.paidAmount||0)<Number(e.monto||0));a.sort((e,t)=>new Date(e.fecha).getTime()-new Date(t.fecha).getTime()),D(a),F(a.map(e=>({debitId:e.id,concepto:e.concepto,pendiente:Math.max(0,e.monto-(e.paidAmount||0)),apply:"",selected:!1})))}catch(e){console.error("Error pending debits",e),D([]),F([])}}(0,o.useEffect)(()=>{L()},[]);let Z=e=>{C(e),T(t=>({...t,memberId:e.id})),S(!1),N(""),E(e.id)},M=e=>{T(t=>({...t,concepto:e.nombre,monto:null!=e.precio?String(e.precio):t.monto}))},R=x.filter(e=>e.nombres.toLowerCase().includes(v.toLowerCase())||e.apellidos.toLowerCase().includes(v.toLowerCase())||e.codigo.toLowerCase().includes(v.toLowerCase())||e.ci.includes(v)),q=A.reduce((e,t)=>e+(t.selected?Number(t.apply||0):0),0),G=async t=>{t.preventDefault(),g(""),r(!0);try{let t=A.filter(e=>e.selected&&Number(e.apply||0)>0).map(e=>({debitId:e.debitId,amount:Number(e.apply)})),r={...P,monto:parseFloat(P.monto)};t.length>0&&(r.allocations=t);let a=await s.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify(r)}),n=await a.json();a.ok?e.push("/admin/cobranzas"):g(n.msg||"Error al registrar pago")}catch(e){g("Error de conexi\xf3n")}finally{r(!1)}};return(0,a.jsx)(n.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.default,{href:"/admin/cobranzas",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,a.jsx)(l.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Nuevo Pago"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Registra un nuevo pago o cobranza"})]})]}),p&&(0,a.jsx)("div",{className:"p-4 rounded-lg ".concat(p.includes("Error")?"bg-red-50 text-red-800 border border-red-200":"bg-green-50 text-green-800 border border-green-200"),children:p}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsxs)("form",{onSubmit:G,className:"p-6 space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n del Socio"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Socio *"}),w?(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-300 rounded-lg bg-gray-50",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:[w.nombres," ",w.apellidos]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[w.codigo," • CI: ",w.ci]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{C(null),T(e=>({...e,memberId:""})),D([]),F([])},className:"text-red-600 hover:text-red-800 text-sm",children:"Cambiar"})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar socio por nombre, c\xf3digo o CI...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:v,onChange:e=>{N(e.target.value),S(e.target.value.length>0)},onFocus:()=>S(v.length>0)})]}),I&&R.length>0&&(0,a.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:R.slice(0,10).map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>Z(e),className:"w-full text-left p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:[(0,a.jsxs)("div",{className:"font-medium",children:[e.nombres," ",e.apellidos]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.codigo," • CI: ",e.ci]})]},e.id))})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n del Pago"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha *"}),(0,a.jsx)("input",{type:"date",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.fecha,onChange:e=>T(t=>({...t,fecha:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pago *"}),(0,a.jsxs)("select",{required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.formaPago,onChange:e=>T(t=>({...t,formaPago:e.target.value})),children:[(0,a.jsx)("option",{value:"efectivo",children:"Efectivo"}),(0,a.jsx)("option",{value:"transferencia",children:"Transferencia"}),(0,a.jsx)("option",{value:"tarjeta",children:"Tarjeta"}),(0,a.jsx)("option",{value:"cheque",children:"Cheque"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Concepto *"}),(0,a.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.concepto,onChange:e=>T(t=>({...t,concepto:e.target.value})),placeholder:"Cuota social, Tenis, Nataci\xf3n, etc."}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Servicios r\xe1pidos:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:b.slice(0,4).map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>M(e),className:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded",children:e.nombre},e.id))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto (Gs.) *"}),(0,a.jsx)("input",{type:"number",required:!0,min:"0",step:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.monto,onChange:e=>T(t=>({...t,monto:e.target.value})),placeholder:"150000"}),P.monto&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(0,u.xG)(parseFloat(P.monto)||0)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cobrador"}),(0,a.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.cobradorId,onChange:e=>T(t=>({...t,cobradorId:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"Caja Interna"}),y.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.nombres," ",e.apellidos," (",e.codigo,")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero de Recibo"}),(0,a.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.numeroRecibo,onChange:e=>T(t=>({...t,numeroRecibo:e.target.value})),placeholder:"REC-001"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),(0,a.jsx)("textarea",{rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P.observaciones,onChange:e=>T(t=>({...t,observaciones:e.target.value})),placeholder:"Notas adicionales sobre el pago..."})]})]})]}),w&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Asignar a d\xe9bitos del socio"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Aplicado:"}),(0,a.jsx)("span",{className:"font-semibold",children:(0,u.xG)(q)}),(0,a.jsx)("span",{className:"text-gray-400",children:"/"}),(0,a.jsx)("span",{className:"font-semibold",children:(0,u.xG)(Number(P.monto||0))}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=Number(P.monto||0);if(!(e>0))return;let t=e;F(A.map(e=>{if(!e.selected)return{...e,apply:""};let r=Math.min(t,e.pendiente),a=r>0?r:0;return t=Math.max(0,t-a),{...e,apply:a?String(a):""}}))},className:"ml-3 px-3 py-1.5 border rounded hover:bg-gray-50",children:"Autodistribuir"})]})]}),0===A.length?(0,a.jsx)("div",{className:"p-3 rounded border text-sm text-gray-600 bg-gray-50",children:"Este socio no tiene d\xe9bitos pendientes."}):(0,a.jsx)("div",{className:"overflow-x-auto border rounded-lg",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left",children:"Sel."}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Concepto"}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Fecha"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"Pendiente"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"Aplicar"})]})}),(0,a.jsx)("tbody",{children:A.map((e,t)=>{let r=k.find(t=>t.id===e.debitId);return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{type:"checkbox",checked:e.selected,onChange:r=>{let a=[...A];a[t]={...e,selected:r.target.checked},F(a)}})}),(0,a.jsx)("td",{className:"p-2",children:e.concepto}),(0,a.jsx)("td",{className:"p-2",children:r?new Date(r.fecha).toLocaleDateString():"-"}),(0,a.jsx)("td",{className:"p-2 text-right",children:(0,u.xG)(e.pendiente)}),(0,a.jsx)("td",{className:"p-2 text-right",children:(0,a.jsx)("input",{type:"number",min:0,step:"1000",value:e.apply,onChange:r=>{let a=r.target.value,n=[...A];n[t]={...e,apply:a},F(n)},className:"w-32 px-2 py-1 border rounded text-right",placeholder:"0",disabled:!e.selected})})]},e.debitId)})})]})}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Pod\xe9s aplicar el pago a uno o varios d\xe9bitos. Si dej\xe1s este bloque vac\xedo, el pago se registra sin asignaci\xf3n (podr\xe1s asignarlo luego desde editar pago)."})]}),P.monto&&P.cobradorId&&(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Resumen del Pago"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Monto:"}),(0,a.jsx)("span",{className:"font-medium",children:(0,u.xG)(parseFloat(P.monto))})]}),(()=>{let e=b.find(e=>e.nombre===P.concepto),t=(null==e?void 0:e.comisionCobrador)?parseFloat(P.monto)*e.comisionCobrador/100:0;return t>0?(0,a.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,a.jsxs)("span",{children:["Comisi\xf3n Cobrador (",null==e?void 0:e.comisionCobrador,"%):"]}),(0,a.jsx)("span",{className:"font-medium",children:(0,u.xG)(t)})]}):null})()]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[(0,a.jsx)(d.default,{href:"/admin/cobranzas",className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:t||!w,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 disabled:opacity-50",children:t?"Registrando...":"Registrar Pago"})]})]})})]})})}},45365:function(e,t,r){"use strict";r.d(t,{D2:function(){return a},LJ:function(){return s},_4:function(){return o},tF:function(){return n}});let a={name:"America/Asuncion",offsetHours:-3,description:"Paraguay (UTC-3)"};function n(){let e=new Date,t=Object.fromEntries(new Intl.DateTimeFormat("en-CA",{timeZone:a.name,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).map(e=>[e.type,e.value]));return new Date(parseInt(t.year),parseInt(t.month)-1,parseInt(t.day),parseInt(t.hour),parseInt(t.minute),parseInt(t.second))}function s(e){if(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(a)}{let e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:a.name,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}function o(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[r,a,n]=e.split("-").map(Number);t=new Date(r,a-1,n)}else t=new Date(e)}else t=e;if(r)return t.toLocaleString("es-PY",{timeZone:a.name,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});if(!("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)))return t.toLocaleDateString("es-PY",{timeZone:a.name,day:"2-digit",month:"2-digit",year:"numeric"});{let[t,r,a]=e.split("-");return"".concat(a.padStart(2,"0"),"/").concat(r.padStart(2,"0"),"/").concat(t)}}},94508:function(e,t,r){"use strict";r.d(t,{Fw:function(){return o},Ji:function(){return i},m9:function(){return l},p6:function(){return s},sQ:function(){return d},sU:function(){return c},xG:function(){return n}});var a=r(45365);function n(e){return new Intl.NumberFormat("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}).format(e)}function s(e){return(0,a._4)(e,!1)}function o(e){let t=(0,a.tF)(),r=new Date(new Date(e).getTime()+108e5),n=t.getUTCFullYear()-r.getUTCFullYear(),s=t.getUTCMonth()-r.getUTCMonth();return(s<0||0===s&&t.getUTCDate()<r.getUTCDate())&&n--,n}function i(){return(0,a.LJ)()}function l(e){let t=e.replace(/\D/g,"");return t?t.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function c(e){return parseInt(e.replace(/\./g,""))||0}function d(e){return Math.round(e)}},32660:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},73247:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(39763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},function(e){e.O(0,[3643,9690,2971,2117,1744],function(){return e(e.s=78156)}),_N_E=e.O()}]);