(()=>{var e={};e.id=6740,e.ids=[6740],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},85807:e=>{"use strict";e.exports=require("module")},61325:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>l}),a(53925),a(11506),a(35866);var t=a(23191),o=a(88716),s=a(37922),i=a.n(s),n=a(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);a.d(r,c);let l=["",{children:["admin",{children:["socios",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,53925)),"C:\\Garden\\app\\admin\\socios\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,11506)),"C:\\Garden\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Garden\\app\\admin\\socios\\page.tsx"],x="/admin/socios/page",m={require:a,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/admin/socios/page",pathname:"/admin/socios",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},70017:(e,r,a)=>{Promise.resolve().then(a.bind(a,18087))},18087:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>T});var t=a(10326),o=a(64447),s=a(17577),i=a(77863);function n({isOpen:e,onClose:r,memberId:o,member:n,debits:c,onSuccess:l}){let[d,x]=(0,s.useState)(6),[m,u]=(0,s.useState)(10),[p,g]=(0,s.useState)(0),[h,b]=(0,s.useState)("0"),[f,v]=(0,s.useState)(()=>{let e=new Date;return e.setMonth(e.getMonth()+1),e.toISOString().split("T")[0]}),[y,N]=(0,s.useState)(""),[j,C]=(0,s.useState)(null),[D,w]=(0,s.useState)(null),[I,E]=(0,s.useState)(!1),S=c.reduce((e,r)=>e+(r.monto-(r.paidAmount||0)),0),A=e=>{let r=(0,i.m9)(e),a=(0,i.sU)(r);if(b(r),g(a),S>0){let e=Math.round(a/S*100);e<=80&&u(e)}},T=async()=>{if(!j||!D?.valid){alert("No hay una proyecci\xf3n v\xe1lida para generar el PDF");return}try{E(!0);let{jsPDF:e}=await a.e(4401).then(a.bind(a,14401)),r=new e("portrait","mm","a4"),t=r.internal.pageSize.width,o=r.internal.pageSize.height,s=[41,128,185],l=[52,73,94],x=[245,246,250],u=[218,223,228],g=25,h=(e,a,o=12,s=!1)=>{r.setFontSize(o),r.setFont("helvetica",s?"bold":"normal");let i=r.getTextWidth(e);r.text(e,(t-i)/2,a)},b=(e=30)=>g+e>o-20&&(r.addPage(),g=25,!0);r.setFillColor(...s),r.rect(0,0,t,15,"F"),r.setTextColor(255,255,255),r.setFontSize(14),r.setFont("helvetica","bold"),h("CLUB SOCIAL DEPORTIVO",10,14,!0),r.setDrawColor(...s),r.setLineWidth(.8),r.line(20,18,t-20,18),r.setTextColor(...l),h("SOLICITUD DE REFINANCIACI\xd3N",28,16,!0),g=38,r.setFontSize(9),r.setTextColor(...l);let v=`${n?.nombres||n?.nombre||""} ${n?.apellidos||n?.apellido||""}`.trim(),y=n?.cedula||n?.ci||n?.numeroDocumento||"",N=n?.codigo||n?.nroSocio||n?.id||"";r.setFillColor(...x),r.rect(20,g-5,t-40,15,"F"),r.setDrawColor(...u),r.rect(20,g-5,t-40,15),r.setFont("helvetica","bold"),r.text("SOCIO:",25,g),r.setFont("helvetica","normal"),r.text(v||"Informaci\xf3n no disponible",45,g),r.setFont("helvetica","bold"),r.text("C.I.N\xb0:",25,g+5),r.setFont("helvetica","normal"),r.text(y||"No disponible",45,g+5),r.setFont("helvetica","bold"),r.text("C\xd3DIGO:",120,g),r.setFont("helvetica","normal"),r.text(N||"No disponible",145,g),r.setFont("helvetica","bold"),r.text("FECHA:",120,g+5),r.setFont("helvetica","normal"),r.text(new Date().toLocaleDateString("es-PY"),145,g+5),g+=15,b(40),g+=8,r.setFontSize(11),r.setTextColor(...s),r.setFont("helvetica","bold"),r.text("1. D\xc9BITOS A REFINANCIAR",20,g);let C=g+=6;r.setFillColor(...s),r.rect(20,C,t-40,6,"F"),r.setTextColor(255,255,255),r.setFontSize(9),r.text("CONCEPTO",22,C+4),r.text("MONTO",130,C+4),r.text("VENCIMIENTO",160,C+4),g=C+6,r.setTextColor(...l),r.setFont("helvetica","normal"),c.forEach((e,a)=>{a>0&&a%8==0&&(b(40),g+=10),a%2==0&&(r.setFillColor(...x),r.rect(20,g,t-40,6,"F")),r.setDrawColor(...u),r.rect(20,g,t-40,6);let o=e.concepto.length>45?e.concepto.substring(0,42)+"...":e.concepto;r.text(o,22,g+4),r.text((0,i.xG)(e.monto-(e.paidAmount||0)),130,g+4),r.text(e.vencimiento?(0,i.p6)(e.vencimiento):"N/A",160,g+4),g+=6}),r.setFillColor(...l),r.rect(20,g,t-40,6,"F"),r.setTextColor(255,255,255),r.setFont("helvetica","bold"),r.text("TOTAL A REFINANCIAR:",22,g+4),r.text((0,i.xG)(S),130,g+4),g+=14,b(30),r.setTextColor(...s),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("2. T\xc9RMINOS DE REFINANCIACI\xd3N",20,g),g+=6;let D=[["Cantidad de Cuotas:",`${d} cuotas`],["Porcentaje Inicial:",`${m}%`],["Monto Cuota Inicial:",(0,i.xG)(p)],["Fecha Primera Cuota:",(0,i.p6)(f)],["Monto por Cuota:",(0,i.xG)(j?.installmentAmount||0)]];if(D.forEach(([e,a],o)=>{let s=g+8*o;o%2==0&&(r.setFillColor(...x),r.rect(20,s,t-40,8,"F")),r.setDrawColor(...u),r.rect(20,s,t-40,8),r.setTextColor(...l),r.setFontSize(9),r.setFont("helvetica","bold"),r.text(e,25,s+5),r.setFont("helvetica","normal");let i=t-45-r.getTextWidth(a);r.text(a,i,s+5)}),g+=8*D.length+4,b(50),r.setTextColor(...s),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("3. CRONOGRAMA DE PAGOS",20,g),g+=6,j?.schedule){let e=j.schedule;if(e.length>8){let a=Math.ceil(e.length/2),o=(t-50)/2;r.setFillColor(...s),r.rect(20,g,o,6,"F"),r.rect(20+o+10,g,o,6,"F"),r.setTextColor(255,255,255),r.setFontSize(8),r.text("CUOTA",25,g+4),r.text("MONTO",60,g+4),r.text("VENCIMIENTO",95,g+4),r.text("CUOTA",25+o+10,g+4),r.text("MONTO",60+o+10,g+4),r.text("VENCIMIENTO",95+o+10,g+4);let n=g+=6;e.forEach((e,t)=>{let s=n+4*Math.floor(t%a);if(t<a)t%2==0&&(r.setFillColor(...x),r.rect(20,s,o,4,"F")),r.setDrawColor(...u),r.rect(20,s,o,4),r.setTextColor(...l),r.text(`${e.number}`,25,s+2.5),r.text((0,i.xG)(e.amount),60,s+2.5),r.text((0,i.p6)(e.dueDate),95,s+2.5);else{let s=t-a,c=n+4*s;s%2==0&&(r.setFillColor(...x),r.rect(20+o+10,c,o,4,"F")),r.setDrawColor(...u),r.rect(20+o+10,c,o,4),r.setTextColor(...l),r.text(`${e.number}`,25+o+10,c+2.5),r.text((0,i.xG)(e.amount),60+o+10,c+2.5),r.text((0,i.p6)(e.dueDate),95+o+10,c+2.5)}}),g=n+4*a+8}else r.setFillColor(...s),r.rect(20,g,t-40,6,"F"),r.setTextColor(255,255,255),r.setFontSize(8),r.text("CUOTA",25,g+4),r.text("MONTO",70,g+4),r.text("VENCIMIENTO",120,g+4),g+=6,e.forEach((e,a)=>{a%2==0&&(r.setFillColor(...x),r.rect(20,g,t-40,5,"F")),r.setDrawColor(...u),r.rect(20,g,t-40,5),r.setTextColor(...l),r.setFontSize(8),r.text(`${e.number}`,25,g+3),r.text((0,i.xG)(e.amount),70,g+3),r.text((0,i.p6)(e.dueDate),120,g+3),g+=5}),g+=4}b(25),r.setTextColor(...s),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("4. RESUMEN FINANCIERO",20,g),g+=6,r.setFillColor(...x),r.rect(20,g,t-40,20,"F"),r.setDrawColor(...s),r.rect(20,g,t-40,20),[["Total Principal Refinanciado:",(0,i.xG)(j?.principal||0)],["Cuota Inicial:",(0,i.xG)(j?.downPaymentAmount||0)],["Total Financiado en Cuotas:",(0,i.xG)(j?.totalInInstallments||0)],["N\xfamero Total de Cuotas:",`${d} cuotas`],["Monto por Cuota:",(0,i.xG)(j?.installmentAmount||0)]].forEach(([e,a],o)=>{let s=g+5+3.5*o;r.setFontSize(9),r.setFont("helvetica","bold"),r.setTextColor(...l),r.text(e,25,s),r.setFont("helvetica","normal"),r.setTextColor(...l);let i=t-45-r.getTextWidth(a);r.text(a,i,s)}),g+=25,b(35),r.setTextColor(...s),r.setFontSize(11),r.setFont("helvetica","bold"),r.text("5. AUTORIZACIONES",20,g),g+=8;let w=(t-60)/2;r.setDrawColor(...u),r.rect(25,g,w,25),r.setFontSize(9),r.setTextColor(...l),r.setFont("helvetica","bold"),r.text("FIRMA DEL SOCIO",25+w/2-r.getTextWidth("FIRMA DEL SOCIO")/2,g+8),r.setFont("helvetica","normal"),r.setFontSize(8),r.text("Acepto los t\xe9rminos y condiciones de esta",30,g+15),r.text("refinanciaci\xf3n y me comprometo a su cumplimiento.",30,g+19),r.rect(35+w,g,w,25),r.setFont("helvetica","bold"),r.text("AUTORIZACI\xd3N DEL CLUB",35+w+w/2-r.getTextWidth("AUTORIZACI\xd3N DEL CLUB")/2,g+8),r.setFont("helvetica","normal"),r.setFontSize(8),r.text("Visto Bueno y Autorizaci\xf3n de la",35+w+5,g+15),r.text("Administraci\xf3n del Club",35+w+5,g+19),g+=32,r.setDrawColor(...u),r.line(20,g,t-20,g),g+=3,r.setFontSize(7),r.setTextColor(...l),h(`Documento generado autom\xe1ticamente el ${new Date().toLocaleString("es-PY")} - P\xe1gina 1 de 1`,g);let I=(n.full_name||n.name||"Sin_Nombre").replace(/[^a-zA-Z0-9áéíóúñÁÉÍÓÚÑ\s]/g,"").replace(/\s+/g,"_"),A=n.member_number||n.id,T=new Date().toLocaleDateString("es-PY",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),F=`Refinanciacion_${I}_${A}_${T}.pdf`;r.save(F),alert("PDF generado exitosamente")}catch(e){console.error("Error generating PDF:",e),alert(`Error al generar PDF: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{E(!1)}};return e?c&&0!==c.length?t.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-lg max-h-[90vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Refinanciaci\xf3n de Deuda"}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"D\xe9bitos seleccionados"}),t.jsx("ul",{className:"text-sm list-disc pl-5",children:c.map(e=>(0,t.jsxs)("li",{children:[e.concepto," — ",(0,i.xG)(e.monto-(e.paidAmount||0))," (Vence: ",e.vencimiento?(0,i.p6)(e.vencimiento):"-",")"]},e.id))})]}),I&&(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-center",children:[t.jsx("span",{className:"animate-spin text-blue-600",children:"⟳"})," Calculando proyecci\xf3n..."]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Cantidad de cuotas"}),t.jsx("input",{type:"number",min:1,max:12,value:d,onChange:e=>x(Number(e.target.value)),className:"w-full border rounded px-2 py-1"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Porcentaje de Cuota Inicial (%)"}),t.jsx("input",{type:"number",min:0,max:80,value:m,onChange:e=>u(Number(e.target.value)),className:"w-full border rounded px-2 py-1"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Cuota Inicial (monto)"}),t.jsx("input",{type:"text",inputMode:"numeric",value:h,onChange:e=>A(e.target.value),className:"w-full border rounded px-2 py-1 font-mono text-right",placeholder:"0"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Fecha 1\xaa cuota"}),t.jsx("input",{type:"date",value:f,onChange:e=>v(e.target.value),className:"w-full border rounded px-2 py-1"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"Observaciones"}),t.jsx("textarea",{value:y,onChange:e=>N(e.target.value),className:"w-full border rounded px-2 py-1"})]}),D&&!D.valid&&D.errors&&t.jsx("div",{className:"bg-red-100 text-red-700 p-2 rounded",children:D.errors.map(e=>t.jsx("div",{children:e},e))}),j&&j.schedule&&Array.isArray(j.schedule)&&(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[t.jsx("div",{className:"font-semibold mb-3",children:"Proyecci\xf3n de cuotas"}),t.jsx("div",{className:"overflow-x-auto mb-4",children:(0,t.jsxs)("table",{className:"w-full text-sm border-collapse border border-gray-300",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-100",children:[t.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left",children:"Cuota Nro."}),t.jsx("th",{className:"border border-gray-300 px-3 py-2 text-right",children:"Monto"}),t.jsx("th",{className:"border border-gray-300 px-3 py-2 text-center",children:"Fecha de Vencimiento"})]})}),t.jsx("tbody",{children:j.schedule.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"border border-gray-300 px-3 py-2 font-medium",children:e.number}),t.jsx("td",{className:"border border-gray-300 px-3 py-2 text-right font-mono",children:(0,i.xG)(e.amount)}),t.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:(0,i.p6)(e.dueDate)})]},e.number))})]})}),(0,t.jsxs)("div",{className:"border-t border-gray-300 pt-3 space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Total principal:"}),t.jsx("span",{className:"font-bold",children:(0,i.xG)(j.principal||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Cuota inicial:"}),t.jsx("span",{className:"font-bold text-blue-600",children:(0,i.xG)(j.downPaymentAmount||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[t.jsx("span",{className:"font-semibold",children:"Total en cuotas:"}),t.jsx("span",{className:"font-bold text-green-600",children:(0,i.xG)(j.totalInInstallments||0)})]})]})]})]}),(0,t.jsxs)("div",{className:"p-6 border-t flex justify-between items-center",children:[t.jsx("button",{onClick:()=>T(),disabled:!j||!D?.valid||I,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:"\uD83D\uDCC4 Generar PDF"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),t.jsx("button",{onClick:async()=>{if(!D?.valid){alert("Por favor corrige los errores antes de continuar.");return}E(!0);try{let e={memberId:o,debitIds:c.map(e=>e.id),principal:S,installments:d,downPaymentPercent:m,downPaymentAmount:p,startDueDate:f,observations:y},r=await fetch("/api/refinancing/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(r.ok)await r.json(),alert("\xa1Refinanciaci\xf3n creada exitosamente!"),l();else{let e=await r.text();throw Error(`Error ${r.status}: ${e}`)}}catch(e){console.error("Error processing refinancing:",e),alert(`Error al procesar la refinanciaci\xf3n: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{E(!1)}},disabled:!D?.valid||I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:I?(0,t.jsxs)(t.Fragment,{children:[t.jsx("span",{className:"animate-spin mr-1",children:"⟳"})," Procesando..."]}):"♻️ Refinanciar"})]})]})]})}):t.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-lg shadow-lg p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Error"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"No se han seleccionado d\xe9bitos para refinanciar."}),t.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cerrar"})]})}):null}var c=a(67269),l=a(60068),d=a(31540),x=a(28916),m=a(83855),u=a(88307),p=a(79635),g=a(231);let h=(0,a(76557).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var b=a(94019),f=a(90434),v=a(98091);function y({conceptos:e,services:r,selectedMember:a,showFormValidation:o,vencimientoDefault:s,onAddConcepto:i,onUpdateConcepto:n,onRemoveConcepto:c,formatNumberWithSeparator:l,getNumericValueSafe:d,isServiceDuplicate:x,onServiceSelection:u,title:p="Conceptos",buttonColor:g="",onOpenReservaModal:h,modoReservaUnica:b=!1,onToggleModoReserva:f,canShowMultiReserva:y=!1,conceptosConReservaCount:N=0}){return(0,t.jsxs)("div",{className:"mb-4 bg-white p-3 rounded-lg border border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-800",children:p}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[y&&f&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 rounded-md px-2 py-1 border border-gray-200",children:[(0,t.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"radio",name:`modo-reserva-${p}`,checked:!b,onChange:()=>!b||f(),className:"w-3 h-3 text-gray-600 border-gray-300 focus:ring-gray-500"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Reserva Individual"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[t.jsx("input",{type:"radio",name:`modo-reserva-${p}`,checked:b,onChange:()=>b||f(),className:"w-3 h-3 text-blue-600 border-gray-300 focus:ring-blue-500"}),t.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Reserva \xdanica"}),b&&N>0&&(0,t.jsxs)("span",{className:"text-xs text-blue-600 font-semibold",children:["(",N,")"]})]})]}),(0,t.jsxs)("button",{type:"button",onClick:i,className:`inline-flex items-center gap-2 px-3 py-1.5 ${g} text-white rounded-md text-sm hover:opacity-90 transition-colors`,children:[t.jsx(m.Z,{size:14})," A\xf1adir concepto"]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-[13px]",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[t.jsx("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[180px]",children:"Servicio"}),t.jsx("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[80px]",children:"Tipo"}),t.jsx("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[100px]",children:"Monto"}),t.jsx("th",{className:"text-left p-1 font-medium text-gray-700 min-w-[110px]",children:"Vencimiento"}),t.jsx("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[50px]",children:"D\xedas"}),t.jsx("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[80px]",children:"Suscripci\xf3n"}),t.jsx("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[120px]",children:"Espacios"}),t.jsx("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[80px]",children:"Reserva"}),t.jsx("th",{className:"text-center p-1 font-medium text-gray-700 min-w-[50px]",children:"Acci\xf3n"})]})}),t.jsx("tbody",{children:e.map(i=>(0,t.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,t.jsxs)("td",{className:"p-1",children:[(0,t.jsxs)("select",{value:i.servicioId,onChange:async e=>{let t=e.target.value;if(u){await u(i.id,t);return}let o=r.find(e=>e.id===t),s=o?String(a?.subcategoria==="NO SOCIO"?o.precioNoSocio??o.precio:o.precioSocio??o.precio):"";n(i.id,"servicioId",t),n(i.id,"concepto",o?.nombre||""),n(i.id,"monto",s?l(s):""),o?.tipo&&n(i.id,"tipoServicio",o.tipo)},className:`w-full px-1 py-1 text-[13px] border rounded focus:outline-none focus:ring-1 ${o&&!i.servicioId?"border-red-300 focus:ring-red-500":o&&i.servicioId&&x(e,i.servicioId,r)?"border-amber-300 focus:ring-amber-500":"border-gray-300 focus:ring-blue-500"}`,children:[t.jsx("option",{value:"",children:"— Seleccionar —"}),r.filter(r=>{let t=a?.subcategoria==="NO SOCIO";return!!function(e,r,a=!1){if(!r&&!a)return!0;let t=!a&&r?.subcategoria!=="NO SOCIO",o=a||r?.subcategoria==="NO SOCIO";if(!0===e.agendamiento){if(t)return!0;if(o)return!0===e.noSocios}return t?!0===e.socios:!!o&&!0===e.noSocios}(r,a,t)&&(!!(r.nombre.toUpperCase().includes("HORA EXTRA")||r.nombre.toUpperCase().includes("HORAS EXTRA"))||!!i.requiereReserva||!e.some(e=>e.servicioId===r.id&&e.id!==i.id&&!e.requiereReserva))}).map(e=>t.jsx("option",{value:e.id,children:e.nombre},e.id))]}),o&&!i.servicioId&&t.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Requerido"}),o&&i.servicioId&&!i.requiereReserva&&x(e,i.servicioId,r)&&t.jsx("div",{className:"text-xs text-amber-700 mt-1",children:"Servicio repetido"})]}),t.jsx("td",{className:"p-1",children:(0,t.jsxs)("select",{value:i.tipoServicio,onChange:e=>n(i.id,"tipoServicio",e.target.value),className:"w-full px-1 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[t.jsx("option",{value:"MENSUAL",children:"Mensual"}),t.jsx("option",{value:"ANUAL",children:"Anual"}),t.jsx("option",{value:"UNICO",children:"\xdanico"}),t.jsx("option",{value:"DIARIO",children:"Diario"})]})}),(0,t.jsxs)("td",{className:"p-1",children:[t.jsx("input",{type:"text",inputMode:"numeric",value:i.monto,onChange:e=>n(i.id,"monto",l(e.target.value)),className:`w-24 px-1 py-1 text-[13px] border rounded focus:outline-none focus:ring-1 ${o&&(!i.monto||0>=parseFloat(d(i.monto)))?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,placeholder:"50.000"}),o&&(!i.monto||0>=parseFloat(d(i.monto)))&&t.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Requerido"})]}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"date",value:(()=>{if(i.requiereReserva&&i.reservaFecha)return i.reservaFecha.slice(0,10);if(i.relatedToReservaConceptId){let r=e.find(e=>e.id===i.relatedToReservaConceptId);if(r?.reservaFecha)return r.reservaFecha.slice(0,10)}return i.vencimiento||s||""})(),onChange:e=>n(i.id,"vencimiento",e.target.value),className:"w-full px-1 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),(0,t.jsxs)("td",{className:"p-1 text-center",children:["DIARIO"===i.tipoServicio?t.jsx("input",{type:"number",min:1,value:i.dias||1,onChange:e=>n(i.id,"dias",Math.max(1,parseInt(e.target.value)||1)),className:`w-12 px-1 py-1 text-[13px] border rounded focus:outline-none focus:ring-1 text-center ${o&&"DIARIO"===i.tipoServicio&&(!i.dias||i.dias<=0)?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`}):t.jsx("span",{className:"text-gray-400 text-xs",children:"—"}),o&&"DIARIO"===i.tipoServicio&&(!i.dias||i.dias<=0)&&t.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Requerido"})]}),t.jsx("td",{className:"p-1 text-center",children:(0,t.jsxs)("label",{className:"inline-flex items-center",children:[t.jsx("input",{type:"checkbox",checked:i.crearSuscripcion||!1,onChange:e=>n(i.id,"crearSuscripcion",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("span",{className:"sr-only",children:"Crear suscripci\xf3n"})]})}),t.jsx("td",{className:"p-1 text-center",children:(()=>{let e=r.find(e=>e.id===i.servicioId);if(!i.requiereReserva||!i.servicioId)return t.jsx("span",{className:"text-gray-400 text-xs",children:"—"});let a=[];return(e?.espaciosDisponibles&&e.espaciosDisponibles.length>0?a=e.espaciosDisponibles:e?.espacios&&e.espacios.length>0&&(a=e.espacios.map((r,a)=>({id:`espacio-${e.id}-${a}`,nombre:r,descripcion:"",activo:!0}))),0===a.length)?t.jsx("span",{className:"text-gray-400 text-xs",children:"—"}):(0,t.jsxs)("select",{value:(()=>{let e=i.reservaVenueId,t=r.find(e=>e.id===i.servicioId);if(e){if(!a.find(r=>r.id===e)){if(console.warn(`⚠️ Concepto ${i.concepto} (${t?.nombre}) tiene venueId ${e} que no est\xe1 en espacios disponibles:`,a.map(e=>e.nombre)),a.length>0){let e=a[0].id;return setTimeout(()=>n(i.id,"reservaVenueId",e),0),e}return""}return e}if(a.length>0){let e=a[0].id;return console.log(`✅ Auto-seleccionando primer espacio para ${i.concepto} (${t?.nombre}): ${a[0].nombre}`),setTimeout(()=>n(i.id,"reservaVenueId",e),0),e}return""})(),onChange:e=>n(i.id,"reservaVenueId",e.target.value),className:"w-full px-1 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[0===a.length&&t.jsx("option",{value:"",children:"Sin espacios disponibles"}),a.map(e=>t.jsx("option",{value:e.id,children:e.nombre},e.id))]})})()}),t.jsx("td",{className:"p-1 text-center",children:(()=>{let e=r.find(e=>e.id===i.servicioId);if(!e?.permiteAgendamiento)return t.jsx("span",{className:"text-gray-400 text-xs",children:"—"});let a=i.requiereReserva,o=a&&i.reservaFechaHora;return(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsxs)("label",{className:"inline-flex items-center",children:[t.jsx("input",{type:"checkbox",checked:a||!1,onChange:e=>n(i.id,"requiereReserva",e.target.checked),className:"w-3 h-3 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),t.jsx("span",{className:"sr-only",children:"Requiere reserva"})]}),a&&!b&&t.jsx("button",{type:"button",onClick:()=>h?.(i.id),className:`text-xs px-1 py-0.5 rounded transition-colors ${o?"text-green-700":"text-purple-700"}`,title:o?"Editar reserva existente":"Configurar nueva reserva",children:o?"Editar":"Agendar"})]})})()}),t.jsx("td",{className:"p-1 text-center",children:t.jsx("button",{type:"button",onClick:()=>c(i.id),className:"inline-flex items-center justify-center w-6 h-6 text-red-600 hover:bg-red-50 rounded-md transition-colors",title:"Eliminar concepto",children:t.jsx(v.Z,{size:14})})})]},i.id))})]})})]})}function N({condicion:e,conceptos:r,pagoAplicado:a,permitirPagosParc:o,calculateTotal:s,getNumericValue:i,onProcessPayment:n,isFormValid:c,saving:l,onCancel:d}){let x=s(r),m=a?parseInt(i(a)):0,u=x-m,p="CONTADO"===e?{texto:"PAGO COMPLETO",color:"text-green-700 bg-green-50 border-green-200"}:"CREDITO"===e?o&&m>0?m>=x?{texto:"PAGO COMPLETO",color:"text-green-700 bg-green-50 border-green-200"}:{texto:"PAGO PARCIAL",color:"text-blue-700 bg-blue-50 border-blue-200"}:{texto:"PENDIENTE",color:"text-orange-700 bg-orange-50 border-orange-200"}:{texto:"PENDIENTE",color:"text-gray-700 bg-gray-50 border-gray-200"};return(0,t.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Resumen de Pago"}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Total:"}),(0,t.jsxs)("span",{className:"font-semibold text-gray-900",children:["Gs. ",x>0?parseInt(String(x)).toLocaleString("es-PY"):"0"]})]}),t.jsx("div",{className:`px-3 py-2 rounded-lg border text-center ${p.color}`,children:t.jsx("span",{className:"text-xs font-medium",children:p.texto})}),Array.isArray(r)&&r.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[(0,t.jsxs)("span",{children:["\uD83D\uDCCB ",r.length," concepto",1!==r.length?"s":""]}),"CONTADO"===e&&t.jsx("span",{children:"✅ Pago inmediato"}),"CREDITO"===e&&!o&&t.jsx("span",{children:"\uD83D\uDCDD A cr\xe9dito"}),"CREDITO"===e&&o&&t.jsx("span",{children:"\uD83D\uDCB0 Con pago parcial"})]}),"CREDITO"===e&&o&&m>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Pagado:"}),(0,t.jsxs)("span",{className:"font-semibold text-green-600",children:["Gs. ",m.toLocaleString("es-PY")]})]}),"CREDITO"===e&&o&&m>0&&u>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[t.jsx("span",{className:"text-xs text-gray-600",children:"Saldo:"}),(0,t.jsxs)("span",{className:"font-semibold text-orange-600",children:["Gs. ",u.toLocaleString("es-PY")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:n,disabled:l||!c,className:`px-4 py-2 rounded-lg text-white font-medium text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${"CONTADO"===e?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"}`,children:l?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-2 border-white border-t-transparent"}),"Guardando..."]}):"CONTADO"===e?"Pagar":"Registrar"}),t.jsx("button",{onClick:d,disabled:l,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 text-sm transition-colors disabled:opacity-50",children:"Cancelar"})]})]})]})}function j(){try{return String(Math.random().toString(36).slice(2,9))}catch{return Date.now().toString(36)}}function C(e){return e?String(e).replace(/\./g,"").replace(/,/g,"."):"0"}function D(e){return e&&0!==e.length?e.reduce((e,r)=>e+(Number(C(r.monto))||0),0):0}function w(e,r,a){if(!e||!r||"HORAS_EXTRAS_TEMP"===r)return!1;if(a){let t=a.find(e=>e.id===r);if(t){let a=0;if(t.espaciosDisponibles&&Array.isArray(t.espaciosDisponibles)?a=t.espaciosDisponibles.length:t.espacios&&Array.isArray(t.espacios)&&(a=t.espacios.length),a>1)return e.reduce((e,a)=>e+(a.servicioId===r?1:0),0)>=a}}return e.reduce((e,a)=>e+(a.servicioId===r?1:0),0)>1}function I(e,r,a){if(!e)return(0,l.LJ)();let t=new Date(e);switch(r){case"MENSUAL":t.getDate(),t.setMonth(t.getMonth()+1);break;case"ANUAL":t.setFullYear(t.getFullYear()+1);break;case"DIARIO":t.setDate(t.getDate()+(a||1));break;case"UNICO":return e;default:t.setMonth(t.getMonth()+1)}return t.toISOString().slice(0,10)}function E(e,r,a){if(e.vencimientoManual){if(a&&a!==e.tipoServicio){let t=I(r,a,e.dias);return{...e,tipoServicio:a,vencimiento:t,vencimientoManual:!1}}return e}let t=I(r,a||e.tipoServicio,e.dias);return{...e,...a&&{tipoServicio:a},vencimiento:t}}function S(e){let r=String(e||"").toUpperCase();return"DEBIT"===r||"DEBE"===r?"DEBIT":"CREDIT"===r||"HABER"===r?"CREDIT":"DEBIT"}function A(e,r){if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return"";let[a,t,o]=e.split("-").map(Number),s=new Date(a,(t??1)-1,o??1);s.setDate(s.getDate()+r);let i=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");return`${i}-${n}-${c}`}function T(){let[e,r]=(0,s.useState)([]),[v,T]=(0,s.useState)([]),[F,P]=(0,s.useState)([]),[O,k]=(0,s.useState)([]),[H,$]=(0,s.useState)(!0),[R,L]=(0,s.useState)(""),[M,U]=(0,s.useState)("nombre"),[G,q]=(0,s.useState)(""),[z,V]=(0,s.useState)(""),[_,Y]=(0,s.useState)(""),[B,J]=(0,s.useState)(!1),[Z,X]=(0,s.useState)(!1),[Q,W]=(0,s.useState)(null),[K,ee]=(0,s.useState)("unified"),[er,ea]=(0,s.useState)(!1),[et,eo]=(0,s.useState)(""),[es,ei]=(0,s.useState)([]),[en,ec]=(0,s.useState)(!1),[el,ed]=(0,s.useState)({venueId:"",fecha:(0,i.Ji)(),inicioHora:"19:00",finHora:"03:00",observaciones:"",cedula:"",telefono:"",ruc:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:"",acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:"",cantidadPersonas:"",observacionesGenerales:"",requiereApa:!0}),[ex,em]=(0,s.useState)(!1),[eu,ep]=(0,s.useState)([]),[eg,eh]=(0,s.useState)({venueId:"",fecha:(0,i.Ji)(),inicioHora:"19:00",finHora:"03:00",observaciones:"",configuracionIndividual:!1,cedula:"",telefono:"",ruc:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:"",acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:"",cantidadPersonas:"",observacionesGenerales:"",requiereApa:!0,configuracionesIndividuales:{}}),[eb,ef]=(0,s.useState)({condicion:"CONTADO",fecha:(0,i.Ji)(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,i.Ji)(),30),observaciones:"",crearSuscripcion:!1,pagoAplicado:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",permitirPagosParc:!1,presupuestoDeudas:"",conceptos:[{id:j(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,i.Ji)(),30),observaciones:"",condicion:"CONTADO"}]});function ev(e,r){let a=function(e){(0,l.LJ)();let r=(0,l.tF)();return r.setUTCDate(r.getUTCDate()+30),{id:j(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:r.toISOString().slice(0,10),observaciones:"",crearSuscripcion:!1,vencimientoManual:!1,condicion:e||"CONTADO"}}(r||eb.condicion),t=I(e||eb.fecha||(0,i.Ji)(),"MENSUAL");return{...a,vencimiento:t,vencimientoManual:!1}}function ey(e,r,a,t){return ef(o=>({...o,conceptos:((o=[])=>o.map(o=>(o.concepto.toUpperCase().includes("HORA EXTRA")||"UNICO"===o.tipoServicio&&o.concepto.includes("h"))&&(t&&o.relatedToReservaConceptId===t||!t&&!o.relatedToReservaConceptId)?{...o,concepto:`HORA EXTRA (${e}h)`,monto:ae(r.toString()),observaciones:a||`Hora extra - ${e} hora(s)`,relatedToReservaConceptId:t}:o))(o.conceptos)})),null}function eN(e,r,a,t){if(t&&function(e){let r=eb.conceptos;return r&&e&&r.find(r=>{let a=r.concepto.toUpperCase().includes("HORA EXTRA")||"UNICO"===r.tipoServicio&&r.concepto.includes("h"),t=r.relatedToReservaConceptId===e;return a&&t})||null}(t))return console.warn("Ya existe concepto de hora extra para esta reservaci\xf3n, actualizando existente"),ey(e,r,a,t);if(function(e,r,a){let t=eb.conceptos;return!!t&&t.some(t=>{let o=t.concepto.toUpperCase().includes("HORA EXTRA")||"UNICO"===t.tipoServicio&&t.concepto.includes(`${e}h`),s=parseFloat(C(t.monto))===r,i=a&&t.observaciones&&t.observaciones.includes(a.substring(0,20));return o&&s&&i})}(e,r,a))return console.warn("Ya existe un concepto de hora extra similar, actualizando existente"),ey(e,r,a,t);let o=function(e,r,a,t){let o=F.find(e=>e.nombre.toUpperCase().includes("HORA EXTRA")||e.nombre.toUpperCase().includes("HORAS EXTRA")),s=o?.id||"HORAS_EXTRAS_TEMP";return o||console.warn("⚠️ Servicio Horas Extras no encontrado, usando ID fallback:",s),{id:j(),servicioId:s,concepto:`HORA EXTRA (${e}h)`,tipoServicio:"UNICO",monto:ae(r.toString()),dias:1,vencimiento:eb.fecha||(0,i.Ji)(),observaciones:a||`Hora extra - ${e} hora(s)`,vencimientoManual:!1,relatedToReservaConceptId:t}}(e,r,a,t);return ef(e=>{let r=(e.conceptos||[]).concat(o);return{...e,conceptos:r}}),o}function ej(e){let r=ev(void 0,eb.condicion);ef(e=>{let a=(e.conceptos||[]).concat(r);return{...e,conceptos:a}})}function eC(e,r){ef(e=>{let a=(e.conceptos||[]).filter(e=>e.id!==r);return 0===a.length&&a.push(ev(void 0,e.condicion)),{...e,conceptos:a}})}function eD(e,r,a,t,o=!1){ef(e=>({...e,conceptos:((s=[])=>s.map(s=>{if(s.id!==r)return s;let i={...s,[a]:t};return"vencimiento"!==a||o?"tipoServicio"===a&&e.fecha?i=E(i,e.fecha,t):"dias"===a&&"DIARIO"===i.tipoServicio&&e.fecha&&(i=E(i,e.fecha,i.tipoServicio)):i={...i,vencimiento:t,vencimientoManual:!0},i}))(e.conceptos)}))}function ew(){return eb.conceptos||[]}async function eI(e,r){let a=F.find(e=>e.id===r);if(!a||!Q)return;let t="NO SOCIO"===Q.subcategoria?a.precioNoSocio??a.precio:a.precioSocio??a.precio,o=eb.condicion||"CONTADO";if(eD(o,e,"servicioId",r),eD(o,e,"concepto",a.nombre),eD(o,e,"monto",ae(String(t))),eD(o,e,"tipoServicio",a.tipo),"UNICO"!==a.tipo){let a=await rP(Q.id,r);if(a){let r=a?.nextChargeDate||a?.validUntil||a?.nextDueDate||a?.dueDate||a?.vencimiento;r&&eD(o,e,"vencimiento",r,!0)}}}let[eE,eS]=(0,s.useState)([]),[eA,eT]=(0,s.useState)(!1),[eF,eP]=(0,s.useState)(!1),[eO,ek]=(0,s.useState)({nombres:"",apellidos:"",ci:"",telefono:"",email:""}),[eH,e$]=(0,s.useState)("");function eR(){eP(!1),e$(""),ek({nombres:"",apellidos:"",ci:"",telefono:"",email:""})}let[eL,eM]=(0,s.useState)({fecha:(0,i.Ji)(),servicioId:"",concepto:"",monto:"",tipoServicio:"MENSUAL",observaciones:"",vencimiento:A((0,i.Ji)(),30),makeSubscription:!1,autoDebit:!0}),[eU,eG]=(0,s.useState)(!1),[eq,ez]=(0,s.useState)([{id:j(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",montoStr:"",vencimiento:new Date(Date.now()+2592e6).toISOString().slice(0,10)}]),[eV,e_]=(0,s.useState)({fecha:(0,i.Ji)(),metodoPago:"",cobradorId:"",numeroRecibo:"",observaciones:""}),[eY,eB]=(0,s.useState)(""),[eJ,eZ]=(0,s.useState)(!1),[eX,eQ]=(0,s.useState)([]),[eW,eK]=(0,s.useState)({}),[e0,e1]=(0,s.useState)([]),[e2,e5]=(0,s.useState)({}),[e3,e4]=(0,s.useState)(!1),[e6,e7]=(0,s.useState)([]),[e8,e9]=(0,s.useState)(!1),[re,rr]=(0,s.useState)(null),[ra,rt]=(0,s.useState)(!1),[ro,rs]=(0,s.useState)(!1),[ri,rn]=(0,s.useState)([]),[rc,rl]=(0,s.useState)(!1),[rd,rx]=(0,s.useState)(""),[rm,ru]=(0,s.useState)({fecha:(0,i.Ji)(),montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""}),[rp,rg]=(0,s.useState)(!1),[rh,rb]=(0,s.useState)(""),[rf,rv]=(0,s.useState)(10),[ry,rN]=(0,s.useState)(1),[rj,rC]=(0,s.useState)(null),[rD,rw]=(0,s.useState)({x:0,y:0}),rI=(0,s.useRef)(null),[rE,rS]=(0,s.useState)({});async function rA(){$(!0);try{let e=await c.L.authenticatedFetch("/api/members"),a=await e.json(),t=Array.isArray(a)?a:[];r(t);let o=[];for(let e=0;e<t.length;e+=6)o.push(t.slice(e,e+6));let s=[];for(let e of o){let r=await Promise.all(e.map(async e=>{try{let r=await c.L.authenticatedFetch(`/api/members/${e.id}/movements?pageSize=1000`);r.ok||(r=await c.L.authenticatedFetch(`/api/movements?memberId=${encodeURIComponent(e.id)}`));let a=r.headers.get("content-type")||"";if(!r.ok||!a.includes("application/json"))throw Error("fail");let t=await r.json(),o=(Array.isArray(t)?t:Array.isArray(t?.items)?t.items:[]).map((r,a)=>({id:String(r.id??`${e.id}-${a}`),memberId:String(r.memberId??e.id),fecha:r.fecha??r.date??new Date().toISOString(),concepto:String(r.concepto??r.description??""),tipo:S(r.tipo??r.type??""),monto:Number(r.monto??r.amount??0),origen:r.origen??r.source??void 0,refId:r.refId??r.referenceId??void 0,vencimiento:r.vencimiento??r.dueDate??void 0,paidAmount:Number(r.paidAmount??0),status:r.status??"PENDIENTE",allocations:r.allocations||[]})),s=(e,r)=>{if(!e||"DEBIT"!==e.tipo)return 0;let a=0;for(let t of r)if(t.allocations&&Array.isArray(t.allocations))for(let r of t.allocations)r.debitId===e.id&&(a+=Number(r.amount||0));return a},n=o.filter(e=>"DEBIT"===S(e.tipo));o.filter(e=>"CREDIT"===S(e.tipo));let l=n.filter(e=>"REFINANCIADO"!==e.status&&"CANCELADO"!==e.status).reduce((e,r)=>{let a=s(r,o);return e+Math.max(0,(0,i.sQ)(r.monto)-(0,i.sQ)(a))},0),d="SUSPENDIDO"===e.estado?"SUSPENDIDO":function(e){let r=new Date;r.setHours(0,0,0,0);let a=e.filter(e=>"DEBIT"===S(e.tipo)&&Number(e.monto||0)-Number(e.paidAmount||0)>0);if(0===a.length)return"AL_DIA";for(let e of a)if(e.vencimiento){let a=new Date(e.vencimiento);if(a.setHours(0,0,0,0),a.getTime()<r.getTime())return"ATRASADO"}return"AL_DIA"}(o);return[e.id,{saldo:l,estadoCalc:d}]}catch{let r="SUSPENDIDO"===e.estado?"SUSPENDIDO":"ATRASADO"===e.estado?"ATRASADO":"AL_DIA";return[e.id,{saldo:e.deudaTotal??0,estadoCalc:r}]}}));s.push(...r)}let n={};s.forEach(([e,r])=>n[e]=r),rS(n)}catch(e){console.error("Error loading members/ledgers:",e),r([]),rS({})}finally{$(!1)}}let rT=()=>v.find(e=>"CLUB"===e.tipoCobrador);async function rF(){try{let e=await c.L.authenticatedFetch("/api/venues"),r=await e.json();ei(Array.isArray(r)?r.filter(e=>!1!==e.activo):[])}catch(e){console.error("Error loading venues:",e),ei([])}}async function rP(e,r){try{let a=await c.L.authenticatedFetch(`/api/members/${encodeURIComponent(e)}/subscriptions`),t=await a.json().catch(()=>({})),o=Array.isArray(t)?t:Array.isArray(t?.items)?t.items:[];return(o=o.filter(e=>String(e.serviceId)===String(r)&&"ACTIVE"===e.status))[0]||null}catch{return null}}let rO=async e=>{W(e),X(!0),ee("unified"),eT(!1),((e.deudaTotal||0)>0||(rE[e.id]?.saldo||0)>0)&&rM(e.id),await rU(e.id);let r=rT(),a=r?.id||"";ef({condicion:"CONTADO",fecha:(0,i.Ji)(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,i.Ji)(),30),observaciones:"",crearSuscripcion:!1,pagoAplicado:"",metodoPago:O[0]?.id||"efectivo",cobradorId:a,numeroRecibo:"",referencia:"",permitirPagosParc:!1,presupuestoDeudas:"",conceptos:[ev(void 0,"CONTADO")]}),eK({}),await rM(e.id)},rk=()=>{X(!1),W(null),ee("unified"),eQ([]),eK({}),e1([]),e4(!1),eT(!1),ru({fecha:(0,i.Ji)(),montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""});let e=rT(),r=e?.id||"";ef({condicion:"CONTADO",fecha:(0,i.Ji)(),servicioId:"",concepto:"",tipoServicio:"MENSUAL",monto:"",dias:1,vencimiento:A((0,i.Ji)(),30),observaciones:"",crearSuscripcion:!1,pagoAplicado:"",metodoPago:"",cobradorId:r,numeroRecibo:"",referencia:"",permitirPagosParc:!1,presupuestoDeudas:"",conceptos:[ev(void 0,"CONTADO")]})},rH=e=>{eo(e);let r=eb.conceptos,a=r?.find(r=>r.id===e),t=[];if(a?.servicioId){let e=F.find(e=>e.id===a.servicioId);e&&(e.espaciosDisponibles&&e.espaciosDisponibles.length>0?(t=e.espaciosDisponibles.map(e=>({id:e.id,nombre:e.nombre,descripcion:e.descripcion,activo:!0,precioBaseHora:e.precioBaseHora,capacidad:e.capacidad})),console.log(`📍 Espacios (nuevos) para ${e.nombre}:`,t.map(e=>e.nombre))):e.espacios&&e.espacios.length>0?(t=e.espacios.map((r,a)=>({id:`${e.id}-espacio-${a}`,nombre:r,descripcion:`Espacio para ${e.nombre}`,activo:!0,precioBaseHora:e.precio||0,capacidad:4})),console.log(`📍 Espacios (antiguos) para ${e.nombre}:`,t.map(e=>e.nombre))):(t=[{id:`servicio-${e.id}`,nombre:e.nombre,descripcion:`Espacio para ${e.nombre}`,activo:!0,precioBaseHora:e.precio||0,capacidad:1}],console.log(`📍 Espacio virtual para ${e.nombre}:`,e.nombre)))}0===t.length&&(t=es,console.log("\uD83D\uDCCD Usando venues globales como fallback")),a&&a.reservaVenueId?ed(e=>({...r0(),venueId:a.reservaVenueId||"",fecha:a.reservaFecha||(0,i.Ji)(),inicioHora:a.reservaHoraInicio||"19:00",finHora:a.reservaHoraFin||"23:00",observaciones:a.reservaObservaciones||"",cedula:a.reservaCedula||Q?.ci||"",telefono:a.reservaTelefono||Q?.telefono||"",ruc:a.reservaRuc||"",esParaTercero:a.reservaEsParaTercero||!1,terceroNombre:a.reservaTerceroNombre||"",terceroCedula:a.reservaTerceroCedula||"",terceroTelefono:a.reservaTerceroTelefono||"",terceroRuc:a.reservaTerceroRuc||"",horaExtra:a.reservaHoraExtra||!1,cantidadHorasExtra:a.reservaCantidadHorasExtra||"",montoHorasExtra:a.reservaMontoHorasExtra||"",acontecimiento:a.reservaAcontecimiento||"",quinceaneraFocusNombre:a.reservaQuinceaneraFocusNombre||"",noviosNombres:a.reservaNoviosNombres||"",cumpleaneroNombre:a.reservaCumpleaneroNombre||"",otrosDescripcion:a.reservaOtrosDescripcion||"",otrosNombrePersona:a.reservaOtrosNombrePersona||"",cantidadPersonas:a.reservaCantidadPersonas||"",observacionesGenerales:a.reservaObservacionesGenerales||""})):ed(e=>({...r0(),venueId:t.length>0?t[0].id:"",cedula:Q?.ci||"",telefono:Q?.telefono||""})),ei(t),console.log(`🎯 Modal abierto para servicio: ${a?.servicioId} con ${t.length} espacio(s) disponible(s)`),ea(!0)},r$=()=>{ea(!1),eo(""),ed(r0()),rF()},rR=async(e,r,a,t)=>{try{let o=new Date(`${r}T${a}:00`),s=new Date(`${r}T${t}:00`);s<=o&&s.setDate(s.getDate()+1),console.log(`🔍 Validando disponibilidad para: venueId=${e}, fecha=${r}`);let i=`${r}T00:00:00.000Z`,n=`${r}T23:59:59.999Z`,l=`/api/reservas?resourceId=${e}&dateFrom=${i}&dateTo=${n}`;console.log(`📡 URL de consulta: ${l}`);let d=await c.L.authenticatedFetch(l);if(!d.ok)return console.warn("No se pudo validar disponibilidad, status:",d.status),{available:!0};let x=await d.json();console.log(`📋 Reservas encontradas para ${e}:`,x);let m=x.filter(e=>{if("CANCELADO"===e.status)return!1;let r=new Date(e.start),a=new Date(e.end);return o>=r&&o<a||s>r&&s<=a||o<=r&&s>=a});if(m.length>0){let e=m.map(e=>{let r=new Date(e.start).toLocaleTimeString("es-PY",{hour:"2-digit",minute:"2-digit"}),a=new Date(e.end).toLocaleTimeString("es-PY",{hour:"2-digit",minute:"2-digit"});return`${r} - ${a} (${e.nombreContacto||"Sin contacto"})`}).join("\n");return{available:!1,conflicts:m,message:`El horario seleccionado tiene conflictos con reservas existentes:

${e}

Por favor seleccione otro horario.`}}return{available:!0}}catch(e){return console.error("Error validating availability:",e),{available:!0}}},rL=async()=>{let e=e=>{let[r,a]=e.split(":").map(Number);return 60*r+a},r=e(el.finHora),a=e(el.inicioHora);if(r>180&&r<480&&!(r<a)){alert("La hora de fin debe ser hasta las 03:00 am. Posterior a esa hora se cobra como hora extra.");return}if(!et||!el.venueId||!el.fecha){alert("Por favor complete todos los campos requeridos (Espacio, Fecha)");return}if(el.esParaTercero&&!el.terceroNombre.trim()){alert("Por favor ingrese el nombre del tercero");return}if(!el.acontecimiento){alert("Por favor seleccione un acontecimiento");return}if("15_anos"===el.acontecimiento&&!el.quinceaneraFocusNombre.trim()){alert("Por favor ingrese el nombre de la quincea\xf1era");return}if("boda"===el.acontecimiento&&!el.noviosNombres.trim()){alert("Por favor ingrese los nombres de los novios");return}if("cumpleanos"===el.acontecimiento&&!el.cumpleaneroNombre.trim()){alert("Por favor ingrese el nombre del cumplea\xf1er@");return}if("otros"===el.acontecimiento&&!el.otrosDescripcion.trim()){alert("Por favor ingrese la descripci\xf3n del acontecimiento");return}if(el.horaExtra&&(!el.cantidadHorasExtra||!el.montoHorasExtra)){alert("Por favor complete cantidad y monto de las horas extra");return}let t=await rR(el.venueId,el.fecha,el.inicioHora,el.finHora);if(!t.available){alert(`⚠️ Conflicto de horario

${t.message}

Por favor seleccione otro horario o espacio.`);return}try{let e=eb.condicion,r=eb.conceptos;if(r&&r.find(e=>e.id===et)){eD(e,et,"reservaVenueId",el.venueId),eD(e,et,"reservaFecha",el.fecha),eD(e,et,"reservaHoraInicio",el.inicioHora),eD(e,et,"reservaHoraFin",el.finHora),eD(e,et,"reservaObservaciones",el.observaciones);let r=e=>{let[r,a]=e.split(":").map(Number);return 60*r+a},a=r(el.finHora),t=r(el.inicioHora);if(a<t){let r=new Date(el.fecha),a=new Date(r);a.setDate(a.getDate()+1),eD(e,et,"reservaFechaFin",a.toISOString().slice(0,10))}else eD(e,et,"reservaFechaFin","");eD(e,et,"reservaCedula",el.cedula),eD(e,et,"reservaTelefono",el.telefono),eD(e,et,"reservaRuc",el.ruc),eD(e,et,"reservaEsParaTercero",el.esParaTercero),eD(e,et,"reservaTerceroNombre",el.terceroNombre),eD(e,et,"reservaTerceroCedula",el.terceroCedula),eD(e,et,"reservaTerceroTelefono",el.terceroTelefono),eD(e,et,"reservaTerceroRuc",el.terceroRuc),eD(e,et,"reservaHoraExtra",el.horaExtra),eD(e,et,"reservaCantidadHorasExtra",el.cantidadHorasExtra),eD(e,et,"reservaMontoHorasExtra",el.montoHorasExtra),eD(e,et,"reservaAcontecimiento",el.acontecimiento),eD(e,et,"reservaQuinceaneraFocusNombre",el.quinceaneraFocusNombre),eD(e,et,"reservaNoviosNombres",el.noviosNombres),eD(e,et,"reservaCumpleaneroNombre",el.cumpleaneroNombre),eD(e,et,"reservaOtrosDescripcion",el.otrosDescripcion),eD(e,et,"reservaOtrosNombrePersona",el.otrosNombrePersona),eD(e,et,"reservaCantidadPersonas",el.cantidadPersonas),eD(e,et,"reservaObservacionesGenerales",el.observacionesGenerales),eD(e,et,"requiereApa",el.requiereApa)}let a=es.find(e=>e.id===el.venueId)?.nombre||"Espacio seleccionado",t=(0,i.p6)(el.fecha),o=!1;if(el.horaExtra&&el.cantidadHorasExtra&&el.montoHorasExtra)try{let e=parseFloat(el.cantidadHorasExtra),r=parseFloat(C(el.montoHorasExtra));if(e>0&&r>0){let s=`Hora extra para ${a} - ${t} (${el.inicioHora}-${el.finHora})`,i=eN(e,r,s,et);(o=null!==i)&&(F.some(e=>e.nombre.toUpperCase().includes("HORA EXTRA")||e.nombre.toUpperCase().includes("HORAS EXTRA"))||P(e=>[...e,{id:"HORA_EXTRA_FALLBACK",nombre:"Horas Extras",precio:0,tipo:"UNICO",activo:!0,descripcion:"Servicio temporal para Horas Extras"}]),ef(e=>({...e})))}}catch(e){console.error("Error creating hora extra concepto:",e)}ef(e=>({...e})),r$();let s=el.acontecimiento?({"15_anos":"15 a\xf1os",boda:"Boda",cumpleanos:"Cumplea\xf1os",otros:"Otros"})[el.acontecimiento]||"":"Sin especificar",n=o?"\n\n\uD83D\uDD50 \xa1Concepto de Hora Extra agregado autom\xe1ticamente!":"";alert(`✅ Configuraci\xf3n de reserva guardada exitosamente!

📍 ${a}
📅 ${t}
🕐 ${el.inicioHora} - ${el.finHora}
🎉 ${s}${n}

La reserva se crear\xe1 autom\xe1ticamente al procesar el pago.`)}catch(e){console.error("Error saving reserva data:",e),alert("Error al guardar los datos de reserva")}};async function rM(e){eZ(!0);try{let r=await c.L.authenticatedFetch(`/api/members/${e}/movements?type=DEBIT&pageSize=1000`),a=r.headers.get("content-type")||"",t=a.includes("application/json")?await r.json():{},o=Array.isArray(t)?t:Array.isArray(t.items)?t.items:[];if(!o.length)try{t=(a=(r=await c.L.authenticatedFetch(`/api/movements?memberId=${encodeURIComponent(e)}&type=DEBIT&pageSize=1000`)).headers.get("content-type")||"").includes("application/json")?await r.json():{},o=Array.isArray(t)?t:Array.isArray(t.items)?t.items:[]}catch(e){console.warn("Fallback fetch for pending debits failed",e)}let s=o.map(e=>({id:String(e.id),memberId:String(e.memberId),fecha:e.fecha,concepto:e.concepto,tipo:"DEBIT",monto:Number(e.monto||0),vencimiento:e.vencimiento,paidAmount:Number(e.paidAmount||0),observaciones:e.observaciones||"",status:e.status||"PENDIENTE",refinancingId:e.refinancingId})).filter(e=>{let r=e.status||"PENDIENTE",a=(e.paidAmount||0)<(e.monto||0);return"REFINANCIADO"!==r&&!!a});s.sort((e,r)=>{let a=e.vencimiento?new Date(e.vencimiento).getTime():1/0,t=r.vencimiento?new Date(r.vencimiento).getTime():1/0;if(a!==t)return a-t;let o=new Date(e.fecha).getTime(),s=new Date(r.fecha).getTime();return o-s}),eQ(s)}catch(e){console.error("Error loading pending debits:",e),eQ([])}finally{eZ(!1)}}async function rU(e){try{let r=await c.L.authenticatedFetch(`/api/members/${e}/movements?pageSize=1000`);r.ok||(r=await c.L.authenticatedFetch(`/api/movements?memberId=${encodeURIComponent(e)}&pageSize=1000`));let a=r.headers.get("content-type")||"";if(!r.ok||!a.includes("application/json"))throw Error("Error al cargar movimientos");let t=await r.json(),o=(Array.isArray(t)?t:Array.isArray(t?.items)?t.items:[]).map(r=>({id:String(r.id??""),memberId:String(r.memberId??e),fecha:r.fecha??r.date??new Date().toISOString(),concepto:String(r.concepto??r.description??""),tipo:S(r.tipo??r.type??""),monto:Number(r.monto??r.amount??0),origen:r.origen??r.source??void 0,refId:r.refId??r.referenceId??void 0,vencimiento:r.vencimiento??r.dueDate??void 0,paidAmount:Number(r.paidAmount??0),observaciones:r.observaciones??r.observations??""}));e7(o)}catch(e){console.error("Error loading member movements for social quota analysis:",e),e7([])}}async function rG(e){rl(!0),rx("");try{let r=await c.L.authenticatedFetch(`/api/refinancing/history?memberId=${encodeURIComponent(e)}`);if(!r.ok)throw Error(`Error ${r.status}: ${r.statusText}`);let a=await r.json();a.sort((e,r)=>{let a=new Date(e.createdAt||e.updatedAt).getTime();return new Date(r.createdAt||r.updatedAt).getTime()-a}),rn(a)}catch(e){console.error("Error loading refinancings history:",e),rx(e instanceof Error?e.message:"Error al cargar el historial"),rn([])}finally{rl(!1)}}let rq=(0,s.useMemo)(()=>eq.reduce((e,r)=>e+(0,i.sU)(r.montoStr),0),[eq]),rz=(0,s.useMemo)(()=>Object.values(eW).reduce((e,r)=>e+function(e){let r="string"==typeof e?Number(e):e??0;return Number.isFinite(r)?r:0}(r),0),[eW]);async function rV(r){let a=e.find(e=>e.id===r);if(a&&window.confirm(`\xbfEliminar al socio ${a.nombres} ${a.apellidos}? Esta acci\xf3n eliminar\xe1 el socio y todos sus datos relacionados (movimientos, pagos, reservas, etc.). Esta acci\xf3n no se puede deshacer.`))try{let e=await c.L.authenticatedFetch(`/api/members/${r}?force=true`,{method:"DELETE"}),a=await e.json();console.log("Delete response:",{status:e.status,data:a}),e.ok?(rb("Socio y todos sus datos eliminados correctamente"),await rA(),setTimeout(()=>rb(""),3e3)):(rb(a.msg||"Error al eliminar socio"),setTimeout(()=>rb(""),8e3))}catch(e){console.error("Delete exception:",e),rb("Error de conexi\xf3n al eliminar socio"),setTimeout(()=>rb(""),5e3)}}async function r_(){try{if(!eO.nombres.trim()||!eO.apellidos.trim()){alert("Nombres y apellidos son obligatorios");return}if(eO.ci.trim()){let r=e.find(e=>e.ci&&e.ci.trim().toLowerCase()===eO.ci.trim().toLowerCase());if(r){let e="NO SOCIO"===r.subcategoria?"no-socio":"socio";e$(`Ya existe un ${e} registrado con la CI ${eO.ci}: ${r.nombres} ${r.apellidos} (C\xf3digo: ${r.codigo})`);return}}e$("");let r=Date.now(),a={codigo:`NS${r.toString().slice(-6)}`,nombres:eO.nombres.trim(),apellidos:eO.apellidos.trim(),ci:eO.ci.trim()||"",telefono:eO.telefono.trim()||"",email:eO.email.trim()||"",categoria:"CLIENTE",subcategoria:"NO SOCIO",estado:"ACTIVO",alta:(0,i.Ji)(),ruc:""},t=await c.L.authenticatedFetch("/api/members",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),o=await t.json();if(t.ok){await rA();let e=o.member;ek({nombres:"",apellidos:"",ci:"",telefono:"",email:""}),e$(""),eR(),W(e),ee("unified"),X(!0)}else alert(o.msg||"Error al crear no-socio")}catch(e){console.error("Error creating no-socio:",e),alert("Error de conexi\xf3n al crear no-socio")}}async function rY(r){let a=e.find(e=>e.id===r);if(a&&window.confirm(`\xbfConvertir a ${a.nombres} ${a.apellidos} de no-socio a socio? Se le asignar\xe1 un nuevo n\xfamero de socio.`))try{let e=await c.L.authenticatedFetch(`/api/members/${r}/convert-to-socio`,{method:"POST"}),a=await e.json();e.ok?(alert(`✅ ${a.message}`),await rA()):alert(a.error||"Error al convertir no-socio a socio")}catch(e){console.error("Error converting no-socio to socio:",e),alert("Error de conexi\xf3n al convertir no-socio a socio")}}(0,s.useMemo)(()=>(0,i.sU)(eY),[eY]),(0,s.useMemo)(()=>rq+rz,[rq,rz]);let rB=(0,s.useMemo)(()=>{let r=0,a=0;return e.forEach(e=>{let t=rE[e.id]?.estadoCalc??e.estado;"ATRASADO"===t?a++:"AL_DIA"===t&&r++}),{total:e.length,alDia:r,atrasados:a}},[e,rE]),rJ=(0,s.useMemo)(()=>{let r=R.toLowerCase();return e.filter(e=>{let a=!0;""!==R.trim()&&(a="codigo"===M?e.codigo.toLowerCase().includes(r):"ci"===M?!!(e.ci&&e.ci.toLowerCase().includes(r)):e.nombres.toLowerCase().includes(r)||e.apellidos.toLowerCase().includes(r));let t=rE[e.id]?.estadoCalc??e.estado,o=!G||e.categoria===G,s=!z||t===z,i=!_||e.subcategoria===_;return a&&o&&s&&i})},[e,rE,R,M,G,z,_]),rZ=Math.max(1,Math.ceil(rJ.length/rf)),rX=Math.min(ry,rZ),rQ=(rX-1)*rf,rW=e=>e.filter(e=>{let r=F.find(r=>r.id===e.servicioId);return r?.permiteAgendamiento&&e.requiereReserva}),rK=e=>e.filter(e=>{let r=F.find(r=>r.id===e.servicioId),a=r?.permiteAgendamiento&&e.requiereReserva,t=!!e.reservaVenueId;return a&&t}),r0=()=>({venueId:"",fecha:(0,i.Ji)(),inicioHora:"19:00",finHora:"03:00",observaciones:"",cedula:"",telefono:"",ruc:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:"",acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:"",cantidadPersonas:"",observacionesGenerales:"",requiereApa:!0}),r1=e=>{console.log("\uD83D\uDE80 Abriendo modal de reserva m\xfaltiple para",e.length,"conceptos"),console.log("\uD83D\uDCCB Conceptos recibidos:",e.map(e=>({id:e.id,servicio:e.concepto,tieneReservaVenueId:!!e.reservaVenueId,reservaHoraInicio:e.reservaHoraInicio,reservaHoraFin:e.reservaHoraFin,reservaHoraExtra:e.reservaHoraExtra,reservaConfiguracionIndividual:e.reservaConfiguracionIndividual})));let r=rW(e);if(console.log("\uD83C\uDFAF Conceptos que requieren reserva:",r.map(e=>e.id)),r.length<2)return;ep(r.map(e=>e.id));let a=rK(r);console.log(`🔍 Conceptos: ${r.length} requieren reserva, ${a.length} ya tienen reserva guardada`);let t=a.length>0?a[0]:null;t?console.log("\uD83D\uDD04 Cargando reserva m\xfaltiple existente:",{venue:t.reservaVenueId,fecha:t.reservaFecha,horaExtra:t.reservaHoraExtra}):console.log("❌ No se encontr\xf3 concepto con reservaVenueId"),eh({venueId:t&&t.reservaVenueId||"",fecha:t&&t.reservaFecha||(0,i.Ji)(),inicioHora:t&&t.reservaHoraInicio||"19:00",finHora:t&&t.reservaHoraFin||"03:00",observaciones:t&&t.reservaObservaciones||"",configuracionIndividual:!!t&&(()=>{let r=t.reservaConfiguracionIndividual;if(void 0===r)for(let a of e){let e=a.reservaConfiguracionIndividual;if(void 0!==e){r=e,console.log("✅ Encontrada marca de configuracionIndividual en concepto",a.id,":",r);break}}if(void 0!==r)return console.log("✅ Usando marca guardada de configuracionIndividual:",r),r;if(0===a.length)return!1;if(1===a.length)return console.log("\uD83D\uDCDD Un solo concepto = configuraci\xf3n global"),!1;let o=a.map(e=>({horaExtra:e.reservaHoraExtra||!1,cantidadHoras:e.reservaCantidadHorasExtra||"",monto:e.reservaMontoHorasExtra||""})),s=o[0],i=o.some(e=>e.horaExtra!==s.horaExtra||e.cantidadHoras!==s.cantidadHoras||e.monto!==s.monto);return console.log(`🔍 Detectando por diferencias: ${i?"Individual":"Global"}`),i})(),cedula:t?t.reservaCedula||Q?.ci||"":Q?.ci||"",telefono:t?t.reservaTelefono||Q?.telefono||"":Q?.telefono||"",ruc:t&&t.reservaRuc||"",esParaTercero:!!t&&(t.reservaEsParaTercero||!1),terceroNombre:t&&t.reservaTerceroNombre||"",terceroCedula:t&&t.reservaTerceroCedula||"",terceroTelefono:t&&t.reservaTerceroTelefono||"",terceroRuc:t&&t.reservaTerceroRuc||"",horaExtra:!!t&&(t.reservaHoraExtra||!1),cantidadHorasExtra:t&&t.reservaCantidadHorasExtra||"",montoHorasExtra:t&&t.reservaMontoHorasExtra||"",acontecimiento:t&&t.reservaAcontecimiento||"",quinceaneraFocusNombre:t&&t.reservaQuinceaneraFocusNombre||"",noviosNombres:t&&t.reservaNoviosNombres||"",cumpleaneroNombre:t&&t.reservaCumpleaneroNombre||"",otrosDescripcion:t&&t.reservaOtrosDescripcion||"",otrosNombrePersona:t&&t.reservaOtrosNombrePersona||"",cantidadPersonas:t&&t.reservaCantidadPersonas||"",observacionesGenerales:t&&t.reservaObservacionesGenerales||"",requiereApa:!t||void 0===t.requiereApa||t.requiereApa,configuracionesIndividuales:t?(()=>{let o={},s=t.reservaConfiguracionIndividual;if(void 0===s)for(let r of e){let e=r.reservaConfiguracionIndividual;if(void 0!==e){s=e,console.log("\uD83D\uDD0D Encontrada marca de configuracionIndividual en concepto",r.id,":",s);break}}let i=!1;if(console.log("\uD83D\uDD0D Cargando configuraciones individuales:",{marcaGuardada:s,conceptosConReserva:r.length,conceptosConReservaExistente:a.length,todosLosConceptos:e.map(e=>({id:e.id,tieneReservaVenueId:!!e.reservaVenueId,inicioHora:e.reservaHoraInicio,finHora:e.reservaHoraFin,horaExtra:e.reservaHoraExtra,cantidadHoras:e.reservaCantidadHorasExtra,monto:e.reservaMontoHorasExtra}))}),void 0!==s)i=s,console.log("✅ Usando marca guardada de configuracionIndividual:",s);else if(a.length>1){let e=a.map(e=>({horaExtra:e.reservaHoraExtra||!1,cantidadHoras:e.reservaCantidadHorasExtra||"",monto:e.reservaMontoHorasExtra||""})),r=e[0];console.log("\uD83D\uDD0D Detectando por diferencias:",{hayDiferencias:i=e.some(e=>e.horaExtra!==r.horaExtra||e.cantidadHoras!==r.cantidadHoras||e.monto!==r.monto),configuraciones:e})}return i?(r.forEach(r=>{let a=e.find(e=>e.id===r.id);a&&(a.reservaHoraInicio||a.reservaHoraFin||a.reservaHoraExtra||a.reservaCantidadHorasExtra||a.reservaMontoHorasExtra)?(o[r.id]={inicioHora:a.reservaHoraInicio||"19:00",finHora:a.reservaHoraFin||"03:00",horaExtra:a.reservaHoraExtra||!1,cantidadHorasExtra:a.reservaCantidadHorasExtra||"",montoHorasExtra:a.reservaMontoHorasExtra||""},console.log(`✅ Cargando config guardada para concepto ${r.id}:`,o[r.id])):(o[r.id]={inicioHora:"19:00",finHora:"03:00",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""},console.log(`🆕 Usando config por defecto para concepto ${r.id}`))}),console.log("\uD83D\uDCCB Configuraciones individuales cargadas para",Object.keys(o).length,"conceptos:",o)):console.log("\uD83C\uDF10 Usando configuraci\xf3n global"),o})():{}}),em(!0)},r2=()=>{let e=[];if(eg.fecha){let r=new Date(eg.fecha+"T00:00:00-03:00"),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),a.getDate());new Date(r.getFullYear(),r.getMonth(),r.getDate())<t&&e.push("La fecha no puede ser anterior a hoy")}else e.push("Debe seleccionar una fecha");if(eg.inicioHora&&eg.finHora){let r=eg.inicioHora,a=eg.finHora,[t,o]=r.split(":").map(Number),[s,i]=a.split(":").map(Number),n=60*t+o,c=60*s+i;n===c&&e.push("La hora de inicio y fin no pueden ser iguales");let l=c-n;l<=0&&(l+=1440),l<60&&e.push("El evento debe tener una duraci\xf3n m\xednima de 1 hora")}else e.push("Debe especificar hora de inicio y fin");return eg.acontecimiento||e.push("Debe seleccionar un acontecimiento"),"15_anos"!==eg.acontecimiento||eg.quinceaneraFocusNombre.trim()||e.push("Debe ingresar el nombre de la quincea\xf1era"),"boda"!==eg.acontecimiento||eg.noviosNombres.trim()||e.push("Debe ingresar los nombres de los novios"),"cumpleanos"!==eg.acontecimiento||eg.cumpleaneroNombre.trim()||e.push("Debe ingresar el nombre del cumplea\xf1er@"),"otros"!==eg.acontecimiento||eg.otrosDescripcion.trim()||e.push("Debe ingresar la descripci\xf3n del acontecimiento"),e},r5=rQ+rf,r3=rJ.slice(rQ,r5),r4=async()=>{try{let e=rJ.map(e=>e.id).join(","),r=await c.L.authenticatedFetch(`/api/members/export?format=excel&ids=${encodeURIComponent(e)}`),a=await r.blob(),t=window.URL.createObjectURL(a),o=document.createElement("a");o.href=t,o.download=`socios-${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(t),document.body.removeChild(o)}catch(e){console.error("Error exporting to Excel:",e)}},r6=({estado:e})=>t.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-medium border ${(()=>{switch(e){case"AL_DIA":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"ATRASADO":return"bg-amber-50 text-amber-700 border-amber-200";case"SUSPENDIDO":return"bg-rose-50 text-rose-700 border-rose-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}})()}`,children:"AL_DIA"===e?"Al D\xeda":"ATRASADO"===e?"Atrasado":"SUSPENDIDO"===e?"Suspendido":e});if(H)return t.jsx(o.Z,{children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-400"})})});let r7=()=>{if(!eb.fecha)return!1;eb.condicion;let e=eb.conceptos||[];if(!e||0===e.length)return!1;if(e.length>0){for(let r of e){if(!r.servicioId)return!1;let e=parseFloat(C(r.monto));if(isNaN(e)||e<=0||"DIARIO"===r.tipoServicio&&(!r.dias||r.dias<=0))return!1}if(function(e){if(!e)return!1;let r=new Set;for(let a of e)if(a.servicioId&&!a.requiereReserva){if(r.has(a.servicioId))return!0;r.add(a.servicioId)}return!1}(e))return!1}if("CONTADO"===eb.condicion){if(!eb.metodoPago||!eb.cobradorId)return!1}else if("CREDITO"===eb.condicion&&eb.permitirPagosParc){if(!eb.pagoAplicado)return!1;let e=parseFloat(ar(eb.pagoAplicado));if(isNaN(e)||e<=0||e>(D(eb.conceptos)||parseFloat(ar(eb.monto||"0")))||!eb.metodoPago)return!1}return!0},r8=async()=>{if(eT(!0),!Q||!r7())return;let e=eb.conceptos||[],r=[];for(let a of e)if(a.servicioId&&"UNICO"!==a.tipoServicio){let e=await rP(Q.id,a.servicioId);if(e){let t=F.find(e=>e.id===a.servicioId),o=t?.nombre||"Servicio",s=e.nextChargeDate?(0,i.p6)(e.nextChargeDate):"N/A";r.push(`ℹ️ ${o}: Suscripci\xf3n activa (vence: ${s})`)}}if(r.length>0){let e="\uD83D\uDCCB Informaci\xf3n de Suscripciones:\n\n"+r.join("\n")+"\n\n✅ Este pago se registrar\xe1 normalmente y las fechas de vencimiento se actualizar\xe1n autom\xe1ticamente sumando el per\xedodo correspondiente.\n\n\xbfDeseas continuar?";if(!window.confirm(e)){rg(!1);return}}rg(!0);try{let r=[];for(let a of e){let e=parseFloat(C(a.monto)),t=a.tipoServicio,o="ANUAL"===t?365:"MENSUAL"===t?30:a.dias||1;if((a.crearSuscripcion||eb.crearSuscripcion)&&"UNICO"!==t&&!await rP(Q.id,a.servicioId)){let r=await c.L.authenticatedFetch(`/api/members/${encodeURIComponent(Q.id)}/subscriptions`,{method:"POST",body:JSON.stringify({serviceId:a.servicioId,periodicity:t,price:e,autoDebit:!1,notes:`Creado desde formulario unificado el ${eb.fecha}`,validUntil:a.vencimiento||A(eb.fecha,o)})}),s=await r.json().catch(()=>({}));if(!r.ok)throw Error(s?.msg||"No se pudo crear la suscripci\xf3n")}let s=await c.L.authenticatedFetch("/api/movements",{method:"POST",body:JSON.stringify({memberId:Q.id,fecha:eb.fecha,concepto:`${a.concepto||"Servicio"}${"UNICO"!==t?` (${t})`:""}`,tipo:"DEBIT",monto:Number(e),origen:"SERVICIO",refId:a.servicioId,observaciones:a.observaciones||eb.observaciones||`Pago contado - ${eb.metodoPago}`,vencimiento:"UNICO"===t?eb.fecha:a.vencimiento||A(eb.fecha,o)})}),i=await s.json().catch(()=>({}));if(!s.ok)throw Error(i?.msg||"No se pudo crear el d\xe9bito del servicio");let n=String(i.id??i?.movement?.id??"");r.push({id:n,amount:e,conceptoName:a.concepto||"Servicio",conceptoId:a.id,relatedToReservaConceptId:a.relatedToReservaConceptId||void 0})}let a=r.reduce((e,r)=>e+r.amount,0),t=r.map(e=>({debitId:e.id,amount:e.amount})),o=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:Q.id,fecha:eb.fecha,monto:a,concepto:`Pago contado: ${r.map(e=>e.conceptoName).join(", ")}`,formaPago:eb.metodoPago,cobradorId:eb.cobradorId||void 0,numeroRecibo:eb.numeroRecibo||void 0,observaciones:eb.observaciones||"",allocations:t})}),s=await o.json().catch(()=>({}));if(!o.ok)throw Error(s?.msg||"No se pudo crear el pago");if(String(s.id??s?.payment?.id??""),eb.presupuestoDeudas&&parseFloat(ar(eb.presupuestoDeudas))>0){let e=parseFloat(ar(eb.presupuestoDeudas)),a=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:Q.id,fecha:eb.fecha,monto:e,concepto:`Pago de deudas pendientes - ${r&&r.length?r.map(e=>e.conceptoName).join(", "):eb.concepto||""}`,formaPago:eb.metodoPago,cobradorId:eb.cobradorId||"",numeroRecibo:eb.numeroRecibo||"",observaciones:`Asignaci\xf3n autom\xe1tica a deudas pendientes. ${eb.observaciones||""}`.trim()})}),t=await a.json().catch(()=>({}));a.ok||console.warn("No se pudo procesar el pago de deudas:",t?.msg)}let i=[];for(let a of e)if(a.reservaVenueId&&a.reservaFecha)try{let e=new Date(`${a.reservaFecha}T${a.reservaHoraInicio||"19:00"}:00`),t=a.reservaFechaFin||a.reservaFecha,o=new Date(`${t}T${a.reservaHoraFin||"23:00"}:00`);o<=e&&!a.reservaFechaFin&&o.setDate(o.getDate()+1);let s={resourceId:a.reservaVenueId,memberId:Q.id,start:e.toISOString(),end:o.toISOString(),nombreContacto:`${Q.nombres} ${Q.apellidos}`,contacto:Q.celular||Q.telefono||"",medioContacto:Q.celular?"whatsapp":"telefono",invitados:0,adelanto:0,montoTotal:function(){let e=parseFloat(C(a.monto))||0,r=a.reservaMontoHorasExtra?Number(C(a.reservaMontoHorasExtra)):0;return e+r}(),status:"ACTIVO",notas:a.reservaObservaciones||a.observaciones||"",createdBy:"system",acontecimiento:a.reservaAcontecimiento||void 0,quinceaneraFocusNombre:a.reservaQuinceaneraFocusNombre||void 0,noviosNombres:a.reservaNoviosNombres||void 0,cumpleaneroNombre:a.reservaCumpleaneroNombre||void 0,otrosDescripcion:a.reservaOtrosDescripcion||void 0,otrosNombrePersona:a.reservaOtrosNombrePersona||void 0,esParaTercero:a.reservaEsParaTercero||void 0,terceroNombre:a.reservaTerceroNombre||void 0,terceroCedula:a.reservaTerceroCedula||void 0,terceroTelefono:a.reservaTerceroTelefono||void 0,terceroRuc:a.reservaTerceroRuc||void 0,cantidadPersonas:a.reservaCantidadPersonas?Number(a.reservaCantidadPersonas):void 0,observacionesGenerales:a.reservaObservacionesGenerales||void 0,horaExtra:a.reservaHoraExtra||void 0,cantidadHorasExtra:a.reservaCantidadHorasExtra?Number(a.reservaCantidadHorasExtra):void 0,montoHorasExtra:a.reservaMontoHorasExtra?Number(C(a.reservaMontoHorasExtra)):void 0,requiereApa:a.requiereApa||void 0,apaEstado:a.requiereApa?"PENDIENTE":void 0,debitMovementIds:function(){let e=r.filter(e=>e.conceptoId===a.id||e.relatedToReservaConceptId===a.id).map(e=>e.id);return e.length?e:void 0}(),debitMovementId:r.find(e=>e.conceptoId===a.id||e.relatedToReservaConceptId===a.id)?.id||void 0},n=await c.L.authenticatedFetch("/api/reservas",{method:"POST",body:JSON.stringify(s)});if(n.ok)await n.json(),i.push(`${a.concepto||"Reserva"} (${a.reservaFecha})`);else{let e=await n.text(),r=e;try{r=JSON.parse(e).msg||e}catch(e){}console.error(`❌ No se pudo crear la reserva para ${a.concepto}:`,r),alert(`⚠️ Error procesando reserva

No se pudo crear la reserva para "${a.concepto}".

${r}

El pago no se procesar\xe1. Por favor verifique la disponibilidad del horario.`);return}}catch(e){console.error(`Error creando reserva para ${a.concepto}:`,e),alert(`⚠️ Error inesperado

Error creando reserva para "${a.concepto}": ${e}

El pago no se procesar\xe1.`);return}let n=eb.presupuestoDeudas&&parseFloat(ar(eb.presupuestoDeudas))>0?` y se asignaron Gs. ${parseInt(ar(eb.presupuestoDeudas)).toLocaleString("es-PY")} a deudas pendientes`:"",l=i.length>0?`

🎯 Reservas creadas:
${i.join("\n")}`:"";alert(`✅ Pago al contado registrado exitosamente${n}${l}`),rk(),await rA()}catch(e){console.error("Error al procesar pago contado:",e),alert(`❌ Error: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{rg(!1)}},r9=async()=>{if(eT(!0),!Q||!r7())return;let e=eb.conceptos||[],r=[];for(let a of e)if(a.servicioId&&"UNICO"!==a.tipoServicio){let e=await rP(Q.id,a.servicioId);if(e){let t=F.find(e=>e.id===a.servicioId),o=t?.nombre||"Servicio",s=e.nextChargeDate?(0,i.p6)(e.nextChargeDate):"N/A";r.push(`ℹ️ ${o}: Suscripci\xf3n activa (vence: ${s})`)}}if(r.length>0){let e="\uD83D\uDCCB Informaci\xf3n de Suscripciones:\n\n"+r.join("\n")+"\n\n✅ El d\xe9bito se registrar\xe1 normalmente. Cuando se pague, las fechas de vencimiento se actualizar\xe1n autom\xe1ticamente sumando el per\xedodo correspondiente.\n\n\xbfDeseas continuar?";if(!window.confirm(e)){rg(!1);return}}rg(!0);try{let r=[];for(let a of e){let e=parseFloat(C(a.monto)),t=a.tipoServicio,o="ANUAL"===t?365:"MENSUAL"===t?30:a.dias||1;if((a.crearSuscripcion||eb.crearSuscripcion)&&"UNICO"!==t&&!await rP(Q.id,a.servicioId)){let r=await c.L.authenticatedFetch(`/api/members/${encodeURIComponent(Q.id)}/subscriptions`,{method:"POST",body:JSON.stringify({serviceId:a.servicioId,periodicity:t,price:e,autoDebit:!1,notes:`Creado desde formulario unificado el ${eb.fecha}`,validUntil:a.vencimiento||A(eb.fecha,o)})}),s=await r.json().catch(()=>({}));if(!r.ok)throw Error(s?.msg||"No se pudo crear la suscripci\xf3n")}let s=await c.L.authenticatedFetch("/api/movements",{method:"POST",body:JSON.stringify({memberId:Q.id,fecha:eb.fecha,concepto:`${a.concepto||"Servicio"}${"UNICO"!==t?` (${t})`:""}`,tipo:"DEBIT",monto:Number(e),origen:"SERVICIO",refId:a.servicioId,observaciones:a.observaciones||eb.observaciones||"Servicio a cr\xe9dito",vencimiento:"UNICO"===t?eb.fecha:a.vencimiento||A(eb.fecha,o)})}),i=await s.json().catch(()=>({}));if(!s.ok)throw Error(i?.msg||"No se pudo crear el d\xe9bito del servicio");let n=String(i.id??i?.movement?.id??"");r.push({id:n,amount:e,conceptoName:a.concepto||"Servicio",conceptoId:a.id,relatedToReservaConceptId:a.relatedToReservaConceptId||void 0})}if(eb.permitirPagosParc&&eb.pagoAplicado&&eb.metodoPago){let e=parseFloat(ar(eb.pagoAplicado)),a=[];for(let t of r){if(e<=0)break;let r=Math.min(e,t.amount);a.push({debitId:t.id,amount:r}),e-=r}if(a.length>0){let e=a.reduce((e,r)=>e+r.amount,0),t=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:Q.id,fecha:eb.fecha,monto:e,concepto:`Pago parcial: ${r.map(e=>e.conceptoName).join(", ")}`,formaPago:eb.metodoPago,cobradorId:eb.cobradorId||"",numeroRecibo:eb.referencia||"",observaciones:eb.observaciones||"",allocations:a})}),o=await t.json().catch(()=>({}));if(!t.ok)throw Error(o?.msg||"No se pudo crear el pago parcial")}}if(eb.presupuestoDeudas&&parseFloat(ar(eb.presupuestoDeudas))>0){let e=parseFloat(ar(eb.presupuestoDeudas)),a=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify({memberId:Q.id,fecha:eb.fecha,monto:e,concepto:`Pago de deudas pendientes - ${r&&r.length?r.map(e=>e.conceptoName).join(", "):eb.concepto||""}`,formaPago:eb.permitirPagosParc?eb.metodoPago:"EFECTIVO",cobradorId:"",numeroRecibo:"",observaciones:`Asignaci\xf3n autom\xe1tica a deudas pendientes. ${eb.observaciones||""}`.trim()})}),t=await a.json().catch(()=>({}));a.ok||console.warn("No se pudo procesar el pago de deudas:",t?.msg)}let a=[];for(let t of e)if(t.reservaVenueId&&t.reservaFecha)try{let e=new Date(`${t.reservaFecha}T${t.reservaHoraInicio||"19:00"}:00`),o=t.reservaFechaFin||t.reservaFecha,s=new Date(`${o}T${t.reservaHoraFin||"23:00"}:00`);s<=e&&!t.reservaFechaFin&&s.setDate(s.getDate()+1);let i={resourceId:t.reservaVenueId,memberId:Q.id,start:e.toISOString(),end:s.toISOString(),nombreContacto:`${Q.nombres} ${Q.apellidos}`,contacto:Q.celular||Q.telefono||"",medioContacto:Q.celular?"whatsapp":"telefono",invitados:0,adelanto:0,montoTotal:function(){let e=parseFloat(C(t.monto))||0,r=t.reservaMontoHorasExtra?Number(C(t.reservaMontoHorasExtra)):0;return e+r}(),status:"ACTIVO",notas:t.reservaObservaciones||t.observaciones||"",createdBy:"system",acontecimiento:t.reservaAcontecimiento||void 0,quinceaneraFocusNombre:t.reservaQuinceaneraFocusNombre||void 0,noviosNombres:t.reservaNoviosNombres||void 0,cumpleaneroNombre:t.reservaCumpleaneroNombre||void 0,otrosDescripcion:t.reservaOtrosDescripcion||void 0,otrosNombrePersona:t.reservaOtrosNombrePersona||void 0,esParaTercero:t.reservaEsParaTercero||void 0,terceroNombre:t.reservaTerceroNombre||void 0,terceroCedula:t.reservaTerceroCedula||void 0,terceroTelefono:t.reservaTerceroTelefono||void 0,terceroRuc:t.reservaTerceroRuc||void 0,cantidadPersonas:t.reservaCantidadPersonas?Number(t.reservaCantidadPersonas):void 0,observacionesGenerales:t.reservaObservacionesGenerales||void 0,horaExtra:t.reservaHoraExtra||void 0,cantidadHorasExtra:t.reservaCantidadHorasExtra?Number(t.reservaCantidadHorasExtra):void 0,montoHorasExtra:t.reservaMontoHorasExtra?Number(C(t.reservaMontoHorasExtra)):void 0,requiereApa:t.requiereApa||void 0,apaEstado:t.requiereApa?"PENDIENTE":void 0,debitMovementIds:function(){let e=r.filter(e=>e.conceptoId===t.id||e.relatedToReservaConceptId===t.id).map(e=>e.id);return e.length?e:void 0}(),debitMovementId:r.find(e=>e.conceptoId===t.id||e.relatedToReservaConceptId===t.id)?.id||void 0},n=await c.L.authenticatedFetch("/api/reservas",{method:"POST",body:JSON.stringify(i)});if(n.ok)await n.json(),a.push(`${t.concepto||"Reserva"} (${t.reservaFecha})`);else{let e=await n.text(),r=e;try{r=JSON.parse(e).msg||e}catch(e){}console.error(`❌ No se pudo crear la reserva para ${t.concepto}:`,r),alert(`⚠️ Error procesando reserva

No se pudo crear la reserva para "${t.concepto}".

${r}

El pago no se procesar\xe1. Por favor verifique la disponibilidad del horario.`);return}}catch(e){console.error(`Error creando reserva para ${t.concepto}:`,e),alert(`⚠️ Error inesperado

Error creando reserva para "${t.concepto}": ${e}

El pago no se procesar\xe1.`);return}let t=eb.permitirPagosParc&&eb.pagoAplicado?"✅ Servicio a cr\xe9dito con pago parcial registrado exitosamente":"✅ Servicio a cr\xe9dito registrado exitosamente",o=eb.presupuestoDeudas&&parseFloat(ar(eb.presupuestoDeudas))>0?` y se asignaron Gs. ${parseInt(ar(eb.presupuestoDeudas)).toLocaleString("es-PY")} a deudas pendientes`:"",s=a.length>0?`

🎯 Reservas creadas:
${a.join("\n")}`:"";alert(`${t}${o}${s}`),rk(),await rA()}catch(e){console.error("Error al procesar servicio a cr\xe9dito:",e),alert(`❌ Error: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{rg(!1)}},ae=e=>{let r=e.replace(/[^\d]/g,"");return r?parseInt(r).toLocaleString("es-PY").replace(/,/g,"."):""},ar=e=>e.replace(/\./g,""),aa=(e,r)=>{let a;let t={...e2};if(r){a=[...e0,e];let r=e2[e];if(!(r&&parseInt(ar(r))>0)){let r=eX.find(r=>r.id===e);if(r){let a=(r.monto||0)-(r.paidAmount||0);t[e]=ae(a.toString())}}if(0===e0.length&&!rm.fecha){let e=(0,i.Ji)();ru(r=>({...r,fecha:e}))}}else a=e0.filter(r=>r!==e),delete t[e];e1(a),e5(t);let o=a.reduce((e,r)=>{let a=t[r];if(a){let r=parseInt(ar(a));return e+(isNaN(r)?0:r)}return e},0),s=o>0?ae(o.toString()):"";ef(e=>({...e,presupuestoDeudas:s})),ru(e=>({...e,montoAPagar:s}))},at=(e,r)=>{let a=eX.find(r=>r.id===e);if(!a)return;let t=(a.monto||0)-(a.paidAmount||0),o=parseInt(ar(r))||0;if(o>t){alert(`El monto no puede ser mayor al saldo pendiente: Gs. ${t.toLocaleString("es-PY")}`);return}let s={...e2,[e]:ae(o.toString())};e5(s);let n=[...e0];if(o>0&&!e0.includes(e)){if(e1(n=[...e0,e]),0===e0.length&&!rm.fecha){let e=(0,i.Ji)();ru(r=>({...r,fecha:e}))}}else 0===o&&e0.includes(e)&&e1(n=e0.filter(r=>r!==e));let c=n.reduce((e,r)=>{let a=s[r];if(a){let r=parseInt(ar(a));return e+(isNaN(r)?0:r)}return e},0),l=c>0?ae(c.toString()):"";ef(e=>({...e,presupuestoDeudas:l})),ru(e=>({...e,montoAPagar:l}))},ao=()=>e0.reduce((e,r)=>{let a=eX.find(e=>e.id===r);return a?e+((a.monto||0)-(a.paidAmount||0)):e},0);return(0,t.jsxs)(o.Z,{children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Gesti\xf3n de Socios"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Administra la informaci\xf3n de los socios del club"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-lg border border-gray-200 shadow-sm",children:[t.jsx("span",{className:"text-lg font-semibold text-gray-900",children:rB.total}),t.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"Total Socios"})]}),(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-lg border border-gray-200 shadow-sm",children:[t.jsx("span",{className:"text-lg font-semibold text-emerald-700",children:rB.alDia}),t.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"Al D\xeda"})]}),(0,t.jsxs)("div",{className:"bg-white px-3 py-2 rounded-lg border border-gray-200 shadow-sm",children:[t.jsx("span",{className:"text-lg font-semibold text-amber-700",children:rB.atrasados}),t.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"Atrasados"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:r4,className:"bg-white text-gray-700 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center gap-2 shadow-sm",children:[t.jsx(d.Z,{className:"w-4 h-4"}),"Exportar"]}),(0,t.jsxs)("button",{onClick:()=>eP(!0),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 flex items-center gap-2 shadow-sm",children:[t.jsx(x.Z,{className:"w-4 h-4"}),"Cobrar (No socio)"]}),(0,t.jsxs)(f.default,{href:"/admin/socios/nuevo",className:"bg-custom-blue text-white px-4 py-2 rounded-lg hover:bg-custom-blue flex items-center gap-2 shadow-sm",children:[t.jsx(m.Z,{className:"w-4 h-4"}),"Nuevo Socio"]})]})]})]}),t.jsx("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end",children:[(0,t.jsxs)("div",{className:"md:col-span-5",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Buscar"}),(0,t.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[t.jsx("div",{className:"relative w-2/5",children:(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:M,onChange:e=>{U(e.target.value),rN(1)},children:[t.jsx("option",{value:"codigo",children:"Nro. de socio"}),t.jsx("option",{value:"ci",children:"C\xe9dula"}),t.jsx("option",{value:"nombre",children:"Nombre y Apellido"})]})}),(0,t.jsxs)("div",{className:"relative w-3/5",children:[t.jsx(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("input",{type:"text",placeholder:"codigo"===M?"Ej: 1234":"ci"===M?"Ej: 1234567":"Nombre o Apellido...",className:"w-full h-[42px] pl-10 pr-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700",value:R,onChange:e=>{L(e.target.value),rN(1)}})]})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Categor\xeda"}),(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:G,onChange:e=>{q(e.target.value),rN(1)},children:[t.jsx("option",{value:"",children:"Todas"}),t.jsx("option",{value:"Individual",children:"Individual"}),t.jsx("option",{value:"Familiar",children:"Familiar"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Subcategor\xeda"}),(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:_,onChange:e=>{Y(e.target.value),rN(1)},children:[t.jsx("option",{value:"",children:"Todas"}),t.jsx("option",{value:"SOCIO",children:"Socio"}),t.jsx("option",{value:"NO SOCIO",children:"No Socio"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estado"}),(0,t.jsxs)("select",{className:"w-full h-[42px] px-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-700 focus:border-gray-700 text-sm",value:z,onChange:e=>{V(e.target.value),rN(1)},children:[t.jsx("option",{value:"",children:"Todos"}),t.jsx("option",{value:"AL_DIA",children:"Al D\xeda"}),t.jsx("option",{value:"ATRASADO",children:"Atrasado"}),t.jsx("option",{value:"SUSPENDIDO",children:"Suspendido"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-1",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"\xa0"}),t.jsx("button",{onClick:()=>{L(""),U("nombre"),q(""),V(""),Y(""),rN(1)},className:"w-full h-[42px] px-1 border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 text-xs",title:"Limpiar todos los filtros",children:"Limpiar"})]})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[t.jsx("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Socio"}),t.jsx("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Categor\xeda"}),t.jsx("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Estado"}),t.jsx("th",{className:"px-6 py-4 text-left text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Deuda"}),t.jsx("th",{className:"px-6 py-4 text-center text-[11px] font-semibold text-gray-500 uppercase tracking-wider"}),t.jsx("th",{className:"px-6 py-4 text-right text-[11px] font-semibold text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r3.map(e=>{let r=rE[e.id]?.saldo??e.deudaTotal??0,a=rE[e.id]?.estadoCalc??e.estado;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50/60",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.foto?t.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:e.foto,alt:`${e.nombres} ${e.apellidos}`,onError:e=>{e.currentTarget.src="/avatar-placeholder.png"}}):t.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center border border-gray-200",children:t.jsx(p.Z,{className:"w-5 h-5 text-gray-400"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.nombres," ",e.apellidos]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.codigo," • CI: ",ae(String(e.ci||""))]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"flex items-center text-sm text-gray-900",children:"NO SOCIO"===e.subcategoria?t.jsx("span",{children:"No Socio"}):(0,t.jsxs)(t.Fragment,{children:["Individual"===e.categoria?"\uD83D\uDC64":"Familiar"===e.categoria?"\uD83D\uDC65":"\uD83D\uDC64"," ",t.jsx("span",{className:"ml-1",children:e.subcategoria})]})})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx(r6,{estado:a})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:`text-sm font-medium ${r>0?"text-amber-700":"text-gray-900"}`,children:(0,i.xG)(Math.max(0,r))})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("button",{onClick:()=>rO(e),className:"bg-emerald-600 text-white px-3 py-1.5 rounded-md text-sm hover:bg-emerald-700 shadow-sm",children:"Cobrar"})}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[t.jsx("button",{onClick:r=>(function(e,r){if(rj===e){rC(null);return}let a=r.currentTarget.getBoundingClientRect();rw({x:a.left-200,y:a.top}),rI.current=r.currentTarget,rC(e)})(e.id,r),className:"text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100",title:"M\xe1s acciones",children:t.jsx(g.Z,{className:"w-5 h-5"})}),rj===e.id&&(0,t.jsxs)("div",{className:"fixed z-50 w-48 bg-white rounded-md shadow-lg border border-gray-200 py-1",style:{left:`${rD.x}px`,top:`${rD.y}px`},children:[(0,t.jsxs)(f.default,{href:`/admin/socios/${e.id}`,className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>rC(null),children:[t.jsx(p.Z,{className:"w-4 h-4 mr-2"}),"Ver Detalles"]}),"NO SOCIO"===e.subcategoria&&(0,t.jsxs)("button",{onClick:()=>{rY(e.id),rC(null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-emerald-700 hover:bg-emerald-50",children:[t.jsx(h,{className:"w-4 h-4 mr-2"}),"Convertir a Socio"]}),(0,t.jsxs)("button",{onClick:()=>{rV(e.id),rC(null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-rose-600 hover:bg-rose-50",children:[t.jsx(b.Z,{className:"w-4 h-4 mr-2"}),"Eliminar"]})]})]})]},e.id)})})]})}),rJ.length>0&&(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 p-6 border-t border-gray-200 bg-gray-50/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Filas por p\xe1gina:"}),(0,t.jsxs)("select",{value:rf,onChange:e=>{rv(Number(e.target.value)),rN(1)},className:"px-2 py-1.5 border border-gray-300 rounded text-sm",children:[t.jsx("option",{value:10,children:"10"}),t.jsx("option",{value:20,children:"20"}),t.jsx("option",{value:50,children:"50"}),t.jsx("option",{value:100,children:"100"})]})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Mostrando ",rQ+1,"–",Math.min(r5,rJ.length)," de ",rJ.length]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>rN(e=>Math.max(1,e-1)),className:"px-3 py-1.5 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",disabled:rX<=1,children:"Anterior"}),(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",rX," de ",rZ]}),t.jsx("button",{onClick:()=>rN(e=>Math.min(rZ,e+1)),className:"px-3 py-1.5 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",disabled:rX>=rZ,children:"Siguiente"})]})]}),t.jsx("div",{style:{height:25},"aria-hidden":"true"})]})]}),eF&&t.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true","aria-labelledby":"modal-no-socio-title",children:t.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-auto",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{id:"modal-no-socio-title",className:"text-xl font-semibold text-gray-900",children:"Registro No-Socio"}),t.jsx("button",{onClick:eR,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombres *"}),t.jsx("input",{type:"text",value:eO.nombres,onChange:e=>ek(r=>({...r,nombres:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ingrese nombres",required:!0})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos *"}),t.jsx("input",{type:"text",value:eO.apellidos,onChange:e=>ek(r=>({...r,apellidos:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ingrese apellidos",required:!0})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CI"}),t.jsx("input",{type:"text",value:eO.ci,onChange:r=>{let a=r.target.value;if(ek(e=>({...e,ci:a})),a.trim()){let r=e.find(e=>e.ci&&e.ci.trim().toLowerCase()===a.trim().toLowerCase());if(r){let e="NO SOCIO"===r.subcategoria?"no-socio":"socio";e$(`Ya existe un ${e} registrado con esta CI: ${r.nombres} ${r.apellidos} (${r.codigo})`)}else e$("")}else e$("")},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 ${eH?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"C\xe9dula de identidad"}),eH&&(0,t.jsxs)("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[t.jsx("svg",{className:"w-4 h-4 mr-1 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),eH]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),t.jsx("input",{type:"tel",value:eO.telefono,onChange:e=>ek(r=>({...r,telefono:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"N\xfamero de tel\xe9fono"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),t.jsx("input",{type:"email",value:eO.email,onChange:e=>ek(r=>({...r,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Correo electr\xf3nico"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:eR,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),(0,t.jsxs)("button",{onClick:r_,disabled:!eO.nombres.trim()||!eO.apellidos.trim()||!!eH,className:"flex-1 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[t.jsx(x.Z,{className:"w-4 h-4"}),"Crear y Cobrar"]})]})]})})}),Z&&t.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true","aria-labelledby":"modal-pago-unificado-title",children:t.jsx("div",{className:"w-full max-w-7xl max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{id:"modal-pago-unificado-title",className:"text-lg font-semibold text-gray-900",children:"Cobranza"}),Q&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[(0,t.jsxs)("span",{className:"font-medium",children:[Q.nombres," ",Q.apellidos]}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:Q.codigo})]})]}),Q&&t.jsx("button",{onClick:()=>{rr(Q),e9(!0),rM(Q.id);let e=(0,i.Ji)(),r=rT(),a=r?.id||"";ru(r=>({...r,fecha:e,cobradorId:a}))},className:"px-3 py-1.5 text-sm text-amber-700 hover:underline transition-colors border border-amber-200 rounded-md",children:"Deudas Pendientes"})]}),t.jsx("button",{onClick:rk,className:"text-gray-400 hover:text-gray-600",children:t.jsx(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[t.jsx("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:t.jsx("table",{className:"w-full",children:t.jsx("tbody",{children:(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"align-top pr-3",style:{width:"15%"},children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fecha de cobro o servicio*"}),t.jsx("input",{type:"date",value:eb.fecha,onChange:e=>{var r;let a;return a=r=e.target.value,void(r&&(a=r.split("T")[0]),ef(e=>({...e,fecha:a,conceptos:((e=[])=>e.map(e=>E(e,a,e.tipoServicio)))(e.conceptos)})))},className:"w-44 px-3 min-h-[42px] py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800"}),eA&&!eb.fecha&&t.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Fecha requerida"})]}),(0,t.jsxs)("td",{className:"align-top pr-3",style:{width:"65%"},children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observaciones"}),t.jsx("textarea",{value:eb.observaciones,onChange:e=>ef(r=>({...r,observaciones:e.target.value})),className:"w-full px-3 h-[42px] border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-gray-800 resize-none",placeholder:"Observaciones adicionales..."})]}),(0,t.jsxs)("td",{className:"align-top",style:{width:"20%"},children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Condici\xf3n"}),(0,t.jsxs)("div",{className:"flex items-center gap-4 h-full",style:{minHeight:"42px",alignItems:"center"},children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"condicion",value:"CONTADO",checked:"CONTADO"===eb.condicion,onChange:()=>{eT(!1),ef(e=>({...e,condicion:"CONTADO",pagoAplicado:e.monto}))},className:"w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Al Contado"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"condicion",value:"CREDITO",checked:"CREDITO"===eb.condicion,onChange:()=>{eT(!1),ef(e=>({...e,condicion:"CREDITO",pagoAplicado:""}))},className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"A Cr\xe9dito"})]})]})]})]})})})}),"CONTADO"===eb.condicion&&(0,t.jsxs)("div",{className:"rounded-xl p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:"Pago Inmediato (Contado)"}),t.jsx(y,{conceptos:ew(),services:F,selectedMember:Q,showFormValidation:eA,vencimientoDefault:eb.vencimiento,onAddConcepto:()=>ej("CONTADO"),onUpdateConcepto:(e,r,a)=>eD("CONTADO",e,r,a),onRemoveConcepto:e=>eC("CONTADO",e),formatNumberWithSeparator:ae,getNumericValueSafe:C,isServiceDuplicate:(e,r)=>w(e,r,F),onServiceSelection:eI,title:"Conceptos a pagar",buttonColor:"bg-green-600",onOpenReservaModal:rH,modoReservaUnica:en,onToggleModoReserva:()=>ec(!en),canShowMultiReserva:rW(ew()).length>=2,conceptosConReservaCount:rW(ew()).length}),rW(ew()).length>=2&&en&&t.jsx("div",{className:"mb-4 flex justify-center",children:(0,t.jsxs)("button",{type:"button",onClick:()=>{ef(e=>(r1(e.conceptos||[]),e))},className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm shadow-sm",children:[rW(ew()).some(e=>e.reservaFechaHora)?"Editar reservaci\xf3n":"Crear reserva",t.jsx("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:rW(ew()).length})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"M\xe9todo de Pago *"}),(0,t.jsxs)("select",{value:eb.metodoPago,onChange:e=>ef(r=>({...r,metodoPago:e.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${eb.metodoPago?"border-gray-300 focus:ring-green-500 focus:border-green-500":"border-red-300 focus:ring-red-500 focus:border-red-500"}`,children:[t.jsx("option",{value:"",children:"— Seleccionar m\xe9todo —"}),t.jsx("option",{value:"EFECTIVO",children:"Efectivo"}),t.jsx("option",{value:"TRANSFERENCIA",children:"Transferencia"}),t.jsx("option",{value:"TARJETA",children:"Tarjeta"}),t.jsx("option",{value:"CHEQUE",children:"Cheque"})]}),eA&&!eb.metodoPago&&t.jsx("p",{className:"text-xs text-red-600 mt-1",children:"M\xe9todo de pago requerido"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cobrador *"}),(0,t.jsxs)("select",{value:eb.cobradorId,onChange:e=>ef(r=>({...r,cobradorId:e.target.value})),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${eA?eb.cobradorId?"border-gray-300 focus:ring-green-500 focus:border-green-500":"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-green-500 focus:border-green-500"}`,children:[t.jsx("option",{value:"",children:"— Seleccionar cobrador —"}),v.map(e=>t.jsx("option",{value:e.id,children:e.nombres},e.id))]}),eA&&!eb.cobradorId&&t.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Cobrador requerido"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"N\xba Recibo/Factura"}),t.jsx("input",{type:"text",value:eb.numeroRecibo,onChange:e=>ef(r=>({...r,numeroRecibo:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: 00001234"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Referencia/Comprobante"}),t.jsx("input",{type:"text",value:eb.referencia,onChange:e=>ef(r=>({...r,referencia:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"N\xba de transferencia, ticket, etc."})]})]})]}),"CREDITO"===eb.condicion&&(0,t.jsxs)("div",{className:"rounded-xl p-4",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:"Configuraci\xf3n de Cr\xe9dito"}),t.jsx(y,{conceptos:ew(),services:F,selectedMember:Q,showFormValidation:eA,vencimientoDefault:eb.vencimiento,onAddConcepto:()=>ej("CREDITO"),onUpdateConcepto:(e,r,a)=>eD("CREDITO",e,r,a),onRemoveConcepto:e=>eC("CREDITO",e),formatNumberWithSeparator:ae,getNumericValueSafe:C,isServiceDuplicate:(e,r)=>w(e,r,F),onServiceSelection:eI,title:"Conceptos (Cr\xe9dito)",buttonColor:"bg-blue-600",onOpenReservaModal:rH,modoReservaUnica:en,onToggleModoReserva:()=>ec(!en),canShowMultiReserva:rW(ew()).length>=2,conceptosConReservaCount:rW(ew()).length}),rW(ew()).length>=2&&en&&t.jsx("div",{className:"mb-4 flex justify-center",children:(0,t.jsxs)("button",{type:"button",onClick:()=>{ef(e=>(r1(e.conceptos||[]),e))},className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm shadow-sm",children:[rW(ew()).some(e=>e.reservaFechaHora)?"Editar reservaci\xf3n":"Crear reserva",t.jsx("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-semibold",children:rW(ew()).length})]})}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{type:"checkbox",id:"permitirPagosParc",checked:eb.permitirPagosParc,onChange:e=>{let r=e.target.checked,a=rT(),t=a?.id||"";ef(e=>({...e,permitirPagosParc:r,pagoAplicado:r?e.pagoAplicado:"",cobradorId:r&&!e.cobradorId?t:e.cobradorId,metodoPago:r&&!e.metodoPago?O[0]?.id||"efectivo":e.metodoPago}))},className:"w-4 h-4 text-blue-600"}),t.jsx("label",{htmlFor:"permitirPagosParc",className:"text-sm font-medium text-gray-700",children:"Aplicar pago parcial ahora"})]}),eb.permitirPagosParc&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-2 mt-3 p-3 bg-white rounded-lg border border-blue-200",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Monto Pago (Gs.) *"}),t.jsx("input",{type:"text",inputMode:"numeric",value:eb.pagoAplicado,onChange:e=>{let r=ae(e.target.value);ef(e=>({...e,pagoAplicado:r}))},className:`w-full px-2 py-2 border rounded-md focus:outline-none focus:ring-2 text-xs ${eA?eb.pagoAplicado&&parseFloat(ar(eb.pagoAplicado))>0&&parseFloat(ar(eb.pagoAplicado))<=D(ew())?"border-gray-300 focus:ring-blue-500 focus:border-blue-500":"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}`,placeholder:"25.000"}),(()=>{let e=D(ew()),r=parseFloat(ar(eb.pagoAplicado));return eb.pagoAplicado&&r>e})()&&t.jsx("p",{className:"text-xs text-red-600 mt-1",children:"No puede superar el monto total"}),eA&&eb.pagoAplicado&&0>=parseFloat(ar(eb.pagoAplicado))&&t.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Monto debe ser mayor a 0"})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"M\xe9todo de Pago *"}),(0,t.jsxs)("select",{value:eb.metodoPago,onChange:e=>ef(r=>({...r,metodoPago:e.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-xs",children:[t.jsx("option",{value:"",children:"— Seleccionar m\xe9todo —"}),t.jsx("option",{value:"EFECTIVO",children:"Efectivo"}),t.jsx("option",{value:"TRANSFERENCIA",children:"Transferencia"}),t.jsx("option",{value:"TARJETA",children:"Tarjeta"}),t.jsx("option",{value:"CHEQUE",children:"Cheque"})]})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cobrador *"}),(0,t.jsxs)("select",{value:eb.cobradorId,onChange:e=>ef(r=>({...r,cobradorId:e.target.value})),className:`w-full px-2 py-2 border rounded-md focus:outline-none focus:ring-2 text-xs ${eA?eb.cobradorId?"border-gray-300 focus:ring-green-500 focus:border-green-500":"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-green-500 focus:border-green-500"}`,children:[t.jsx("option",{value:"",children:"— Seleccionar cobrador —"}),v.map(e=>t.jsx("option",{value:e.id,children:e.nombres},e.id))]})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Referencia"}),t.jsx("input",{type:"text",value:eb.referencia,onChange:e=>ef(r=>({...r,referencia:e.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-xs",placeholder:"N\xba comprobante"})]})]})]})]}),t.jsx(N,{condicion:eb.condicion,conceptos:ew(),pagoAplicado:eb.pagoAplicado,permitirPagosParc:eb.permitirPagosParc,calculateTotal:D,getNumericValue:ar,onProcessPayment:()=>{"CONTADO"===eb.condicion?r8():r9()},isFormValid:r7(),saving:rp,onCancel:rk})]})]})})}),e8&&re&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[90vh] flex flex-col overflow-hidden",children:[t.jsx("div",{className:"border-b border-gray-200 px-6 py-3 bg-white flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"border border-gray-300 p-1.5 rounded-lg",children:t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-black",children:"Gesti\xf3n de Deudas Pendientes"}),(0,t.jsxs)("p",{className:"text-black text-sm",children:[re.nombres," ",re.apellidos,(0,t.jsxs)("span",{className:"ml-2 text-gray-600",children:["• C\xf3digo: ",re.codigo]})]})]})]}),t.jsx("button",{onClick:()=>{e9(!1),rr(null),e1([]),e5({}),ru({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""})},className:"text-black hover:text-gray-600 transition-colors",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 mb-4",children:[t.jsx("h3",{className:"text-base font-semibold text-black mb-3",children:"Datos del Pago"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-3 mb-3",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Fecha de Pago *"}),t.jsx("input",{type:"date",value:rm.fecha,onChange:e=>ru(r=>({...r,fecha:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"M\xe9todo de Pago *"}),(0,t.jsxs)("select",{value:rm.metodoPago,onChange:e=>ru(r=>({...r,metodoPago:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",children:[t.jsx("option",{value:"",children:"— Seleccionar m\xe9todo —"}),t.jsx("option",{value:"EFECTIVO",children:"Efectivo"}),t.jsx("option",{value:"TRANSFERENCIA",children:"Transferencia"}),t.jsx("option",{value:"TARJETA",children:"Tarjeta"}),t.jsx("option",{value:"CHEQUE",children:"Cheque"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Cobrador"}),(0,t.jsxs)("select",{value:rm.cobradorId,onChange:e=>ru(r=>({...r,cobradorId:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",children:[t.jsx("option",{value:"",children:"— Sin asignar —"}),v.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.nombres," ",e.apellidos]},e.id))]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Nro. de Recibo"}),t.jsx("input",{type:"text",value:rm.numeroRecibo,onChange:e=>ru(r=>({...r,numeroRecibo:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"001-001-0000123"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Referencia/Comprobante"}),t.jsx("input",{type:"text",value:rm.referencia,onChange:e=>ru(r=>({...r,referencia:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"N\xba transferencia, cheque, etc."})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-0.5",children:"Observaciones"}),t.jsx("textarea",{rows:2,value:rm.observaciones,onChange:e=>ru(r=>({...r,observaciones:e.target.value})),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"Observaciones adicionales sobre el pago..."})]}),t.jsx("div",{})]})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg",children:[t.jsx("div",{className:"px-3 py-2 border-b border-gray-200 bg-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx("span",{className:"font-medium text-black",children:"\uD83D\uDCCB Detalle de D\xe9bitos Pendientes"}),t.jsx("span",{className:"text-gray-400",children:"•"}),(0,t.jsxs)("span",{className:"text-black font-medium",children:["Deuda Total Gs.",(rE[re.id]?.saldo||re.deudaTotal||0).toLocaleString("es-PY")]}),t.jsx("span",{className:"text-gray-400",children:"•"}),(0,t.jsxs)("span",{className:"text-black font-medium",children:["D\xe9bitos Pendientes ",eX.length]}),t.jsx("span",{className:"text-gray-400",children:"•"}),(0,t.jsxs)("span",{className:"text-black font-medium",children:["Seleccionados ",e0.length>0?`Gs.${ao().toLocaleString("es-PY")}`:"Gs.0"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>{eX.length>0&&e1(eX.map(e=>e.id))},title:"Seleccionar Todo",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs font-medium",children:"✓ Todo"}),t.jsx("button",{onClick:()=>e1([]),title:"Limpiar Selecci\xf3n",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs",children:"\uD83E\uDDF9"}),t.jsx("button",{onClick:()=>rM(re.id),disabled:eJ,title:"Actualizar Lista",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs disabled:opacity-50",children:eJ?"⟳":"\uD83D\uDD04"}),t.jsx("button",{onClick:()=>{rG(re.id),rs(!0)},title:"Ver Historial de Refinanciaciones",className:"px-2 py-1 border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors text-xs font-medium",children:"\uD83D\uDCCB Historial Refinanciaciones"})]})]})}),t.jsx("div",{className:"overflow-x-auto",children:eJ?t.jsx("div",{className:"p-6 text-center",children:t.jsx("div",{className:"text-gray-500 text-sm",children:"⟳ Cargando d\xe9bitos pendientes..."})}):eX.length>0?(0,t.jsxs)("table",{className:"w-full text-xs",children:[t.jsx("thead",{className:"bg-white border-b border-gray-200",children:(0,t.jsxs)("tr",{children:[t.jsx("th",{className:"px-2 py-3 text-left font-semibold text-black w-8",children:t.jsx("input",{type:"checkbox",checked:eX.length>0&&e0.length===eX.length,onChange:e=>{e.target.checked?e1(eX.map(e=>e.id)):e1([])},className:"w-4 h-4 text-gray-600 bg-gray-100 border-gray-300 rounded focus:ring-gray-500 focus:ring-2"})}),t.jsx("th",{className:"px-3 py-3 text-left font-semibold text-black min-w-[150px]",children:"Descripci\xf3n"}),t.jsx("th",{className:"px-3 py-3 text-left font-semibold text-black w-20",children:"Fecha"}),t.jsx("th",{className:"px-3 py-3 text-left font-semibold text-black w-24",children:"Vencimiento"}),t.jsx("th",{className:"px-3 py-3 text-center font-semibold text-black w-20",children:"D\xedas Atraso"}),t.jsx("th",{className:"px-3 py-3 text-center font-semibold text-black w-16",children:"Estado"}),t.jsx("th",{className:"px-3 py-3 text-right font-semibold text-black w-28",children:"Saldo Pendiente"}),t.jsx("th",{className:"px-3 py-3 text-right font-semibold text-black w-24",children:"Pagado"}),t.jsx("th",{className:"px-3 py-3 text-center font-semibold text-black w-32",children:"Monto a Pagar"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:eX.map((e,r)=>{let a=(e.monto||0)-(e.paidAmount||0),o=e.vencimiento?new Date(e.vencimiento):null,s=new Date;s.setHours(0,0,0,0);let i=o?new Date(o):null;i&&i.setHours(0,0,0,0);let n=i&&i<s,c=e0.includes(e.id),l=o?Math.floor((new Date().getTime()-o.getTime())/864e5):0;return(0,t.jsxs)("tr",{className:`transition-all hover:bg-gray-50 ${c?"bg-gray-100 border-l-4 border-gray-400":""}`,children:[t.jsx("td",{className:"px-2 py-3",children:t.jsx("input",{type:"checkbox",id:`debt-${e.id}`,checked:c,onChange:r=>aa(e.id,r.target.checked),className:"w-4 h-4 text-gray-600 bg-gray-100 border-gray-300 rounded focus:ring-gray-500 focus:ring-2"})}),t.jsx("td",{className:"px-3 py-3",children:t.jsx("label",{htmlFor:`debt-${e.id}`,className:"font-medium text-black cursor-pointer block",children:e.concepto||"Sin concepto"})}),t.jsx("td",{className:"px-3 py-3 text-black",children:e.fecha?new Date(e.fecha).toLocaleDateString("es-PY"):"N/A"}),t.jsx("td",{className:`px-3 py-3 ${n?"text-black font-medium":"text-black"}`,children:e.vencimiento?new Date(e.vencimiento).toLocaleDateString("es-PY"):"N/A"}),t.jsx("td",{className:"px-3 py-3 text-center",children:n&&l>0?t.jsx("span",{className:"text-black font-medium",children:l}):t.jsx("span",{className:"text-gray-400",children:"-"})}),t.jsx("td",{className:"px-3 py-3 text-center",children:n?t.jsx("span",{className:"text-black text-xs font-medium",children:"VENCIDO"}):t.jsx("span",{className:"text-black text-xs font-medium",children:"AL D\xcdA"})}),t.jsx("td",{className:"px-3 py-3 text-right",children:(0,t.jsxs)("span",{className:"font-bold text-black",children:["Gs.",a.toLocaleString("es-PY")]})}),t.jsx("td",{className:"px-3 py-3 text-right text-black",children:(e.paidAmount||0)>0?`Gs.${(e.paidAmount||0).toLocaleString("es-PY")}`:"-"}),t.jsx("td",{className:"px-3 py-3",children:t.jsx("input",{type:"text",inputMode:"numeric",value:e2[e.id]||"",onChange:r=>at(e.id,r.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",placeholder:"Ingrese monto"})})]},e.id)})})]}):(0,t.jsxs)("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"text-gray-500 mb-2 text-sm",children:"No se encontraron d\xe9bitos pendientes"}),t.jsx("button",{onClick:()=>rM(re.id),className:"text-amber-600 hover:text-amber-700 font-medium text-xs",children:"\uD83D\uDD04 Cargar d\xe9bitos"})]})})]}),(()=>{let e=Object.values(e2).reduce((e,r)=>{if(r){let a=parseInt(ar(r));return e+(isNaN(a)?0:a)}return e},0),r=ao(),a=Math.max(0,r-e);return e>0&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 mx-4 shadow-sm bg-white",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-bold text-black flex items-center gap-2",children:"\uD83D\uDCCA Resumen del Pago"}),(0,t.jsxs)("span",{className:"text-xs border border-gray-300 text-black px-2 py-1 rounded-full font-medium",children:[e0.length," d\xe9bito",1!==e0.length?"s":""," seleccionado",1!==e0.length?"s":""]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[t.jsx("div",{className:"text-xs text-black mb-1",children:"Total Adeudado"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-black",children:["Gs.",r.toLocaleString("es-PY")]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[t.jsx("div",{className:"text-xs text-black mb-1",children:"Total a Pagar"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-black",children:["Gs.",e.toLocaleString("es-PY")]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[t.jsx("div",{className:"text-xs text-black mb-1",children:"Saldo Restante"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-black",children:["Gs.",a.toLocaleString("es-PY")]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[t.jsx("div",{className:"text-xs text-black mb-1",children:"M\xe9todo de Pago"}),t.jsx("div",{className:"text-sm font-medium text-black",children:rm.metodoPago||"No seleccionado"})]})]}),t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:a<=0?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-black border border-gray-300 px-3 py-2 rounded-lg text-sm",children:[t.jsx("span",{className:"text-lg",children:"✅"}),(0,t.jsxs)("div",{children:[t.jsx("div",{className:"font-semibold",children:"Pago Completo"}),t.jsx("div",{className:"text-xs text-black",children:"Se saldar\xe1n todos los d\xe9bitos seleccionados"})]})]}):e>0?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-black border border-gray-300 px-3 py-2 rounded-lg text-sm",children:[t.jsx("span",{className:"text-lg",children:"\uD83D\uDCA1"}),(0,t.jsxs)("div",{children:[t.jsx("div",{className:"font-semibold",children:"Pago Parcial"}),(0,t.jsxs)("div",{className:"text-xs text-black",children:["Quedar\xe1 un saldo pendiente de Gs.",a.toLocaleString("es-PY")]})]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-black border border-gray-300 px-3 py-2 rounded-lg text-sm",children:[t.jsx("span",{className:"text-lg",children:"ℹ️"}),(0,t.jsxs)("div",{children:[t.jsx("div",{className:"font-semibold",children:"Sin Pagos Definidos"}),t.jsx("div",{className:"text-xs text-black",children:"Ingrese los montos a pagar para cada d\xe9bito"})]})]})})]})})()]}),t.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-3 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsx("div",{className:"text-xs text-black",children:e0.length>0?`${e0.length} d\xe9bito${e0.length>1?"s":""} seleccionado${e0.length>1?"s":""}`:"Completa los datos de pago y selecciona los d\xe9bitos"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{e9(!1),rr(null),e1([]),ru({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""})},className:"px-3 py-1.5 text-sm border border-gray-300 rounded text-black hover:bg-gray-50 transition-colors",children:"Cerrar"}),e0.length>0&&(0,t.jsxs)(t.Fragment,{children:[t.jsx("button",{onClick:()=>rt(!0),className:"px-4 py-1.5 text-sm border border-gray-300 text-black rounded hover:bg-gray-50 transition-colors font-medium",children:"♻️ Refinanciar deuda"}),t.jsx("button",{onClick:async()=>{if(!re||!rm.fecha||!rm.metodoPago){alert("Por favor completa todos los campos requeridos.");return}let e=Object.values(e2).reduce((e,r)=>{if(r){let a=parseInt(ar(r));return e+(isNaN(a)?0:a)}return e},0);if(e<=0){alert("Ingresa al menos un monto para procesar el pago.");return}rg(!0);try{let r=[];for(let e of Object.keys(e2)){let a=e2[e];if(a){let t=parseInt(ar(a));t>0&&r.push({debitId:e,amount:t})}}if(0===r.length){alert("No hay montos v\xe1lidos para procesar.");return}let a={memberId:re.id,fecha:rm.fecha,monto:e,concepto:`Pago de ${r.length} d\xe9bito${r.length>1?"s":""} pendiente${r.length>1?"s":""}`,formaPago:rm.metodoPago.toLowerCase(),cobradorId:rm.cobradorId||"",numeroRecibo:rm.numeroRecibo||"",observaciones:rm.observaciones||(rm.referencia?`Referencia: ${rm.referencia}`:""),allocations:r},t=await c.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify(a)});if(t.ok)alert(`\xa1Pago procesado exitosamente!

Total procesado: Gs. ${e.toLocaleString("es-PY")}
D\xe9bitos pagados: ${r.length}`),e9(!1),rr(null),e1([]),e5({}),ru({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""}),await rA();else{let e=await t.text();throw Error(`Error ${t.status}: ${e}`)}}catch(e){console.error("Error processing debt payments:",e),alert(`Error al procesar el pago: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{rg(!1)}},disabled:(()=>{let e=Object.values(e2).reduce((e,r)=>{if(r){let a=parseInt(ar(r));return e+(isNaN(a)?0:a)}return e},0);return!rm.fecha||!rm.metodoPago||e<=0||rp})(),className:"px-4 py-1.5 text-sm border border-gray-300 text-black rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-200 transition-colors font-medium",children:rp?(0,t.jsxs)(t.Fragment,{children:[t.jsx("span",{className:"animate-spin",children:"⟳"})," Procesando..."]}):(0,t.jsxs)(t.Fragment,{children:["\uD83D\uDCB3 Procesar Pago",(()=>{let e=Object.values(e2).reduce((e,r)=>{if(r){let a=parseInt(ar(r));return e+(isNaN(a)?0:a)}return e},0);return e>0&&(0,t.jsxs)("span",{className:"ml-1 font-normal text-xs",children:["(Gs. ",e.toLocaleString("es-PY"),")"]})})()]})})]})]})]})})]})}),ra&&re&&t.jsx(n,{isOpen:ra,onClose:()=>rt(!1),memberId:re.id,member:re,debits:eX.filter(e=>e0.includes(e.id)),onSuccess:()=>{rt(!1),e9(!1),rr(null),e1([]),e5({}),ru({fecha:"",montoAPagar:"",metodoPago:"",cobradorId:"",numeroRecibo:"",referencia:"",observaciones:""}),rA(),re?.id&&rM(re.id)}}),ro&&t.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:e=>e.target===e.currentTarget&&rs(!1),children:t.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDCCB Historial de Refinanciaciones"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[re?.nombres," ",re?.apellidos]})]}),t.jsx("button",{onClick:()=>rs(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx(b.Z,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:rc?t.jsx("div",{className:"p-8 text-center",children:t.jsx("div",{className:"text-gray-500 text-sm",children:"⟳ Cargando historial..."})}):rd?(0,t.jsxs)("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg",children:[(0,t.jsxs)("div",{className:"text-red-800 text-sm",children:["❌ Error: ",rd]}),t.jsx("button",{onClick:()=>rG(re.id),className:"mt-2 px-3 py-1 bg-red-100 text-red-800 rounded text-xs hover:bg-red-200",children:"\uD83D\uDD04 Reintentar"})]}):0===ri.length?t.jsx("div",{className:"p-8 text-center",children:t.jsx("div",{className:"text-gray-500 text-sm",children:"\uD83D\uDCC4 No hay refinanciaciones registradas para este socio."})}):t.jsx("div",{className:"space-y-4",children:ri.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["ID: ",e.id]}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${"ACTIVA"===e.status?"bg-green-100 text-green-800":"COMPLETADA"===e.status?"bg-blue-100 text-blue-800":"ANULADA"===e.status?"bg-red-100 text-red-800":"CANCELADA"===e.status?"bg-orange-100 text-orange-800":"APROBADA"===e.status?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:e.status})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Creado: ",new Date(e.createdAt).toLocaleDateString("es-PY"),e.executedAt&&(0,t.jsxs)(t.Fragment,{children:[" | Ejecutado: ",new Date(e.executedAt).toLocaleDateString("es-PY")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["ACTIVA"===e.status&&t.jsx("button",{onClick:async()=>{if(confirm("\xbfEst\xe1 seguro de cancelar esta refinanciaci\xf3n? Esta acci\xf3n revertir\xe1 todos los pagos y restaurar\xe1 las deudas originales."))try{let r=await c.L.authenticatedFetch("/api/refinancing/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refinancingId:e.id,cancelledBy:"admin"})});if(r.ok)alert("Refinanciaci\xf3n cancelada exitosamente"),rG(re.id),rM(re.id);else{let e=await r.json();alert(`Error: ${e.error||"No se pudo cancelar la refinanciaci\xf3n"}`)}}catch(e){console.error("Error cancelling refinancing:",e),alert("Error de conexi\xf3n al cancelar la refinanciaci\xf3n")}},className:"px-2 py-1 bg-red-100 text-red-800 rounded text-xs hover:bg-red-200 transition-colors",title:"Cancelar refinanciaci\xf3n",children:"\uD83D\uDDD1️ Cancelar"}),t.jsx("button",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs hover:bg-purple-200 transition-colors",title:"Generar PDF",onClick:async()=>{try{let r=(await a.e(4401).then(a.bind(a,14401))).default,t=e=>e?.toLocaleString("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0})?.replace("₲","Gs.")??"Gs.0",o=e=>e?new Date(e).toLocaleDateString("es-PY"):"",s=e.originalDebitsSnapshot||[];e.principal,e.downPaymentAmount,e.totalInInstallments,e.installmentAmount,e.schedule;let i=new r("portrait","mm","a4"),n=i.internal.pageSize.width,c=i.internal.pageSize.height,l=[41,128,185],d=[52,73,94],x=[245,246,250],m=[218,223,228],u=25,p=(e,r,a=12,t=!1)=>{i.setFontSize(a),i.setFont("helvetica",t?"bold":"normal");let o=i.getTextWidth(e);i.text(e,(n-o)/2,r)},g=(e=30)=>u+e>c-20&&(i.addPage(),u=25,!0);i.setFillColor(...l),i.rect(0,0,n,15,"F"),i.setTextColor(255,255,255),i.setFontSize(14),i.setFont("helvetica","bold"),p("CLUB SOCIAL DEPORTIVO",10,14,!0),i.setDrawColor(...l),i.setLineWidth(.8),i.line(20,18,n-20,18),i.setTextColor(...d),p("SOLICITUD DE REFINANCIACI\xd3N",28,16,!0),u=38,i.setFontSize(9),i.setTextColor(...d);let h=`${re?.nombres||""} ${re?.apellidos||""}`.trim(),b=re?.ci||"",f=re?.codigo||"";i.setFillColor(...x),i.rect(20,u-5,n-40,15,"F"),i.setDrawColor(...m),i.rect(20,u-5,n-40,15),i.setFont("helvetica","bold"),i.text("SOCIO:",25,u),i.setFont("helvetica","normal"),i.text(h||"Informaci\xf3n no disponible",45,u),i.setFont("helvetica","bold"),i.text("C.I.N\xb0:",25,u+5),i.setFont("helvetica","normal"),i.text(b||"No disponible",45,u+5),i.setFont("helvetica","bold"),i.text("C\xd3DIGO:",120,u),i.setFont("helvetica","normal"),i.text(f||"No disponible",145,u),i.setFont("helvetica","bold"),i.text("FECHA:",120,u+5),i.setFont("helvetica","normal"),i.text(new Date(e.createdAt).toLocaleDateString("es-PY"),145,u+5),u+=15,g(40),u+=8,i.setFontSize(11),i.setTextColor(...l),i.setFont("helvetica","bold"),i.text("1. D\xc9BITOS A REFINANCIAR",20,u);let v=u+=6;i.setFillColor(...l),i.rect(20,v,n-40,6,"F"),i.setTextColor(255,255,255),i.setFontSize(9),i.text("CONCEPTO",22,v+4),i.text("MONTO",130,v+4),i.text("VENCIMIENTO",160,v+4),u=v+6,i.setTextColor(...d),i.setFont("helvetica","normal"),s.forEach((e,r)=>{r>0&&r%8==0&&(g(40),u+=10),r%2==0&&(i.setFillColor(...x),i.rect(20,u,n-40,6,"F")),i.setDrawColor(...m),i.rect(20,u,n-40,6);let a=(e.concepto?.length>45?e.concepto.substring(0,42)+"...":e.concepto)||"";i.text(a,22,u+4),i.text(t(e.monto-(e.paidAmount||0)),130,u+4),i.text(e.vencimiento?o(e.vencimiento):"N/A",160,u+4),u+=6}),i.setFillColor(...d),i.rect(20,u,n-40,6,"F"),i.setTextColor(255,255,255),i.setFont("helvetica","bold"),i.text("TOTAL A REFINANCIAR:",22,u+4),i.text(t(e.principal),130,u+4),u+=14,g(30),i.setTextColor(...l),i.setFontSize(11),i.setFont("helvetica","bold"),i.text("2. T\xc9RMINOS DE REFINANCIACI\xd3N",20,u),u+=6;let y=[["Cantidad de Cuotas:",`${e.installments} cuotas`],["Porcentaje Inicial:",`${e.downPaymentPercent}%`],["Monto Cuota Inicial:",t(e.downPaymentAmount)],["Fecha Primera Cuota:",o(e.startDueDate)],["Monto por Cuota:",t(e.installmentAmount)]];if(y.forEach(([e,r],a)=>{let t=u+8*a;a%2==0&&(i.setFillColor(...x),i.rect(20,t,n-40,8,"F")),i.setDrawColor(...m),i.rect(20,t,n-40,8),i.setTextColor(...d),i.setFontSize(9),i.setFont("helvetica","bold"),i.text(e,25,t+5),i.setFont("helvetica","normal");let o=n-45-i.getTextWidth(r);i.text(r,o,t+5)}),u+=8*y.length+4,g(50),i.setTextColor(...l),i.setFontSize(11),i.setFont("helvetica","bold"),i.text("3. CRONOGRAMA DE PAGOS",20,u),u+=6,e.schedule){let r=e.schedule;if(r.length>8){let e=Math.ceil(r.length/2),a=(n-50)/2;i.setFillColor(...l),i.rect(20,u,a,6,"F"),i.rect(20+a+10,u,a,6,"F"),i.setTextColor(255,255,255),i.setFontSize(8),i.text("CUOTA",25,u+4),i.text("MONTO",60,u+4),i.text("VENCIMIENTO",95,u+4),i.text("CUOTA",25+a+10,u+4),i.text("MONTO",60+a+10,u+4),i.text("VENCIMIENTO",95+a+10,u+4);let s=u+=6;r.forEach((r,n)=>{let c=s+4*Math.floor(n%e);if(n<e)n%2==0&&(i.setFillColor(...x),i.rect(20,c,a,4,"F")),i.setDrawColor(...m),i.rect(20,c,a,4),i.setTextColor(...d),i.text(`${r.number}`,25,c+2.5),i.text(t(r.amount),60,c+2.5),i.text(o(r.dueDate),95,c+2.5);else{let c=n-e,l=s+4*c;c%2==0&&(i.setFillColor(...x),i.rect(20+a+10,l,a,4,"F")),i.setDrawColor(...m),i.rect(20+a+10,l,a,4),i.setTextColor(...d),i.text(`${r.number}`,25+a+10,l+2.5),i.text(t(r.amount),60+a+10,l+2.5),i.text(o(r.dueDate),95+a+10,l+2.5)}}),u=s+4*e+8}else i.setFillColor(...l),i.rect(20,u,n-40,6,"F"),i.setTextColor(255,255,255),i.setFontSize(8),i.text("CUOTA",25,u+4),i.text("MONTO",70,u+4),i.text("VENCIMIENTO",120,u+4),u+=6,r.forEach((e,r)=>{r%2==0&&(i.setFillColor(...x),i.rect(20,u,n-40,5,"F")),i.setDrawColor(...m),i.rect(20,u,n-40,5),i.setTextColor(...d),i.setFontSize(8),i.text(`${e.number}`,25,u+3),i.text(t(e.amount),70,u+3),i.text(o(e.dueDate),120,u+3),u+=5}),u+=4}g(25),i.setTextColor(...l),i.setFontSize(11),i.setFont("helvetica","bold"),i.text("4. RESUMEN FINANCIERO",20,u),u+=6,i.setFillColor(...x),i.rect(20,u,n-40,20,"F"),i.setDrawColor(...l),i.rect(20,u,n-40,20);let N=0;N=e.schedule&&e.schedule.length>0?e.schedule.reduce((e,r)=>e+(r.amount||0),0):e.installmentAmount&&e.installments?e.installmentAmount*e.installments:(e.principal||0)-(e.downPaymentAmount||0),[["Total Principal Refinanciado:",t(e.principal)],["Cuota Inicial:",t(e.downPaymentAmount)],["Total Financiado en Cuotas:",t(N)],["N\xfamero Total de Cuotas:",`${e.installments} cuotas`],["Monto por Cuota:",t(e.installmentAmount)]].forEach(([e,r],a)=>{let t=u+5+3.5*a;i.setFontSize(9),i.setFont("helvetica","bold"),i.setTextColor(...d),i.text(e,25,t),i.setFont("helvetica","normal"),i.setTextColor(...d);let o=n-45-i.getTextWidth(r);i.text(r,o,t)}),u+=25,g(35),i.setTextColor(...l),i.setFontSize(11),i.setFont("helvetica","bold"),i.text("5. AUTORIZACIONES",20,u),u+=8;let j=(n-60)/2;i.setDrawColor(...m),i.rect(25,u,j,25),i.setFontSize(9),i.setTextColor(...d),i.setFont("helvetica","bold"),i.text("FIRMA DEL SOCIO",25+j/2-i.getTextWidth("FIRMA DEL SOCIO")/2,u+8),i.setFont("helvetica","normal"),i.setFontSize(8),i.text("Acepto los t\xe9rminos y condiciones de esta",30,u+15),i.text("refinanciaci\xf3n y me comprometo a su cumplimiento.",30,u+19),i.rect(35+j,u,j,25),i.setFont("helvetica","bold"),i.text("AUTORIZACI\xd3N DEL CLUB",35+j+j/2-i.getTextWidth("AUTORIZACI\xd3N DEL CLUB")/2,u+8),i.setFont("helvetica","normal"),i.setFontSize(8),i.text("Visto Bueno y Autorizaci\xf3n de la",35+j+5,u+15),i.text("Administraci\xf3n del Club",35+j+5,u+19),u+=32,i.setDrawColor(...m),i.line(20,u,n-20,u),u+=3,i.setFontSize(7),i.setTextColor(...d),p(`Documento generado autom\xe1ticamente el ${new Date().toLocaleString("es-PY")} - P\xe1gina 1 de 1`,u);let C=(re?`${re.nombres} ${re.apellidos}`.trim():"Sin_Nombre").replace(/[^a-zA-Z0-9áéíóúñÁÉÍÓÚÑ\s]/g,"").replace(/\s+/g,"_"),D=re?.codigo||"Sin_Codigo",w=new Date(e.createdAt).toLocaleDateString("es-PY",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),I=`Refinanciacion_${C}_${D}_${w}.pdf`;i.save(I)}catch(e){alert("Error al generar PDF: "+(e instanceof Error?e.message:e))}},children:"\uD83D\uDCC4 Generar PDF"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Principal:"}),(0,t.jsxs)("div",{className:"font-medium",children:["Gs.",e.principal?.toLocaleString("es-PY")||0]})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Anticipo:"}),(0,t.jsxs)("div",{className:"font-medium",children:["Gs.",e.downPaymentAmount?.toLocaleString("es-PY")||0]})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Cuotas:"}),t.jsx("div",{className:"font-medium",children:e.installments||0})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Estado Cuotas:"}),t.jsx("div",{className:"font-medium",children:e.schedule?(0,t.jsxs)(t.Fragment,{children:[e.schedule.filter(e=>"PAGADA"===e.status).length," pagadas / ",e.schedule.length," total"]}):"N/A"})]})]}),e.observations&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[t.jsx("span",{className:"font-medium",children:"Observaciones:"})," ",e.observations]}),e.schedule&&e.schedule.length>0&&(0,t.jsxs)("details",{className:"mt-3",children:[t.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Ver cronograma de cuotas"}),t.jsx("div",{className:"mt-2 overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"#"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Vencimiento"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Importe"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Pagado"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-center",children:"Estado"})]})}),t.jsx("tbody",{children:e.schedule.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"border border-gray-300 px-2 py-1",children:e.number}),t.jsx("td",{className:"border border-gray-300 px-2 py-1",children:new Date(e.dueDate).toLocaleDateString("es-PY")}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",e.amount?.toLocaleString("es-PY")||0]}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",e.paidAmount?.toLocaleString("es-PY")||0]}),t.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:t.jsx("span",{className:`px-1 py-0.5 text-xs rounded ${"PAGADA"===e.status?"bg-green-100 text-green-800":"PARCIAL"===e.status?"bg-yellow-100 text-yellow-800":"VENCIDA"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.status})})]},e.number))})]})})]}),e.originalDebitsSnapshot&&e.originalDebitsSnapshot.length>0&&(0,t.jsxs)("details",{className:"mt-3",children:[t.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900",children:"Ver deudas refinanciadas"}),t.jsx("div",{className:"mt-2 overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"#"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Concepto"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Monto original"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-right",children:"Pagado antes"}),t.jsx("th",{className:"border border-gray-300 px-2 py-1 text-left",children:"Vencimiento"})]})}),t.jsx("tbody",{children:e.originalDebitsSnapshot.map((e,r)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"border border-gray-300 px-2 py-1",children:r+1}),t.jsx("td",{className:"border border-gray-300 px-2 py-1",children:e.concepto}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",e.monto?.toLocaleString("es-PY")||0]}),(0,t.jsxs)("td",{className:"border border-gray-300 px-2 py-1 text-right",children:["Gs.",e.paidAmount?.toLocaleString("es-PY")||0]}),t.jsx("td",{className:"border border-gray-300 px-2 py-1",children:e.vencimiento?new Date(e.vencimiento).toLocaleDateString("es-PY"):"-"})]},e.id||r))})]})})]})]},e.id))})}),(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 flex justify-between items-center",children:[t.jsx("div",{className:"text-sm text-gray-600",children:ri.length>0&&`${ri.length} refinanciaci\xf3n(es) encontrada(s)`}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>rG(re.id),disabled:rc,className:"px-3 py-2 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 transition-colors text-sm disabled:opacity-50",children:[rc?"⟳":"\uD83D\uDD04"," Actualizar"]}),t.jsx("button",{onClick:()=>rs(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors text-sm",children:"Cerrar"})]})]})]})})}),er&&t.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:e=>e.target===e.currentTarget&&r$(),children:t.jsx("div",{className:"w-full max-w-4xl max-h-[95vh] overflow-y-auto bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"\uD83D\uDCC5 Configurar Reserva"}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Complete todos los detalles para la reserva del servicio"})]}),t.jsx("button",{onClick:r$,className:"text-gray-400 hover:text-gray-600",children:t.jsx(b.Z,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDC64 Datos del Socio"}),(0,t.jsxs)("div",{className:"grid grid-cols-[3fr_1fr_1.5fr_2fr_2fr_1.2fr] gap-3 items-end",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre y Apellido"}),t.jsx("input",{type:"text",value:`${Q?.nombres||""} ${Q?.apellidos||""}`,disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"N\xb0 de Socio"}),t.jsx("input",{type:"text",value:Q?.codigo||"",disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600 text-center"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula"}),t.jsx("input",{type:"text",value:el.cedula||Q?.ci||"",onChange:e=>ed(r=>({...r,cedula:e.target.value})),placeholder:"Ingrese c\xe9dula",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nro de Tel\xe9fono"}),t.jsx("input",{type:"text",value:el.telefono||Q?.telefono||"",onChange:e=>ed(r=>({...r,telefono:e.target.value})),placeholder:"Ingrese tel\xe9fono",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),t.jsx("input",{type:"text",value:el.ruc,onChange:e=>ed(r=>({...r,ruc:e.target.value})),placeholder:"Ingrese RUC",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estado"}),t.jsx("div",{className:`w-full px-2 py-1 text-[13px] border border-gray-300 rounded text-center font-medium ${(rE[Q?.id||""]?.estadoCalc??Q?.estado)==="AL_DIA"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:(rE[Q?.id||""]?.estadoCalc??Q?.estado)==="AL_DIA"?"Al d\xeda":"Atrasado"})]})]})]})}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{type:"checkbox",id:"esParaTercero",checked:el.esParaTercero,onChange:e=>ed(r=>({...r,esParaTercero:e.target.checked})),className:"w-4 h-4 text-amber-600 border-gray-300 rounded focus:ring-amber-500"}),t.jsx("label",{htmlFor:"esParaTercero",className:"text-xs font-medium text-gray-900",children:"\uD83C\uDFAD \xbfReserva a favor de un tercero?"})]}),el.esParaTercero&&(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre y Apellido *"}),t.jsx("input",{type:"text",value:el.terceroNombre,onChange:e=>ed(r=>({...r,terceroNombre:e.target.value})),placeholder:"Nombre completo del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500",required:!0})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula (Opcional)"}),t.jsx("input",{type:"text",value:el.terceroCedula,onChange:e=>ed(r=>({...r,terceroCedula:e.target.value})),placeholder:"C\xe9dula del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tel\xe9fono (Opcional)"}),t.jsx("input",{type:"text",value:el.terceroTelefono,onChange:e=>ed(r=>({...r,terceroTelefono:e.target.value})),placeholder:"Tel\xe9fono del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),t.jsx("input",{type:"text",value:el.terceroRuc,onChange:e=>ed(r=>({...r,terceroRuc:e.target.value})),placeholder:"RUC del tercero",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83C\uDFE2 Servicios y Espacios"}),(()=>{let e=ew().find(e=>e.id===et),r=F.find(r=>r.id===e?.servicioId);return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Servicio"}),t.jsx("input",{type:"text",value:r?.nombre||"Servicio no encontrado",disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Espacio *"}),t.jsx("input",{type:"text",value:(()=>{let e=es.find(e=>e.id===el.venueId);if(e)return e.nombre;if(r?.espacios&&r.espacios.length>0){let e=r.espacios.findIndex((e,a)=>`espacio-${r.id}-${a}`===el.venueId);if(e>=0)return r.espacios[e]}return"Espacio seleccionado previamente"})(),disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{className:"bg-purple-100 p-2 rounded text-xs",children:[t.jsx("strong",{children:"\uD83D\uDCB0 Pagos:"})," ",(()=>{let e=ew().find(e=>e.id===et),r=F.find(r=>r.id===e?.servicioId),a=e?.monto?parseInt(e.monto.replace(/[^\d]/g,"")):0;return`${r?.nombre||"N/A"} - Gs.${a.toLocaleString("es-PY")}`})()]})]})})()]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83C\uDF89 Datos del Evento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fecha del Evento *"}),t.jsx("input",{type:"date",value:el.fecha,onChange:e=>ed(r=>({...r,fecha:e.target.value})),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hora de Inicio *"}),t.jsx("input",{type:"time",value:el.inicioHora,onChange:e=>ed(r=>({...r,inicioHora:e.target.value})),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hora de Fin *"}),t.jsx("input",{type:"time",max:"03:00",value:el.finHora,onChange:e=>ed(r=>({...r,finHora:e.target.value})),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"})]})]}),t.jsx("div",{className:"space-y-2",children:(()=>{let e=ew().find(e=>e.id===et),r=F.find(r=>r.id===e?.servicioId),a=r?.permiteHorasExtras,o=r?.precioHoraExtra;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"horaExtra",checked:el.horaExtra,disabled:!a,onChange:e=>{if(e.target.checked&&a){let e=o?ae(o.toString()):"";ed(r=>({...r,horaExtra:!0,cantidadHorasExtra:"1",montoHorasExtra:e}))}else ed(e=>({...e,horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""}))},className:`w-3 h-3 border-gray-300 rounded focus:ring-green-500 ${a?"text-green-600":"text-gray-400"}`}),t.jsx("label",{htmlFor:"horaExtra",className:`text-xs ${a?"text-gray-700":"text-gray-400"}`,children:"⏰ Hora extra"})]}),!a&&t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-2",children:t.jsx("p",{className:"text-xs text-amber-700",children:"⚠️ El servicio no permite horas extras"})}),el.horaExtra&&a&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Horas"}),t.jsx("input",{type:"number",min:"1",step:"0.5",value:el.cantidadHorasExtra,onChange:e=>{let r=(parseFloat(e.target.value)||0)*(o||0),a=r>0?ae(r.toString()):"";ed(r=>({...r,cantidadHorasExtra:e.target.value,montoHorasExtra:a}))},placeholder:"Ej: 2",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Monto (Gs.)"}),t.jsx("input",{type:"text",value:el.montoHorasExtra,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600",placeholder:"Calculado autom\xe1ticamente"})]})]})]})})()})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83C\uDF8A Acontecimiento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),(0,t.jsxs)("select",{value:el.acontecimiento,onChange:e=>{ed(r=>({...r,acontecimiento:e.target.value,quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosDescripcion:"",otrosNombrePersona:""}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500",children:[t.jsx("option",{value:"",children:"— Seleccionar tipo —"}),t.jsx("option",{value:"15_anos",children:"15 a\xf1os"}),t.jsx("option",{value:"boda",children:"Boda"}),t.jsx("option",{value:"cumpleanos",children:"Cumplea\xf1os"}),t.jsx("option",{value:"otros",children:"Otros"})]})]}),"15_anos"===el.acontecimiento&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre de la Quincea\xf1era"}),t.jsx("input",{type:"text",value:el.quinceaneraFocusNombre,onChange:e=>ed(r=>({...r,quinceaneraFocusNombre:e.target.value})),placeholder:"Nombre completo de la quincea\xf1era",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),"boda"===el.acontecimiento&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombres de los Novios"}),t.jsx("input",{type:"text",value:el.noviosNombres,onChange:e=>ed(r=>({...r,noviosNombres:e.target.value})),placeholder:"Ej: Juan P\xe9rez y Mar\xeda Gonz\xe1lez",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),"cumpleanos"===el.acontecimiento&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre del/la Cumplea\xf1er@"}),t.jsx("input",{type:"text",value:el.cumpleaneroNombre,onChange:e=>ed(r=>({...r,cumpleaneroNombre:e.target.value})),placeholder:"Nombre del/la cumplea\xf1er@",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),"otros"===el.acontecimiento&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),t.jsx("input",{type:"text",value:el.otrosDescripcion,onChange:e=>ed(r=>({...r,otrosDescripcion:e.target.value})),placeholder:"Descripci\xf3n del evento",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre de la Persona (Opcional)"}),t.jsx("input",{type:"text",value:el.otrosNombrePersona,onChange:e=>ed(r=>({...r,otrosNombrePersona:e.target.value})),placeholder:"Nombre de la persona relacionada",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDCDD Informaci\xf3n Adicional"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad de Personas (Aproximada)"}),t.jsx("input",{type:"number",min:"1",value:el.cantidadPersonas,onChange:e=>ed(r=>({...r,cantidadPersonas:e.target.value})),placeholder:"Ej: 50",className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"requiereApa",checked:!1!==el.requiereApa,onChange:e=>ed(r=>({...r,requiereApa:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"requiereApa",className:"text-xs font-medium text-gray-700 select-none",children:"Requiere APA?"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observaciones Generales"}),t.jsx("textarea",{rows:1,value:el.observacionesGenerales,onChange:e=>ed(r=>({...r,observacionesGenerales:e.target.value})),placeholder:"Detalles adicionales, requerimientos especiales, contactos importantes, etc.",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-500 resize-none"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-4 pt-3 border-t border-gray-200",children:[t.jsx("button",{onClick:rL,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"\uD83D\uDCBE Guardar reserva"}),t.jsx("button",{onClick:r$,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})})}),ex&&t.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-[1px] flex items-center justify-center p-4",role:"dialog","aria-modal":"true",onClick:e=>e.target===e.currentTarget&&em(!1),children:t.jsx("div",{className:"w-full max-w-[52.8rem] max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-2xl border border-gray-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDCC5 Reserva M\xfaltiple de Espacios"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Configure una reserva \xfanica para ",eu.length," espacios simult\xe1neamente"]})]}),t.jsx("button",{onClick:()=>em(!1),className:"text-gray-400 hover:text-gray-600",children:t.jsx(b.Z,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDC64 Datos del Socio"}),(0,t.jsxs)("div",{className:"grid grid-cols-[3fr_1fr_1.5fr_2fr_2fr_1.2fr] gap-3 items-end",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre y Apellido"}),t.jsx("input",{type:"text",value:Q?`${Q.nombres} ${Q.apellidos}`:"",disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"N\xb0 de Socio"}),t.jsx("input",{type:"text",value:Q?.codigo||"",disabled:!0,className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded bg-gray-50 text-gray-600 text-center"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula"}),t.jsx("input",{type:"text",value:eg.cedula||Q?.ci||"",onChange:e=>eh(r=>({...r,cedula:e.target.value})),placeholder:"Ingrese c\xe9dula",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nro de Tel\xe9fono"}),t.jsx("input",{type:"text",value:eg.telefono||Q?.telefono||"",onChange:e=>eh(r=>({...r,telefono:e.target.value})),placeholder:"Ingrese tel\xe9fono",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),t.jsx("input",{type:"text",value:eg.ruc,onChange:e=>eh(r=>({...r,ruc:e.target.value})),placeholder:"Ingrese RUC",className:"w-full px-2 py-1 text-[13px] border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Estado"}),t.jsx("div",{className:`w-full px-2 py-1 text-[13px] border border-gray-300 rounded text-center font-medium ${(rE[Q?.id||""]?.estadoCalc??Q?.estado)==="AL_DIA"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:(rE[Q?.id||""]?.estadoCalc??Q?.estado)==="AL_DIA"?"Al d\xeda":"Atrasado"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("input",{type:"checkbox",id:"esParaTerceroMulti",checked:eg.esParaTercero,onChange:e=>eh(r=>({...r,esParaTercero:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"esParaTerceroMulti",className:"text-xs font-medium text-gray-700 select-none",children:"\uD83E\uDD1D Reserva a favor de un tercero"})]}),eg.esParaTercero&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Nombre Completo *"}),t.jsx("input",{type:"text",value:eg.terceroNombre,onChange:e=>eh(r=>({...r,terceroNombre:e.target.value})),placeholder:"Nombre completo del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"C\xe9dula"}),t.jsx("input",{type:"text",value:eg.terceroCedula,onChange:e=>eh(r=>({...r,terceroCedula:e.target.value})),placeholder:"C\xe9dula del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tel\xe9fono"}),t.jsx("input",{type:"text",value:eg.terceroTelefono,onChange:e=>eh(r=>({...r,terceroTelefono:e.target.value})),placeholder:"Tel\xe9fono del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"RUC (Opcional)"}),t.jsx("input",{type:"text",value:eg.terceroRuc,onChange:e=>eh(r=>({...r,terceroRuc:e.target.value})),placeholder:"RUC del tercero",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83C\uDFE2 Servicios y Espacios"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{className:"text-xs text-gray-600 mb-2",children:[eu.length," concepto(s) seleccionado(s) para reserva:"]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded overflow-hidden",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 bg-gray-100 border-b border-gray-200",children:[t.jsx("div",{className:"px-2 py-1 text-xs font-semibold text-gray-700 border-r border-gray-200",children:"Servicio"}),t.jsx("div",{className:"px-2 py-1 text-xs font-semibold text-gray-700",children:"Espacio"})]}),t.jsx("div",{className:"max-h-16 overflow-y-auto",children:eu.map(e=>{let r=ew().find(r=>r.id===e),a=F.find(e=>e.id===r?.servicioId),o=null;return r?.reservaVenueId&&!(o=es.find(e=>e.id===r.reservaVenueId))&&a&&(a.espaciosDisponibles&&a.espaciosDisponibles.length>0?o=a.espaciosDisponibles.find(e=>e.id===r.reservaVenueId):a.espacios&&a.espacios.length>0&&(o=a.espacios.map((e,r)=>({id:`espacio-${a.id}-${r}`,nombre:e,descripcion:"",activo:!0})).find(e=>e.id===r.reservaVenueId))),(0,t.jsxs)("div",{className:"grid grid-cols-2 border-b border-gray-100 last:border-b-0 hover:bg-blue-25",children:[(0,t.jsxs)("div",{className:"px-2 py-1 text-xs text-gray-700 border-r border-gray-100 flex items-center",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full flex-shrink-0 mr-1"}),t.jsx("span",{className:"font-medium truncate",children:a?.nombre||"Servicio no encontrado"})]}),t.jsx("div",{className:"px-2 py-1 text-xs text-gray-700 flex items-center",children:o?(0,t.jsxs)("span",{className:"truncate font-medium",children:[o.nombre,o.capacidad?` (${o.capacidad} pers.)`:""]}):r?.reservaVenueId?t.jsx("span",{className:"truncate",children:a?.nombre||"Servicio no encontrado"}):t.jsx("span",{className:"truncate",children:a?.nombre||"Sin espacio asignado"})})]},e)})})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[t.jsx("h4",{className:"text-xs font-medium text-gray-900 mb-2 flex items-center gap-2",children:"\uD83D\uDCDD Informaci\xf3n Adicional"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad de Personas"}),t.jsx("input",{type:"number",min:"1",value:eg.cantidadPersonas,onChange:e=>eh(r=>({...r,cantidadPersonas:e.target.value})),placeholder:"Ej: 50",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-gray-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Requiere APA"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("input",{type:"checkbox",id:"requiereApaMulti",checked:!1!==eg.requiereApa,onChange:e=>eh(r=>({...r,requiereApa:e.target.checked})),className:"w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"requiereApaMulti",className:"text-xs font-medium text-gray-700 select-none",children:"S\xed"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Observaciones"}),t.jsx("textarea",{rows:2,value:eg.observacionesGenerales,onChange:e=>eh(r=>({...r,observacionesGenerales:e.target.value})),placeholder:"Detalles adicionales...",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-gray-500 resize-none"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-1 mb-3",children:[(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-2",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"⚙️ Configuraci\xf3n Avanzada"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"checkbox",id:"configuracionIndividualCheck",checked:eg.configuracionIndividual,onChange:e=>{let r=e.target.checked;if(!r&&eg.horaExtra){let e=0,a=0;if(eu.forEach(r=>{let t=ew().find(e=>e.id===r),o=F.find(e=>e.id===t?.servicioId);o?.permiteHorasExtras&&o?.precioHoraExtra&&(e+=o.precioHoraExtra,a++)}),a>0){let t=parseFloat(eg.cantidadHorasExtra)||1,o=t*e,s=ae(o.toString());console.log("\uD83D\uDCB0 Auto-calculando monto global:",{horas:t,servicios:a,montoPorHora:e,montoTotal:o,montoFormateado:s}),eh(e=>({...e,configuracionIndividual:r,cantidadHorasExtra:t.toString(),montoHorasExtra:s}));return}}eh(e=>({...e,configuracionIndividual:r}))},className:"w-3 h-3 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),t.jsx("label",{htmlFor:"configuracionIndividualCheck",className:"text-xs font-medium text-gray-700 select-none",children:"Configuraci\xf3n individual por servicio"})]}),t.jsx("p",{className:"text-xs text-gray-600",children:"Permite configurar horarios y horas extra espec\xedficos para cada servicio seleccionado."})]})]}),eg.configuracionIndividual&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83D\uDD27 Configuraci\xf3n Individual por Servicio"}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Configure horarios y horas extra espec\xedficos para cada servicio:"}),t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50",children:[t.jsx("th",{className:"border border-gray-200 px-3 py-2 text-left font-medium text-gray-700",children:"Servicio"}),t.jsx("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Inicio"}),t.jsx("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Fin"}),t.jsx("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Extra"}),t.jsx("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Cantidad"}),t.jsx("th",{className:"border border-gray-200 px-3 py-2 text-center font-medium text-gray-700",children:"Monto (Gs.)"})]})}),t.jsx("tbody",{children:eu.map(e=>{let r=ew().find(r=>r.id===e),a=F.find(e=>e.id===r?.servicioId),o=eg.configuracionesIndividuales[e]||{inicioHora:eg.inicioHora||"19:00",finHora:eg.finHora||"03:00",horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""};return(0,t.jsxs)("tr",{className:"hover:bg-gray-25",children:[t.jsx("td",{className:"border border-gray-200 px-3 py-2 font-medium text-gray-800",children:a?.nombre}),t.jsx("td",{className:"border border-gray-200 px-3 py-2 text-center",children:t.jsx("input",{type:"time",value:o.inicioHora,onChange:r=>{eh(a=>({...a,configuracionesIndividuales:{...a.configuracionesIndividuales,[e]:{...o,inicioHora:r.target.value}}}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded text-center"})}),t.jsx("td",{className:"border border-gray-200 px-3 py-2 text-center",children:t.jsx("input",{type:"time",value:o.finHora,onChange:r=>{eh(a=>({...a,configuracionesIndividuales:{...a.configuracionesIndividuales,[e]:{...o,finHora:r.target.value}}}))},className:"w-full px-2 py-1 text-xs border border-gray-300 rounded text-center"})}),t.jsx("td",{className:"border border-gray-200 px-3 py-2 text-center",children:a?.permiteHorasExtras&&a?.precioHoraExtra?t.jsx("input",{type:"checkbox",checked:o.horaExtra,onChange:r=>{eh(t=>({...t,configuracionesIndividuales:{...t.configuracionesIndividuales,[e]:{...o,horaExtra:r.target.checked,cantidadHorasExtra:r.target.checked?"1":"",montoHorasExtra:r.target.checked?ae((a?.precioHoraExtra||0).toString()):""}}}))},className:"w-4 h-4 border-gray-300 rounded focus:ring-orange-500 text-orange-600"}):t.jsx("div",{className:"flex items-center justify-center cursor-help",title:`${a?.nombre||"Servicio"} no permite hora extra o no tiene precio configurado`,children:t.jsx("span",{className:"text-red-500 text-xs",children:"❌"})})}),t.jsx("td",{className:"border border-gray-200 px-3 py-2 text-center",children:o.horaExtra&&a?.permiteHorasExtras&&a?.precioHoraExtra?(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[t.jsx("input",{type:"number",min:"1",step:"0.5",value:o.cantidadHorasExtra,onChange:r=>{let t=(parseFloat(r.target.value)||0)*(a?.precioHoraExtra||5e4),s=t>0?ae(t.toString()):"";eh(a=>({...a,configuracionesIndividuales:{...a.configuracionesIndividuales,[e]:{...o,cantidadHorasExtra:r.target.value,montoHorasExtra:s}}}))},placeholder:"1",className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded text-center"}),t.jsx("span",{className:"text-gray-500 text-xs",children:"hrs"})]}):t.jsx("span",{className:"text-gray-400",children:"—"})}),t.jsx("td",{className:"border border-gray-200 px-3 py-2 text-center",children:o.horaExtra&&a?.permiteHorasExtras&&a?.precioHoraExtra?t.jsx("input",{type:"text",value:o.montoHorasExtra,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600 text-center",placeholder:"Auto"}):a?.permiteHorasExtras&&a?.precioHoraExtra?t.jsx("span",{className:"text-gray-400",children:"—"}):t.jsx("span",{className:"text-red-400 text-xs",children:"Sin config."})})]},e)})})]})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[!eg.configuracionIndividual&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"⏰ Horas Extra"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"horaExtraMulti",checked:eg.horaExtra,onChange:e=>{if(e.target.checked){let e=0,r=0;if(eu.forEach(a=>{let t=ew().find(e=>e.id===a),o=F.find(e=>e.id===t?.servicioId);o?.permiteHorasExtras&&o?.precioHoraExtra&&(e+=o.precioHoraExtra,r++)}),0===r){alert("❌ Ninguno de los servicios seleccionados permite horas extra o no tienen precio configurado.\n\nDebe configurar los precios de hora extra en la p\xe1gina de Editar Servicios primero.");return}let a=ae(e.toString());eh(e=>({...e,horaExtra:!0,cantidadHorasExtra:"1",montoHorasExtra:a}))}else eh(e=>({...e,horaExtra:!1,cantidadHorasExtra:"",montoHorasExtra:""}))},className:"w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500"}),t.jsx("label",{htmlFor:"horaExtraMulti",className:"text-xs font-medium text-gray-700",children:"\xbfHora extra? (despu\xe9s de las 03:00)"})]}),t.jsx("div",{className:"text-xs text-gray-600 pl-6",children:(()=>{let e=[],r=[];return eu.forEach(a=>{let t=ew().find(e=>e.id===a),o=F.find(e=>e.id===t?.servicioId);o?.permiteHorasExtras&&o?.precioHoraExtra?e.push(`${o.nombre} (${ae(o.precioHoraExtra.toString())} Gs/h)`):r.push(o?.nombre||"Desconocido")}),(0,t.jsxs)("div",{className:"space-y-1",children:[e.length>0&&(0,t.jsxs)("div",{children:["✅ ",t.jsx("strong",{children:"Con hora extra:"})," ",e.join(", ")]}),r.length>0&&(0,t.jsxs)("div",{className:"text-red-600",children:["❌ ",t.jsx("strong",{children:"Sin configurar:"})," ",r.join(", ")]})]})})()}),t.jsx("div",{className:"flex items-center gap-2"}),eg.horaExtra&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 pl-6",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cantidad (horas)"}),t.jsx("input",{type:"number",min:"1",step:"0.5",value:eg.cantidadHorasExtra,onChange:e=>{let r=parseFloat(e.target.value)||0,a=0;eu.forEach(e=>{let r=ew().find(r=>r.id===e),t=F.find(e=>e.id===r?.servicioId);t?.permiteHorasExtras&&t?.precioHoraExtra&&(a+=t.precioHoraExtra)});let t=r*a,o=t>0?ae(t.toString()):"";eh(r=>({...r,cantidadHorasExtra:e.target.value,montoHorasExtra:o}))},placeholder:"Ej: 2",className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-yellow-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Monto (Gs.)"}),t.jsx("input",{type:"text",value:eg.montoHorasExtra,disabled:!0,className:"w-full px-2 py-1 text-xs border border-gray-300 rounded bg-gray-50 text-gray-600",placeholder:"Calculado autom\xe1ticamente"})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83C\uDF89 Datos del Evento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fecha"}),t.jsx("input",{type:"date",value:eg.fecha,onChange:e=>eh(r=>({...r,fecha:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]}),!eg.configuracionIndividual&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Inicio"}),t.jsx("input",{type:"time",value:eg.inicioHora,onChange:e=>eh(r=>({...r,inicioHora:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Fin"}),t.jsx("input",{type:"time",value:eg.finHora,onChange:e=>eh(r=>({...r,finHora:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-green-500"})]})]})]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:"\uD83C\uDF8A Acontecimiento"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo de Evento"}),(0,t.jsxs)("select",{value:eg.acontecimiento,onChange:e=>eh(r=>({...r,acontecimiento:e.target.value})),className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500",children:[t.jsx("option",{value:"",children:"— Seleccionar —"}),t.jsx("option",{value:"15_anos",children:"\uD83C\uDF82 15 a\xf1os"}),t.jsx("option",{value:"boda",children:"\uD83D\uDC92 Boda"}),t.jsx("option",{value:"cumpleanos",children:"\uD83C\uDF89 Cumple"}),t.jsx("option",{value:"otros",children:"\uD83C\uDFAA Otros"})]})]}),"15_anos"===eg.acontecimiento&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Quincea\xf1era"}),t.jsx("input",{type:"text",value:eg.quinceaneraFocusNombre,onChange:e=>eh(r=>({...r,quinceaneraFocusNombre:e.target.value})),placeholder:"Nombre completo",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),"boda"===eg.acontecimiento&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Novios"}),t.jsx("input",{type:"text",value:eg.noviosNombres,onChange:e=>eh(r=>({...r,noviosNombres:e.target.value})),placeholder:"Juan y Mar\xeda",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),"cumpleanos"===eg.acontecimiento&&(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cumplea\xf1er@"}),t.jsx("input",{type:"text",value:eg.cumpleaneroNombre,onChange:e=>eh(r=>({...r,cumpleaneroNombre:e.target.value})),placeholder:"Nombre",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),"otros"===eg.acontecimiento&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Descripci\xf3n"}),t.jsx("input",{type:"text",value:eg.otrosDescripcion,onChange:e=>eh(r=>({...r,otrosDescripcion:e.target.value})),placeholder:"Tipo de evento",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Persona"}),t.jsx("input",{type:"text",value:eg.otrosNombrePersona,onChange:e=>eh(r=>({...r,otrosNombrePersona:e.target.value})),placeholder:"Nombre (opcional)",className:"w-full px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-pink-500"})]})]})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-6 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>{let e=r2();if(e.length>0){alert("❌ Errores de validaci\xf3n:\n\n"+e.join("\n"));return}let r=es.find(e=>e.id===eg.venueId),a=r?.nombre||"Espacio no encontrado",t=0,o=0;ef(e=>{let r={...e};return eu.forEach(a=>{let t=e.conceptos?.find(e=>e.id===a),{fechaInicio:o,fechaFin:s}=(()=>{let e=eg.fecha,r=eg.inicioHora,a=eg.finHora,[t,o]=r.split(":").map(Number),[s,i]=a.split(":").map(Number),n=e;if(60*s+i<60*t+o){let r=new Date(e+"T00:00:00");r.setDate(r.getDate()+1),n=r.toISOString().split("T")[0]}return{fechaInicio:e,fechaFin:n}})(),i=eg.venueId;if(t){let e=F.find(e=>e.id===t.servicioId);e&&((e.espaciosDisponibles&&e.espaciosDisponibles.length>0?e.espaciosDisponibles.some(e=>e.id===eg.venueId):e.espacios&&e.espacios.length>0?e.espacios.some((r,a)=>`${e.id}-espacio-${a}`===eg.venueId):es.some(e=>e.id===eg.venueId))||(console.warn(`⚠️ Servicio ${e.nombre} no tiene disponible el venue ${eg.venueId}`),i=""))}let n={reservaVenueId:i,reservaFecha:o,reservaHoraInicio:eg.inicioHora,reservaHoraFin:eg.finHora,reservaFechaInicio:o,reservaFechaFin:s,reservaObservaciones:eg.observaciones,requiereApa:eg.requiereApa,reservaCedula:eg.cedula,reservaTelefono:eg.telefono,reservaRuc:eg.ruc,reservaEsParaTercero:eg.esParaTercero,reservaTerceroNombre:eg.terceroNombre,reservaTerceroCedula:eg.terceroCedula,reservaTerceroTelefono:eg.terceroTelefono,reservaTerceroRuc:eg.terceroRuc,reservaAcontecimiento:eg.acontecimiento,reservaQuinceaneraFocusNombre:eg.quinceaneraFocusNombre,reservaNoviosNombres:eg.noviosNombres,reservaCumpleaneroNombre:eg.cumpleaneroNombre,reservaOtrosDescripcion:eg.otrosDescripcion,reservaOtrosNombrePersona:eg.otrosNombrePersona,reservaCantidadPersonas:eg.cantidadPersonas,reservaObservacionesGenerales:eg.observacionesGenerales,reservaHoraExtra:eg.horaExtra,reservaCantidadHorasExtra:eg.cantidadHorasExtra,reservaMontoHorasExtra:eg.montoHorasExtra,reservaConfiguracionIndividual:eg.configuracionIndividual},c=eg.configuracionesIndividuales[a];if(c){if(c.inicioHora&&(n.reservaHoraInicio=c.inicioHora),c.finHora){n.reservaHoraFin=c.finHora;let e=c.inicioHora||eg.inicioHora,r=c.finHora,[a,t]=e.split(":").map(Number),[i,l]=r.split(":").map(Number);if(60*i+l<60*a+t){let e=new Date(o+"T00:00:00");e.setDate(e.getDate()+1);let r=e.toISOString().split("T")[0];n.reservaFechaFin=r}else n.reservaFechaFin=s}n.reservaHoraExtra=c.horaExtra||n.reservaHoraExtra,n.reservaCantidadHorasExtra=c.cantidadHorasExtra||n.reservaCantidadHorasExtra,n.reservaMontoHorasExtra=c.montoHorasExtra||n.reservaMontoHorasExtra}t&&(console.log(`💾 Guardando reserva m\xfaltiple para concepto ${t.condicion} ${a}:`,n),r.conceptos=r.conceptos?.map(e=>e.id===a?{...e,...n}:e))}),r}),rK(ew().filter(e=>eu.includes(e.id)));let s=eg.configuracionIndividual,i=ew().filter(e=>e.concepto.toLowerCase().includes("hora extra")),n=!1;if(i.length>0&&(n=i.filter(e=>e.relatedConceptoId&&eu.includes(e.relatedConceptoId)).length>0),console.log("⚡ Analizando transici\xf3n de horas extra:",{configPreviaIndividual:n,configActualIndividual:s,conceptosHoraExtraExistentes:i.length,cambioDeConfiguracion:n!==s}),(n!==s&&i.length>0||i.length>0&&(s||!s&&eg.horaExtra))&&(console.log("\uD83D\uDD04 Limpiando TODOS los conceptos de horas extra anteriores..."),ef(e=>{let r=e.conceptos.length,a=e.conceptos.filter(e=>{let r=e.concepto.toLowerCase().includes("hora extra");return r&&console.log(`🗑️ Eliminando hora extra ${e.condicion}: ${e.concepto}`),!r});return console.log(`📊 Conceptos: ${r} → ${a.length}`),{...e,conceptos:a}})),console.log("\uD83D\uDD50 Creando conceptos de hora extra:",{configuracionIndividual:eg.configuracionIndividual,horaExtraGlobal:eg.horaExtra,selectedConceptsCount:eu.length}),eg.configuracionIndividual)console.log("\uD83D\uDC65 MODO INDIVIDUAL: Creando conceptos individuales por servicio"),eu.forEach(e=>{let r=eg.configuracionesIndividuales[e];if(r&&r.horaExtra&&r.cantidadHorasExtra&&r.montoHorasExtra)try{let s=parseFloat(r.cantidadHorasExtra),i=parseFloat(C(r.montoHorasExtra));if(s>0&&i>0){let r=ew().find(r=>r.id===e),n=F.find(e=>e.id===r?.servicioId),c=new Date(eg.fecha+"T12:00:00").toLocaleDateString("es-PY"),l=`Hora extra para ${n?.nombre||"Servicio"} - ${a} - ${c}`;console.log(`➕ Creando concepto INDIVIDUAL para ${n?.nombre}: ${s}h x ${i}`);let d=eN(s,i,l,e);null!==d&&(t++,o+=i,console.log(`✅ Concepto INDIVIDUAL creado: ID ${d}`))}}catch(r){console.error("Error creating hora extra concepto for",e,r)}});else if(eg.horaExtra&&eg.cantidadHorasExtra&&eg.montoHorasExtra){console.log("\uD83C\uDF0D MODO GLOBAL: Creando UN concepto global para todas las reservas");try{let e=parseFloat(eg.cantidadHorasExtra),r=parseFloat(C(eg.montoHorasExtra));if(e>0&&r>0){let s=new Date(eg.fecha+"T12:00:00").toLocaleDateString("es-PY"),i=`Hora extra global - ${a} - ${s}`;console.log(`➕ Creando concepto GLOBAL: ${e}h x ${r}`);let n=eN(e,r,i);null!==n&&(t++,console.log(`✅ Concepto GLOBAL creado: ID ${n}`),o+=r)}}catch(e){console.error("Error creating global hora extra concepto:",e)}}em(!1);let c="";eu.forEach(e=>{let r=ew().find(r=>r.id===e),a=F.find(e=>e.id===r?.servicioId),t=null;r?.reservaVenueId&&(a?.espaciosDisponibles&&(t=a.espaciosDisponibles.find(e=>e.id===r.reservaVenueId)),t||(t=es.find(e=>e.id===r.reservaVenueId))),!t&&a?.espaciosDisponibles?.length>0&&(t=a.espaciosDisponibles[0]);let o=t?.nombre||"Espacio por asignar";c+=`📍 ${a?.nombre||"Servicio"}: ${o}
`});let l=new Date(eg.fecha+"T12:00:00").toLocaleDateString("es-PY"),d=`✅ Reserva m\xfaltiple configurada exitosamente!

${c}📅 ${l}
🕐 ${eg.inicioHora} - ${eg.finHora}
🎯 ${eu.length} espacios configurados`;t>0&&(d+=`

🕐 \xa1${t} concepto(s) de Hora Extra agregados autom\xe1ticamente!
💰 Monto total horas extra: ${ae(o.toString())} Gs.`),alert(d)},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"\uD83D\uDCBE Guardar reserva"}),t.jsx("button",{onClick:()=>em(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})})})]})}},60068:(e,r,a)=>{"use strict";a.d(r,{D2:()=>t,LJ:()=>s,_4:()=>i,tF:()=>o});let t={name:"America/Asuncion",offsetHours:-3,description:"Paraguay (UTC-3)"};function o(){let e=new Date,r=Object.fromEntries(new Intl.DateTimeFormat("en-CA",{timeZone:t.name,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).map(e=>[e.type,e.value]));return new Date(parseInt(r.year),parseInt(r.month)-1,parseInt(r.day),parseInt(r.hour),parseInt(r.minute),parseInt(r.second))}function s(e){if(e){let r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${r}-${a}-${t}`}{let e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:t.name,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}function i(e,r=!1){let a;if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[r,t,o]=e.split("-").map(Number);a=new Date(r,t-1,o)}else a=new Date(e)}else a=e;if(r)return a.toLocaleString("es-PY",{timeZone:t.name,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});if(!("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)))return a.toLocaleDateString("es-PY",{timeZone:t.name,day:"2-digit",month:"2-digit",year:"numeric"});{let[r,a,t]=e.split("-");return`${t.padStart(2,"0")}/${a.padStart(2,"0")}/${r}`}}},77863:(e,r,a)=>{"use strict";a.d(r,{Fw:()=>i,Ji:()=>n,m9:()=>c,p6:()=>s,sQ:()=>d,sU:()=>l,xG:()=>o});var t=a(60068);function o(e){return new Intl.NumberFormat("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}).format(e)}function s(e){return(0,t._4)(e,!1)}function i(e){let r=(0,t.tF)(),a=new Date(new Date(e).getTime()+108e5),o=r.getUTCFullYear()-a.getUTCFullYear(),s=r.getUTCMonth()-a.getUTCMonth();return(s<0||0===s&&r.getUTCDate()<a.getUTCDate())&&o--,o}function n(){return(0,t.LJ)()}function c(e){let r=e.replace(/\D/g,"");return r?r.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function l(e){return parseInt(e.replace(/\./g,""))||0}function d(e){return Math.round(e)}},28916:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},31540:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},231:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},83855:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},88307:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},98091:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},79635:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},94019:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},53925:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>t});let t=(0,a(68570).createProxy)(String.raw`C:\Garden\app\admin\socios\page.tsx#default`)}};var r=require("../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[8948,4471,6837,8750],()=>a(61325));module.exports=t})();