(()=>{var e={};e.id=1756,e.ids=[1756],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},40965:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(27490),r(11506),r(35866);var a=r(23191),s=r(88716),n=r(37922),o=r.n(n),i=r(95231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let d=["",{children:["admin",{children:["cobranzas",{children:["nuevo",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,27490)),"C:\\Garden\\app\\admin\\cobranzas\\nuevo\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,11506)),"C:\\Garden\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Garden\\app\\admin\\cobranzas\\nuevo\\page.tsx"],m="/admin/cobranzas/nuevo/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/cobranzas/nuevo/page",pathname:"/admin/cobranzas/nuevo",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},84978:(e,t,r)=>{Promise.resolve().then(r.bind(r,90332))},90332:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(10326),s=r(64447),n=r(67269),o=r(17577),i=r(35047),l=r(86333),d=r(88307),c=r(90434),m=r(77863),u=r(60068);function p(){let e=(0,i.useRouter)(),[t,r]=(0,o.useState)(!1),[p,x]=(0,o.useState)(""),[g,h]=(0,o.useState)([]),[b,f]=(0,o.useState)([]),[y,j]=(0,o.useState)([]),[v,N]=(0,o.useState)(""),[w,C]=(0,o.useState)(null),[I,P]=(0,o.useState)(!1),[S,D]=(0,o.useState)([]),[k,A]=(0,o.useState)([]),[T,F]=(0,o.useState)({memberId:"",fecha:(0,u.LJ)(),monto:"",concepto:"",formaPago:"efectivo",cobradorId:"",observaciones:"",numeroRecibo:""});async function G(e){try{let t=await n.L.authenticatedFetch(`/api/members/${e}/movements?type=DEBIT`),r=(t.headers.get("content-type")||"").includes("application/json")?await t.json():[],a=(Array.isArray(r)?r:Array.isArray(r?.items)?r.items:[]).map(e=>({id:e.id,memberId:e.memberId,fecha:e.fecha,concepto:e.concepto,tipo:e.tipo||"DEBIT",monto:Number(e.monto||0),paidAmount:Number(e.paidAmount||0),status:e.status||void 0})).filter(e=>"DEBIT"===e.tipo&&Number(e.paidAmount||0)<Number(e.monto||0));a.sort((e,t)=>new Date(e.fecha).getTime()-new Date(t.fecha).getTime()),D(a),A(a.map(e=>({debitId:e.id,concepto:e.concepto,pendiente:Math.max(0,e.monto-(e.paidAmount||0)),apply:"",selected:!1})))}catch(e){console.error("Error pending debits",e),D([]),A([])}}let _=e=>{C(e),F(t=>({...t,memberId:e.id})),P(!1),N(""),G(e.id)},q=e=>{F(t=>({...t,concepto:e.nombre,monto:null!=e.precio?String(e.precio):t.monto}))},E=g.filter(e=>e.nombres.toLowerCase().includes(v.toLowerCase())||e.apellidos.toLowerCase().includes(v.toLowerCase())||e.codigo.toLowerCase().includes(v.toLowerCase())||e.ci.includes(v)),L=k.reduce((e,t)=>e+(t.selected?Number(t.apply||0):0),0),z=async t=>{t.preventDefault(),x(""),r(!0);try{let t=k.filter(e=>e.selected&&Number(e.apply||0)>0).map(e=>({debitId:e.debitId,amount:Number(e.apply)})),r={...T,monto:parseFloat(T.monto)};t.length>0&&(r.allocations=t);let a=await n.L.authenticatedFetch("/api/payments",{method:"POST",body:JSON.stringify(r)}),s=await a.json();a.ok?e.push("/admin/cobranzas"):x(s.msg||"Error al registrar pago")}catch(e){x("Error de conexi\xf3n")}finally{r(!1)}};return a.jsx(s.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx(c.default,{href:"/admin/cobranzas",className:"p-2 hover:bg-gray-100 rounded-lg",children:a.jsx(l.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Nuevo Pago"}),a.jsx("p",{className:"text-gray-600",children:"Registra un nuevo pago o cobranza"})]})]}),p&&a.jsx("div",{className:`p-4 rounded-lg ${p.includes("Error")?"bg-red-50 text-red-800 border border-red-200":"bg-green-50 text-green-800 border border-green-200"}`,children:p}),a.jsx("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsxs)("form",{onSubmit:z,className:"p-6 space-y-8",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n del Socio"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Socio *"}),w?(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-300 rounded-lg bg-gray-50",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:[w.nombres," ",w.apellidos]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[w.codigo," • CI: ",w.ci]})]}),a.jsx("button",{type:"button",onClick:()=>{C(null),F(e=>({...e,memberId:""})),D([]),A([])},className:"text-red-600 hover:text-red-800 text-sm",children:"Cambiar"})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx(d.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),a.jsx("input",{type:"text",placeholder:"Buscar socio por nombre, c\xf3digo o CI...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:v,onChange:e=>{N(e.target.value),P(e.target.value.length>0)},onFocus:()=>P(v.length>0)})]}),I&&E.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:E.slice(0,10).map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>_(e),className:"w-full text-left p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:[(0,a.jsxs)("div",{className:"font-medium",children:[e.nombres," ",e.apellidos]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.codigo," • CI: ",e.ci]})]},e.id))})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci\xf3n del Pago"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha *"}),a.jsx("input",{type:"date",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.fecha,onChange:e=>F(t=>({...t,fecha:e.target.value}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pago *"}),(0,a.jsxs)("select",{required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.formaPago,onChange:e=>F(t=>({...t,formaPago:e.target.value})),children:[a.jsx("option",{value:"efectivo",children:"Efectivo"}),a.jsx("option",{value:"transferencia",children:"Transferencia"}),a.jsx("option",{value:"tarjeta",children:"Tarjeta"}),a.jsx("option",{value:"cheque",children:"Cheque"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Concepto *"}),a.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.concepto,onChange:e=>F(t=>({...t,concepto:e.target.value})),placeholder:"Cuota social, Tenis, Nataci\xf3n, etc."}),(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Servicios r\xe1pidos:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:b.slice(0,4).map(e=>a.jsx("button",{type:"button",onClick:()=>q(e),className:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded",children:e.nombre},e.id))})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto (Gs.) *"}),a.jsx("input",{type:"number",required:!0,min:"0",step:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.monto,onChange:e=>F(t=>({...t,monto:e.target.value})),placeholder:"150000"}),T.monto&&a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(0,m.xG)(parseFloat(T.monto)||0)})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cobrador"}),(0,a.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.cobradorId,onChange:e=>F(t=>({...t,cobradorId:e.target.value})),children:[a.jsx("option",{value:"",children:"Caja Interna"}),y.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.nombres," ",e.apellidos," (",e.codigo,")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"N\xfamero de Recibo"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.numeroRecibo,onChange:e=>F(t=>({...t,numeroRecibo:e.target.value})),placeholder:"REC-001"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),a.jsx("textarea",{rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:T.observaciones,onChange:e=>F(t=>({...t,observaciones:e.target.value})),placeholder:"Notas adicionales sobre el pago..."})]})]})]}),w&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Asignar a d\xe9bitos del socio"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Aplicado:"}),a.jsx("span",{className:"font-semibold",children:(0,m.xG)(L)}),a.jsx("span",{className:"text-gray-400",children:"/"}),a.jsx("span",{className:"font-semibold",children:(0,m.xG)(Number(T.monto||0))}),a.jsx("button",{type:"button",onClick:()=>{let e=Number(T.monto||0);if(!(e>0))return;let t=e;A(k.map(e=>{if(!e.selected)return{...e,apply:""};let r=Math.min(t,e.pendiente),a=r>0?r:0;return t=Math.max(0,t-a),{...e,apply:a?String(a):""}}))},className:"ml-3 px-3 py-1.5 border rounded hover:bg-gray-50",children:"Autodistribuir"})]})]}),0===k.length?a.jsx("div",{className:"p-3 rounded border text-sm text-gray-600 bg-gray-50",children:"Este socio no tiene d\xe9bitos pendientes."}):a.jsx("div",{className:"overflow-x-auto border rounded-lg",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"p-2 text-left",children:"Sel."}),a.jsx("th",{className:"p-2 text-left",children:"Concepto"}),a.jsx("th",{className:"p-2 text-left",children:"Fecha"}),a.jsx("th",{className:"p-2 text-right",children:"Pendiente"}),a.jsx("th",{className:"p-2 text-right",children:"Aplicar"})]})}),a.jsx("tbody",{children:k.map((e,t)=>{let r=S.find(t=>t.id===e.debitId);return(0,a.jsxs)("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2",children:a.jsx("input",{type:"checkbox",checked:e.selected,onChange:r=>{let a=[...k];a[t]={...e,selected:r.target.checked},A(a)}})}),a.jsx("td",{className:"p-2",children:e.concepto}),a.jsx("td",{className:"p-2",children:r?new Date(r.fecha).toLocaleDateString():"-"}),a.jsx("td",{className:"p-2 text-right",children:(0,m.xG)(e.pendiente)}),a.jsx("td",{className:"p-2 text-right",children:a.jsx("input",{type:"number",min:0,step:"1000",value:e.apply,onChange:r=>{let a=r.target.value,s=[...k];s[t]={...e,apply:a},A(s)},className:"w-32 px-2 py-1 border rounded text-right",placeholder:"0",disabled:!e.selected})})]},e.debitId)})})]})}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Pod\xe9s aplicar el pago a uno o varios d\xe9bitos. Si dej\xe1s este bloque vac\xedo, el pago se registra sin asignaci\xf3n (podr\xe1s asignarlo luego desde editar pago)."})]}),T.monto&&T.cobradorId&&(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Resumen del Pago"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Monto:"}),a.jsx("span",{className:"font-medium",children:(0,m.xG)(parseFloat(T.monto))})]}),(()=>{let e=b.find(e=>e.nombre===T.concepto),t=e?.comisionCobrador?parseFloat(T.monto)*e.comisionCobrador/100:0;return t>0?(0,a.jsxs)("div",{className:"flex justify-between text-orange-600",children:[(0,a.jsxs)("span",{children:["Comisi\xf3n Cobrador (",e?.comisionCobrador,"%):"]}),a.jsx("span",{className:"font-medium",children:(0,m.xG)(t)})]}):null})()]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[a.jsx(c.default,{href:"/admin/cobranzas",className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:t||!w,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 disabled:opacity-50",children:t?"Registrando...":"Registrar Pago"})]})]})})]})})}},60068:(e,t,r)=>{"use strict";r.d(t,{D2:()=>a,LJ:()=>n,_4:()=>o,tF:()=>s});let a={name:"America/Asuncion",offsetHours:-3,description:"Paraguay (UTC-3)"};function s(){let e=new Date,t=Object.fromEntries(new Intl.DateTimeFormat("en-CA",{timeZone:a.name,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).map(e=>[e.type,e.value]));return new Date(parseInt(t.year),parseInt(t.month)-1,parseInt(t.day),parseInt(t.hour),parseInt(t.minute),parseInt(t.second))}function n(e){if(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${a}`}{let e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:a.name,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}function o(e,t=!1){let r;if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[t,a,s]=e.split("-").map(Number);r=new Date(t,a-1,s)}else r=new Date(e)}else r=e;if(t)return r.toLocaleString("es-PY",{timeZone:a.name,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});if(!("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)))return r.toLocaleDateString("es-PY",{timeZone:a.name,day:"2-digit",month:"2-digit",year:"numeric"});{let[t,r,a]=e.split("-");return`${a.padStart(2,"0")}/${r.padStart(2,"0")}/${t}`}}},77863:(e,t,r)=>{"use strict";r.d(t,{Fw:()=>o,Ji:()=>i,m9:()=>l,p6:()=>n,sQ:()=>c,sU:()=>d,xG:()=>s});var a=r(60068);function s(e){return new Intl.NumberFormat("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}).format(e)}function n(e){return(0,a._4)(e,!1)}function o(e){let t=(0,a.tF)(),r=new Date(new Date(e).getTime()+108e5),s=t.getUTCFullYear()-r.getUTCFullYear(),n=t.getUTCMonth()-r.getUTCMonth();return(n<0||0===n&&t.getUTCDate()<r.getUTCDate())&&s--,s}function i(){return(0,a.LJ)()}function l(e){let t=e.replace(/\D/g,"");return t?t.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function d(e){return parseInt(e.replace(/\./g,""))||0}function c(e){return Math.round(e)}},86333:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});let a=(0,r(76557).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},88307:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});let a=(0,r(76557).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},27490:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(68570).createProxy)(String.raw`C:\Garden\app\admin\cobranzas\nuevo\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,4471,6837,8750],()=>r(40965));module.exports=a})();