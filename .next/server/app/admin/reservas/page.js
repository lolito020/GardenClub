(()=>{var e={};e.id=404,e.ids=[404],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15945:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>c}),a(33486),a(11506),a(35866);var s=a(23191),r=a(88716),o=a(37922),l=a.n(o),n=a(95231),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);a.d(t,i);let c=["",{children:["admin",{children:["reservas",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,33486)),"C:\\Garden\\app\\admin\\reservas\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,11506)),"C:\\Garden\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Garden\\app\\admin\\reservas\\page.tsx"],m="/admin/reservas/page",x={require:a,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/reservas/page",pathname:"/admin/reservas",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},59083:(e,t,a)=>{Promise.resolve().then(a.bind(a,78452))},78452:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(10326),r=a(64447),o=a(67269),l=a(17577),n=a(77863),i=a(60068),c=a(94019),d=a(76557);let m=(0,d.Z)("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]);var x=a(63685),u=a(87888);let p=(0,d.Z)("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),h=(0,d.Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);function b({reservationId:e,currentFile:t,currentStatus:a="PENDIENTE",isAdmin:r=!1,onClose:o,onFileUploaded:n,onStatusChange:i}){let[d,b]=(0,l.useState)(!1),[g,v]=(0,l.useState)(!1),[f,N]=(0,l.useState)(0),[j,w]=(0,l.useState)(null),[y,C]=(0,l.useState)(null),[E,D]=(0,l.useState)(""),A=e=>{if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(e.type)){alert("❌ Tipo de archivo no v\xe1lido. Solo se permiten PDF, JPG, JPEG y PNG.");return}if(e.size>10485760){alert("❌ El archivo es demasiado grande. M\xe1ximo 10MB permitido.");return}w(e)},k=async()=>{if(j){v(!0),N(0);try{let t=new FormData;t.append("file",j),t.append("reservationId",e);let a=setInterval(()=>{N(e=>e<90?e+10:e)},200),s=await fetch("/api/reservas/apa-upload",{method:"POST",body:t});if(clearInterval(a),N(100),!s.ok)throw Error("Error al subir el archivo");let r=await s.json();await T(e,"ENTREGADO",r.fileUrl),n(r.fileUrl,"ENTREGADO"),setTimeout(()=>{o()},1e3)}catch(e){console.error("Error uploading file:",e),alert("❌ Error al subir el archivo. Intente nuevamente."),N(0)}finally{v(!1)}}},T=async(e,t,a,s)=>{try{if(!(await fetch(`/api/reservas/${e}/apa-status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({apaEstado:t,apaComprobante:a,apaObservaciones:s,apaFechaEntrega:"ENTREGADO"===t?new Date().toISOString():void 0})})).ok)throw Error("Error al actualizar estado APA")}catch(e){throw console.error("Error updating APA status:",e),e}},P=async()=>{if(y)try{if(v(!0),j){let t=new FormData;t.append("file",j),t.append("reservationId",e);let a=await fetch("/api/reservas/apa-upload",{method:"POST",body:t});if(!a.ok)throw Error("Error al subir el archivo");let s=await a.json();await T(e,"APROBADO",s.fileUrl,E),n(s.fileUrl,"APROBADO")}else await T(e,"APROBADO",t,E),n(t||"","APROBADO");i?.("APROBADO"),o()}catch(e){alert("❌ Error al procesar la aprobaci\xf3n. Intente nuevamente.")}finally{v(!1)}},S="PENDIENTE"===a||"APROBADO"===a||"ENTREGADO"===a,L=r&&("PENDIENTE"===a||"ENTREGADO"===a);return s.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-lg bg-white rounded-xl shadow-lg",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-slate-50 rounded-t-xl",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:"Gesti\xf3n APA"}),s.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-200 transition-colors",children:s.jsx(c.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(0,s.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Estado Actual del APA"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"APROBADO"===a?"bg-green-100 text-green-800":"ENTREGADO"===a?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:"APROBADO"===a?"✅ Aprobado":"ENTREGADO"===a?"\uD83D\uDCE4 Entregado":"⏳ Pendiente"}),t&&(0,s.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1",children:[s.jsx(m,{className:"w-4 h-4"}),"Ver archivo digital"]})]}),"PENDIENTE"===a&&null,"APROBADO"===a&&!t&&(0,s.jsxs)("div",{className:"text-xs text-slate-600 bg-green-50 border border-green-200 rounded p-2",children:[s.jsx("span",{className:"font-medium",children:"✓ Aprobado:"})," Comprobante f\xedsico verificado en recepci\xf3n."]})]}),S&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-700",children:"Subir Comprobante APA"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[s.jsx("span",{children:"\uD83D\uDCDD"}),"Opcional: No es obligatorio adjuntar el comprobante de pago de APA"]})})]}),(0,s.jsxs)("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${d?"border-blue-400 bg-blue-50":"border-slate-300 hover:border-slate-400"}`,onDragOver:e=>{e.preventDefault(),b(!0)},onDragLeave:e=>{e.preventDefault(),b(!1)},onDrop:e=>{e.preventDefault(),b(!1);let t=Array.from(e.dataTransfer.files);t.length>0&&A(t[0])},children:[s.jsx(x.Z,{className:"w-8 h-8 text-slate-400 mx-auto mb-2"}),(0,s.jsxs)("p",{className:"text-sm text-slate-600 mb-2",children:["Arrastra tu archivo aqu\xed o",(0,s.jsxs)("label",{className:"text-blue-600 hover:text-blue-800 cursor-pointer ml-1",children:["selecciona uno",s.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{let t=e.target.files;t&&t.length>0&&A(t[0])}})]})]}),s.jsx("p",{className:"text-xs text-slate-500",children:"Formatos permitidos: PDF, JPG, PNG (m\xe1x. 10MB)"})]}),j&&(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(m,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-blue-900",children:j.name}),(0,s.jsxs)("span",{className:"text-xs text-blue-600",children:["(",(j.size/1024/1024).toFixed(1)," MB)"]})]}),s.jsx("button",{onClick:()=>w(null),className:"text-blue-600 hover:text-blue-800",children:s.jsx(c.Z,{className:"w-4 h-4"})})]}),g&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Subiendo archivo..."}),(0,s.jsxs)("span",{className:"font-medium",children:[f,"%"]})]}),s.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${f}%`}})})]})]}),r&&("PENDIENTE"===a||"ENTREGADO"===a)&&(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("h4",{className:"text-sm font-semibold text-slate-700",children:"Gesti\xf3n Administrativa"}),"ENTREGADO"===a&&t?s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[s.jsx(u.Z,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Archivo pendiente de revisi\xf3n"}),s.jsx("p",{className:"text-xs text-amber-700",children:"El usuario ha subido un comprobante que requiere aprobaci\xf3n."})]})]})}):s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[s.jsx(u.Z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Gesti\xf3n administrativa"}),s.jsx("p",{className:"text-xs text-blue-700",children:"PENDIENTE"===a?"Puede aprobar/rechazar si el comprobante de pago APA fue entregado f\xedsicamente.":"Revisar y decidir sobre el comprobante APA."})]})]})}),s.jsx("div",{className:"flex justify-center",children:(0,s.jsxs)("button",{onClick:()=>C("approve"),className:`flex items-center justify-center gap-2 px-6 py-3 rounded-lg text-sm font-medium transition-colors ${"approve"===y?"bg-green-600 text-white":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:[s.jsx(p,{className:"w-4 h-4"}),j?"Subir Archivo y Aprobar":"Aprobar APA"]})}),y&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Observaciones (opcionales)"}),s.jsx("textarea",{value:E,onChange:e=>D(e.target.value),placeholder:"Ej: Comprobante f\xedsico verificado en recepci\xf3n...",className:"w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]})]})]}),(0,s.jsxs)("div",{className:"p-4 border-t bg-slate-50 rounded-b-xl flex justify-end gap-2",children:[s.jsx("button",{onClick:o,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-medium text-gray-700 transition-colors",children:"Cancelar"}),S&&j&&s.jsx("button",{onClick:k,disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:g?(0,s.jsxs)(s.Fragment,{children:[s.jsx(h,{className:"w-4 h-4 animate-spin"}),"Subiendo..."]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(x.Z,{className:"w-4 h-4"}),"Subir Archivo"]})}),L&&y&&s.jsx("button",{onClick:P,disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:g?(0,s.jsxs)(s.Fragment,{children:[s.jsx(h,{className:"w-4 h-4 animate-spin"}),"Procesando..."]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(p,{className:"w-4 h-4"}),"Confirmar Aprobaci\xf3n"]})})]})]})})}function g(){async function e(){try{let e=await a.e(6180).then(a.t.bind(a,16180,23)),t=await a.e(3240).then(a.t.bind(a,53240,23));e.default.vfs=t.default.vfs;let s=e=>e.toLocaleString("de-DE",{minimumFractionDigits:0}),r=d.map(e=>{let t="";e.acontecimiento&&(t="15_anos"===e.acontecimiento?"Quincea\xf1era":"boda"===e.acontecimiento?"Boda":"cumpleanos"===e.acontecimiento?"Cumplea\xf1os":"Otro");let a=e.quinceaneraFocusNombre||e.noviosNombres||e.cumpleaneroNombre||e.otrosNombrePersona||"",r=t?a?`${t} - ${a}`:t:"",o=e.nombreContacto||"",l=e.acontecimiento||"",n="15_anos"===l?"15 a\xf1os":"cumpleanos"===l?"Cumplea\xf1os":"boda"===l?"Boda":"otros"===l?"Otro":l,i=n?`${o} - ${n}`:o,c=s(e.montoTotal||0),d=s((e.montoTotal||0)-(B[e.id]?.totalPagado||0));return[new Date(e.start).toLocaleDateString("es-ES"),`${eU(e.start)} - ${eU(e.end)}`,(()=>{let t=eO(e);return t.hasSpace?`${t.serviceName} - ${t.spaceName}`:t.serviceName})(),r,i,e.contacto||"",c,d,e.requiereApa?e.apaEstado||"Pendiente":"No aplica"]}),o={pageOrientation:"landscape",pageSize:"A4",content:[{text:"Reporte de Reservas",style:"header",alignment:"center",margin:[0,0,0,10]},{text:`Fecha de exportaci\xf3n: ${new Date().toLocaleDateString("es-PY")}`,style:"subheader",margin:[0,0,0,10]},{table:{headerRows:1,widths:["auto","auto","*","*","*","auto","auto","auto","auto"],body:[["Fecha","Horario","Servicio/Espacio","Evento","Contacto","Tel\xe9fono","Monto","Saldo","APA"],...r]},layout:"lightHorizontalLines"}],styles:{header:{fontSize:16,bold:!0},subheader:{fontSize:10,margin:[0,2,0,2]}},defaultStyle:{fontSize:7}},l=`reservas_${new Date().toISOString().slice(0,10)}.pdf`;e.default.createPdf(o).download(l)}catch(e){console.error("Error al generar PDF:",e),alert("Error al generar el PDF. Verifique que pdfmake est\xe9 instalado.")}}let[t,c]=(0,l.useState)([]),[d,m]=(0,l.useState)([]),[x,u]=(0,l.useState)([]),[p,h]=(0,l.useState)([]),[g,v]=(0,l.useState)([]),[f,N]=(0,l.useState)(!0),[j,w]=(0,l.useState)(""),[y,C]=(0,l.useState)(""),[E,D]=(0,l.useState)(""),[A,k]=(0,l.useState)(""),[T,P]=(0,l.useState)("contacto"),[S,L]=(0,l.useState)(""),[I,O]=(0,l.useState)(!1),[M,R]=(0,l.useState)([]),[$,G]=(0,l.useState)(!1),[F,H]=(0,l.useState)(""),[B,z]=(0,l.useState)({}),[q,V]=(0,l.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}),[U,_]=(0,l.useState)(!1),[W,Y]=(0,l.useState)(!1),[Z,J]=(0,l.useState)(!1),[Q,X]=(0,l.useState)(!1),[K,ee]=(0,l.useState)(!1),[et,ea]=(0,l.useState)(null),[es,er]=(0,l.useState)(!1),[eo,el]=(0,l.useState)({cancelReason:"",refundType:"TOTAL",refundAmount:"",penaltyAmount:""}),[en,ei]=(0,l.useState)(0),[ec,ed]=(0,l.useState)([]),[em,ex]=(0,l.useState)({resourceId:"",fecha:(0,i.LJ)(),inicioHora:"19:00",finHora:"23:00",memberId:"",nombreContacto:"",contacto:"",medioContacto:"telefono",invitados:"",adelanto:"",montoTotal:"",status:"ACTIVO",notas:"",requiereApa:!1,acontecimiento:"",quinceaneraFocusNombre:"",noviosNombres:"",cumpleaneroNombre:"",otrosNombrePersona:"",otrosDescripcion:"",esParaTercero:!1,terceroNombre:"",terceroCedula:"",terceroTelefono:"",terceroRuc:"",cantidadPersonas:"",observacionesGenerales:"",horaExtra:!1,cantidadHorasExtra:1,montoHorasExtra:0,apaEstado:"PENDIENTE"}),[eu,ep]=(0,l.useState)(""),[eh,eb]=(0,l.useState)(!1);(0,l.useRef)(null);let[eg,ev]=(0,l.useState)(null),[ef,eN]=(0,l.useState)(null),[ej,ew]=(0,l.useState)(null),[ey,eC]=(0,l.useState)(null),[eE,eD]=(0,l.useState)("year"),eA=(e,t)=>{let a=eB.get(e)||[];if(0===a.length)return;ew(e);let s=t.currentTarget.getBoundingClientRect(),r=Math.min(40*a.length+60,400),o=s.right+8,l=s.top;o+450>window.innerWidth-8&&(o=s.left-450-8),l+r>window.innerHeight-8&&(l=window.innerHeight-r-8),eC({top:l,left:o})},ek=()=>{ew(null),eC(null)},eT=e=>{let t=g.find(t=>t.id===e);return t?t.espaciosDisponibles&&t.espaciosDisponibles.length>0?t.espaciosDisponibles.map(e=>({id:e.id,nombre:e.nombre})):t.espacios&&t.espacios.length>0?t.espacios.map((t,a)=>({id:`${e}-espacio-${a}`,nombre:t})):[]:[]};async function eP(){try{let e=await o.L.authenticatedFetch("/api/reservas/update-expired",{method:"POST"});if(e.ok){let t=await e.json();t.updatedCount>0&&console.log(`🕒 ${t.message}`)}}catch(e){console.warn("Error actualizando estados de reservas:",e)}}let[eS,eL]=(0,l.useState)(!1),eI=e=>{w(e),C("")},eO=e=>{for(let t of g){if(t.espaciosDisponibles&&t.espaciosDisponibles.length>0){let a=t.espaciosDisponibles.find(t=>t.id===e.resourceId);if(a)return{serviceName:t.nombre,spaceName:a.nombre,hasSpace:!0}}if(t.espacios&&t.espacios.length>0){let a=t.espacios.findIndex((a,s)=>{let r=`${t.id}-espacio-${s}`,o=`espacio-${t.id}-${s}`;return r===e.resourceId||o===e.resourceId});if(a>=0)return{serviceName:t.nombre,spaceName:t.espacios[a],hasSpace:!0}}}let a=e.resourceId;if(a){if(a.startsWith("servicio-")){let e=a.replace("servicio-",""),t=g.find(t=>t.id===e);if(t)return{serviceName:t.nombre,spaceName:t.nombre,hasSpace:!0}}if(a.includes("tenis")){let e=g.find(e=>e.nombre.toLowerCase().includes("tenis"));if(e){let t=a.replace(/^.*?-/,"").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase());return{serviceName:e.nombre,spaceName:t||"Cancha 1",hasSpace:!0}}return{serviceName:"Tenis",spaceName:"Cancha 1",hasSpace:!0}}if(a.includes("natacion")||a.includes("piscina")){let e=g.find(e=>e.nombre.toLowerCase().includes("nataci\xf3n"));if(e){let t=a.replace(/^.*?-/,"").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase());return{serviceName:e.nombre,spaceName:t||"Piscina 1",hasSpace:!0}}return{serviceName:"Nataci\xf3n",spaceName:"Piscina 1",hasSpace:!0}}if(a.includes("salon")||a.includes("social")){let e=g.find(e=>e.nombre.toLowerCase().includes("sal\xf3n")||e.nombre.toLowerCase().includes("social"));if(e){let t=a.replace(/^.*?-/,"").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase());return{serviceName:e.nombre,spaceName:t||"Sal\xf3n Social",hasSpace:!0}}return{serviceName:"Alquiler Sal\xf3n Social",spaceName:"Sal\xf3n Social",hasSpace:!0}}}let s=t.find(t=>t.id===e.resourceId);return s?{serviceName:s.nombre,spaceName:s.nombre,hasSpace:!1}:{serviceName:"Servicio no especificado",spaceName:"Espacio no especificado",hasSpace:!1}};async function eM(){N(!0);try{await eP();let e=new Date(q.getFullYear(),q.getMonth(),1).toISOString().slice(0,10),t=new Date(q.getFullYear(),q.getMonth()+1,0).toISOString().slice(0,10),a=new URLSearchParams;if(j){let e=eT(j);if(y)a.set("venueId",y);else if(e.length>0){let t=e.map(e=>e.id).join(",");a.set("venueIds",t)}}else E&&a.set("venueId",E);A&&(a.set("q",A),a.set("searchType",T)),a.set("from",e),a.set("to",t),a.set("status","ACTIVO");let s=await o.L.authenticatedFetch(`/api/reservas?${a.toString()}`),r=await s.json(),l=Array.isArray(r)?r:[],n=l.filter(e=>"ACTIVO"===e.status||"ACTIVE"===e.status||"CONFIRMED"===e.status||"PENDING"===e.status);if(u(n),S){let e=n.filter(e=>new Date(e.start).toISOString().slice(0,10)===S);m(e)}else m(n);let i={};for(let e of l)e.debitMovementId&&e.memberId?i[e.id]=await e$(e):i[e.id]={totalPagado:e.adelanto||0,pagosCount:0};z(i)}catch(e){console.error(e),m([])}finally{N(!1)}}async function eR(){G(!0);try{let e=new URLSearchParams;e.set("includeHistory","true"),F&&e.set("q",F);let t=await o.L.authenticatedFetch(`/api/reservas?${e.toString()}`),a=await t.json(),s=(Array.isArray(a)?a:[]).filter(e=>"CULMINADO"===e.status||"CANCELADO"===e.status||"COMPLETED"===e.status||"CANCELED"===e.status);R(s)}catch(e){console.error(e),R([])}finally{G(!1)}}async function e$(e){let t=[];if(Array.isArray(e.debitMovementIds)&&e.debitMovementIds.length&&t.push(...e.debitMovementIds),e.debitMovementId&&t.push(e.debitMovementId),!t.length||!e.memberId)return{totalPagado:e.adelanto||0,pagosCount:0};try{let a=await o.L.authenticatedFetch(`/api/members/${e.memberId}/movements?pageSize=1000`);if(!a.ok)return console.error(`❌ API Error ${a.status}:`,await a.text()),{totalPagado:e.adelanto||0,pagosCount:0};let s=await a.json(),r=(Array.isArray(s)?s:s.items||[]).filter(e=>"CREDIT"===e.tipo&&e.allocations?.some(e=>t.includes(e.debitId))),l=r.reduce((e,a)=>{if(!a.allocations)return e;let s=a.allocations.filter(e=>t.includes(e.debitId)).reduce((e,t)=>e+Math.abs(t.amount||0),0);return e+s},0),n=e.adelanto||0;return{totalPagado:l+n,pagosCount:r.length+(n>0?1:0)}}catch(t){return console.error("Error obteniendo pagos relacionados:",t),{totalPagado:e.adelanto||0,pagosCount:0}}}let eG=async(e,t)=>{if(et)try{m(a=>a.map(a=>a.id===et.id?{...a,apaComprobante:e,apaEstado:t||a.apaEstado,apaFechaEntrega:"ENTREGADO"===t?new Date().toISOString():a.apaFechaEntrega}:a)),W&&et&&ea(a=>a?{...a,apaComprobante:e,apaEstado:t||a.apaEstado,apaFechaEntrega:"ENTREGADO"===t?new Date().toISOString():a.apaFechaEntrega}:null),console.log(`✅ Archivo APA actualizado para reserva ${et.id}:`,{fileUrl:e,newStatus:t})}catch(e){console.error("Error actualizando estado local despu\xe9s del archivo APA:",e)}},eF=(0,l.useMemo)(()=>{let e=q.getFullYear(),t=[];for(let a=0;a<12;a++){let s=new Date(e,a,1),r=new Date(s);r.setDate(s.getDate()-(s.getDay()+6)%7);let o=[];for(let e=0;e<6;e++){let t=[];for(let a=0;a<7;a++){let s=new Date(r);s.setDate(r.getDate()+(7*e+a)),t.push(new Date(s))}o.push(t)}t.push({month:a,matrix:o})}return t},[q]);function eH(e){return e.toISOString().slice(0,10)}let eB=(0,l.useMemo)(()=>{let e=new Map;for(let t of x){let a=new Date(t.start),s=new Date(t.end);for(let r=new Date(a);r<=s;r.setDate(r.getDate()+1)){let a=eH(r),s=e.get(a)||[];s.find(e=>e.id===t.id)||s.push(t),e.set(a,s)}}return e},[x]),ez=(0,l.useMemo)(()=>{let e=new Map;for(let[t,a]of eB){let s=a.filter(e=>"CANCELED"!==e.status);if(0===s.length){e.set(t,"available");continue}let r=s.some(e=>"boda"===e.acontecimiento||"15_anos"===e.acontecimiento||e.horaExtra&&(e.cantidadHorasExtra||0)>2||e.requiereApa&&"PENDIENTE"===e.apaEstado);s.some((e,t)=>s.slice(t+1).some(t=>e.resourceId===t.resourceId&&new Date(e.start)<new Date(t.end)&&new Date(e.end)>new Date(t.start)))?e.set(t,"conflict"):r?e.set(t,"special"):s.length>=3?e.set(t,"busy"):e.set(t,"available")}return e},[eB]);function eq(e){let t=e;"ACTIVE"===e||"RESERVADO"===e||"PENDING"===e?t="ACTIVO":"COMPLETED"===e?t="CULMINADO":"CANCELED"===e&&(t="CANCELADO");let a=t;return{className:({ACTIVO:"bg-emerald-100 border-emerald-300 text-emerald-800",CULMINADO:"bg-blue-100 border-blue-300 text-blue-800",CANCELADO:"bg-red-100 border-red-300 text-red-800",HOLD:"bg-amber-100 border-amber-300 text-amber-800",PENDING:"bg-slate-100 border-slate-300 text-slate-800",CONFIRMED:"bg-emerald-100 border-emerald-300 text-emerald-800",COMPLETED:"bg-blue-100 border-blue-300 text-blue-800",CANCELED:"bg-red-100 border-red-300 text-red-800"})[a]||"bg-gray-100 border-gray-300 text-gray-800",label:({ACTIVO:"Activo",CULMINADO:"Culminado",CANCELADO:"Cancelado",HOLD:"En Espera",PENDING:"Pendiente",CONFIRMED:"Confirmada",COMPLETED:"Completada",CANCELED:"Cancelada"})[a]||a}}async function eV(e){try{(await o.L.authenticatedFetch(`/api/reservas/${e}?permanent=true`,{method:"DELETE"})).ok?eR():alert("Error al eliminar la reserva")}catch(e){console.error("Error:",e),alert("Error al eliminar la reserva")}}function eU(e){return new Date(e).toTimeString().slice(0,5)}function e_(e){let t=new Date(e.end);return e.horaExtra&&e.cantidadHorasExtra&&t.setHours(t.getHours()+e.cantidadHorasExtra),t.toISOString()}function eW(e){ea(e),Y(!0)}function eY(e){ea(e);let t=new Date(e.start),a=new Date(e.end);if(ex({resourceId:e.resourceId,fecha:t.toISOString().slice(0,10),inicioHora:t.toTimeString().slice(0,5),finHora:a.toTimeString().slice(0,5),memberId:e.memberId||"",nombreContacto:e.nombreContacto||"",contacto:e.contacto||"",medioContacto:e.medioContacto||"telefono",invitados:e.invitados?.toString()||"",adelanto:e.adelanto?.toString()||"",montoTotal:e.montoTotal?.toString()||"",status:e.status,notas:e.notas||"",requiereApa:e.requiereApa||!1,acontecimiento:e.acontecimiento||"",quinceaneraFocusNombre:e.quinceaneraFocusNombre||"",noviosNombres:e.noviosNombres||"",cumpleaneroNombre:e.cumpleaneroNombre||"",otrosNombrePersona:e.otrosNombrePersona||"",otrosDescripcion:e.otrosDescripcion||"",esParaTercero:e.esParaTercero||!1,terceroNombre:e.terceroNombre||"",terceroCedula:e.terceroCedula||"",terceroTelefono:e.terceroTelefono||"",terceroRuc:e.terceroRuc||"",cantidadPersonas:e.cantidadPersonas?.toString()||"",observacionesGenerales:e.observacionesGenerales||"",horaExtra:e.horaExtra||!1,cantidadHorasExtra:e.cantidadHorasExtra||1,montoHorasExtra:e.montoHorasExtra||0,apaEstado:e.apaEstado||"PENDIENTE"}),e.memberId){let t=p.find(t=>t.id===e.memberId);t&&ep(`${t.nombres} ${t.apellidos} (${t.codigo})`)}else ep("");J(!0)}function eZ(){Y(!1),J(!1),ee(!1),ea(null),ep(""),eb(!1),el({cancelReason:"",refundType:"TOTAL",refundAmount:"",penaltyAmount:""}),ei(0)}async function eJ(e){ea(e),ee(!0);let t=await e$(e);ei(t.totalPagado),0===t.totalPagado&&el(e=>({...e,refundType:"NINGUNO"}))}async function eQ(){if(!et)return;if(!eo.cancelReason.trim()){alert("Por favor ingrese un motivo para la cancelaci\xf3n");return}if("PARCIAL"===eo.refundType){let e=parseFloat(eo.refundAmount||"0"),t=parseFloat(eo.penaltyAmount||"0");if(e<=0&&t<=0){alert("Para reembolso parcial debe especificar ambos montos");return}if(Math.abs(e+t-en)>1){alert(`La suma de reembolso (${e}) + penalizaci\xf3n (${t}) debe ser igual al total pagado (${en})`);return}}let e=`\xbfConfirmar cancelaci\xf3n de reserva?

Tipo de reembolso: ${eo.refundType}`;if(e+=`
Total reserva: Gs. ${et.montoTotal.toLocaleString("es-PY")}
Total pagado: Gs. ${en.toLocaleString("es-PY")}`,"NINGUNO"===eo.refundType?e+=`

El club retendr\xe1: Gs. ${en.toLocaleString("es-PY")}`:"TOTAL"===eo.refundType?e+=`

Se devolver\xe1 al socio: Gs. ${en.toLocaleString("es-PY")}`:"PARCIAL"===eo.refundType&&(e+=`

Reembolso al socio: Gs. ${parseFloat(eo.refundAmount||"0").toLocaleString("es-PY")}
Penalizaci\xf3n (club retiene): Gs. ${parseFloat(eo.penaltyAmount||"0").toLocaleString("es-PY")}`),confirm(e)){er(!0);try{let e={cancelReason:eo.cancelReason,refundType:eo.refundType};"PARCIAL"===eo.refundType&&(e.refundAmount=parseFloat(eo.refundAmount||"0"),e.penaltyAmount=parseFloat(eo.penaltyAmount||"0"));let t=await o.L.authenticatedFetch(`/api/reservas/${et.id}/cancel`,{method:"PATCH",body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.msg||"Error al cancelar reserva")}let a=(await t.json()).cancellationDetails;alert(`✅ Reserva cancelada exitosamente

Tipo de reembolso: ${a.refundType}
Monto total reserva: Gs. ${a.totalAmount.toLocaleString("es-PY")}
Total pagado: Gs. ${a.totalPagado.toLocaleString("es-PY")}
Reembolso al socio: Gs. ${a.refundAmount.toLocaleString("es-PY")}
Penalizaci\xf3n (club retiene): Gs. ${a.penaltyAmount.toLocaleString("es-PY")}
Pagos eliminados: ${a.deletedPayments}
Movimientos creados: ${a.movementsCreated}`),eZ(),await eM()}catch(e){console.error("Error canceling reservation:",e),alert(`❌ Error: ${e instanceof Error?e.message:"Error desconocido"}`)}finally{er(!1)}}}async function eX(){if(!et)return;let e=function(){let e=[];if(em.resourceId||e.push("Debe seleccionar un sal\xf3n"),em.fecha||e.push("Debe seleccionar una fecha"),em.inicioHora||e.push("Debe especificar hora de inicio"),em.finHora||e.push("Debe especificar hora de fin"),em.fecha&&em.inicioHora&&em.finHora){let t=new Date(`${em.fecha}T${em.inicioHora}:00`),a=new Date(`${em.fecha}T${em.finHora}:00`);if(a<=t&&a.setDate(a.getDate()+1),isNaN(t.getTime())||isNaN(a.getTime()))e.push("Las fechas y horas no son v\xe1lidas");else{t<new Date(new Date().getTime()-36e5)&&e.push("No se pueden crear reservas en el pasado");let s=(a.getTime()-t.getTime())/36e5;s<.5&&e.push("La duraci\xf3n m\xednima es de 30 minutos"),s>24&&e.push("La duraci\xf3n m\xe1xima es de 24 horas")}}return em.invitados&&(isNaN(Number(em.invitados))||0>Number(em.invitados))&&e.push("El n\xfamero de invitados debe ser v\xe1lido"),em.montoTotal&&(isNaN(Number(em.montoTotal))||0>Number(em.montoTotal))&&e.push("El monto total debe ser v\xe1lido"),em.adelanto&&(isNaN(Number(em.adelanto))||0>Number(em.adelanto))&&e.push("El adelanto debe ser v\xe1lido"),em.adelanto&&em.montoTotal&&Number(em.adelanto)>Number(em.montoTotal)&&e.push("El adelanto no puede ser mayor al monto total"),em.nombreContacto?.trim()||em.contacto?.trim()||e.push("Debe especificar al menos un nombre de contacto o informaci\xf3n de contacto"),e}();if(e.length>0)return alert("Errores en el formulario:\n\n• "+e.join("\n• "));let t=new Date(`${em.fecha}T${em.inicioHora}:00`),a=new Date(`${em.fecha}T${em.finHora}:00`),s=new Date(et.start),r=new Date(et.end);if(t.getTime()!==s.getTime()||a.getTime()!==r.getTime()||em.resourceId!==et.resourceId){let e=d.filter(e=>e.id!==et.id&&e.resourceId===em.resourceId&&"CANCELED"!==e.status&&new Date(e.start)<a&&new Date(e.end)>t);if(e.length>0&&!function(e){let t=e.map(e=>`• ${e.nombreContacto||"Sin nombre"} - ${eU(e.start)}-${eU(e.end)}`).join("\n");return confirm(`⚠️ CONFLICTO DE HORARIOS

Ya hay reservas en este horario:
${t}

\xbfDeseas continuar de todas formas?`)}(e))return}er(!0);try{let e;let s=g.find(e=>e.id===j);if(s){let t;s.espaciosDisponibles&&s.espaciosDisponibles.length>0&&(t=s.espaciosDisponibles.find(e=>e.id===em.resourceId))&&"number"==typeof t.precioHoraExtra&&(e=t.precioHoraExtra),"number"!=typeof e&&"number"==typeof s.precioHoraExtra&&(e=s.precioHoraExtra)}et?.horaExtra&&et.cantidadHorasExtra;let r={resourceId:em.resourceId,start:t.toISOString(),end:a.toISOString(),memberId:em.memberId||void 0,nombreContacto:em.nombreContacto||void 0,contacto:em.contacto||void 0,medioContacto:em.medioContacto,invitados:em.invitados?Number(em.invitados):void 0,adelanto:em.adelanto?Number(em.adelanto):void 0,montoTotal:em.montoTotal?Number(em.montoTotal):void 0,status:em.status,notas:em.notas||void 0,horaExtra:em.horaExtra||!1,cantidadHorasExtra:em.horaExtra?em.cantidadHorasExtra:void 0,montoHorasExtra:em.horaExtra?em.montoHorasExtra:void 0,acontecimiento:em.acontecimiento||void 0,quinceaneraFocusNombre:em.quinceaneraFocusNombre||void 0,noviosNombres:em.noviosNombres||void 0,cumpleaneroNombre:em.cumpleaneroNombre||void 0,otrosNombrePersona:em.otrosNombrePersona||void 0,otrosDescripcion:em.otrosDescripcion||void 0,esParaTercero:em.esParaTercero||!1,terceroNombre:em.terceroNombre||void 0,terceroCedula:em.terceroCedula||void 0,terceroTelefono:em.terceroTelefono||void 0,terceroRuc:em.terceroRuc||void 0,cantidadPersonas:em.cantidadPersonas?Number(em.cantidadPersonas):void 0,observacionesGenerales:em.observacionesGenerales||void 0};em.requiereApa?(r.requiereApa=!0,r.apaEstado=em.apaEstado||"PENDIENTE"):(r.requiereApa=!1,r.apaEstado="NO_APLICA");let l=await o.L.authenticatedFetch(`/api/reservas/${et.id}`,{method:"PATCH",body:JSON.stringify(r)}),n=await l.json().catch(()=>({}));if(!l.ok)return console.error(n),alert(n?.msg||"No se pudo actualizar la reserva");alert("Reserva actualizada exitosamente"),eZ(),await eM()}catch(e){console.error(e),alert(e?.message||"Error actualizando reserva")}finally{er(!1)}}return(0,l.useMemo)(()=>{if(!eu.trim())return p.slice(0,10);let e=eu.toLowerCase();return p.filter(t=>t.nombres.toLowerCase().includes(e)||t.apellidos.toLowerCase().includes(e)||t.codigo.toLowerCase().includes(e)).slice(0,10)},[eu,p]),s.jsx(r.Z,{children:s.jsx(s.Fragment,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 tracking-tight",children:"Reservas"}),!f&&(0,s.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:[d.length," ",1===d.length?"reserva":"reservas"]})]}),s.jsx("p",{className:"text-slate-600 mt-1 text-sm sm:text-base",children:"Gestion\xe1 salones, reservas y pagos parciales con facilidad"})]}),s.jsx("div",{className:"flex gap-3",children:(0,s.jsxs)("button",{onClick:()=>O(!0),className:"inline-flex items-center px-3 sm:px-4 py-2.5 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40 hover:scale-105",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("span",{className:"hidden sm:inline",children:"Historial de Reservas"}),s.jsx("span",{className:"sm:hidden",children:"Historial"})]})})]}),s.jsx("div",{className:"bg-gradient-to-r from-white to-slate-50 p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 sm:gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-lg p-1",children:[(0,s.jsxs)("button",{onClick:()=>eD("year"),className:`flex items-center gap-1 px-2 sm:px-3 py-1.5 text-xs sm:text-sm font-medium rounded-md transition-all duration-200 ${"year"===eE?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,title:"Vista anual - Ver todos los 12 meses",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),s.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),s.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),s.jsx("span",{className:"hidden sm:inline",children:"A\xf1o Completo"})]}),(0,s.jsxs)("button",{onClick:()=>eD("month"),className:`flex items-center gap-1 px-2 sm:px-3 py-1.5 text-xs sm:text-sm font-medium rounded-md transition-all duration-200 ${"month"===eE?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,title:"Vista mensual - Un mes espec\xedfico",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),s.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),s.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"}),s.jsx("path",{d:"M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"})]}),s.jsx("span",{className:"hidden sm:inline",children:"Mes Individual"})]})]}),s.jsx("button",{onClick:function(){let e=new Date(q);e.setMonth(e.getMonth()-1),V(e)},className:"border border-slate-300 rounded-lg p-2.5 hover:bg-slate-50 hover:border-slate-400 transition-all duration-200 text-slate-600 hover:text-slate-900",title:"Mes anterior",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("select",{value:q.getMonth(),onChange:e=>{let t=parseInt(e.target.value,10);V(new Date(q.getFullYear(),t,1))},className:"border border-slate-300 rounded-lg px-3 py-2 text-sm w-28 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 mr-2","aria-label":"Seleccionar mes",title:"Seleccionar mes",children:Array.from({length:12}).map((e,t)=>s.jsx("option",{value:t,children:new Date(2e3,t,1).toLocaleString("es-ES",{month:"long"}).replace(/^\w/,e=>e.toUpperCase())},t))}),s.jsx("select",{value:q.getFullYear(),onChange:e=>{V(new Date(parseInt(e.target.value,10),q.getMonth(),1))},className:"border border-slate-300 rounded-lg px-3 py-2 text-sm w-24 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200","aria-label":"Seleccionar a\xf1o",title:"Seleccionar a\xf1o",children:(()=>{let e=Math.max(2025,new Date().getFullYear());return Array.from({length:11}).map((t,a)=>{let r=e+a;return s.jsx("option",{value:r,children:r},r)})})()}),s.jsx("button",{onClick:function(){let e=new Date(q);e.setMonth(e.getMonth()+1),V(e)},className:"border border-slate-300 rounded-lg p-2.5 hover:bg-slate-50 hover:border-slate-400 transition-all duration-200 text-slate-600 hover:text-slate-900",title:"Mes siguiente",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 sm:p-6",children:"year"===eE?s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:eF.map(({month:e,matrix:t})=>(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-white shadow-sm",children:[s.jsx("div",{className:"text-center mb-2",children:s.jsx("span",{className:"font-bold text-slate-900 text-sm",children:new Date(q.getFullYear(),e).toLocaleString("es-ES",{month:"long"}).replace(/^\w/,e=>e.toUpperCase())})}),s.jsx("div",{className:"grid grid-cols-7 gap-1 text-xs font-medium text-slate-500 mb-2",children:["L","M","X","J","V","S","D"].map(e=>s.jsx("div",{className:"text-center py-1",children:e},e))}),s.jsx("div",{className:"grid grid-cols-7 gap-1",children:t.map((t,a)=>s.jsx("div",{className:"contents",children:t.map((t,a)=>{let r=t.getMonth()!==e,o=eH(t),l=eB.get(o)||[],n=ez.get(o),i="",c="border-slate-200";if(!r&&l.length>0)switch(n){case"conflict":i="bg-gradient-to-br from-red-50 to-red-100",c="border-red-300";break;case"special":i="bg-gradient-to-br from-purple-50 to-purple-100",c="border-purple-300";break;case"busy":i="bg-gradient-to-br from-amber-50 to-amber-100",c="border-amber-300";break;default:i="bg-gradient-to-br from-emerald-50 to-emerald-100",c="border-emerald-300"}return s.jsx("div",{className:`h-8 border rounded flex items-center justify-center text-xs font-medium cursor-pointer hover:shadow-sm transition-all duration-200 relative ${r?"text-slate-300 bg-slate-50":l.length>0?`${i} ${c} text-slate-700 hover:shadow-md`:"text-slate-600 bg-white hover:bg-slate-50 border-slate-200"} ${S===o?"ring-2 ring-blue-600 bg-blue-100 border-blue-400 shadow-md":""}`,title:r?"":S===o?`${l.length} reserva(s) - Clic para quitar filtro`:l.length>0?`${l.length} reserva(s) - Clic para filtrar`:"Clic para ver reservas de este d\xeda",onClick:r?void 0:()=>{S===o?L(""):L(o)},onMouseEnter:!r&&l.length>0?e=>eA(o,e):void 0,onMouseLeave:ek,children:(0,s.jsxs)("span",{className:"relative",children:[t.getDate(),!r&&l.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 min-w-[12px] h-3 bg-blue-500 rounded-full text-[8px] text-white flex items-center justify-center px-0.5 font-bold",children:l.length>9?"9+":l.length})]})},a)})},a))})]},e))}):s.jsx("div",{className:"max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[s.jsx("div",{className:"text-center mb-4",children:s.jsx("span",{className:"font-bold text-slate-900 text-xl",children:q.toLocaleString("es-ES",{month:"long",year:"numeric"}).replace(/^\w/,e=>e.toUpperCase())})}),s.jsx("div",{className:"grid grid-cols-7 gap-2 text-sm font-medium text-slate-500 mb-3",children:["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"].map(e=>s.jsx("div",{className:"text-center py-2",children:e},e))}),s.jsx("div",{className:"grid grid-cols-7 gap-2",children:eF.find(e=>e.month===q.getMonth())?.matrix.map((e,t)=>s.jsx("div",{className:"contents",children:e.map((e,t)=>{let a=e.getMonth()===q.getMonth(),r=eH(e),o=eB.get(r)||[],l=ez.get(r),n="",i="border-slate-200";if(a&&o.length>0)switch(l){case"conflict":n="bg-gradient-to-br from-red-50 to-red-100",i="border-red-300";break;case"special":n="bg-gradient-to-br from-purple-50 to-purple-100",i="border-purple-300";break;case"busy":n="bg-gradient-to-br from-amber-50 to-amber-100",i="border-amber-300";break;default:n="bg-gradient-to-br from-emerald-50 to-emerald-100",i="border-emerald-300"}return s.jsx("div",{className:`h-16 border rounded-lg flex flex-col items-center justify-center text-sm font-medium cursor-pointer hover:shadow-sm transition-all duration-200 relative ${a?o.length>0?`${n} ${i} text-slate-700 hover:shadow-md`:"text-slate-600 bg-white hover:bg-slate-50 border-slate-200":"text-slate-300 bg-slate-50"} ${S===r?"ring-2 ring-blue-600 bg-blue-100 border-blue-400 shadow-md":""}`,title:a?S===r?`${o.length} reserva(s) - Clic para quitar filtro`:o.length>0?`${o.length} reserva(s) - Clic para filtrar`:"Clic para ver reservas de este d\xeda":"",onClick:a?()=>{S===r?L(""):L(r)}:void 0,onMouseEnter:a&&o.length>0?e=>eA(r,e):void 0,onMouseLeave:ek,children:s.jsxs("span",{className:"relative text-lg",children:[e.getDate(),a&&o.length>0&&s.jsx("span",{className:"absolute -top-2 -right-2 min-w-[16px] h-4 bg-blue-500 rounded-full text-[10px] text-white flex items-center justify-center px-1 font-bold",children:o.length>9?"9+":o.length})]})},t)})},t))})]})})}),(0,s.jsxs)("div",{className:"bg-gradient-to-r from-white to-slate-50 p-4 sm:p-6 rounded-xl shadow-sm border border-slate-200 space-y-4 sm:space-y-0 sm:flex sm:flex-wrap sm:gap-4 sm:items-end backdrop-blur-sm",children:[(0,s.jsxs)("div",{className:"min-w-[180px]",children:[s.jsx("label",{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Servicios"}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,s.jsxs)("select",{value:j,onChange:e=>eI(e.target.value),className:"w-full border border-slate-300 rounded-lg pl-10 pr-10 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 appearance-none bg-white hover:border-slate-400 hover:shadow-sm",children:[s.jsx("option",{value:"",children:"Todos los servicios"}),g.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]}),s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),j&&eT(j).length>0&&(0,s.jsxs)("div",{className:"min-w-[180px]",children:[s.jsx("label",{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Espacios"}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,s.jsxs)("select",{value:y,onChange:e=>C(e.target.value),className:"w-full border border-slate-300 rounded-lg pl-10 pr-10 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 appearance-none bg-white hover:border-slate-400 hover:shadow-sm",children:[s.jsx("option",{value:"",children:"Todos los espacios"}),eT(j).map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]}),s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,s.jsxs)("div",{className:"min-w-[160px]",children:[s.jsx("label",{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Fecha espec\xedfica"}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),s.jsx("input",{type:"date",value:S,onChange:e=>L(e.target.value),className:"w-full border border-slate-300 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white hover:border-slate-400 hover:shadow-sm"}),S&&s.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",title:"Limpiar fecha",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[s.jsx("label",{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Buscar"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("div",{className:"w-32",children:(0,s.jsxs)("select",{value:T,onChange:e=>P(e.target.value),className:"w-full border border-slate-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white hover:border-slate-400 hover:shadow-sm",children:[s.jsx("option",{value:"contacto",children:"Contacto"}),s.jsx("option",{value:"evento",children:"Evento"})]})}),(0,s.jsxs)("div",{className:"relative flex-1",children:[s.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{value:A,onChange:e=>k(e.target.value),placeholder:"contacto"===T?"Buscar por cliente, tel\xe9fono, email...":"Buscar por tipo de evento, descripci\xf3n...",className:"w-full border border-slate-300 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white hover:border-slate-400 hover:shadow-sm"}),A&&s.jsx("button",{onClick:()=>k(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",title:"Limpiar b\xfasqueda",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-end px-4 pt-4 pb-2",children:[s.jsx("button",{onClick:function(){a.e(5603).then(a.bind(a,25603)).then(e=>{let t=d.map(e=>{let t="";e.acontecimiento&&(t="15_anos"===e.acontecimiento?"Quincea\xf1era":"boda"===e.acontecimiento?"Boda":"cumpleanos"===e.acontecimiento?"Cumplea\xf1os":"Otro");let a=e.quinceaneraFocusNombre||e.noviosNombres||e.cumpleaneroNombre||e.otrosNombrePersona||"",s=t?a?`${t} - ${a}`:t:"",r=e.nombreContacto||"",o=e.acontecimiento||"",l="15_anos"===o?"15 a\xf1os":"cumpleanos"===o?"Cumplea\xf1os":"boda"===o?"Boda":"otros"===o?"Otro":o,n=l?`${r} - ${l}`:r;return{Fecha:new Date(e.start).toLocaleDateString("es-ES"),Horario:`${eU(e.start)} - ${eU(e.end)}`,"Servicio/Espacio":(()=>{let t=eO(e);return t.hasSpace?`${t.serviceName} - ${t.spaceName}`:t.serviceName})(),Evento:s,Contacto:n,Teléfono:e.contacto||"",Monto:e.montoTotal||0,Saldo:(e.montoTotal||0)-(B[e.id]?.totalPagado||0),APA:e.requiereApa?e.apaEstado||"Pendiente":"No aplica"}}),a=e.utils.json_to_sheet(t),s=e.utils.book_new();e.utils.book_append_sheet(s,a,"Reservas"),e.writeFile(s,`reservas_${new Date().toISOString().slice(0,10)}.xlsx`)})},className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-colors text-sm font-semibold",children:"Excel"}),s.jsx("button",{onClick:e,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition-colors text-sm font-semibold",children:"PDF"})]}),f?s.jsx("div",{className:"p-12 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[s.jsx("div",{className:"relative",children:s.jsx("div",{className:"w-12 h-12 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-lg font-semibold text-slate-700",children:"Cargando reservas"}),s.jsx("p",{className:"text-sm text-slate-500",children:"Obteniendo informaci\xf3n actualizada..."})]})]})}):0===d.length?s.jsx("div",{className:"p-12 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-6",children:[(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center"}),s.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2",fill:"none"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-4.35-4.35"})]})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700",children:"Sin reservas para este per\xedodo"}),s.jsx("p",{className:"text-slate-500 max-w-md mx-auto",children:"No se encontraron reservas con los filtros actuales. Las nuevas reservas aparecer\xe1n aqu\xed autom\xe1ticamente."})]}),s.jsx("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:s.jsx("span",{children:"Tip: Intenta cambiar los filtros o el per\xedodo de fechas"})})]})}):s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200",children:(0,s.jsxs)("tr",{className:"text-xs uppercase tracking-wide text-slate-700",children:[s.jsx("th",{className:"px-3 sm:px-6 py-4 text-left font-bold",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Fecha & Horario"]})}),s.jsx("th",{className:"hidden lg:table-cell px-6 py-4 text-left font-bold",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Servicio/Espacio"]})}),s.jsx("th",{className:"hidden lg:table-cell px-6 py-4 text-left font-bold",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"})}),"Evento"]})}),s.jsx("th",{className:"px-3 sm:px-6 py-4 text-left font-bold",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Contacto"]})}),s.jsx("th",{className:"hidden lg:table-cell px-6 py-4 text-left font-bold",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),"Monto"]})}),s.jsx("th",{className:"hidden lg:table-cell px-6 py-4 text-left font-bold",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Saldo"]})}),s.jsx("th",{className:"hidden sm:table-cell px-6 py-4 text-center font-bold",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"APA"]})}),s.jsx("th",{className:"px-3 sm:px-6 py-4 text-right font-bold",children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})}),"Acciones"]})})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:d.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-slate-50 transition-all duration-200 hover:shadow-sm border-b border-slate-100",children:[s.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4",children:s.jsx("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("div",{className:"min-w-0",children:[s.jsx("div",{className:"text-xs sm:text-sm font-bold text-slate-900",children:new Date(e.start).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})}),(0,s.jsxs)("div",{className:"text-xs text-slate-600",children:[eU(e.start),"–",eU(e_(e)),(0,s.jsxs)("span",{className:"text-slate-400 ml-1",children:["(",e.horaExtra&&e.cantidadHorasExtra?`${e.cantidadHorasExtra}h`:"0h",")"]})]})]})})}),s.jsx("td",{className:"hidden lg:table-cell px-6 py-4",children:s.jsx("div",{className:"min-w-0",children:s.jsx("div",{className:"text-sm font-medium text-slate-900 truncate",children:(()=>{let t=eO(e);return(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-semibold text-slate-900",children:t.serviceName}),t.hasSpace&&t.spaceName!==t.serviceName&&s.jsx("div",{className:"text-xs text-slate-500",children:t.spaceName})]})})()})})}),s.jsx("td",{className:"hidden lg:table-cell px-6 py-4",children:e.acontecimiento?(0,s.jsxs)("div",{children:[s.jsx("div",{className:"text-sm font-medium capitalize text-slate-900",children:"15_anos"===e.acontecimiento?"Quincea\xf1era":"boda"===e.acontecimiento?"Boda":"cumpleanos"===e.acontecimiento?"Cumplea\xf1os":"Otro"}),s.jsx("div",{className:"text-xs text-slate-500 truncate max-w-[120px]",children:e.quinceaneraFocusNombre||e.noviosNombres||e.cumpleaneroNombre||e.otrosNombrePersona||""})]}):s.jsx("span",{className:"text-xs italic text-slate-400",children:"Sin especificar"})}),s.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4",children:s.jsx("div",{className:"flex items-center gap-1 sm:gap-2",children:(0,s.jsxs)("div",{className:"min-w-0",children:[s.jsx("div",{className:"text-xs sm:text-sm font-semibold text-slate-900 truncate",children:e.nombreContacto||"—"}),s.jsx("div",{className:"sm:hidden text-[10px] text-slate-500",children:(()=>{let t=eO(e);return t.serviceName===t.spaceName?t.serviceName:`${t.serviceName} - ${t.spaceName}`})()}),e.esParaTercero&&(0,s.jsxs)("div",{className:"md:hidden text-[10px] text-purple-600 font-medium",children:["\uD83D\uDC64 Para: ",e.terceroNombre]}),e.acontecimiento&&(0,s.jsxs)("div",{className:"text-[10px] text-blue-600 font-medium",children:["Evento especial: ","15_anos"===e.acontecimiento?"15 a\xf1os":"cumpleanos"===e.acontecimiento?"Cumplea\xf1os":"boda"===e.acontecimiento?"Boda":"otros"===e.acontecimiento?"Otro":e.acontecimiento]}),s.jsx("div",{className:"text-xs text-slate-500",children:e.contacto?`${e.medioContacto}: ${e.contacto}`:"—"})]})})}),s.jsx("td",{className:"hidden lg:table-cell px-6 py-4 text-sm",children:(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-semibold text-slate-900",children:(0,n.xG)(e.montoTotal||0)}),Number(e.adelanto)>0?(0,s.jsxs)("div",{className:"text-xs text-green-600 font-medium",children:["Adelanto: ",(0,n.xG)(Number(e.adelanto))]}):null]})}),s.jsx("td",{className:"hidden lg:table-cell px-6 py-4 text-sm",children:(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-semibold text-amber-700",children:(0,n.xG)((e.montoTotal||0)-(B[e.id]?.totalPagado||0))}),B[e.id]?.totalPagado>0&&(0,s.jsxs)("div",{className:"text-xs text-green-600 font-medium",children:["Pagado: ",(0,n.xG)(B[e.id].totalPagado)]})]})}),s.jsx("td",{className:"hidden sm:table-cell px-6 py-4 text-center",children:e.requiereApa?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[s.jsx("button",{onClick:()=>{ea(e),X(!0)},className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105 cursor-pointer ${"APROBADO"===e.apaEstado?"bg-green-100 text-green-800 hover:bg-green-200":"ENTREGADO"===e.apaEstado?"bg-blue-100 text-blue-800 hover:bg-blue-200":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,title:"APROBADO"===e.apaEstado?"APA Aprobado - Clic para gestionar":"ENTREGADO"===e.apaEstado?"APA Entregado - Clic para gestionar":"APA Pendiente - Clic para gestionar",children:"APROBADO"===e.apaEstado?"✅":"ENTREGADO"===e.apaEstado?"\uD83D\uDCE4":"⏳"}),e.apaComprobante&&s.jsx("a",{href:e.apaComprobante,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800",title:"Ver comprobante APA",children:"Ver archivo"})]}):s.jsx("span",{className:"text-xs text-slate-400",children:"No aplica"})}),s.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 text-right",children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-0.5",children:[(0,s.jsxs)("div",{className:"group relative",children:[s.jsx("button",{onClick:()=>eW(e),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-sm",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),s.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10",children:"Ver detalles completos"})]}),(0,s.jsxs)("div",{className:"group relative",children:[s.jsx("button",{onClick:()=>eY(e),className:"p-2 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-sm",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),s.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10",children:"Editar informaci\xf3n"})]}),(0,s.jsxs)("div",{className:"group relative",children:[s.jsx("button",{onClick:()=>eJ(e),className:"p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-sm",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),s.jsx("div",{className:"absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10",children:"Cancelar reserva"})]})]})})]},e.id))})]})})]}),Z&&et&&s.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:eZ,children:(0,s.jsxs)("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-white rounded-lg shadow",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"Editar Reserva"}),s.jsx("button",{onClick:eZ,className:"text-gray-400 hover:text-gray-600",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Servicio/Espacio *"}),(0,s.jsxs)("select",{value:em.resourceId,onChange:e=>ex(t=>({...t,resourceId:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"— Seleccionar —"}),t.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Fecha *"}),s.jsx("input",{type:"date",value:em.fecha,onChange:e=>ex(t=>({...t,fecha:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Horario"}),(0,s.jsxs)("div",{className:"mt-1 grid grid-cols-2 gap-2",children:[s.jsx("input",{type:"time",value:em.inicioHora,onChange:e=>ex(t=>({...t,inicioHora:e.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Inicio"}),s.jsx("input",{type:"time",value:em.finHora,onChange:e=>ex(t=>({...t,finHora:e.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Fin"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Contacto"}),s.jsx("input",{type:"text",value:em.nombreContacto,onChange:e=>ex(t=>({...t,nombreContacto:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nombre del contacto"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Tel\xe9fono"}),s.jsx("input",{type:"text",value:em.contacto,onChange:e=>ex(t=>({...t,contacto:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"N\xfamero de tel\xe9fono"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estado"}),(0,s.jsxs)("select",{value:em.status||"ACTIVO",onChange:e=>ex(t=>({...t,status:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"ACTIVO",children:"Activo"}),s.jsx("option",{value:"CONFIRMED",children:"Confirmado"}),s.jsx("option",{value:"PENDING",children:"Pendiente"}),s.jsx("option",{value:"CULMINADO",children:"Culminado"}),s.jsx("option",{value:"CANCELADO",children:"Cancelado"})]})]})]}),(0,s.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wide mb-2",children:"\uD83D\uDCB0 Informaci\xf3n Financiera"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"Monto Total (Gs.)"}),s.jsx("input",{type:"text",value:em.montoTotal?parseInt(em.montoTotal).toLocaleString("de-DE"):"",onChange:e=>{let t=e.target.value.replace(/\./g,"");/^\d*$/.test(t)&&ex(e=>({...e,montoTotal:t}))},className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"Pagos Realizados (Gs.)"}),(0,s.jsxs)("p",{className:"mt-1 text-sm font-medium text-gray-900 py-2",children:[(0,n.xG)(B[et.id]?.totalPagado||0),B[et.id]?.pagosCount>0&&et.montoTotal&&(0,s.jsxs)("span",{className:"text-gray-500 text-xs ml-1",children:["(",Math.round(B[et.id].totalPagado/et.montoTotal*100),"%)"]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"Saldo"}),s.jsx("p",{className:"mt-1 text-sm font-bold text-amber-700 py-2",children:(0,n.xG)(Math.max(0,(parseInt(em.montoTotal.replace(/\./g,""))||0)-(B[et.id]?.totalPagado||0)))})]})]})]}),(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-blue-700 uppercase tracking-wide mb-2",children:"\uD83C\uDF89 Informaci\xf3n del Evento"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Tipo de Evento"}),(0,s.jsxs)("select",{value:em.acontecimiento||"",onChange:e=>ex(t=>({...t,acontecimiento:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Sin evento espec\xedfico"}),s.jsx("option",{value:"15_anos",children:"Quincea\xf1era"}),s.jsx("option",{value:"boda",children:"Boda"}),s.jsx("option",{value:"cumpleanos",children:"Cumplea\xf1os"}),s.jsx("option",{value:"otro",children:"Otro"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Nombre de la persona"}),s.jsx("input",{type:"text",value:em.quinceaneraFocusNombre||em.noviosNombres||em.cumpleaneroNombre||em.otrosNombrePersona||"",onChange:e=>{let t=e.target.value;ex(e=>{let a={...e};return"15_anos"===em.acontecimiento?a.quinceaneraFocusNombre=t:"boda"===em.acontecimiento?a.noviosNombres=t:"cumpleanos"===em.acontecimiento?a.cumpleaneroNombre=t:a.otrosNombrePersona=t,a})},className:"mt-1 w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nombre de la quincea\xf1era, novios, etc."})]})]}),"otro"===em.acontecimiento&&(0,s.jsxs)("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Descripci\xf3n del evento"}),s.jsx("input",{type:"text",value:em.otrosDescripcion||"",onChange:e=>ex(t=>({...t,otrosDescripcion:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe el tipo de evento"})]})]}),(0,s.jsxs)("div",{className:"bg-purple-50 rounded-lg p-3",children:[(0,s.jsxs)("h4",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide mb-2 flex items-center gap-2",children:["\uD83D\uDC64 Reserva para Tercero",(0,s.jsxs)("label",{className:"flex items-center text-xs",children:[s.jsx("input",{type:"checkbox",checked:em.esParaTercero||!1,onChange:e=>ex(t=>({...t,esParaTercero:e.target.checked})),className:"mr-1"}),"Es para tercero"]})]}),em.esParaTercero&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"Nombre"}),s.jsx("input",{type:"text",value:em.terceroNombre||"",onChange:e=>ex(t=>({...t,terceroNombre:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-purple-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Nombre del tercero"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"C\xe9dula"}),s.jsx("input",{type:"text",value:em.terceroCedula||"",onChange:e=>ex(t=>({...t,terceroCedula:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-purple-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"N\xfamero de c\xe9dula"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"Tel\xe9fono"}),s.jsx("input",{type:"text",value:em.terceroTelefono||"",onChange:e=>ex(t=>({...t,terceroTelefono:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-purple-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Tel\xe9fono del tercero"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"RUC"}),s.jsx("input",{type:"text",value:em.terceroRuc||"",onChange:e=>ex(t=>({...t,terceroRuc:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-purple-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"RUC del tercero"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-green-700 uppercase tracking-wide mb-2",children:"\uD83D\uDCDD Info Adicional"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-green-600",children:"Cantidad de Personas"}),s.jsx("input",{type:"number",value:em.cantidadPersonas||"",onChange:e=>ex(t=>({...t,cantidadPersonas:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"N\xfamero de invitados"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-green-600",children:"Observaciones"}),s.jsx("textarea",{value:em.observacionesGenerales||"",onChange:e=>ex(t=>({...t,observacionesGenerales:e.target.value})),className:"mt-1 w-full px-3 py-2 border border-green-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",rows:2,placeholder:"Observaciones generales"})]})]})]}),(0,s.jsxs)("div",{className:"bg-amber-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide mb-2",children:"\uD83D\uDD27 Extras y Requisitos"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center text-xs text-amber-600",children:[s.jsx("input",{type:"checkbox",checked:em.horaExtra||!1,onChange:e=>ex(t=>({...t,horaExtra:e.target.checked})),className:"mr-2"}),"Requiere horas extra"]}),em.horaExtra&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-amber-600",children:"Cantidad (horas)"}),s.jsx("input",{type:"number",value:em.cantidadHorasExtra||1,onChange:e=>ex(t=>({...t,cantidadHorasExtra:parseInt(e.target.value)})),className:"mt-1 w-full px-2 py-1 border border-amber-300 rounded-md text-sm",min:"1"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-amber-600",children:"Monto Extra (Gs.)"}),s.jsx("input",{type:"text",value:em.montoHorasExtra?parseInt(em.montoHorasExtra.toString()).toLocaleString("de-DE"):"0",onChange:e=>{let t=e.target.value.replace(/\./g,"");/^\d*$/.test(t)&&ex(e=>({...e,montoHorasExtra:parseInt(t)||0}))},className:"mt-1 w-full px-2 py-1 border border-amber-300 rounded-md text-sm"})]})]}),(0,s.jsxs)("label",{className:"flex items-center text-xs text-amber-600",children:[s.jsx("input",{type:"checkbox",checked:em.requiereApa||!1,onChange:e=>ex(t=>({...t,requiereApa:e.target.checked})),className:"mr-2"}),"Requiere APA"]}),em.requiereApa&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-amber-600",children:"Estado APA"}),(0,s.jsxs)("select",{value:em.apaEstado||"PENDIENTE",onChange:e=>ex(t=>({...t,apaEstado:e.target.value})),className:"mt-1 w-full px-2 py-1 border border-amber-300 rounded-md text-sm",children:[s.jsx("option",{value:"PENDIENTE",children:"Pendiente"}),s.jsx("option",{value:"ENTREGADO",children:"Entregado"}),s.jsx("option",{value:"APROBADO",children:"Aprobado"}),s.jsx("option",{value:"RECHAZADO",children:"Rechazado"})]})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[s.jsx("label",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"\uD83D\uDCDD Notas"}),s.jsx("textarea",{value:em.notas,onChange:e=>ex(t=>({...t,notas:e.target.value})),className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Notas adicionales sobre la reserva"})]})]}),(0,s.jsxs)("div",{className:"p-4 border-t bg-slate-50 flex justify-end gap-2",children:[s.jsx("button",{onClick:eZ,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-medium text-gray-700 transition-colors",children:"Cancelar"}),s.jsx("button",{onClick:()=>eX(),disabled:es,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors disabled:opacity-50",children:es?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1 inline animate-spin",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M4 12a8 8 0 018-8"})]}),"Actualizando…"]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Actualizar Reserva"]})})]})]})}),W&&et&&s.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:eZ,children:(0,s.jsxs)("div",{className:"w-full max-w-4xl max-h-[85vh] overflow-y-auto bg-white rounded-lg shadow",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border-b bg-slate-50",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"\uD83D\uDCCB Detalles de Reserva"}),s.jsx("button",{onClick:eZ,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-200 transition-colors","aria-label":"Cerrar",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-2",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Servicio/Espacio"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:(()=>{let e=eO(et);return e.hasSpace?`${e.serviceName} - ${e.spaceName}`:e.serviceName})()})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Fecha"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:new Date(et.start).toLocaleDateString()})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Horario"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[eU(et.start)," - ",eU(e_(et)),(0,s.jsxs)("span",{className:"text-gray-500 text-xs ml-1",children:["(",et.horaExtra&&et.cantidadHorasExtra?`+${et.cantidadHorasExtra}h extra`:"Sin horas extra",")"]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Contacto"}),s.jsx("p",{className:"text-sm font-medium text-gray-900",children:et.nombreContacto||"—"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Medio"}),s.jsx("p",{className:"text-sm text-gray-700",children:et.contacto?`${et.medioContacto}: ${et.contacto}`:"—"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estado"}),s.jsx("div",{className:"mt-0.5",children:function(e){let t=e;"ACTIVE"===e||"RESERVADO"===e||"PENDING"===e?t="ACTIVO":"COMPLETED"===e?t="CULMINADO":"CANCELED"===e&&(t="CANCELADO");let a=t,r={ACTIVO:"bg-emerald-100 border border-emerald-200 text-emerald-700",CULMINADO:"bg-blue-100 border border-blue-200 text-blue-700",CANCELADO:"bg-red-100 border border-red-200 text-red-700",HOLD:"bg-amber-100 border border-amber-200 text-amber-700",PENDING:"bg-slate-100 border border-slate-200 text-slate-700",CONFIRMED:"bg-emerald-100 border border-emerald-200 text-emerald-700",COMPLETED:"bg-blue-100 border border-blue-200 text-blue-700",CANCELED:"bg-red-100 border border-red-200 text-red-700"}[a]||"bg-slate-100 border border-slate-200 text-slate-700";return(0,s.jsxs)("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-semibold shadow-sm ${r}`,children:[s.jsx("span",{className:"text-[10px]",children:{ACTIVO:"✅",CULMINADO:"\uD83C\uDFC1",CANCELADO:"❌",HOLD:"⏳",PENDING:"⏱️",CONFIRMED:"✅",COMPLETED:"\uD83C\uDFC1",CANCELED:"❌"}[a]||"•"}),s.jsx("span",{children:{ACTIVO:"Activo",CULMINADO:"Culminado",CANCELADO:"Cancelado",HOLD:"En Espera",PENDING:"Pendiente",CONFIRMED:"Confirmada",COMPLETED:"Completada",CANCELED:"Cancelada"}[a]||a})]})}(et.status)})]})]}),(0,s.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wide mb-2",children:"\uD83D\uDCB0 Informaci\xf3n Financiera"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-2",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"Monto Total"}),s.jsx("p",{className:"text-sm font-bold text-gray-900",children:(0,n.xG)(et.montoTotal||0)})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"Pagos Realizados"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[(0,n.xG)(B[et.id]?.totalPagado||0),B[et.id]?.pagosCount>0&&et.montoTotal&&(0,s.jsxs)("span",{className:"text-gray-500 text-xs ml-1",children:["(",Math.round(B[et.id].totalPagado/et.montoTotal*100),"%)"]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-gray-500",children:"Saldo"}),s.jsx("p",{className:"text-sm font-bold text-amber-700",children:(0,n.xG)((et.montoTotal||0)-(B[et.id]?.totalPagado||0))})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[et.acontecimiento&&(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-blue-700 uppercase tracking-wide mb-2 flex items-center gap-1",children:"\uD83C\uDF89 Informaci\xf3n del Evento"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-1",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Tipo"}),s.jsx("p",{className:"text-sm font-medium text-blue-900 capitalize",children:"15_anos"===et.acontecimiento?"Quincea\xf1era":"boda"===et.acontecimiento?"Boda":"cumpleanos"===et.acontecimiento?"Cumplea\xf1os":"Otro"})]}),et.quinceaneraFocusNombre&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Quincea\xf1era"}),s.jsx("p",{className:"text-sm text-blue-900",children:et.quinceaneraFocusNombre})]}),et.noviosNombres&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Novios"}),s.jsx("p",{className:"text-sm text-blue-900",children:et.noviosNombres})]}),et.cumpleaneroNombre&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Cumplea\xf1ero/a"}),s.jsx("p",{className:"text-sm text-blue-900",children:et.cumpleaneroNombre})]}),et.otrosNombrePersona&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Contacto evento"}),s.jsx("p",{className:"text-sm text-blue-900",children:et.otrosNombrePersona})]})]}),et.otrosDescripcion&&(0,s.jsxs)("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs text-blue-600",children:"Descripci\xf3n"}),s.jsx("p",{className:"text-sm text-blue-900",children:et.otrosDescripcion})]})]}),et.esParaTercero&&(0,s.jsxs)("div",{className:"bg-purple-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-purple-700 uppercase tracking-wide mb-2 flex items-center gap-1",children:"\uD83D\uDC64 Reserva para Tercero"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-x-4 gap-y-1",children:[et.terceroNombre&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"Nombre"}),s.jsx("p",{className:"text-sm font-medium text-purple-900",children:et.terceroNombre})]}),et.terceroCedula&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"C\xe9dula"}),s.jsx("p",{className:"text-sm text-purple-900",children:et.terceroCedula})]}),et.terceroTelefono&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"Tel\xe9fono"}),s.jsx("p",{className:"text-sm text-purple-900",children:et.terceroTelefono})]}),et.terceroRuc&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-purple-600",children:"RUC"}),s.jsx("p",{className:"text-sm text-purple-900",children:et.terceroRuc})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(et.cantidadPersonas||et.observacionesGenerales)&&(0,s.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-green-700 uppercase tracking-wide mb-2",children:"\uD83D\uDCDD Info Adicional"}),(0,s.jsxs)("div",{className:"space-y-1",children:[et.cantidadPersonas&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-green-600",children:"Personas"}),s.jsx("p",{className:"text-sm font-medium text-green-900",children:et.cantidadPersonas})]}),et.observacionesGenerales&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-green-600",children:"Observaciones"}),s.jsx("p",{className:"text-sm text-green-900",children:et.observacionesGenerales})]})]})]}),(et.horaExtra||et.requiereApa)&&(0,s.jsxs)("div",{className:"bg-amber-50 rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs font-semibold text-amber-700 uppercase tracking-wide mb-2",children:"\uD83D\uDD27 Extras y Requisitos"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[et.horaExtra&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-amber-600",children:"Horas Extra"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-amber-900",children:[et.cantidadHorasExtra||0,"h"]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-xs text-amber-600",children:"Monto Extra"}),s.jsx("p",{className:"text-sm font-bold text-amber-900",children:(0,n.xG)(et.montoHorasExtra||0)})]})]}),et.requiereApa&&s.jsx(s.Fragment,{children:(0,s.jsxs)("div",{className:"col-span-2",children:[s.jsx("label",{className:"text-xs text-amber-600",children:"Estado APA"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${"APROBADO"===et.apaEstado?"bg-green-100 text-green-800":"ENTREGADO"===et.apaEstado?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:"APROBADO"===et.apaEstado?"✅ Aprobado":"ENTREGADO"===et.apaEstado?"\uD83D\uDCE4 Entregado":"⏳ Pendiente"}),s.jsx("button",{onClick:()=>X(!0),className:"inline-flex items-center gap-1 px-2 py-1 bg-amber-600 text-white text-xs rounded-md hover:bg-amber-700 transition-colors",children:"Gestionar"})]}),et.apaComprobante&&s.jsx("div",{className:"mt-1",children:s.jsx("a",{href:et.apaComprobante,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1",children:"Ver comprobante"})})]})})]})]})]})]}),et.notas&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[s.jsx("label",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"\uD83D\uDCDD Notas"}),s.jsx("p",{className:"text-sm text-gray-700 mt-1",children:et.notas})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-200 grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:"font-medium",children:"Creada:"})," ",new Date(et.createdAt).toLocaleDateString()]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"font-medium",children:"Actualizada:"})," ",new Date(et.updatedAt).toLocaleDateString()]})]})]}),(0,s.jsxs)("div",{className:"p-3 border-t bg-slate-50 flex justify-end gap-2",children:[s.jsx("button",{onClick:eZ,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm font-medium text-gray-700 transition-colors",children:"Cerrar"}),s.jsx("button",{onClick:()=>{eZ(),eY(et)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors",children:"Editar Reserva"})]})]})}),I&&s.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>O(!1),children:s.jsx("div",{className:"w-full max-w-6xl bg-white rounded-lg shadow max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"\uD83D\uDCCB Historial de Reservas"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Reservas culminadas y canceladas"})]}),s.jsx("button",{onClick:()=>O(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex gap-3 items-end",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar en historial"}),s.jsx("input",{type:"text",value:F,onChange:e=>H(e.target.value),onKeyDown:e=>"Enter"===e.key&&eR(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Buscar por contacto, notas, etc..."})]}),s.jsx("button",{onClick:eR,disabled:$,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:$?"Buscando...":"Buscar"})]})}),s.jsx("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600",children:"Fecha"}),s.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600",children:"Servicio/Espacio"}),s.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600",children:"Contacto"}),s.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600",children:"Monto"}),s.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600",children:"APA"}),s.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600",children:"Estado"}),s.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-600",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y",children:$?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"px-4 py-12",children:s.jsx("div",{className:"flex flex-col items-center justify-center space-y-3",children:s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Cargando historial..."})})})}):0===M.length?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"No se encontraron reservas en el historial"})}):M.map(e=>{let t=eO(e),a=new Date(e.start);return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-4 py-2",children:[s.jsx("div",{className:"text-sm font-medium",children:a.toLocaleDateString()}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[eU(e.start),"–",eU(e_(e))]})]}),(0,s.jsxs)("td",{className:"px-4 py-2",children:[s.jsx("div",{className:"text-sm font-medium",children:t.serviceName}),t.serviceName!==t.spaceName&&s.jsx("div",{className:"text-xs text-gray-500",children:t.spaceName})]}),(0,s.jsxs)("td",{className:"px-4 py-2",children:[s.jsx("div",{className:"text-sm font-medium",children:e.nombreContacto||"—"}),e.contacto&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[e.medioContacto,": ",e.contacto]})]}),(0,s.jsxs)("td",{className:"px-4 py-2",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:(0,n.xG)(e.montoTotal||0)}),Number(e.adelanto)>0&&(0,s.jsxs)("div",{className:"text-xs text-green-600",children:["Adelanto: ",(0,n.xG)(Number(e.adelanto))]})]}),s.jsx("td",{className:"px-4 py-2 text-center",children:e.requiereApa?s.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"APROBADO"===e.apaEstado?"bg-green-100 text-green-800":"ENTREGADO"===e.apaEstado?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:"APROBADO"===e.apaEstado?"✅":"ENTREGADO"===e.apaEstado?"\uD83D\uDCE4":"⏳"}):s.jsx("span",{className:"text-xs text-gray-400",children:"—"})}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("span",{className:`border px-2 py-0.5 rounded text-xs font-medium ${eq(e.status).className}`,children:eq(e.status).label})}),s.jsx("td",{className:"px-4 py-2 text-right",children:s.jsx("button",{onClick:()=>{confirm("\xbfEst\xe1s seguro de eliminar permanentemente esta reserva del historial?")&&eV(e.id)},className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Eliminar"})})]},e.id)})})]})})]})})}),eg&&ef&&(0,s.jsxs)("div",{className:"menu-action",style:{position:"fixed",top:ef.top,left:ef.left,minWidth:"12rem",background:"white",borderRadius:"0.5rem",boxShadow:"0 10px 40px rgba(0,0,0,0.25)",border:"1px solid #e5e7eb",zIndex:9999},children:[s.jsx("button",{onClick:()=>{ev(null),eN(null);let e=d.find(e=>e.id===eg);e&&eW(e)},className:"flex items-center gap-3 w-full text-left px-4 py-3 text-sm text-slate-700 hover:bg-slate-50 transition-colors duration-200",children:"Ver Detalles"}),s.jsx("button",{onClick:()=>{ev(null),eN(null);let e=d.find(e=>e.id===eg);e&&eY(e)},className:"flex items-center gap-3 w-full text-left px-4 py-3 text-sm text-blue-600 hover:bg-blue-50 transition-colors duration-200",children:"Editar"}),s.jsx("button",{onClick:()=>{ev(null),eN(null);let e=d.find(e=>e.id===eg);e&&eJ(e)},className:"flex items-center gap-3 w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200 border-t border-slate-100",children:"Cancelar Reserva"})]}),ej&&ey&&(0,s.jsxs)("div",{className:"fixed bg-white border border-slate-200 rounded-xl shadow-lg z-50 p-4",style:{top:ey.top,left:ey.left,width:"450px"},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h4",{className:"font-semibold text-slate-900",children:new Date(ej+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})}),(0,s.jsxs)("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium",children:[eB.get(ej)?.length||0," reservas"]})]}),s.jsx("div",{className:"max-h-80 overflow-y-auto space-y-2",children:(eB.get(ej)||[]).map(e=>{let t=eO(e),a=eq(e.status),r=t.serviceName===t.spaceName?t.serviceName:t.hasSpace?t.spaceName:t.serviceName,o=e.acontecimiento?"15_anos"===e.acontecimiento?"\uD83C\uDF89 Quincea\xf1era":"boda"===e.acontecimiento?"\uD83C\uDF89 Boda":"cumpleanos"===e.acontecimiento?"\uD83C\uDF89 Cumplea\xf1os":"\uD83C\uDF89 Evento":null;return s.jsx("div",{className:"border border-slate-200 rounded-lg px-3 py-2 hover:bg-slate-50 cursor-pointer transition-colors duration-200",onClick:()=>{ek(),eW(e)},children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("span",{className:"font-medium text-slate-900 truncate",children:r}),s.jsx("span",{className:"text-slate-400",children:"•"}),(0,s.jsxs)("span",{className:"text-slate-600 whitespace-nowrap",children:[eU(e.start)," - ",eU(e_(e))]}),o&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("span",{className:"text-slate-400",children:"•"}),s.jsx("span",{className:"text-blue-600 truncate",children:o})]})]}),s.jsx("span",{className:`border px-2 py-0.5 rounded-md text-xs font-medium ml-2 whitespace-nowrap ${a.className}`,children:a.label})]})},e.id)})})]}),Q&&et&&s.jsx(b,{reservationId:et.id,currentFile:et.apaComprobante,currentStatus:et.apaEstado,isAdmin:!0,onClose:()=>{X(!1),ea(null)},onFileUploaded:eG}),K&&et&&s.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:eZ,children:(0,s.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow-xl",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-red-50",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-800 flex items-center gap-2",children:"❌ Cancelar Reserva"}),s.jsx("button",{onClick:eZ,className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-200 transition-colors",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-slate-700 mb-2",children:"Datos de la Reserva"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Espacio:"}),s.jsx("p",{className:"font-medium",children:(()=>{let e=eO(et);return e.hasSpace?`${e.serviceName} - ${e.spaceName}`:e.serviceName})()})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Fecha:"}),s.jsx("p",{className:"font-medium",children:new Date(et.start).toLocaleDateString("es-ES")})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Contacto:"}),s.jsx("p",{className:"font-medium",children:et.nombreContacto})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-slate-500",children:"Monto Total:"}),s.jsx("p",{className:"font-bold text-lg",children:(0,n.xG)(et.montoTotal)})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Motivo de Cancelaci\xf3n *"}),s.jsx("textarea",{value:eo.cancelReason,onChange:e=>el(t=>({...t,cancelReason:e.target.value})),placeholder:"Explique el motivo de la cancelaci\xf3n...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Tipo de Reembolso *"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-slate-50 transition-colors",style:{borderColor:"NINGUNO"===eo.refundType?"#dc2626":"#e2e8f0"},children:[s.jsx("input",{type:"radio",name:"refundType",value:"NINGUNO",checked:"NINGUNO"===eo.refundType,onChange:e=>el(e=>({...e,refundType:"NINGUNO",refundAmount:"",penaltyAmount:""})),className:"mt-1 w-4 h-4 text-red-600"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-slate-900",children:"Sin Reembolso"}),(0,s.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:["El club retiene todo lo pagado: ",(0,n.xG)(en),". Se crea un d\xe9bito de penalizaci\xf3n."]}),en<et.montoTotal&&(0,s.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:["⚠️ Total reserva: ",(0,n.xG)(et.montoTotal)," | Pagado: ",(0,n.xG)(en)]})]})]}),(0,s.jsxs)("label",{className:`flex items-start gap-3 p-3 border-2 rounded-lg transition-colors ${0===en?"opacity-50 cursor-not-allowed bg-slate-100":"cursor-pointer hover:bg-slate-50"}`,style:{borderColor:"TOTAL"===eo.refundType?"#16a34a":"#e2e8f0"},children:[s.jsx("input",{type:"radio",name:"refundType",value:"TOTAL",checked:"TOTAL"===eo.refundType,onChange:e=>el(e=>({...e,refundType:"TOTAL",refundAmount:"",penaltyAmount:""})),disabled:0===en,className:"mt-1 w-4 h-4 text-green-600 disabled:opacity-50"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-slate-900",children:"Reembolso Total"}),s.jsx("p",{className:"text-xs text-slate-600 mt-1",children:0===en?"❌ No disponible: No hay pagos registrados":`Se devuelve todo lo pagado: ${(0,n.xG)(en)} al socio. El club no retiene nada.`}),en>0&&en<et.montoTotal&&(0,s.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:["⚠️ Total reserva: ",(0,n.xG)(et.montoTotal)," | Pagado: ",(0,n.xG)(en)]})]})]}),(0,s.jsxs)("label",{className:`flex items-start gap-3 p-3 border-2 rounded-lg transition-colors ${0===en?"opacity-50 cursor-not-allowed bg-slate-100":"cursor-pointer hover:bg-slate-50"}`,style:{borderColor:"PARCIAL"===eo.refundType?"#2563eb":"#e2e8f0"},children:[s.jsx("input",{type:"radio",name:"refundType",value:"PARCIAL",checked:"PARCIAL"===eo.refundType,onChange:e=>el(e=>({...e,refundType:"PARCIAL"})),disabled:0===en,className:"mt-1 w-4 h-4 text-blue-600 disabled:opacity-50"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-slate-900",children:"Reembolso Parcial"}),s.jsx("p",{className:"text-xs text-slate-600 mt-1",children:0===en?"❌ No disponible: No hay pagos registrados":"Se devuelve una parte al socio y el club retiene el resto como penalizaci\xf3n."}),"PARCIAL"===eo.refundType&&(0,s.jsxs)("div",{className:"mt-3 space-y-3 pl-3 border-l-2 border-blue-300",children:[0===en&&s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-2 text-xs text-amber-800",children:"⚠️ No hay pagos registrados. No se puede hacer reembolso parcial."}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Monto a Reembolsar (Gs.)"}),s.jsx("input",{type:"text",value:eo.refundAmount,onChange:e=>{let t=e.target.value.replace(/\D/g,""),a=en-parseInt(t||"0");el(e=>({...e,refundAmount:t,penaltyAmount:a.toString()}))},placeholder:"0",className:"w-full px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Penalizaci\xf3n / Club Retiene (Gs.)"}),s.jsx("input",{type:"text",value:eo.penaltyAmount,onChange:e=>{let t=e.target.value.replace(/\D/g,""),a=en-parseInt(t||"0");el(e=>({...e,penaltyAmount:t,refundAmount:a.toString()}))},placeholder:"0",className:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 text-sm"})]}),(0,s.jsxs)("div",{className:"bg-blue-50 rounded p-2 text-xs text-blue-800",children:[s.jsx("strong",{children:"Total:"})," ",(0,n.xG)(parseInt(eo.refundAmount||"0")+parseInt(eo.penaltyAmount||"0")),(0,s.jsxs)("span",{className:"text-blue-600 ml-2",children:["(debe ser igual a ",(0,n.xG)(en),")"]})]}),en<et.montoTotal&&(0,s.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded p-2 text-xs text-amber-700",children:["ℹ️ ",s.jsx("strong",{children:"Nota:"})," Total reserva: ",(0,n.xG)(et.montoTotal)," | Total pagado: ",(0,n.xG)(en)]})]})]})]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t bg-slate-50",children:[s.jsx("button",{onClick:eZ,disabled:es,className:"px-4 py-2 text-slate-600 hover:text-slate-800 hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),s.jsx("button",{onClick:eQ,disabled:es||!eo.cancelReason.trim(),className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:es?"Procesando...":"✅ Confirmar Cancelaci\xf3n"})]})]})})]})})})}},60068:(e,t,a)=>{"use strict";a.d(t,{D2:()=>s,LJ:()=>o,_4:()=>l,tF:()=>r});let s={name:"America/Asuncion",offsetHours:-3,description:"Paraguay (UTC-3)"};function r(){let e=new Date,t=Object.fromEntries(new Intl.DateTimeFormat("en-CA",{timeZone:s.name,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(e).map(e=>[e.type,e.value]));return new Date(parseInt(t.year),parseInt(t.month)-1,parseInt(t.day),parseInt(t.hour),parseInt(t.minute),parseInt(t.second))}function o(e){if(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${s}`}{let e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:s.name,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}function l(e,t=!1){let a;if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[t,s,r]=e.split("-").map(Number);a=new Date(t,s-1,r)}else a=new Date(e)}else a=e;if(t)return a.toLocaleString("es-PY",{timeZone:s.name,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});if(!("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)))return a.toLocaleDateString("es-PY",{timeZone:s.name,day:"2-digit",month:"2-digit",year:"numeric"});{let[t,a,s]=e.split("-");return`${s.padStart(2,"0")}/${a.padStart(2,"0")}/${t}`}}},77863:(e,t,a)=>{"use strict";a.d(t,{Fw:()=>l,Ji:()=>n,m9:()=>i,p6:()=>o,sQ:()=>d,sU:()=>c,xG:()=>r});var s=a(60068);function r(e){return new Intl.NumberFormat("es-PY",{style:"currency",currency:"PYG",minimumFractionDigits:0}).format(e)}function o(e){return(0,s._4)(e,!1)}function l(e){let t=(0,s.tF)(),a=new Date(new Date(e).getTime()+108e5),r=t.getUTCFullYear()-a.getUTCFullYear(),o=t.getUTCMonth()-a.getUTCMonth();return(o<0||0===o&&t.getUTCDate()<a.getUTCDate())&&r--,r}function n(){return(0,s.LJ)()}function i(e){let t=e.replace(/\D/g,"");return t?t.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""}function c(e){return parseInt(e.replace(/\./g,""))||0}function d(e){return Math.round(e)}},63685:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},94019:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(76557).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},33486:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(68570).createProxy)(String.raw`C:\Garden\app\admin\reservas\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[8948,4471,6837,8750],()=>a(15945));module.exports=s})();